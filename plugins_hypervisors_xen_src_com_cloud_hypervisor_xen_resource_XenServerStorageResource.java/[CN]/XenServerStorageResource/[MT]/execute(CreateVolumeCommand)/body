{
  VolumeTO volume=null;
  PrimaryDataStoreTO primaryDataStore=volume.getDataStore();
  Connection conn=hypervisorResource.getConnection();
  VDI vdi=null;
  boolean result=false;
  String errorMsg=null;
  try {
    SR primaryDataStoreSR=getSRByNameLabel(conn,primaryDataStore.getUuid());
    vdi=createVdi(conn,volume.getName(),primaryDataStoreSR,volume.getSize());
    VDI.Record record=vdi.getRecord(conn);
    result=true;
    return new CreateVolumeAnswer(cmd,record.uuid);
  }
 catch (  BadServerResponse e) {
    s_logger.debug("Failed to create volume",e);
    errorMsg=e.toString();
  }
catch (  XenAPIException e) {
    s_logger.debug("Failed to create volume",e);
    errorMsg=e.toString();
  }
catch (  XmlRpcException e) {
    s_logger.debug("Failed to create volume",e);
    errorMsg=e.toString();
  }
 finally {
    if (!result && vdi != null) {
      try {
        deleteVDI(conn,vdi);
      }
 catch (      Exception e) {
        s_logger.debug("Faled to delete vdi: " + vdi.toString());
      }
    }
  }
  return new CreateVolumeAnswer(cmd,false,errorMsg);
}
