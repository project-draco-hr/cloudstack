{
  String uriString=cmd.getObjectUri();
  Map<String,String> params=null;
  try {
    URI uri=new URI(uriString);
    params=getParameters(uri);
  }
 catch (  URISyntaxException e1) {
    s_logger.debug("uri exception",e1);
    return new CreateObjectAnswer(cmd,false,e1.toString());
  }
  if (params.get("objType").equalsIgnoreCase("template")) {
    return getTemplateSize(cmd,params.get("path"));
  }
  long size=Long.parseLong(params.get("size"));
  String name=params.get("name");
  String storeUuid=params.get("storagePath");
  Connection conn=hypervisorResource.getConnection();
  VDI vdi=null;
  boolean result=false;
  String errorMsg=null;
  try {
    SR primaryDataStoreSR=getSRByNameLabel(conn,storeUuid);
    vdi=createVdi(conn,name,primaryDataStoreSR,size);
    VDI.Record record=vdi.getRecord(conn);
    result=true;
    return new CreateObjectAnswer(cmd,record.uuid,record.virtualSize);
  }
 catch (  BadServerResponse e) {
    s_logger.debug("Failed to create volume",e);
    errorMsg=e.toString();
  }
catch (  XenAPIException e) {
    s_logger.debug("Failed to create volume",e);
    errorMsg=e.toString();
  }
catch (  XmlRpcException e) {
    s_logger.debug("Failed to create volume",e);
    errorMsg=e.toString();
  }
 finally {
    if (!result && vdi != null) {
      try {
        deleteVDI(conn,vdi);
      }
 catch (      Exception e) {
        s_logger.debug("Faled to delete vdi: " + vdi.toString());
      }
    }
  }
  return new CreateObjectAnswer(cmd,false,errorMsg);
}
