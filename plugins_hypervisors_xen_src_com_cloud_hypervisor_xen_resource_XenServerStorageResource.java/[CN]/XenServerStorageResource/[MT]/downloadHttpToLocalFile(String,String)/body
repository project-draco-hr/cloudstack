{
  File destFile=new File(destFilePath);
  if (!destFile.exists()) {
    throw new CloudRuntimeException("dest file doesn't exist: " + destFilePath);
  }
  DefaultHttpClient client=new DefaultHttpClient();
  HttpGet getMethod=new HttpGet(url);
  HttpResponse response;
  BufferedOutputStream output=null;
  long length=0;
  try {
    response=client.execute(getMethod);
    HttpEntity entity=response.getEntity();
    length=entity.getContentLength();
    output=new BufferedOutputStream(new FileOutputStream(destFile));
    entity.writeTo(output);
  }
 catch (  ClientProtocolException e) {
    throw new CloudRuntimeException("Failed to download template",e);
  }
catch (  IOException e) {
    throw new CloudRuntimeException("Failed to download template",e);
  }
 finally {
    if (output != null) {
      try {
        output.close();
      }
 catch (      IOException e) {
        throw new CloudRuntimeException("Failed to download template",e);
      }
    }
  }
  destFile=new File(destFilePath);
  if (destFile.length() != length) {
    throw new CloudRuntimeException("Download file length doesn't match: expected: " + length + ", actual: "+ destFile.length());
  }
}
