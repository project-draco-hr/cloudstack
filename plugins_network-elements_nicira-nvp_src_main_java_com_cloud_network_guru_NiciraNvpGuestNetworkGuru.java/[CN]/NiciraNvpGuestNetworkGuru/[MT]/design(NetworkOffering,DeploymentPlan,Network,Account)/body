{
  final PhysicalNetworkVO physnet=physicalNetworkDao.findById(plan.getPhysicalNetworkId());
  final DataCenter dc=_dcDao.findById(plan.getDataCenterId());
  if (!canHandle(offering,dc.getNetworkType(),physnet)) {
    s_logger.debug("Refusing to design this network");
    return null;
  }
  final List<NiciraNvpDeviceVO> devices=niciraNvpDao.listByPhysicalNetwork(physnet.getId());
  if (devices.isEmpty()) {
    s_logger.error("No NiciraNvp Controller on physical network " + physnet.getName());
    return null;
  }
  s_logger.debug("Nicira Nvp " + devices.get(0).getUuid() + " found on physical network "+ physnet.getId());
  s_logger.debug("Physical isolation type is supported, asking GuestNetworkGuru to design this network");
  final NetworkVO networkObject=(NetworkVO)super.design(offering,plan,userSpecified,owner);
  if (networkObject == null) {
    return null;
  }
  networkObject.setBroadcastDomainType(BroadcastDomainType.Lswitch);
  return networkObject;
}
