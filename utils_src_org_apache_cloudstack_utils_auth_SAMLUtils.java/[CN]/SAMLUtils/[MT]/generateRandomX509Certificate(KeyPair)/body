{
  Date referenceDate=new Date();
  Calendar validityBeginDate=Calendar.getInstance();
  validityBeginDate.setTime(referenceDate);
  validityBeginDate.add(Calendar.DAY_OF_YEAR,-1);
  Calendar validityEndDate=Calendar.getInstance();
  validityEndDate.setTime(referenceDate);
  validityEndDate.add(Calendar.YEAR,3);
  X500Principal dnName=new X500Principal("CN=ApacheCloudStack");
  X509V1CertificateGenerator certGen=new X509V1CertificateGenerator();
  certGen.setSerialNumber(BigInteger.valueOf(System.currentTimeMillis()));
  certGen.setSubjectDN(dnName);
  certGen.setIssuerDN(dnName);
  certGen.setNotBefore(validityBeginDate.getTime());
  certGen.setNotAfter(validityEndDate.getTime());
  certGen.setPublicKey(keyPair.getPublic());
  certGen.setSignatureAlgorithm("SHA256WithRSAEncryption");
  return certGen.generate(keyPair.getPrivate(),"BC");
}
