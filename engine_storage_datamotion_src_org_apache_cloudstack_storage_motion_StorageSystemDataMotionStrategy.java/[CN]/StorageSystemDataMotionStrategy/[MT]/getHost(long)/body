{
  StoragePoolVO storagePoolVO=_storagePoolDao.findById(dataStoreId);
  List<? extends Cluster> clusters=_mgr.searchForClusters(storagePoolVO.getDataCenterId(),new Long(0),Long.MAX_VALUE,HypervisorType.XenServer.toString());
  if (clusters == null) {
    throw new CloudRuntimeException("Unable to locate an applicable cluster");
  }
  for (  Cluster cluster : clusters) {
    if (cluster.getAllocationState() == AllocationState.Enabled) {
      List<HostVO> hosts=_hostDao.findByClusterId(cluster.getId());
      if (hosts != null) {
        for (        HostVO host : hosts) {
          if (host.getResourceState() == ResourceState.Enabled) {
            return host;
          }
        }
      }
    }
  }
  throw new CloudRuntimeException("Unable to locate an applicable cluster");
}
