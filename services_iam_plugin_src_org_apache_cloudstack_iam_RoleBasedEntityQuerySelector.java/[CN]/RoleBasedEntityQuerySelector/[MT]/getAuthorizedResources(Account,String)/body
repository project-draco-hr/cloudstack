{
  long accountId=caller.getAccountId();
  List<IAMPolicy> policies=_iamService.listAclPolicies(accountId);
  List<IAMGroup> groups=_iamService.listAclGroups(caller.getId());
  for (  IAMGroup group : groups) {
    List<IAMGroup> parentGroups=_iamService.listParentAclGroups(group.getId());
    for (    IAMGroup parentGroup : parentGroups) {
      policies.addAll(_iamService.listRecursiveAclPoliciesByGroup(parentGroup.getId()));
    }
  }
  List<Long> entityIds=new ArrayList<Long>();
  for (  IAMPolicy policy : policies) {
    List<IAMPolicyPermission> pp=_iamService.listPolicyPermissionsByScope(policy.getId(),action,PermissionScope.RESOURCE.toString());
    if (pp != null) {
      for (      IAMPolicyPermission p : pp) {
        if (p.getScopeId() != null) {
          entityIds.add(p.getScopeId());
        }
      }
    }
  }
  return entityIds;
}
