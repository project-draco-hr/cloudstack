{
  if (canHandle(config.getGuestType(),dest.getDataCenter())) {
    if (vm.getType() != VirtualMachine.Type.User) {
      return false;
    }
    @SuppressWarnings("unchecked") VirtualMachineProfile<UserVm> uservm=(VirtualMachineProfile<UserVm>)vm;
    DomainRouterVO router=_routerDao.findById(uservm.getVirtualMachine().getDomainRouterId());
    if (router != null) {
      State state=router.getState();
      if (state == State.Starting) {
        for (int i=0; i < 300; ) {
          try {
            Thread.sleep(2000);
          }
 catch (          Exception e) {
          }
          i+=2;
          state=router.getState();
          if (state != State.Starting) {
            break;
          }
        }
      }
      if (state != State.Running)       throw new ResourceUnavailableException("Virtual router is not available",Host.class,router.getHostId());
    }
    return _routerMgr.addVirtualMachineIntoNetwork(config,nic,uservm,dest,context,false) != null;
  }
 else {
    return false;
  }
}
