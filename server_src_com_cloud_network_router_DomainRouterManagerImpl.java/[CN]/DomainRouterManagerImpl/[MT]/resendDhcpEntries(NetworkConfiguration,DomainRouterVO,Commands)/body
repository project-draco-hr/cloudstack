{
  final List<UserVmVO> vms=_vmDao.listBy(router.getId(),State.Creating,State.Starting,State.Running,State.Stopping,State.Stopped,State.Migrating);
  Commands cmds=new Commands(OnError.Continue);
  for (  UserVmVO vm : vms) {
    if (vm.getGuestIpAddress() == null || vm.getGuestMacAddress() == null || vm.getHostName() == null)     continue;
    DhcpEntryCommand decmd=new DhcpEntryCommand(vm.getGuestMacAddress(),vm.getGuestIpAddress(),router.getPrivateIpAddress(),vm.getHostName());
    cmds.addCommand(decmd);
  }
  if (cmds.size() > 0) {
    try {
      _agentMgr.send(router.getHostId(),cmds);
    }
 catch (    final AgentUnavailableException e) {
      s_logger.warn("agent unavailable",e);
    }
catch (    final OperationTimedoutException e) {
      s_logger.warn("Timed Out",e);
    }
    Answer[] answers=cmds.getAnswers();
    if (answers == null) {
      return false;
    }
    int i=0;
    while (i < cmds.size()) {
      Answer ans=answers[i];
      i++;
      if ((ans != null) && (ans.getResult())) {
        continue;
      }
 else {
        return false;
      }
    }
  }
  return true;
}
