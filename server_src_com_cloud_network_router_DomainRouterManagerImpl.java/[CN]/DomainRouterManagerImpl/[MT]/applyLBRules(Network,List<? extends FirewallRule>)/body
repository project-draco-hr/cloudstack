{
  DomainRouterVO router=_routerDao.findByNetworkConfiguration(network.getId());
  Commands cmds=new Commands(OnError.Continue);
  LoadBalancerTO[] lbs=new LoadBalancerTO[rules.size()];
  int i=0;
  for (  FirewallRule fwRule : rules) {
    LoadBalancingRule rule=(LoadBalancingRule)fwRule;
    boolean revoked=(rule.getState().equals(FirewallRule.State.Revoke));
    String protocol=rule.getProtocol();
    String algorithm=rule.getAlgorithm();
    String srcIp=rule.getSourceIpAddress().addr();
    int srcPort=rule.getSourcePortStart();
    List<LbDestination> destinations=rule.getDestinations();
    LoadBalancerTO lb=new LoadBalancerTO(srcIp,srcPort,protocol,algorithm,revoked,false,destinations);
    lbs[i++]=lb;
  }
  LoadBalancerConfigCommand cmd=new LoadBalancerConfigCommand(lbs);
  cmd.setAccessDetail(RoutingCommand.ROUTER_IP,router.getPrivateIpAddress());
  cmd.setAccessDetail(RoutingCommand.ROUTER_NAME,router.getInstanceName());
  cmds.addCommand(cmd);
  return sendCommandsToRouter(router,cmds);
}
