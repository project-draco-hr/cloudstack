{
  DomainRouterVO router=_routerDao.findByNetworkConfiguration(network.getId());
  if (router == null) {
    router=_routerDao.findByNetworkConfigurationIncludingRemoved(network.getId());
    if (router != null && router.getState() == State.Destroyed && router.isRemoved()) {
      return true;
    }
    s_logger.warn("Unable to associate ip addresses, virtual router doesn't exist in the network " + network.getId());
    throw new ResourceUnavailableException("Unable to assign ip addresses");
  }
  if (router.getState() == State.Running || router.getState() == State.Starting) {
    Commands cmds=new Commands(OnError.Continue);
    cmds=getAssociateIPCommands(router,ipAddress,cmds,0);
    return sendCommandsToRouter(router,cmds);
  }
 else   if (router.getState() == State.Stopped || router.getState() == State.Stopping) {
    return true;
  }
 else {
    s_logger.warn("Unable to associate ip addresses, virtual router is not in the right state " + router.getState());
    throw new ResourceUnavailableException("Unable to assign ip addresses, domR is not in right state " + router.getState());
  }
}
