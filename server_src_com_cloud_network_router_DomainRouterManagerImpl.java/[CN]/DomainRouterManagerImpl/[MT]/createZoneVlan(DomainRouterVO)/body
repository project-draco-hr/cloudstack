{
  String zoneVlan=_dcDao.allocateVnet(router.getDataCenterId(),router.getAccountId());
  final DataCenterVO dc=_dcDao.findById(router.getDataCenterId());
  router.setZoneVlan(zoneVlan);
  router.setGuestZoneMacAddress(getRouterMacForZoneVlan(dc,zoneVlan));
  _routerDao.update(router.getId(),router);
  final CreateZoneVlanCommand cmdCreateZoneVlan=new CreateZoneVlanCommand(router);
  CreateZoneVlanAnswer answer=(CreateZoneVlanAnswer)_agentMgr.easySend(router.getHostId(),cmdCreateZoneVlan);
  if (!answer.getResult()) {
    s_logger.error("Unable to create zone vlan for router: " + router.getHostName() + " zoneVlan: "+ zoneVlan);
    return null;
  }
  return zoneVlan;
}
