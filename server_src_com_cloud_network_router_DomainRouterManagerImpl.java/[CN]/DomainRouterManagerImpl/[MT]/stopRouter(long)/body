{
  UserContext context=UserContext.current();
  Account account=context.getAccount();
  long accountId=context.getAccountId();
  long userId=context.getUserId();
  DomainRouterVO router=_routerDao.findById(routerId);
  if (router == null) {
    throw new PermissionDeniedException("Unable to stop router with id " + routerId + ". Permission denied.");
  }
  _accountMgr.checkAccess(account,router);
  long eventId=EventUtils.saveScheduledEvent(userId,accountId,EventTypes.EVENT_ROUTER_STOP,"stopping Router with Id: " + routerId);
  UserVO user=_userDao.findById(context.getUserId());
  try {
    if (!_itMgr.stop(router,user,account)) {
      return null;
    }
  }
 catch (  AgentUnavailableException e) {
    throw new ResourceUnavailableException("Unable to reach the server to stop the vm",e);
  }
catch (  OperationTimedoutException e) {
    throw new ResourceUnavailableException("Stop operation timed out",e);
  }
  return router;
}
