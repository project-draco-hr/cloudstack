{
  AccessType accessType=null;
  AclEntityType[] entityTypes=null;
  if (cmdClass != null) {
    BaseCmd cmdObj;
    try {
      cmdObj=(BaseCmd)cmdClass.newInstance();
      if (cmdObj instanceof BaseListCmd) {
        accessType=AccessType.ListEntry;
      }
    }
 catch (    Exception e) {
      throw new CloudRuntimeException(String.format("%s is claimed as an API command, but it cannot be instantiated",cmdClass.getName()));
    }
    APICommand at=cmdClass.getAnnotation(APICommand.class);
    entityTypes=at.entityType();
  }
  PermissionScope permissionScope=PermissionScope.ACCOUNT;
switch (role) {
case User:
    permissionScope=PermissionScope.ACCOUNT;
  break;
case Admin:
permissionScope=PermissionScope.ALL;
break;
case DomainAdmin:
permissionScope=PermissionScope.DOMAIN;
break;
case ResourceAdmin:
permissionScope=PermissionScope.DOMAIN;
break;
}
if (entityTypes == null || entityTypes.length == 0) {
_iamSrv.addAclPermissionToAclPolicy(new Long(role.ordinal()) + 1,null,permissionScope.toString(),new Long(-1),apiName,accessType.toString(),Permission.Allow);
}
 else {
for (AclEntityType entityType : entityTypes) {
_iamSrv.addAclPermissionToAclPolicy(new Long(role.ordinal()) + 1,entityType.toString(),permissionScope.toString(),new Long(-1),apiName,accessType.toString(),Permission.Allow);
}
}
}
