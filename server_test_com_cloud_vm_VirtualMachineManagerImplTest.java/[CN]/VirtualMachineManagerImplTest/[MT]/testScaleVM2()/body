{
  DeployDestination dest=new DeployDestination(null,null,null,_host);
  long l=1L;
  when(_vmInstanceDao.findById(anyLong())).thenReturn(_vmInstance);
  ServiceOfferingVO newServiceOffering=getSvcoffering(512);
  when(_hostDao.findById(_vmInstance.hostId)).thenReturn(hostVO);
  doReturn(1L).when(hostVO).getClusterId();
  when(_configServer.getConfigValue(Config.MemOverprovisioningFactor.key(),Config.ConfigurationParameterScope.cluster.toString(),1L)).thenReturn("1.0");
  when(_configServer.getConfigValue(Config.CPUOverprovisioningFactor.key(),Config.ConfigurationParameterScope.cluster.toString(),1L)).thenReturn("1.0");
  ScaleVmCommand reconfigureCmd=new ScaleVmCommand("myVmName",newServiceOffering.getCpu(),newServiceOffering.getSpeed(),newServiceOffering.getSpeed(),newServiceOffering.getRamSize(),newServiceOffering.getRamSize(),newServiceOffering.getLimitCpuUse());
  Answer answer=new ScaleVmAnswer(reconfigureCmd,true,"details");
  when(_agentMgr.send(2l,reconfigureCmd)).thenReturn(null);
  _vmMgr.reConfigureVm(_vmInstance,getSvcoffering(256),false);
}
