{
  VMInstanceVO vmInstance=_vmDao.findById(vm.getId());
  DataCenterVO dc=_dcDao.findById(vmInstance.getDataCenterId());
  if (dc.getNetworkType() == NetworkType.Basic) {
    List<NicVO> nics=_nicDao.listByVmId(vmInstance.getId());
    NetworkVO network=_networksDao.findById(nics.get(0).getNetworkId());
    final LinkedHashMap<Network,NicProfile> profiles=new LinkedHashMap<Network,NicProfile>();
    profiles.put(network,null);
    Transaction.executeWithException(new TransactionCallbackWithException<Object>(){
      @Override public Object doInTransaction(      TransactionStatus status) throws Exception {
        cleanupNics(vm);
        allocate(vm,profiles);
        return null;
      }
    }
,InsufficientCapacityException.class);
  }
  return true;
}
