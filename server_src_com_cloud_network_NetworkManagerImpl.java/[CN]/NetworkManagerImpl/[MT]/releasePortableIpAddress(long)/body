{
  Transaction txn=Transaction.currentTxn();
  GlobalLock portableIpLock=GlobalLock.getInternLock("PortablePublicIpRange");
  txn.start();
  try {
    portableIpLock.lock(5);
    IPAddressVO ip=_ipAddressDao.findById(addrId);
    PortableIpVO portableIp=_portableIpDao.findByIpAddress(ip.getAddress().addr());
    _portableIpDao.unassignIpAddress(portableIp.getId());
    VlanVO vlan=_vlanDao.findById(ip.getVlanId());
    _vlanDao.expunge(vlan.getId());
    _ipAddressDao.expunge(ip.getId());
    txn.commit();
  }
  finally {
    portableIpLock.releaseRef();
  }
}
