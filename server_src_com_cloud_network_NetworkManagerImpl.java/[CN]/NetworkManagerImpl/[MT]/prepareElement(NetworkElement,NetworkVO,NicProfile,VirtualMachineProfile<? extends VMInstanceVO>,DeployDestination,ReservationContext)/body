{
  element.prepare(network,profile,vmProfile,dest,context);
  if (vmProfile.getType() == Type.User && element.getProvider() != null) {
    if (_networkModel.areServicesSupportedInNetwork(network.getId(),Service.Dhcp) && _networkModel.isProviderSupportServiceInNetwork(network.getId(),Service.Dhcp,element.getProvider()) && element instanceof DhcpServiceProvider) {
      DhcpServiceProvider sp=(DhcpServiceProvider)element;
      if (!sp.configDhcpSupportForSubnet(network,profile,vmProfile,dest,context)) {
        return false;
      }
      sp.addDhcpEntry(network,profile,vmProfile,dest,context);
    }
    if (_networkModel.areServicesSupportedInNetwork(network.getId(),Service.UserData) && _networkModel.isProviderSupportServiceInNetwork(network.getId(),Service.UserData,element.getProvider()) && element instanceof UserDataServiceProvider) {
      UserDataServiceProvider sp=(UserDataServiceProvider)element;
      sp.addPasswordAndUserdata(network,profile,vmProfile,dest,context);
    }
  }
  return true;
}
