{
  Transaction txn=Transaction.currentTxn();
  Account owner=_accountMgr.getAccount(addr.getAccountId());
  long isSourceNat=(addr.isSourceNat()) ? 1 : 0;
  txn.start();
  _ipAddressDao.unassignIpAddress(addr.getId());
  if (owner.getAccountId() != Account.ACCOUNT_ID_SYSTEM) {
    UsageEventVO usageEvent=new UsageEventVO(EventTypes.EVENT_NET_IP_RELEASE,owner.getId(),addr.getDataCenterId(),addr.getId(),addr.getAddress().toString(),isSourceNat);
    _usageEventDao.persist(usageEvent);
  }
  _accountMgr.decrementResourceCount(owner.getId(),ResourceType.public_ip);
  txn.commit();
}
