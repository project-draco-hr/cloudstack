{
  VMInstanceVO vmInstance=_vmDao.findById(vm.getId());
  DataCenterVO dc=_dcDao.findById(vmInstance.getDataCenterId());
  if (dc.getNetworkType() == NetworkType.Basic) {
    List<NicVO> nics=_nicDao.listByVmId(vmInstance.getId());
    NetworkVO network=_networksDao.findById(nics.get(0).getNetworkId());
    LinkedHashMap<Network,NicProfile> profiles=new LinkedHashMap<Network,NicProfile>();
    profiles.put(network,null);
    Transaction txn=Transaction.currentTxn();
    txn.start();
    try {
      cleanupNics(vm);
      allocate(vm,profiles);
    }
  finally {
      txn.commit();
    }
  }
  return true;
}
