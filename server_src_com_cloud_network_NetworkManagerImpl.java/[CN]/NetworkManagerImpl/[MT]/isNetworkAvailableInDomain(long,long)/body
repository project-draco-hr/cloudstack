{
  Long networkDomainId=null;
  Network network=getNetwork(networkId);
  if (!network.getIsShared()) {
    s_logger.trace("Network id=" + networkId + " is not shared");
    return false;
  }
  if (network.isDomainSpecific() && network.getGuestType() == GuestIpType.Virtual && !_supportDomainLevelVirtualNetwork) {
    s_logger.trace("Network of Guest Virtual Domain specific type is not supported");
    return false;
  }
  List<NetworkDomainVO> networkDomainMap=_networkDomainDao.listDomainNetworkMapByNetworkId(networkId);
  if (networkDomainMap.isEmpty()) {
    s_logger.trace("Network id=" + networkId + " is shared, but not domain specific, assuming it's a zone wide network");
    return true;
  }
 else {
    networkDomainId=networkDomainMap.get(0).getDomainId();
  }
  if (domainId == networkDomainId.longValue()) {
    return true;
  }
  if (_allowSubdomainNetworkAccess && network.getGuestType() == GuestIpType.Direct) {
    Set<Long> parentDomains=_accountMgr.getDomainParentIds(domainId);
    if (parentDomains.contains(domainId)) {
      return true;
    }
  }
  return false;
}
