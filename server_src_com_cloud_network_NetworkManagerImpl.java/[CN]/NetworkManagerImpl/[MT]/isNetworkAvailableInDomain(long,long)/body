{
  Long networkDomainId=null;
  Network network=getNetwork(networkId);
  if (network.getType() != Network.Type.Shared) {
    s_logger.trace("Network id=" + networkId + " is not shared");
    return false;
  }
  List<NetworkDomainVO> networkDomainMap=_networkDomainDao.listDomainNetworkMapByNetworkId(networkId);
  if (networkDomainMap.isEmpty()) {
    s_logger.trace("Network id=" + networkId + " is shared, but not domain specific");
    return true;
  }
 else {
    networkDomainId=networkDomainMap.get(0).getDomainId();
  }
  if (domainId == networkDomainId.longValue()) {
    return true;
  }
  if (_allowSubdomainNetworkAccess) {
    Set<Long> parentDomains=_domainMgr.getDomainParentIds(domainId);
    if (parentDomains.contains(domainId)) {
      return true;
    }
  }
  return false;
}
