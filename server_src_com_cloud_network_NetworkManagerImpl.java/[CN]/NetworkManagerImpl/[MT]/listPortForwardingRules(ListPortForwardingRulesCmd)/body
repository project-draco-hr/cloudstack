{
  String ipAddress=cmd.getIpAddress();
  Account account=(Account)UserContext.current().getAccountObject();
  IPAddressVO ipAddressVO=_ipAddressDao.findById(ipAddress);
  if (ipAddressVO == null) {
    throw new InvalidParameterValueException("Unable to find IP address " + ipAddress);
  }
  Account addrOwner=_accountDao.findById(ipAddressVO.getAccountId());
  if ((account != null) && isAdmin(account.getType())) {
    if (ipAddressVO.getAccountId() != null) {
      if ((addrOwner != null) && !_domainDao.isChildDomain(account.getDomainId(),addrOwner.getDomainId())) {
        throw new PermissionDeniedException("Unable to list port forwarding rules for address " + ipAddress + ", permission denied for account "+ account.getId());
      }
    }
 else {
      throw new InvalidParameterValueException("Unable to list port forwarding rules for address " + ipAddress + ", address not in use.");
    }
  }
 else {
    if (account != null) {
      if ((ipAddressVO.getAccountId() == null) || (account.getId() != ipAddressVO.getAccountId().longValue())) {
        throw new PermissionDeniedException("Unable to list port forwarding rules for address " + ipAddress + ", permission denied for account "+ account.getId());
      }
    }
  }
  return _rulesDao.listIPForwarding(cmd.getIpAddress(),true);
}
