{
  Account owner=_accountMgr.getAccount(networkOwnerId);
  NetworkOfferingVO ntwkOff=_systemNetworks.get(NetworkOffering.SystemPrivateGatewayNetworkOffering);
  PhysicalNetwork pNtwk=_physicalNetworkDao.findById(physicalNetworkId);
  if (pNtwk == null) {
    InvalidParameterValueException ex=new InvalidParameterValueException("Unable to find a physical network" + " having the given id");
    ex.addProxyObject("physical_network",physicalNetworkId,"physicalNetworkId");
    throw ex;
  }
  if (!NetUtils.isValidIp(startIp)) {
    throw new InvalidParameterValueException("Invalid format for the startIp parameter");
  }
  if (endIp == null) {
    endIp=startIp;
  }
 else   if (!NetUtils.isValidIp(endIp)) {
    throw new InvalidParameterValueException("Invalid format for the endIp parameter");
  }
  String cidr=null;
  if (!NetUtils.isValidIp(gateway)) {
    throw new InvalidParameterValueException("Invalid gateway");
  }
  if (!NetUtils.isValidNetmask(netmask)) {
    throw new InvalidParameterValueException("Invalid netmask");
  }
  cidr=NetUtils.ipAndNetMaskToCidr(gateway,netmask);
  Transaction txn=Transaction.currentTxn();
  txn.start();
  Network privateNetwork=createGuestNetwork(ntwkOff.getId(),networkName,displayText,gateway,cidr,vlan,null,owner,null,pNtwk,pNtwk.getDataCenterId(),ACLType.Account,null,null);
  PrivateIpVO privateIp=new PrivateIpVO(startIp,privateNetwork.getId());
  _privateIpDao.persist(privateIp);
  txn.commit();
  s_logger.debug("Private network " + privateNetwork + " is created");
  return privateNetwork;
}
