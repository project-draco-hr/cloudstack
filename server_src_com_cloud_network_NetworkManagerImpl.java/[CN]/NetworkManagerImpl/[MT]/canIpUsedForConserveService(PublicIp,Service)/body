{
  Map<Service,Set<Provider>> serviceToProviders=getServiceProvidersMap(publicIp.getAssociatedWithNetworkId());
  List<PublicIp> ipList=new ArrayList<PublicIp>();
  ipList.add(publicIp);
  Map<PublicIp,Set<Service>> ipToServices=getIpToServices(ipList,false);
  Set<Service> services=ipToServices.get(publicIp);
  if (services == null || services.isEmpty()) {
    return true;
  }
  Provider oldProvider=(Provider)serviceToProviders.get((Service)services.toArray()[0]).toArray()[0];
  Provider newProvider=(Provider)serviceToProviders.get(service).toArray()[0];
  if (!oldProvider.equals(newProvider)) {
    throw new CloudRuntimeException("There would be multiply providers for IP " + publicIp.getAddress() + "!");
  }
  return true;
}
