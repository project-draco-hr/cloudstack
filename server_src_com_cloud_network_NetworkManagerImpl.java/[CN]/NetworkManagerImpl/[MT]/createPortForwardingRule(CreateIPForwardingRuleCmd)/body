{
  IPAddressVO ipAddress=_ipAddressDao.findById(cmd.getIpAddress());
  if (ipAddress == null) {
    throw new InvalidParameterValueException("Unable to create port forwarding rule on address " + ipAddress + ", invalid IP address specified.");
  }
  UserVmVO userVM=_vmDao.findById(cmd.getVirtualMachineId());
  if (userVM == null) {
    throw new InvalidParameterValueException("Unable to create port forwarding rule on address " + ipAddress + ", invalid virtual machine id specified ("+ cmd.getVirtualMachineId()+ ").");
  }
  if ((ipAddress.getAccountId() == null) || (ipAddress.getAccountId().longValue() != userVM.getAccountId())) {
    throw new InvalidParameterValueException("Unable to create port forwarding rule, IP address " + ipAddress + " owner is not the same as owner of virtual machine "+ userVM.toString());
  }
  if (ipAddress.getDataCenterId() != userVM.getDataCenterId()) {
    throw new InvalidParameterValueException("Unable to create port forwarding rule, IP address " + ipAddress + " is not in the same availability zone as virtual machine "+ userVM.toString());
  }
}
