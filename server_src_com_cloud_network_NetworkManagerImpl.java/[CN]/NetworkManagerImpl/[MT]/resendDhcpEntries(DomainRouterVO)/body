{
  final List<UserVmVO> vms=_vmDao.listBy(router.getId(),State.Creating,State.Starting,State.Running,State.Stopping,State.Stopped,State.Migrating);
  final List<Command> cmdList=new ArrayList<Command>();
  for (  UserVmVO vm : vms) {
    if (vm.getGuestIpAddress() == null || vm.getGuestMacAddress() == null || vm.getName() == null)     continue;
    DhcpEntryCommand decmd=new DhcpEntryCommand(vm.getGuestMacAddress(),vm.getGuestIpAddress(),router.getPrivateIpAddress(),vm.getName());
    cmdList.add(decmd);
  }
  if (cmdList.size() > 0) {
    final Command[] cmds=new Command[cmdList.size()];
    Answer[] answers=null;
    try {
      answers=_agentMgr.send(router.getHostId(),cmdList.toArray(cmds),false);
    }
 catch (    final AgentUnavailableException e) {
      s_logger.warn("agent unavailable",e);
    }
catch (    final OperationTimedoutException e) {
      s_logger.warn("Timed Out",e);
    }
    if (answers == null) {
      return false;
    }
    int i=0;
    while (i < cmdList.size()) {
      Answer ans=answers[i];
      i++;
      if ((ans != null) && (ans.getResult())) {
        continue;
      }
 else {
        return false;
      }
    }
  }
  return true;
}
