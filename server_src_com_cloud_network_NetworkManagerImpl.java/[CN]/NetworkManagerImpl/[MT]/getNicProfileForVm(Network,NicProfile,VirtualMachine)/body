{
  NicProfile nic=null;
  if (requested != null && requested.getBroadCastUri() != null) {
    String broadcastUri=requested.getBroadCastUri().toString();
    String ipAddress=requested.getIp4Address();
    NicVO nicVO=_nicDao.findByNetworkIdInstanceIdAndBroadcastUri(network.getId(),vm.getId(),broadcastUri);
    if (nicVO != null) {
      if (ipAddress == null || nicVO.getIp4Address().equals(ipAddress)) {
        nic=getNicProfile(vm,network.getId(),broadcastUri);
      }
    }
  }
 else {
    NicVO nicVO=_nicDao.findByInstanceIdAndNetworkId(network.getId(),vm.getId());
    if (nicVO != null) {
      nic=getNicProfile(vm,network.getId(),null);
    }
  }
  return nic;
}
