{
  List<NetworkVO> configs=_networkConfigDao.listBy(owner.getId(),offering.getId(),plan.getDataCenterId());
  if (configs.size() > 0) {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Found existing network configuration for offering " + offering + ": "+ configs.get(0));
    }
    return configs;
  }
  configs=new ArrayList<NetworkVO>();
  long related=-1;
  for (  NetworkGuru guru : _networkGurus) {
    Network config=guru.design(offering,plan,predefined,owner);
    if (config == null) {
      continue;
    }
    if (config.getId() != -1) {
      if (config instanceof NetworkVO) {
        configs.add((NetworkVO)config);
      }
 else {
        configs.add(_networkConfigDao.findById(config.getId()));
      }
      continue;
    }
    long id=_networkConfigDao.getNextInSequence(Long.class,"id");
    if (related == -1) {
      related=id;
    }
    NetworkVO vo=new NetworkVO(id,config,offering.getId(),plan.getDataCenterId(),guru.getName(),owner.getDomainId(),owner.getId(),related);
    configs.add(_networkConfigDao.persist(vo));
  }
  if (configs.size() < 1) {
    throw new CloudRuntimeException("Unable to convert network offering to network profile: " + offering.getId());
  }
  return configs;
}
