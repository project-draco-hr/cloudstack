{
  final IPAddressVO ipVO=_ipAddressDao.findById(rule.getPublicIpAddress());
  if (ipVO == null || ipVO.getAllocated() == null) {
    return false;
  }
  final DomainRouterVO router=_routerMgr.getRouter(ipVO.getAccountId(),ipVO.getDataCenterId());
  Long hostId=router.getHostId();
  if (router == null || router.getHostId() == null) {
    return true;
  }
  if (rule.isForwarding()) {
    return updatePortForwardingRule(rule,router,hostId,oldPrivateIP,oldPrivatePort);
  }
 else {
    final List<FirewallRuleVO> fwRules=_rulesDao.listIPForwarding(ipVO.getAccountId(),ipVO.getDataCenterId());
    return updateLoadBalancerRules(fwRules,router,hostId);
  }
}
