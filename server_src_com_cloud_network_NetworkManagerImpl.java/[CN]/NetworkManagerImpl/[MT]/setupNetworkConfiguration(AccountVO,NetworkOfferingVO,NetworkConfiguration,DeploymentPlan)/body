{
  List<NetworkConfigurationVO> configs=_networkProfileDao.listBy(owner.getId(),offering.getId(),plan.getDataCenterId());
  if (configs.size() > 0) {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Found existing network configuration for offering " + offering + ": "+ configs.get(0));
    }
    return configs.get(0);
  }
  for (  NetworkGuru guru : _networkGurus) {
    NetworkConfiguration profile=guru.design(offering,plan,predefined,owner);
    if (profile == null) {
      continue;
    }
    if (profile.getId() != null) {
      if (profile instanceof NetworkConfigurationVO) {
        return (NetworkConfigurationVO)profile;
      }
 else {
        return _networkProfileDao.findById(profile.getId());
      }
    }
    NetworkConfigurationVO vo=new NetworkConfigurationVO(profile,offering.getId(),plan.getDataCenterId(),guru.getName());
    return _networkProfileDao.persist(vo,owner.getId());
  }
  throw new CloudRuntimeException("Unable to convert network offering to network profile: " + offering.getId());
}
