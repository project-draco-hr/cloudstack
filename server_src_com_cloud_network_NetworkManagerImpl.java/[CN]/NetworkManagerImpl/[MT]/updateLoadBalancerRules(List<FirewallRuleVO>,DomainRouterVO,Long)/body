{
  for (  FirewallRuleVO rule : fwRules) {
    IPAddressVO ip=_ipAddressDao.findById(rule.getPublicIpAddress());
    VlanVO vlan=_vlanDao.findById(new Long(ip.getVlanDbId()));
    String vlanNetmask=vlan.getVlanNetmask();
    rule.setVlanNetmask(vlanNetmask);
  }
  final LoadBalancerConfigurator cfgrtr=new HAProxyConfigurator();
  final String[] cfg=cfgrtr.generateConfiguration(fwRules);
  final String[][] addRemoveRules=cfgrtr.generateFwRules(fwRules);
  final LoadBalancerCfgCommand cmd=new LoadBalancerCfgCommand(cfg,addRemoveRules,router.getInstanceName(),router.getPrivateIpAddress());
  final Answer ans=_agentMgr.easySend(hostId,cmd);
  if (ans == null) {
    return false;
  }
 else {
    return ans.getResult();
  }
}
