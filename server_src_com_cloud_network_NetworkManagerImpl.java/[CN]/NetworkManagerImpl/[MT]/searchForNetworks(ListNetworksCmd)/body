{
  Object id=cmd.getId();
  Object keyword=cmd.getKeyword();
  Long zoneId=cmd.getZoneId();
  Account account=UserContext.current().getAccount();
  Long domainId=cmd.getDomainId();
  String accountName=cmd.getAccountName();
  String type=cmd.getType();
  Boolean isSystem=cmd.getIsSystem();
  Long accountId=null;
  if (isSystem == null) {
    isSystem=false;
  }
  if (isAdmin(account.getType())) {
    if (domainId != null) {
      if ((account != null) && !_domainDao.isChildDomain(account.getDomainId(),domainId)) {
        throw new PermissionDeniedException("Invalid domain id (" + domainId + ") given, unable to list networks");
      }
      if (accountName != null) {
        account=_accountDao.findActiveAccount(accountName,domainId);
        if (account == null) {
          throw new InvalidParameterValueException("Unable to find account " + accountName + " in domain "+ domainId);
        }
        accountId=account.getId();
      }
    }
 else {
      accountId=account.getId();
    }
  }
 else {
    accountId=account.getId();
  }
  Filter searchFilter=new Filter(NetworkVO.class,"id",false,cmd.getStartIndex(),cmd.getPageSizeVal());
  SearchBuilder<NetworkVO> sb=_networksDao.createSearchBuilder();
  SearchBuilder<NetworkOfferingVO> networkOfferingSearch=_networkOfferingDao.createSearchBuilder();
  networkOfferingSearch.and("systemOnly",networkOfferingSearch.entity().isSystemOnly(),SearchCriteria.Op.EQ);
  if (isSystem) {
    networkOfferingSearch.and("trafficType",networkOfferingSearch.entity().getTrafficType(),SearchCriteria.Op.EQ);
  }
  sb.join("networkOfferingSearch",networkOfferingSearch,sb.entity().getNetworkOfferingId(),networkOfferingSearch.entity().getId(),JoinBuilder.JoinType.INNER);
  SearchBuilder<DataCenterVO> zoneSearch=_dcDao.createSearchBuilder();
  zoneSearch.and("networkType",zoneSearch.entity().getNetworkType(),SearchCriteria.Op.EQ);
  sb.join("zoneSearch",zoneSearch,sb.entity().getDataCenterId(),zoneSearch.entity().getId(),JoinBuilder.JoinType.INNER);
  SearchCriteria<NetworkVO> sc=sb.create();
  if (!isSystem) {
    sc.setJoinParameters("networkOfferingSearch","systemOnly",false);
  }
 else {
    sc.setJoinParameters("networkOfferingSearch","systemOnly",true);
    sc.setJoinParameters("networkOfferingSearch","trafficType",TrafficType.Public);
    sc.setJoinParameters("zoneSearch","networkType",NetworkType.Advanced.toString());
  }
  if (keyword != null) {
    SearchCriteria<NetworkVO> ssc=_networksDao.createSearchCriteria();
    ssc.addOr("name",SearchCriteria.Op.LIKE,"%" + keyword + "%");
    sc.addAnd("name",SearchCriteria.Op.SC,ssc);
  }
  if (id != null) {
    sc.addAnd("id",SearchCriteria.Op.EQ,id);
  }
  if (zoneId != null) {
    sc.addAnd("dataCenterId",SearchCriteria.Op.EQ,zoneId);
  }
  if (type != null) {
    sc.addAnd("guestType",SearchCriteria.Op.EQ,type);
  }
  SearchCriteria<NetworkVO> ssc=_networksDao.createSearchCriteria();
  ssc.addOr("accountId",SearchCriteria.Op.EQ,accountId);
  if (accountName == null && domainId == null) {
    ssc.addOr("accountId",SearchCriteria.Op.EQ,1L);
  }
  sc.addAnd("accountId",SearchCriteria.Op.SC,ssc);
  return _networksDao.search(sc,searchFilter);
}
