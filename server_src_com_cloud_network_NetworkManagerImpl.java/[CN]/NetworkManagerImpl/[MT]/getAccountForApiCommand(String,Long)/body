{
  Account account=UserContext.current().getAccount();
  if ((account == null) || isAdmin(account.getType())) {
    if (domainId != null) {
      if ((account != null) && !_domainDao.isChildDomain(account.getDomainId(),domainId)) {
        throw new PermissionDeniedException("Invalid domain id (" + domainId + ") given, , permission denied");
      }
      if (accountName != null) {
        Account userAccount=_accountDao.findActiveAccount(accountName,domainId);
        if (userAccount != null) {
          account=userAccount;
        }
 else {
          throw new PermissionDeniedException("Unable to find account " + accountName + " in domain "+ domainId+ ", permission denied");
        }
      }
    }
 else     if (account != null) {
      return account;
    }
 else {
      throw new InvalidParameterValueException("Account information is not specified.");
    }
  }
  return account;
}
