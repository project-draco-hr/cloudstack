{
  Account account=UserContext.current().getCaller();
  if (_accountMgr.isAdmin(account.getType())) {
    if (domainId != null) {
      if ((account != null) && !_domainDao.isChildDomain(account.getDomainId(),domainId)) {
        throw new PermissionDeniedException("Invalid domain id (" + domainId + ") given, , permission denied");
      }
      if (accountName != null) {
        Account userAccount=_accountMgr.getActiveAccountByName(accountName,domainId);
        if (userAccount != null) {
          account=userAccount;
        }
 else {
          throw new PermissionDeniedException("Unable to find account " + accountName + " in domain "+ domainId+ ", permission denied");
        }
      }
    }
 else {
      return account;
    }
  }
  return account;
}
