{
  Vpc vpc=_vpcMgr.getActiveVpc(vpcId);
  if (networkDomain == null) {
    networkDomain=vpc.getNetworkDomain();
  }
  if (vpc.getZoneId() != zoneId) {
    throw new InvalidParameterValueException("New network doesn't belong to vpc zone",null);
  }
  _vpcMgr.validateGuestNtkwForVpc(_configMgr.getNetworkOffering(ntwkOffId),cidr,networkDomain,owner,vpc,null,gateway);
  Network guestNetwork=createGuestNetwork(ntwkOffId,name,displayText,gateway,cidr,vlanId,networkDomain,owner,domainId,pNtwk,zoneId,aclType,subdomainAccess,vpcId);
  return guestNetwork;
}
