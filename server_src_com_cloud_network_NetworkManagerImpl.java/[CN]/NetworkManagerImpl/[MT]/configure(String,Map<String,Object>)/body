{
  _name=name;
  _executor=Executors.newScheduledThreadPool(1,new NamedThreadFactory("RouterMonitor"));
  final ComponentLocator locator=ComponentLocator.getCurrentLocator();
  final Map<String,String> configs=_configDao.getConfiguration("AgentManager",params);
  _routerRamSize=NumbersUtil.parseInt(configs.get("router.ram.size"),128);
  String value=configs.get("start.retry");
  _retry=NumbersUtil.parseInt(value,2);
  value=configs.get("router.stats.interval");
  _routerStatsInterval=NumbersUtil.parseInt(value,300);
  value=configs.get("router.cleanup.interval");
  _routerCleanupInterval=NumbersUtil.parseInt(value,3600);
  _domain=configs.get("domain");
  if (_domain == null) {
    _domain="foo.com";
  }
  _instance=configs.get("instance.name");
  if (_instance == null) {
    _instance="DEFAULT";
  }
  s_logger.info("Router configurations: " + "ramsize=" + _routerRamSize + "; templateId="+ _routerTemplateId);
  final UserStatisticsDao statsDao=locator.getDao(UserStatisticsDao.class);
  if (statsDao == null) {
    throw new ConfigurationException("Unable to get " + UserStatisticsDao.class.getName());
  }
  _agentMgr.registerForHostEvents(new SshKeysDistriMonitor(this,_hostDao,_configDao),true,false,false);
  _haMgr.registerHandler(VirtualMachine.Type.DomainRouter,this);
  boolean useLocalStorage=Boolean.parseBoolean(configs.get(Config.SystemVMUseLocalStorage.key()));
  String networkRateStr=_configDao.getValue("network.throttling.rate");
  String multicastRateStr=_configDao.getValue("multicast.throttling.rate");
  _networkRate=((networkRateStr == null) ? 200 : Integer.parseInt(networkRateStr));
  _multicastRate=((multicastRateStr == null) ? 10 : Integer.parseInt(multicastRateStr));
  _offering=new ServiceOfferingVO("Fake Offering For DomR",1,_routerRamSize,0,0,0,false,null,NetworkOffering.GuestIpType.Virtualized,useLocalStorage,true,null);
  _offering.setUniqueName("Cloud.Com-SoftwareRouter");
  _offering=_serviceOfferingDao.persistSystemServiceOffering(_offering);
  _template=_templateDao.findRoutingTemplate();
  if (_template == null) {
    s_logger.error("Unable to find system vm template.");
  }
 else {
    _routerTemplateId=_template.getId();
  }
  NetworkOfferingVO publicNetworkOffering=new NetworkOfferingVO(NetworkOfferingVO.SystemVmPublicNetwork,TrafficType.Public,null);
  publicNetworkOffering=_networkOfferingDao.persistSystemNetworkOffering(publicNetworkOffering);
  _systemNetworks.put(NetworkOfferingVO.SystemVmPublicNetwork,publicNetworkOffering);
  NetworkOfferingVO managementNetworkOffering=new NetworkOfferingVO(NetworkOfferingVO.SystemVmManagementNetwork,TrafficType.Management,null);
  managementNetworkOffering=_networkOfferingDao.persistSystemNetworkOffering(managementNetworkOffering);
  _systemNetworks.put(NetworkOfferingVO.SystemVmManagementNetwork,managementNetworkOffering);
  NetworkOfferingVO controlNetworkOffering=new NetworkOfferingVO(NetworkOfferingVO.SystemVmControlNetwork,TrafficType.Control,null);
  controlNetworkOffering=_networkOfferingDao.persistSystemNetworkOffering(controlNetworkOffering);
  _systemNetworks.put(NetworkOfferingVO.SystemVmControlNetwork,controlNetworkOffering);
  NetworkOfferingVO guestNetworkOffering=new NetworkOfferingVO(NetworkOfferingVO.SystemVmGuestNetwork,TrafficType.Guest,GuestIpType.Virtualized);
  guestNetworkOffering=_networkOfferingDao.persistSystemNetworkOffering(guestNetworkOffering);
  _systemNetworks.put(NetworkOfferingVO.SystemVmGuestNetwork,guestNetworkOffering);
  NetworkOfferingVO storageNetworkOffering=new NetworkOfferingVO(NetworkOfferingVO.SystemVmStorageNetwork,TrafficType.Storage,null);
  storageNetworkOffering=_networkOfferingDao.persistSystemNetworkOffering(storageNetworkOffering);
  _systemNetworks.put(NetworkOfferingVO.SystemVmGuestNetwork,storageNetworkOffering);
  s_logger.info("Network Manager is configured.");
  return true;
}
