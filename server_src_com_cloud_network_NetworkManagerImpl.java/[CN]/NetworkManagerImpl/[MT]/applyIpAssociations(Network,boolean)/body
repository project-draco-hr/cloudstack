{
  List<IPAddressVO> userIps=_ipAddressDao.listByNetwork(network.getId());
  boolean success=true;
  for (  NetworkElement element : _networkElements) {
    try {
      element.associate(network,userIps);
    }
 catch (    ResourceUnavailableException e) {
      success=false;
      if (!continueOnError) {
        throw e;
      }
 else {
        s_logger.debug("Resource is not available: " + element.getName(),e);
      }
    }
  }
  if (success) {
    for (    IPAddressVO addr : userIps) {
      if (addr.getState() == IpAddress.State.Allocating) {
        addr.setState(IpAddress.State.Allocated);
        _ipAddressDao.update(addr.getAddress(),addr);
      }
 else       if (addr.getState() == IpAddress.State.Releasing) {
        _ipAddressDao.unassignIpAddress(addr.getAddress());
      }
    }
  }
  return success;
}
