{
  Transaction txn=Transaction.currentTxn();
  NetworkConfigurationVO config=_networkConfigDao.acquire(configId);
  if (config == null) {
    throw new ConcurrentOperationException("Unable to acquire network configuration: " + configId);
  }
  try {
    NetworkGuru guru=_networkGurus.get(config.getGuruName());
    if (config.getState() == NetworkConfiguration.State.Implemented || config.getState() == NetworkConfiguration.State.Setup) {
      return new Pair<NetworkGuru,NetworkConfigurationVO>(guru,config);
    }
    NetworkConfiguration result=guru.implement(config,_networkOfferingDao.findById(config.getNetworkOfferingId()),dest);
    config.setCidr(result.getCidr());
    config.setBroadcastUri(result.getBroadcastUri());
    config.setGateway(result.getGateway());
    config.setDns(result.getDns());
    config.setMode(result.getMode());
    config.setState(NetworkConfiguration.State.Implemented);
    _networkConfigDao.update(configId,config);
    return new Pair<NetworkGuru,NetworkConfigurationVO>(guru,config);
  }
  finally {
    _networkConfigDao.release(configId);
  }
}
