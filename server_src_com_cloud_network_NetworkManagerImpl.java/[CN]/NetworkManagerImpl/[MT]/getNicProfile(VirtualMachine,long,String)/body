{
  NicVO nic=null;
  if (broadcastUri != null) {
    nic=_nicDao.findByNetworkIdInstanceIdAndBroadcastUri(networkId,vm.getId(),broadcastUri);
  }
 else {
    nic=_nicDao.findByInstanceIdAndNetworkId(networkId,vm.getId());
  }
  NetworkVO network=_networksDao.findById(networkId);
  Integer networkRate=getNetworkRate(network.getId(),vm.getId());
  NetworkGuru guru=AdapterBase.getAdapterByName(_networkGurus,network.getGuruName());
  NicProfile profile=new NicProfile(nic,network,nic.getBroadcastUri(),nic.getIsolationUri(),networkRate,isSecurityGroupSupportedInNetwork(network),getNetworkTag(vm.getHypervisorType(),network));
  guru.updateNicProfile(profile,network);
  return profile;
}
