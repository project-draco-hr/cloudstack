{
  SearchBuilder<IPAddressVO> ipAddressSB=_ipAddressDao.createSearchBuilder();
  ipAddressSB.and("accountId",ipAddressSB.entity().getAccountId(),SearchCriteria.Op.EQ);
  ipAddressSB.and("dataCenterId",ipAddressSB.entity().getDataCenterId(),SearchCriteria.Op.EQ);
  if (sourceNat != null) {
    ipAddressSB.and("sourceNat",ipAddressSB.entity().isSourceNat(),SearchCriteria.Op.EQ);
  }
  SearchBuilder<VlanVO> virtualNetworkVlanSB=_vlanDao.createSearchBuilder();
  virtualNetworkVlanSB.and("vlanType",virtualNetworkVlanSB.entity().getVlanType(),SearchCriteria.Op.EQ);
  ipAddressSB.join("virtualNetworkVlanSB",virtualNetworkVlanSB,ipAddressSB.entity().getVlanDbId(),virtualNetworkVlanSB.entity().getId(),JoinBuilder.JoinType.INNER);
  SearchCriteria<IPAddressVO> ipAddressSC=ipAddressSB.create();
  ipAddressSC.setParameters("accountId",accountId);
  ipAddressSC.setParameters("dataCenterId",dcId);
  if (sourceNat != null) {
    ipAddressSC.setParameters("sourceNat",sourceNat);
  }
  ipAddressSC.setJoinParameters("virtualNetworkVlanSB","vlanType",VlanType.VirtualNetwork);
  return _ipAddressDao.search(ipAddressSC,null);
}
