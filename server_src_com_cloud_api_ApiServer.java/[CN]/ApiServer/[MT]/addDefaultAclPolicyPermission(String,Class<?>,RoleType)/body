{
  boolean isReadCommand=false;
  AclEntityType[] entityTypes=null;
  if (cmdClass != null) {
    BaseCmd cmdObj;
    try {
      cmdObj=(BaseCmd)cmdClass.newInstance();
      if (cmdObj instanceof BaseListCmd) {
        isReadCommand=true;
      }
    }
 catch (    Exception e) {
      throw new CloudRuntimeException(String.format("%s is claimed as an API command, but it cannot be instantiated",cmdClass.getName()));
    }
    APICommand at=cmdClass.getAnnotation(APICommand.class);
    entityTypes=at.entityType();
  }
  AclPolicyPermissionVO apiPermission=null;
  PermissionScope permissionScope=PermissionScope.ACCOUNT;
switch (role) {
case User:
    permissionScope=PermissionScope.ACCOUNT;
  break;
case Admin:
permissionScope=PermissionScope.ALL;
break;
case DomainAdmin:
permissionScope=PermissionScope.DOMAIN;
break;
case ResourceAdmin:
permissionScope=PermissionScope.DOMAIN;
break;
}
if (entityTypes == null || entityTypes.length == 0) {
apiPermission=new AclPolicyPermissionVO(role.ordinal() + 1,apiName,null,null,permissionScope,new Long(-1),Permission.Allow);
if (apiPermission != null) {
if (isReadCommand) {
apiPermission.setAccessType(AccessType.ListEntry);
}
_aclPermissionDao.persist(apiPermission);
}
}
 else {
for (AclEntityType entityType : entityTypes) {
apiPermission=new AclPolicyPermissionVO(role.ordinal() + 1,apiName,entityType.toString(),null,permissionScope,new Long(-1),Permission.Allow);
if (apiPermission != null) {
if (isReadCommand) {
apiPermission.setAccessType(AccessType.ListEntry);
}
_aclPermissionDao.persist(apiPermission);
}
}
}
}
