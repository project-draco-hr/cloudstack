{
  boolean isReadCommand=false;
  if (cmdClass != null) {
    BaseCmd cmdObj;
    try {
      cmdObj=(BaseCmd)cmdClass.newInstance();
      if (cmdObj instanceof BaseListCmd) {
        isReadCommand=true;
      }
    }
 catch (    Exception e) {
      throw new CloudRuntimeException(String.format("%s is claimed as an API command, but it cannot be instantiated",cmdClass.getName()));
    }
  }
  AclPolicyPermissionVO apiPermission=null;
switch (role) {
case User:
    apiPermission=new AclPolicyPermissionVO(role.ordinal() + 1,apiName,null,null,PermissionScope.ACCOUNT,null,Permission.Allow);
  break;
case Admin:
apiPermission=new AclPolicyPermissionVO(role.ordinal() + 1,apiName,null,null,PermissionScope.ALL,null,Permission.Allow);
break;
case DomainAdmin:
apiPermission=new AclPolicyPermissionVO(role.ordinal() + 1,apiName,null,null,PermissionScope.DOMAIN,null,Permission.Allow);
break;
case ResourceAdmin:
apiPermission=new AclPolicyPermissionVO(role.ordinal() + 1,apiName,null,null,PermissionScope.DOMAIN,null,Permission.Allow);
break;
}
if (apiPermission != null) {
if (isReadCommand) {
apiPermission.setAccessType(AccessType.ListEntry);
}
_aclPermissionDao.persist(apiPermission);
}
}
