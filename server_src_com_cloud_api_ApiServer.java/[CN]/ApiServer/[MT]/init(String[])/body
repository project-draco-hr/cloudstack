{
  try {
    BaseCmd.setComponents(new ApiResponseHelper());
    BaseListCmd.configure();
    _apiCommands=new Properties();
    Properties preProcessedCommands=new Properties();
    if (apiConfig != null) {
      for (      String configFile : apiConfig) {
        File commandsFile=PropertiesUtil.findConfigFile(configFile);
        preProcessedCommands.load(new FileInputStream(commandsFile));
      }
      for (      Object key : preProcessedCommands.keySet()) {
        String preProcessedCommand=preProcessedCommands.getProperty((String)key);
        String[] commandParts=preProcessedCommand.split(";");
        _apiCommands.put(key,commandParts[0]);
        if (commandParts.length > 1) {
          try {
            short cmdPermissions=Short.parseShort(commandParts[1]);
            if ((cmdPermissions & ADMIN_COMMAND) != 0) {
              s_adminCommands.add((String)key);
            }
            if ((cmdPermissions & DOMAIN_ADMIN_COMMAND) != 0) {
              s_resellerCommands.add((String)key);
            }
            if ((cmdPermissions & READ_ONLY_ADMIN_COMMAND) != 0) {
              s_readOnlyAdminCommands.add((String)key);
            }
            if ((cmdPermissions & USER_COMMAND) != 0) {
              s_userCommands.add((String)key);
            }
          }
 catch (          NumberFormatException nfe) {
            s_logger.info("Malformed command.properties permissions value, key = " + key + ", value = "+ preProcessedCommand);
          }
        }
      }
      s_allCommands.addAll(s_adminCommands);
      s_allCommands.addAll(s_readOnlyAdminCommands);
      s_allCommands.addAll(s_userCommands);
      s_allCommands.addAll(s_resellerCommands);
    }
  }
 catch (  FileNotFoundException fnfex) {
    s_logger.error("Unable to find properites file",fnfex);
  }
catch (  IOException ioex) {
    s_logger.error("Exception loading properties file",ioex);
  }
  _ms=(ManagementServer)ComponentLocator.getComponent(ManagementServer.Name);
  ComponentLocator locator=ComponentLocator.getLocator(ManagementServer.Name);
  _accountMgr=locator.getManager(AccountService.class);
  _asyncMgr=locator.getManager(AsyncJobManager.class);
  _systemAccount=_accountMgr.getSystemAccount();
  _systemUser=_accountMgr.getSystemUser();
  _dispatcher=ApiDispatcher.getInstance();
  int apiPort=8096;
  ConfigurationDao configDao=locator.getDao(ConfigurationDao.class);
  SearchCriteria<ConfigurationVO> sc=configDao.createSearchCriteria();
  sc.addAnd("name",SearchCriteria.Op.EQ,"integration.api.port");
  List<ConfigurationVO> values=configDao.search(sc,null);
  if ((values != null) && (values.size() > 0)) {
    ConfigurationVO apiPortConfig=values.get(0);
    apiPort=Integer.parseInt(apiPortConfig.getValue());
  }
  ListenerThread listenerThread=new ListenerThread(this,apiPort);
  listenerThread.start();
}
