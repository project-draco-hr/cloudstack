{
  BaseCmd.setComponents(new ApiResponseHelper());
  BaseListCmd.configure();
  _systemAccount=_accountMgr.getSystemAccount();
  _systemUser=_accountMgr.getSystemUser();
  _dispatcher=ApiDispatcher.getInstance();
  Integer apiPort=null;
  ComponentLocator locator=ComponentLocator.getLocator(ManagementServer.Name);
  ConfigurationDao configDao=locator.getDao(ConfigurationDao.class);
  SearchCriteria<ConfigurationVO> sc=configDao.createSearchCriteria();
  sc.addAnd("name",SearchCriteria.Op.EQ,"integration.api.port");
  List<ConfigurationVO> values=configDao.search(sc,null);
  if ((values != null) && (values.size() > 0)) {
    ConfigurationVO apiPortConfig=values.get(0);
    if (apiPortConfig.getValue() != null) {
      apiPort=Integer.parseInt(apiPortConfig.getValue());
    }
  }
  for (  ApiDiscoveryService discoveryService : _apiDiscoveryServices) {
    _apiNameCmdClassMap.putAll(discoveryService.getApiNameCmdClassMapping());
  }
  if (_apiNameCmdClassMap.size() == 0) {
    s_logger.fatal("ApiServer failed to generate apiname, cmd class mappings." + "Please check and enable at least one ApiDiscovery adapter.");
  }
  encodeApiResponse=Boolean.valueOf(configDao.getValue(Config.EncodeApiResponse.key()));
  String jsonType=configDao.getValue(Config.JavaScriptDefaultContentType.key());
  if (jsonType != null) {
    jsonContentType=jsonType;
  }
  apiThrottlingEnabled=Boolean.valueOf(configDao.getValue(Config.ApiLimitEnabled.key()));
  if (apiPort != null) {
    ListenerThread listenerThread=new ListenerThread(this,apiPort);
    listenerThread.start();
  }
}
