{
  MockVMVO vm=_mockVmDao.findByVmName(cmd.getVmName());
  if (vm == null) {
    return new SecurityIngressRuleAnswer(cmd,false,"cant' find the vm: " + cmd.getVmName());
  }
  boolean update=logSecurityGroupAction(cmd);
  MockSecurityRulesVO rules=_mockSecurityDao.findByVmId(cmd.getVmId());
  if (rules == null) {
    rules=new MockSecurityRulesVO();
    rules.setRuleSet(cmd.stringifyRules());
    rules.setSeqNum(cmd.getSeqNum());
    rules.setSignature(cmd.getSignature());
    rules.setVmId(vm.getId());
    rules.setHostId(vm.getHostId());
    _mockSecurityDao.persist(rules);
  }
 else   if (update) {
    rules.setSeqNum(cmd.getSeqNum());
    rules.setSignature(cmd.getSignature());
    rules.setRuleSet(cmd.stringifyRules());
    rules.setVmId(cmd.getVmId());
    rules.setHostId(vm.getHostId());
    _mockSecurityDao.update(rules.getId(),rules);
  }
  return new SecurityIngressRuleAnswer(cmd);
}
