{
  Transaction txn=Transaction.open(Transaction.SIMULATOR_DB);
  try {
    txn.start();
    List<MockSecurityRulesVO> rules=_mockSecurityDao.findByHost(info.getHostUuid());
    for (    MockSecurityRulesVO rule : rules) {
      MockVMVO vm=_mockVmDao.findByVmNameAndHost(rule.getVmName(),info.getHostUuid());
      if (vm == null) {
        _mockSecurityDao.remove(rule.getId());
      }
    }
    txn.commit();
    return new Answer(cmd);
  }
 catch (  Exception ex) {
    txn.rollback();
    throw new CloudRuntimeException("unable to clean up rules",ex);
  }
 finally {
    txn.close();
    txn=Transaction.open(Transaction.CLOUD_DB);
    txn.close();
  }
}
