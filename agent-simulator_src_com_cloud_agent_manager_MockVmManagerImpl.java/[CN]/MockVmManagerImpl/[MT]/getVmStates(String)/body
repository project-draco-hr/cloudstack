{
  Transaction txn=Transaction.open(Transaction.SIMULATOR_DB);
  try {
    txn.start();
    Map<String,State> states=new HashMap<String,State>();
    List<MockVMVO> vms=_mockVmDao.findByHostGuid(hostGuid);
    if (vms.isEmpty()) {
      txn.commit();
      return states;
    }
    for (    MockVm vm : vms) {
      states.put(vm.getName(),vm.getState());
    }
    txn.commit();
    return states;
  }
 catch (  Exception ex) {
    txn.rollback();
    throw new CloudRuntimeException("unable to fetch vms  from host " + hostGuid,ex);
  }
 finally {
    txn.close();
    txn=Transaction.open(Transaction.CLOUD_DB);
    txn.close();
  }
}
