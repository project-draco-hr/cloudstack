{
  QueryBuilder<HostVO> hq=QueryBuilder.create(HostVO.class);
  hq.and(hq.entity().getPrivateMacAddress(),SearchCriteria.Op.EQ,cmd.getMac());
  HostVO host=hq.find();
  if (host == null) {
    throw new CloudRuntimeException(String.format("cannot find host[mac:%s]",cmd.getMac()));
  }
  _hostDao.loadDetails(host);
  String vmName=host.getDetail("vmName");
  if (vmName == null) {
    throw new CloudRuntimeException(String.format("cannot find any baremetal instance running on host[mac:%s]",cmd.getMac()));
  }
  QueryBuilder<VMInstanceVO> vmq=QueryBuilder.create(VMInstanceVO.class);
  vmq.and(vmq.entity().getInstanceName(),SearchCriteria.Op.EQ,vmName);
  VMInstanceVO vm=vmq.find();
  if (vm == null) {
    throw new CloudRuntimeException(String.format("cannot find baremetal instance[name:%s]",vmName));
  }
  if (State.Starting != vm.getState()) {
    throw new CloudRuntimeException(String.format("baremetal instance[name:%s, state:%s] is not in state of Starting",vmName,vm.getState()));
  }
  vm.setState(State.Running);
  vm.setLastHostId(vm.getHostId());
  vmDao.update(vm.getId(),vm);
  logger.debug(String.format("received baremetal provision done notification for vm[id:%s name:%s] running on host[mac:%s, ip:%s]",vm.getId(),vm.getInstanceName(),host.getPrivateMacAddress(),host.getPrivateIpAddress()));
}
