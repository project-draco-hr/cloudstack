{
  String alertType=(String)params.get(BaseCmd.Properties.TYPE.getName());
  String keyword=(String)params.get(BaseCmd.Properties.KEYWORD.getName());
  Integer page=(Integer)params.get(BaseCmd.Properties.PAGE.getName());
  Integer pageSize=(Integer)params.get(BaseCmd.Properties.PAGESIZE.getName());
  Long startIndex=Long.valueOf(0);
  int pageSizeNum=50;
  if (pageSize != null) {
    pageSizeNum=pageSize.intValue();
  }
  if (page != null) {
    int pageNum=page.intValue();
    if (pageNum > 0) {
      startIndex=Long.valueOf(pageSizeNum * (pageNum - 1));
    }
  }
  Criteria c=new Criteria("lastSent",Boolean.FALSE,startIndex,Long.valueOf(pageSizeNum));
  c.addCriteria(Criteria.KEYWORD,keyword);
  if (keyword == null)   c.addCriteria(Criteria.TYPE,alertType);
  List<AlertVO> alerts=getManagementServer().searchForAlerts(c);
  if (alerts == null) {
    throw new ServerApiException(BaseCmd.INTERNAL_ERROR,"unable to find alerts");
  }
  List<Pair<String,Object>> alertsTags=new ArrayList<Pair<String,Object>>();
  Object[] aTag=new Object[alerts.size()];
  int i=0;
  for (  AlertVO alert : alerts) {
    List<Pair<String,Object>> alertData=new ArrayList<Pair<String,Object>>();
    alertData.add(new Pair<String,Object>(BaseCmd.Properties.TYPE.getName(),alert.getType()));
    alertData.add(new Pair<String,Object>(BaseCmd.Properties.DESCRIPTION.getName(),alert.getSubject()));
    alertData.add(new Pair<String,Object>(BaseCmd.Properties.SENT.getName(),alert.getLastSent()));
    aTag[i++]=alertData;
  }
  Pair<String,Object> alertTag=new Pair<String,Object>("alert",aTag);
  alertsTags.add(alertTag);
  return alertsTags;
}
