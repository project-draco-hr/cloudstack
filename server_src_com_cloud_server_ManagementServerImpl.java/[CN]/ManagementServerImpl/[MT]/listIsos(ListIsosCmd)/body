{
  TemplateFilter isoFilter=TemplateFilter.valueOf(cmd.getIsoFilter());
  Long accountId=null;
  Account account=UserContext.current().getAccount();
  Long domainId=cmd.getDomainId();
  String accountName=cmd.getAccountName();
  if ((account == null) || (account.getType() == Account.ACCOUNT_TYPE_ADMIN)) {
    if ((domainId != null) && (accountName != null)) {
      if ((account != null) && !_domainDao.isChildDomain(account.getDomainId(),domainId)) {
        throw new InvalidParameterValueException("Invalid domain id (" + domainId + ") given, unable to list events.");
      }
      Account userAccount=_accountDao.findActiveAccount(accountName,domainId);
      if (userAccount != null) {
        accountId=userAccount.getId();
      }
 else {
        throw new InvalidParameterValueException("Failed to list ISOs.  Unable to find account " + accountName + " in domain "+ domainId);
      }
    }
 else     if (account != null) {
      accountId=account.getId();
    }
  }
 else {
    accountId=account.getId();
  }
  boolean isAccountSpecific=(account == null || isAdmin(account.getType())) && (accountName != null) && (domainId != null);
  HypervisorType hypervisorType=HypervisorType.getType(cmd.getHypervisor());
  return listTemplates(cmd.getId(),cmd.getIsoName(),cmd.getKeyword(),isoFilter,true,cmd.isBootable(),accountId,cmd.getPageSizeVal(),cmd.getStartIndex(),cmd.getZoneId(),hypervisorType,isAccountSpecific,true);
}
