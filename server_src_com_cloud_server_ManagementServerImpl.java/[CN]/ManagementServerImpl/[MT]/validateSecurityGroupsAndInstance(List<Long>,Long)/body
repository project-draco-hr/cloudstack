{
  if ((securityGroupIds == null) || securityGroupIds.isEmpty() || (instanceId == null)) {
    return null;
  }
  List<SecurityGroupVO> securityGroups=new ArrayList<SecurityGroupVO>();
  for (  Long securityGroupId : securityGroupIds) {
    if (securityGroupId.longValue() == 0) {
      continue;
    }
    SecurityGroupVO securityGroup=_securityGroupDao.findById(securityGroupId);
    if (securityGroup == null) {
      return null;
    }
    securityGroups.add(securityGroup);
  }
  UserVm userVm=_userVmDao.findById(instanceId);
  if (userVm == null) {
    return null;
  }
  long accountId=userVm.getAccountId();
  for (  SecurityGroupVO securityGroup : securityGroups) {
    Long sgAccountId=securityGroup.getAccountId();
    if ((sgAccountId != null) && (sgAccountId.longValue() != accountId)) {
      return null;
    }
  }
  return Long.valueOf(accountId);
}
