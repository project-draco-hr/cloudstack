{
  boolean success=true;
{
    SearchCriteria<DomainVO> sc=_domainDao.createSearchCriteria();
    sc.addAnd("parent",SearchCriteria.Op.EQ,domainId);
    List<DomainVO> domains=_domainDao.search(sc,null);
    for (    DomainVO domain : domains) {
      success=(success && cleanupDomain(domain.getId(),domain.getOwner()));
    }
  }
{
    SearchCriteria<AccountVO> sc=_accountDao.createSearchCriteria();
    sc.addAnd("domainId",SearchCriteria.Op.EQ,domainId);
    List<AccountVO> accounts=_accountDao.search(sc,null);
    for (    AccountVO account : accounts) {
      SearchCriteria<UserVO> userSc=_userDao.createSearchCriteria();
      userSc.addAnd("accountId",SearchCriteria.Op.EQ,account.getId());
      List<UserVO> users=_userDao.search(userSc,null);
      for (      UserVO user : users) {
        success=(success && deleteUserInternal(user.getId()));
      }
    }
  }
  boolean deleteDomainSuccess=_domainDao.remove(domainId);
  if (!deleteDomainSuccess) {
    EventUtils.saveEvent(new Long(1),ownerId,EventVO.LEVEL_ERROR,EventTypes.EVENT_DOMAIN_DELETE,"Domain with id " + domainId + " was not deleted");
  }
 else {
    EventUtils.saveEvent(new Long(1),ownerId,EventVO.LEVEL_INFO,EventTypes.EVENT_DOMAIN_DELETE,"Domain with id " + domainId + " was deleted");
  }
  return success && deleteDomainSuccess;
}
