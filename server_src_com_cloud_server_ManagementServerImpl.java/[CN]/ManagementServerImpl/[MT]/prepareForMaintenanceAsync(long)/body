{
  HostVO host=_hostDao.findById(hostId);
  if (host == null) {
    s_logger.debug("Unable to find host " + hostId);
    throw new InvalidParameterValueException("Unable to find host with ID: " + hostId + ". Please specify a valid host ID.");
  }
  if (_hostDao.countBy(host.getClusterId(),Status.PrepareForMaintenance,Status.ErrorInMaintenance,Status.Maintenance) > 0) {
    throw new InvalidParameterValueException("There are other servers in maintenance mode.");
  }
  if (_storageMgr.isLocalStorageActiveOnHost(host)) {
    throw new InvalidParameterValueException("There are active VMs using the host's local storage pool. Please stop all VMs on this host that use local storage.");
  }
  Long param=new Long(hostId);
  Gson gson=GsonHelper.getBuilder().create();
  AsyncJobVO job=new AsyncJobVO();
  job.setUserId(UserContext.current().getUserId());
  job.setAccountId(Account.ACCOUNT_ID_SYSTEM);
  job.setCmd("PrepareMaintenance");
  job.setCmdInfo(gson.toJson(param));
  job.setCmdOriginator(PrepareForMaintenanceCmd.getResultObjectName());
  return _asyncMgr.submitAsyncJob(job);
}
