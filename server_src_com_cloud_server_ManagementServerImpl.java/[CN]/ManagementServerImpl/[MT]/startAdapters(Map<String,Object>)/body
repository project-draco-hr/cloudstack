{
  @SuppressWarnings("rawtypes") Map<String,Adapter> adapters=ComponentContext.getApplicationContext().getBeansOfType(Adapter.class);
  Map<String,Object> params=new HashMap<String,Object>();
  for (  Adapter adapter : adapters.values()) {
    try {
      s_logger.info("Start adapter: " + ComponentContext.getTargetClass(adapter).getName() + "...");
      if (avoidMap.get(ComponentContext.getTargetClass(adapter).getName()) != null) {
        s_logger.info("Skip adapter: " + ComponentContext.getTargetClass(adapter).getName() + " as it is already started");
        continue;
      }
      if (!adapter.configure(adapter.getName(),params)) {
        throw new CloudRuntimeException("Failed to configure adapter: " + ComponentContext.getTargetClass(adapter).getName());
      }
      if (!adapter.start()) {
        throw new CloudRuntimeException("Failed to start adapter: " + ComponentContext.getTargetClass(adapter).getName());
      }
      avoidMap.put(ComponentContext.getTargetClass(adapter).getName(),adapter);
      if (adapter instanceof ManagementBean) {
        registerMBean((ManagementBean)adapter);
      }
    }
 catch (    Exception e) {
      s_logger.error("Problems to start adapter:" + ComponentContext.getTargetClass(adapter).getName(),e);
      System.exit(1);
    }
  }
}
