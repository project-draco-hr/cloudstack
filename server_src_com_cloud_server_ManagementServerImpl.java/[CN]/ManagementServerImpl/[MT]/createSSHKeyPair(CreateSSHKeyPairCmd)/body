{
  final Account caller=getCaller();
  final String accountName=cmd.getAccountName();
  final Long domainId=cmd.getDomainId();
  final Long projectId=cmd.getProjectId();
  final Account owner=_accountMgr.finalizeOwner(caller,accountName,domainId,projectId);
  final SSHKeyPairVO s=_sshKeyPairDao.findByName(owner.getAccountId(),owner.getDomainId(),cmd.getName());
  if (s != null) {
    throw new InvalidParameterValueException("A key pair with name '" + cmd.getName() + "' already exists.");
  }
  final SSHKeysHelper keys=new SSHKeysHelper();
  final String name=cmd.getName();
  final String publicKey=keys.getPublicKey();
  final String fingerprint=keys.getPublicKeyFingerPrint();
  final String privateKey=keys.getPrivateKey();
  return createAndSaveSSHKeyPair(name,fingerprint,publicKey,privateKey,owner);
}
