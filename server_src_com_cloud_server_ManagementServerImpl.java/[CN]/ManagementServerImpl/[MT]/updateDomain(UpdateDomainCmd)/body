{
  Long domainId=cmd.getId();
  String domainName=cmd.getName();
  DomainVO domain=_domainDao.findById(domainId);
  if (domain == null) {
    throw new InvalidParameterValueException("Unable to find domain " + domainId);
  }
 else   if (domain.getParent() == null) {
    throw new InvalidParameterValueException("ROOT domain can not be edited");
  }
  Account account=(Account)UserContext.current().getAccountObject();
  if ((account != null) && !isChildDomain(account.getDomainId(),domain.getId())) {
    throw new PermissionDeniedException("Unable to update domain " + domainId + ", permission denied");
  }
  if (domainName == null) {
    domainName=domain.getName();
  }
  SearchCriteria<DomainVO> sc=_domainDao.createSearchCriteria();
  sc.addAnd("name",SearchCriteria.Op.EQ,domainName);
  List<DomainVO> domains=_domainDao.search(sc,null);
  if ((domains == null) || domains.isEmpty()) {
    _domainDao.update(domainId,domainName);
    domain=_domainDao.findById(domainId);
    EventUtils.saveEvent(new Long(1),domain.getOwner(),EventVO.LEVEL_INFO,EventTypes.EVENT_DOMAIN_UPDATE,"Domain, " + domainName + " was updated");
    return true;
  }
 else {
    domain=_domainDao.findById(domainId);
    EventUtils.saveEvent(new Long(1),domain.getOwner(),EventVO.LEVEL_ERROR,EventTypes.EVENT_DOMAIN_UPDATE,"Failed to update domain " + domain.getName() + " with name "+ domainName+ ", name in use.");
    return false;
  }
}
