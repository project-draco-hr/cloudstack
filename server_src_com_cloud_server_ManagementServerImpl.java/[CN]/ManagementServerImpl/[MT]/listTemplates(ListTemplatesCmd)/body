{
  TemplateFilter templateFilter=TemplateFilter.valueOf(cmd.getTemplateFilter());
  Long accountId=null;
  Account account=UserContext.current().getCaller();
  Long domainId=cmd.getDomainId();
  String accountName=cmd.getAccountName();
  if (accountName != null && domainId != null) {
    accountId=_accountMgr.finalizeOwner(account,accountName,domainId).getAccountId();
  }
 else {
    accountId=account.getId();
  }
  boolean isAccountSpecific=(account == null || isAdmin(account.getType())) && (accountName != null) && (domainId != null);
  boolean showDomr=((templateFilter != TemplateFilter.selfexecutable) && (templateFilter != TemplateFilter.featured));
  HypervisorType hypervisorType=HypervisorType.getType(cmd.getHypervisor());
  return listTemplates(cmd.getId(),cmd.getTemplateName(),cmd.getKeyword(),templateFilter,false,null,accountId,cmd.getPageSizeVal(),cmd.getStartIndex(),cmd.getZoneId(),hypervisorType,isAccountSpecific,showDomr,cmd.listInReadyState());
}
