{
  StoragePoolVO primaryStorage=_poolDao.findById(primaryStorageId);
  if (primaryStorage == null) {
    s_logger.debug("Unable to find primary storage id: " + primaryStorageId);
    throw new InvalidParameterValueException("Unable to find storage pool with ID: " + primaryStorageId + ". Please specify a valid primary storage ID.");
  }
  if (_poolDao.countBy(primaryStorage.getId(),Status.PrepareForMaintenance,Status.ErrorInMaintenance,Status.Maintenance) > 0) {
    throw new InvalidParameterValueException("There are other primary storages in maintenance mode.");
  }
  primaryStorage.setStatus(Status.PrepareForMaintenance);
  _poolDao.persist(primaryStorage);
  Long param=new Long(primaryStorageId);
  Gson gson=GsonHelper.getBuilder().create();
  AsyncJobVO job=new AsyncJobVO();
  job.setUserId(UserContext.current().getUserId());
  job.setAccountId(Account.ACCOUNT_ID_SYSTEM);
  job.setCmd("PreparePrimaryStorageMaintenance");
  job.setCmdInfo(gson.toJson(param));
  job.setCmdOriginator(PreparePrimaryStorageForMaintenanceCmd.getResultObjectName());
  return _asyncMgr.submitAsyncJob(job);
}
