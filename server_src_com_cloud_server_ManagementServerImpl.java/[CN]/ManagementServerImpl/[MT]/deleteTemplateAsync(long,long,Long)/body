{
  UserVO user=_userDao.findById(userId);
  if (user == null) {
    throw new InvalidParameterValueException("Please specify a valid user.");
  }
  VMTemplateVO template=_templateDao.findById(templateId);
  if (template == null) {
    throw new InvalidParameterValueException("Please specify a valid template.");
  }
  if (template.getFormat() == ImageFormat.ISO) {
    throw new InvalidParameterValueException("Please specify a valid template.");
  }
  if (template.getUniqueName().equals("routing")) {
    throw new InvalidParameterValueException("The DomR template cannot be deleted.");
  }
  if (zoneId != null && (_hostDao.findSecondaryStorageHost(zoneId) == null)) {
    throw new InvalidParameterValueException("Failed to find a secondary storage host in the specified zone.");
  }
  DeleteTemplateParam param=new DeleteTemplateParam(userId,templateId,zoneId,0);
  Gson gson=GsonHelper.getBuilder().create();
  AsyncJobVO job=new AsyncJobVO();
  job.setUserId(UserContext.current().getUserId());
  job.setAccountId(template.getAccountId());
  job.setCmd("DeleteTemplate");
  job.setCmdInfo(gson.toJson(param));
  job.setCmdOriginator(DeleteTemplateCmd.getStaticName());
  return _asyncMgr.submitAsyncJob(job);
}
