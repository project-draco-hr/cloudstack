{
  UserAccount userAccount=null;
  Long accountId=null;
  String username=null;
  try {
    UserVO user=_userDao.findById(userId);
    if (user == null || user.getRemoved() != null) {
      return true;
    }
    username=user.getUsername();
    boolean result=_userDao.remove(userId);
    if (!result) {
      s_logger.error("Unable to remove the user with id: " + userId + "; username: "+ user.getUsername());
      return false;
    }
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("User is removed, id: " + userId + "; username: "+ user.getUsername());
    }
    accountId=user.getAccountId();
    userAccount=_userAccountDao.findByIdIncludingRemoved(userId);
    List<UserVO> users=_userDao.listByAccount(accountId);
    if (users.size() != 0) {
      s_logger.debug("User (" + userId + "/"+ user.getUsername()+ ") is deleted but there's still other users in the account so not deleting account.");
      return true;
    }
    result=_accountDao.remove(accountId);
    if (!result) {
      s_logger.error("Unable to delete account " + accountId);
    }
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Remove account " + accountId);
    }
    AccountVO account=_accountDao.findByIdIncludingRemoved(accountId);
    deleteAccount(account);
    EventUtils.saveEvent(Long.valueOf(1),Long.valueOf(1),EventVO.LEVEL_INFO,EventTypes.EVENT_USER_DELETE,"User " + username + " (id: "+ userId+ ") for accountId = "+ accountId+ " and domainId = "+ userAccount.getDomainId()+ " was deleted.");
    return true;
  }
 catch (  Exception e) {
    s_logger.error("exception deleting user: " + userId,e);
    long domainId=0L;
    if (userAccount != null)     domainId=userAccount.getDomainId();
    EventUtils.saveEvent(Long.valueOf(1),Long.valueOf(1),EventVO.LEVEL_INFO,EventTypes.EVENT_USER_DELETE,"Error deleting user " + username + " (id: "+ userId+ ") for accountId = "+ accountId+ " and domainId = "+ domainId);
    return false;
  }
}
