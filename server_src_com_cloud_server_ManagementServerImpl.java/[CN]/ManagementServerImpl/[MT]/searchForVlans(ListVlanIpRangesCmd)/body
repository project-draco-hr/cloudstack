{
  String accountName=cmd.getAccountName();
  Long domainId=cmd.getDomainId();
  Long accountId=null;
  Long networkId=cmd.getNetworkId();
  if (accountName != null && domainId != null) {
    Account account=_accountDao.findActiveAccount(accountName,domainId);
    if (account == null) {
      throw new InvalidParameterValueException("Unable to find account " + accountName + " in domain "+ domainId);
    }
 else {
      accountId=account.getId();
    }
  }
  Filter searchFilter=new Filter(VlanVO.class,"id",true,cmd.getStartIndex(),cmd.getPageSizeVal());
  Object id=cmd.getId();
  Object vlan=cmd.getVlan();
  Object dataCenterId=cmd.getZoneId();
  Object podId=cmd.getPodId();
  Object keyword=cmd.getKeyword();
  SearchBuilder<VlanVO> sb=_vlanDao.createSearchBuilder();
  sb.and("id",sb.entity().getId(),SearchCriteria.Op.EQ);
  sb.and("vlan",sb.entity().getVlanId(),SearchCriteria.Op.EQ);
  sb.and("dataCenterId",sb.entity().getDataCenterId(),SearchCriteria.Op.EQ);
  sb.and("networkId",sb.entity().getNetworkId(),SearchCriteria.Op.EQ);
  if (accountId != null) {
    SearchBuilder<AccountVlanMapVO> accountVlanMapSearch=_accountVlanMapDao.createSearchBuilder();
    accountVlanMapSearch.and("accountId",accountVlanMapSearch.entity().getAccountId(),SearchCriteria.Op.EQ);
    sb.join("accountVlanMapSearch",accountVlanMapSearch,sb.entity().getId(),accountVlanMapSearch.entity().getVlanDbId(),JoinBuilder.JoinType.INNER);
  }
  if (podId != null) {
    SearchBuilder<PodVlanMapVO> podVlanMapSearch=_podVlanMapDao.createSearchBuilder();
    podVlanMapSearch.and("podId",podVlanMapSearch.entity().getPodId(),SearchCriteria.Op.EQ);
    sb.join("podVlanMapSearch",podVlanMapSearch,sb.entity().getId(),podVlanMapSearch.entity().getVlanDbId(),JoinBuilder.JoinType.INNER);
  }
  SearchCriteria<VlanVO> sc=sb.create();
  if (keyword != null) {
    SearchCriteria<VlanVO> ssc=_vlanDao.createSearchCriteria();
    ssc.addOr("vlanId",SearchCriteria.Op.LIKE,"%" + keyword + "%");
    ssc.addOr("ipRange",SearchCriteria.Op.LIKE,"%" + keyword + "%");
    sc.addAnd("vlanId",SearchCriteria.Op.SC,ssc);
  }
 else {
    if (id != null) {
      sc.setParameters("id",id);
    }
    if (vlan != null) {
      sc.setParameters("vlan",vlan);
    }
    if (dataCenterId != null) {
      sc.setParameters("dataCenterId",dataCenterId);
    }
    if (networkId != null) {
      sc.setParameters("networkId",networkId);
    }
    if (accountId != null) {
      sc.setJoinParameters("accountVlanMapSearch","accountId",accountId);
    }
    if (podId != null) {
      sc.setJoinParameters("podVlanMapSearch","podId",podId);
    }
  }
  return _vlanDao.search(sc,searchFilter);
}
