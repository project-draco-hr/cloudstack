{
  Filter searchFilter=new Filter(PreallocatedLunVO.class,"id",true,cmd.getStartIndex(),cmd.getPageSizeVal());
  SearchCriteria<PreallocatedLunVO> sc=_lunDao.createSearchCriteria();
  Object targetIqn=cmd.getTargetIqn();
  Object scope=cmd.getScope();
  if (targetIqn != null) {
    sc.addAnd("targetIqn",SearchCriteria.Op.EQ,targetIqn);
  }
  if (scope == null || scope.toString().equalsIgnoreCase("ALL")) {
    return _lunDao.search(sc,searchFilter);
  }
 else   if (scope.toString().equalsIgnoreCase("ALLOCATED")) {
    sc.addAnd("volumeId",SearchCriteria.Op.NNULL);
    sc.addAnd("taken",SearchCriteria.Op.NNULL);
    return _lunDao.search(sc,searchFilter);
  }
 else   if (scope.toString().equalsIgnoreCase("FREE")) {
    sc.addAnd("volumeId",SearchCriteria.Op.NULL);
    sc.addAnd("taken",SearchCriteria.Op.NULL);
    return _lunDao.search(sc,searchFilter);
  }
  return null;
}
