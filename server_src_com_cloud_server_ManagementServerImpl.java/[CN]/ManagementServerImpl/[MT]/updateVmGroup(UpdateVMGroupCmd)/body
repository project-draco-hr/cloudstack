{
  Account account=UserContext.current().getCaller();
  Long groupId=cmd.getId();
  String groupName=cmd.getGroupName();
  InstanceGroupVO group=_vmGroupDao.findById(groupId.longValue());
  if (group == null) {
    throw new ServerApiException(BaseCmd.PARAM_ERROR,"unable to find a vm group with id " + groupId);
  }
  if (account != null) {
    Account tempAccount=_accountDao.findById(group.getAccountId());
    if (!isAdmin(account.getType()) && (account.getId() != group.getAccountId())) {
      throw new ServerApiException(BaseCmd.ACCOUNT_ERROR,"unable to find a group with id " + groupId + " for this account");
    }
 else     if (!_domainDao.isChildDomain(account.getDomainId(),tempAccount.getDomainId())) {
      throw new ServerApiException(BaseCmd.ACCOUNT_ERROR,"Invalid group id (" + groupId + ") given, unable to update the group.");
    }
  }
  boolean isNameInUse=_vmGroupDao.isNameInUse(group.getAccountId(),groupName);
  if (isNameInUse && !group.getName().equals(groupName)) {
    throw new ServerApiException(BaseCmd.PARAM_ERROR,"Unable to update vm group, a group with name " + groupName + " already exisits for account");
  }
  if (groupName != null) {
    _vmGroupDao.updateVmGroup(groupId,groupName);
  }
  InstanceGroupVO vmGroup=_vmGroupDao.findById(groupId);
  return vmGroup;
}
