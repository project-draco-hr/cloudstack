{
  Filter searchFilter=new Filter(ConfigurationVO.class,"name",true,cmd.getStartIndex(),cmd.getPageSizeVal());
  SearchCriteria<ConfigurationVO> sc=_configDao.createSearchCriteria();
  Object name=cmd.getConfigName();
  Object category=cmd.getCategory();
  Object keyword=cmd.getKeyword();
  Long zoneId=cmd.getZoneId();
  Long clusterId=cmd.getClusterId();
  Long storagepoolId=cmd.getStoragepoolId();
  Long accountId=cmd.getAccountId();
  String scope=null;
  Long id=null;
  int paramCountCheck=0;
  if (zoneId != null) {
    scope=ConfigKey.Scope.Zone.toString();
    id=zoneId;
    paramCountCheck++;
  }
  if (clusterId != null) {
    scope=ConfigKey.Scope.Cluster.toString();
    id=clusterId;
    paramCountCheck++;
  }
  if (accountId != null) {
    scope=ConfigKey.Scope.Account.toString();
    id=accountId;
    paramCountCheck++;
  }
  if (storagepoolId != null) {
    scope=ConfigKey.Scope.StoragePool.toString();
    id=storagepoolId;
    paramCountCheck++;
  }
  if (paramCountCheck > 1) {
    throw new InvalidParameterValueException("cannot handle multiple IDs, provide only one ID corresponding to the scope");
  }
  if (keyword != null) {
    SearchCriteria<ConfigurationVO> ssc=_configDao.createSearchCriteria();
    ssc.addOr("name",SearchCriteria.Op.LIKE,"%" + keyword + "%");
    ssc.addOr("instance",SearchCriteria.Op.LIKE,"%" + keyword + "%");
    ssc.addOr("component",SearchCriteria.Op.LIKE,"%" + keyword + "%");
    ssc.addOr("description",SearchCriteria.Op.LIKE,"%" + keyword + "%");
    ssc.addOr("category",SearchCriteria.Op.LIKE,"%" + keyword + "%");
    ssc.addOr("value",SearchCriteria.Op.LIKE,"%" + keyword + "%");
    sc.addAnd("name",SearchCriteria.Op.SC,ssc);
  }
  if (name != null) {
    sc.addAnd("name",SearchCriteria.Op.LIKE,"%" + name + "%");
  }
  if (category != null) {
    sc.addAnd("category",SearchCriteria.Op.EQ,category);
  }
  sc.addAnd("category",SearchCriteria.Op.NEQ,"Hidden");
  if (scope != null && !scope.isEmpty()) {
    if (id == null) {
      throw new InvalidParameterValueException("Invalid id null, id is needed corresponding to the scope");
    }
    sc.addAnd("scope",SearchCriteria.Op.EQ,scope);
  }
  Pair<List<ConfigurationVO>,Integer> result=_configDao.searchAndCount(sc,searchFilter);
  if (scope != null && !scope.isEmpty()) {
    List<ConfigurationVO> configVOList=new ArrayList<ConfigurationVO>();
    for (    ConfigurationVO param : result.first()) {
      ConfigurationVO configVo=_configDao.findByName(param.getName());
      configVo.setValue(_configDepot.get(param.getName()).valueIn(id).toString());
      configVOList.add(configVo);
    }
    return new Pair<List<? extends Configuration>,Integer>(configVOList,configVOList.size());
  }
  return new Pair<List<? extends Configuration>,Integer>(result.first(),result.second());
}
