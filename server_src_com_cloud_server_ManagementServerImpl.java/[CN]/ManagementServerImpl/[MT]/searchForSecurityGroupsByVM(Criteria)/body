{
  Filter searchFilter=new Filter(SecurityGroupVMMapVO.class,c.getOrderBy(),c.getAscending(),c.getOffset(),c.getLimit());
  SearchCriteria<SecurityGroupVMMapVO> sc=_securityGroupVMMapDao.createSearchCriteria();
  Object instanceId=c.getCriteria(Criteria.INSTANCEID);
  Object ipAddress=c.getCriteria(Criteria.ADDRESS);
  if (instanceId != null) {
    sc.addAnd("instanceId",SearchCriteria.Op.EQ,instanceId);
  }
  if (ipAddress != null) {
    sc.addAnd("ipAddress",SearchCriteria.Op.EQ,ipAddress);
  }
  Map<String,List<SecurityGroupVO>> securityGroups=new HashMap<String,List<SecurityGroupVO>>();
  List<SecurityGroupVMMapVO> sgVmMappings=_securityGroupVMMapDao.search(sc,searchFilter);
  if (sgVmMappings != null) {
    for (    SecurityGroupVMMapVO sgVmMapping : sgVmMappings) {
      SecurityGroupVO sg=_securityGroupDao.findById(sgVmMapping.getSecurityGroupId());
      List<SecurityGroupVO> sgList=securityGroups.get(sgVmMapping.getIpAddress());
      if (sgList == null) {
        sgList=new ArrayList<SecurityGroupVO>();
      }
      sgList.add(sg);
      securityGroups.put(sgVmMapping.getIpAddress(),sgList);
    }
  }
  return securityGroups;
}
