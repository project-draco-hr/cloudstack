{
  Account caller=UserContext.current().getCaller();
  Long domainId=cmd.getDomainId();
  String acctName=cmd.getAccountName();
  Long id=cmd.getId();
  if (caller.getType() == Account.ACCOUNT_TYPE_DOMAIN_ADMIN) {
    if (domainId != null) {
      DomainVO domain=_domainDao.findById(domainId);
      if (domain == null) {
        throw new InvalidParameterValueException("Unable to find domain by id " + domainId);
      }
      _accountMgr.checkAccess(caller,domain,null);
      if (acctName != null) {
        Account userAccount=_accountDao.findActiveAccount(acctName,domainId);
        if (userAccount == null) {
          throw new PermissionDeniedException("Unable to find account " + acctName + " in domain "+ domainId);
        }
      }
    }
  }
  if (id == Long.valueOf(1)) {
    throw new PermissionDeniedException("unable to list permissions for " + cmd.getMediaType() + " with id "+ id);
  }
  VirtualMachineTemplate template=_templateMgr.getTemplate(id);
  if (template == null || !templateIsCorrectType(template)) {
    throw new InvalidParameterValueException("unable to find " + cmd.getMediaType() + " with id "+ id);
  }
  if (!template.isPublicTemplate()) {
    _accountMgr.checkAccess(caller,null,template);
  }
  List<String> accountNames=new ArrayList<String>();
  List<LaunchPermissionVO> permissions=_launchPermissionDao.findByTemplate(id);
  if ((permissions != null) && !permissions.isEmpty()) {
    for (    LaunchPermissionVO permission : permissions) {
      Account acct=_accountDao.findById(permission.getAccountId());
      accountNames.add(acct.getAccountName());
    }
  }
  return accountNames;
}
