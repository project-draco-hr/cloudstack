{
  Account account=UserContext.current().getCaller();
  Long domainId=cmd.getDomainId();
  String acctName=cmd.getAccountName();
  Long id=cmd.getId();
  Long accountId=null;
  if ((account == null) || account.getType() == Account.ACCOUNT_TYPE_ADMIN) {
    if (domainId != null) {
      if ((account != null) && !_domainDao.isChildDomain(account.getDomainId(),domainId)) {
        throw new PermissionDeniedException("Invalid domain id (" + domainId + ") given, unable to list "+ cmd.getMediaType()+ " permissions.");
      }
      if (acctName != null) {
        Account userAccount=_accountDao.findActiveAccount(acctName,domainId);
        if (userAccount != null) {
          accountId=userAccount.getId();
        }
 else {
          throw new PermissionDeniedException("Unable to find account " + acctName + " in domain "+ domainId);
        }
      }
    }
  }
 else {
    accountId=account.getId();
  }
  VMTemplateVO template=_templateDao.findById(id.longValue());
  if (template == null || !templateIsCorrectType(template)) {
    throw new InvalidParameterValueException("unable to find " + cmd.getMediaType() + " with id "+ id);
  }
  if (accountId != null && !template.isPublicTemplate()) {
    if (account.getType() == Account.ACCOUNT_TYPE_NORMAL && template.getAccountId() != accountId) {
      throw new PermissionDeniedException("unable to list permissions for " + cmd.getMediaType() + " with id "+ id);
    }
 else     if (account.getType() == Account.ACCOUNT_TYPE_DOMAIN_ADMIN || account.getType() == Account.ACCOUNT_TYPE_RESOURCE_DOMAIN_ADMIN) {
      DomainVO accountDomain=_domainDao.findById(account.getDomainId());
      Account templateAccount=_accountDao.findById(template.getAccountId());
      DomainVO templateDomain=_domainDao.findById(templateAccount.getDomainId());
      if (!templateDomain.getPath().contains(accountDomain.getPath())) {
        throw new PermissionDeniedException("unable to list permissions for " + cmd.getMediaType() + " with id "+ id);
      }
    }
  }
  if (id == Long.valueOf(1)) {
    throw new PermissionDeniedException("unable to list permissions for " + cmd.getMediaType() + " with id "+ id);
  }
  List<String> accountNames=new ArrayList<String>();
  List<LaunchPermissionVO> permissions=_launchPermissionDao.findByTemplate(id);
  if ((permissions != null) && !permissions.isEmpty()) {
    for (    LaunchPermissionVO permission : permissions) {
      Account acct=_accountDao.findById(permission.getAccountId());
      accountNames.add(acct.getAccountName());
    }
  }
  return accountNames;
}
