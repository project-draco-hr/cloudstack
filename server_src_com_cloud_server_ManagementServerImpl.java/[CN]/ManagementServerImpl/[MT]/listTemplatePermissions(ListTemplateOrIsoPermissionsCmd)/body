{
  Account caller=UserContext.current().getCaller();
  Long domainId=cmd.getDomainId();
  String acctName=cmd.getAccountName();
  Long id=cmd.getId();
  Long accountId=null;
  if (caller.getType() == Account.ACCOUNT_TYPE_DOMAIN_ADMIN) {
    if (domainId != null) {
      if ((caller != null) && !_domainDao.isChildDomain(caller.getDomainId(),domainId)) {
        throw new PermissionDeniedException("Invalid domain id (" + domainId + ") given, unable to list "+ cmd.getMediaType()+ " permissions.");
      }
      if (acctName != null) {
        Account userAccount=_accountDao.findActiveAccount(acctName,domainId);
        if (userAccount != null) {
          accountId=userAccount.getId();
        }
 else {
          throw new PermissionDeniedException("Unable to find account " + acctName + " in domain "+ domainId);
        }
      }
    }
  }
 else   if (caller.getType() == Account.ACCOUNT_TYPE_NORMAL) {
    accountId=caller.getId();
  }
  if (id == Long.valueOf(1)) {
    throw new PermissionDeniedException("unable to list permissions for " + cmd.getMediaType() + " with id "+ id);
  }
  VMTemplateVO template=_templateDao.findById(id.longValue());
  if (template == null || !templateIsCorrectType(template)) {
    throw new InvalidParameterValueException("unable to find " + cmd.getMediaType() + " with id "+ id);
  }
  if (!template.isPublicTemplate()) {
    _accountMgr.checkAccess(caller,template);
  }
  List<String> accountNames=new ArrayList<String>();
  List<LaunchPermissionVO> permissions=_launchPermissionDao.findByTemplate(id);
  if ((permissions != null) && !permissions.isEmpty()) {
    for (    LaunchPermissionVO permission : permissions) {
      Account acct=_accountDao.findById(permission.getAccountId());
      accountNames.add(acct.getAccountName());
    }
  }
  return accountNames;
}
