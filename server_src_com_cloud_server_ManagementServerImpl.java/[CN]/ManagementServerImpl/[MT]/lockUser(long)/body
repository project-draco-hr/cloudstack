{
  boolean success=false;
  UserVO user=_userDao.findById(userId);
  if (user != null) {
    if (user.getState().equals(Account.ACCOUNT_STATE_LOCKED)) {
      return true;
    }
 else     if (user.getState().equals(Account.ACCOUNT_STATE_ENABLED)) {
      success=doSetUserStatus(userId,Account.ACCOUNT_STATE_LOCKED);
      boolean lockAccount=true;
      List<UserVO> allUsersByAccount=_userDao.listByAccount(user.getAccountId());
      for (      UserVO oneUser : allUsersByAccount) {
        if (oneUser.getState().equals(Account.ACCOUNT_STATE_ENABLED)) {
          lockAccount=false;
          break;
        }
      }
      if (lockAccount) {
        success=(success && lockAccount(user.getAccountId()));
      }
    }
 else {
      if (s_logger.isInfoEnabled()) {
        s_logger.info("Attempting to lock a non-enabled user, current state is " + user.getState() + " (userId: "+ userId+ "), locking failed.");
      }
    }
  }
 else {
    s_logger.warn("Unable to find user with id: " + userId);
  }
  return success;
}
