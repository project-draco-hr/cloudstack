{
  Account caller=CallContext.current().getCallingAccount();
  List<Long> ids=cmd.getIds();
  boolean result=true;
  List<Long> permittedAccountIds=new ArrayList<Long>();
  if (caller.getType() == Account.ACCOUNT_TYPE_NORMAL || caller.getType() == Account.ACCOUNT_TYPE_PROJECT) {
    permittedAccountIds.add(caller.getId());
  }
 else {
    DomainVO domain=_domainDao.findById(caller.getDomainId());
    List<Long> permittedDomainIds=_domainDao.getDomainChildrenIds(domain.getPath());
    permittedAccountIds=_accountDao.getAccountIdsForDomains(permittedDomainIds);
  }
  List<EventVO> events=_eventDao.listToArchiveOrDeleteEvents(ids,cmd.getType(),cmd.getStartDate(),cmd.getEndDate(),permittedAccountIds);
  ControlledEntity[] sameOwnerEvents=events.toArray(new ControlledEntity[events.size()]);
  _accountMgr.checkAccess(CallContext.current().getCallingAccount(),null,true,sameOwnerEvents);
  if (ids != null && events.size() < ids.size()) {
    result=false;
    return result;
  }
  _eventDao.archiveEvents(events);
  return result;
}
