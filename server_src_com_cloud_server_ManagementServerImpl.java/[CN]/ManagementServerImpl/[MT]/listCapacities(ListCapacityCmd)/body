{
  Filter searchFilter=new Filter(CapacityVO.class,"capacityType",true,cmd.getStartIndex(),cmd.getPageSizeVal());
  SearchCriteria<CapacityVO> sc=_capacityDao.createSearchCriteria();
  List<CapacityVO> capacities=new LinkedList<CapacityVO>();
  Integer type=cmd.getType();
  Long zoneId=cmd.getZoneId();
  Long podId=cmd.getPodId();
  Long hostId=cmd.getHostId();
  if (type != null) {
    sc.addAnd("capacityType",SearchCriteria.Op.EQ,type);
  }
  if (zoneId != null) {
    sc.addAnd("dataCenterId",SearchCriteria.Op.EQ,zoneId);
  }
  if (podId != null) {
    sc.addAnd("podId",SearchCriteria.Op.EQ,podId);
  }
  if (hostId != null) {
    sc.addAnd("hostOrPoolId",SearchCriteria.Op.EQ,hostId);
  }
  capacities=_capacityDao.search(sc,searchFilter);
  if (type == null || type == Capacity.CAPACITY_TYPE_SECONDARY_STORAGE) {
    capacities.addAll(_storageMgr.getSecondaryStorageUsedStats(hostId,podId,zoneId));
  }
  if (type == null || type == Capacity.CAPACITY_TYPE_STORAGE) {
    capacities.addAll(_storageMgr.getStoragePoolUsedStats(hostId,podId,zoneId));
  }
  return capacities;
}
