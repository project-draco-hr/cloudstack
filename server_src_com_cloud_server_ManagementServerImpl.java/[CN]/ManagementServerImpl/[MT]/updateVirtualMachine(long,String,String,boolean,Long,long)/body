{
  UserVmVO vm=_userVmDao.findById(vmId);
  if (vm == null) {
    throw new CloudRuntimeException("Unable to find virual machine with id " + vmId);
  }
  if (group != null) {
    boolean addToGroup=_vmMgr.addInstanceToGroup(Long.valueOf(vmId),group);
    if (!addToGroup) {
      throw new CloudRuntimeException("Unable to update Vm with the the group " + group);
    }
  }
  boolean haEnabled=vm.isHaEnabled();
  _userVmDao.updateVM(vmId,displayName,enable);
  if (haEnabled != enable) {
    String description=null;
    String type=null;
    if (enable) {
      description="Successfully enabled HA for virtual machine " + vm.getName();
      type=EventTypes.EVENT_VM_ENABLE_HA;
    }
 else {
      description="Successfully disabled HA for virtual machine " + vm.getName();
      type=EventTypes.EVENT_VM_DISABLE_HA;
    }
    saveEvent(userId,accountId,EventVO.LEVEL_INFO,type,description,null);
  }
}
