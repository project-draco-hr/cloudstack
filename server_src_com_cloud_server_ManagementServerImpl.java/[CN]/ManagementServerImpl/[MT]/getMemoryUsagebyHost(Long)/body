{
  long mem=0;
  List<VMInstanceVO> vms=_vmInstanceDao.listUpByHostIdTypes(hostId,VirtualMachine.Type.DomainRouter);
  mem+=vms.size() * _routerRamSize * 1024L* 1024L;
  vms=_vmInstanceDao.listUpByHostIdTypes(hostId,VirtualMachine.Type.SecondaryStorageVm);
  mem+=vms.size() * _ssRamSize * 1024L* 1024L;
  vms=_vmInstanceDao.listUpByHostIdTypes(hostId,VirtualMachine.Type.ConsoleProxy);
  mem+=vms.size() * _proxyRamSize * 1024L* 1024L;
  List<UserVmVO> instances=_userVmDao.listUpByHostId(hostId);
  for (  UserVmVO vm : instances) {
    ServiceOffering so=findServiceOfferingById(vm.getServiceOfferingId());
    if (so != null) {
      mem+=so.getRamSize() * 1024L * 1024L;
    }
  }
  return mem;
}
