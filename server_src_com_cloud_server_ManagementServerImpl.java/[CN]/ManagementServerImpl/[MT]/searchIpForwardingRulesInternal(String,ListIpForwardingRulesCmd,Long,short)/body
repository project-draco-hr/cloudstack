{
  Filter searchFilter=new Filter(FirewallRuleVO.class,"id",true,cmd.getStartIndex(),cmd.getPageSizeVal());
  if (accountId == null) {
    SearchCriteria<FirewallRuleVO> sc=_firewallRulesDao.createSearchCriteria();
    if (ipAddress != null) {
      sc.addAnd("publicIpAddress",SearchCriteria.Op.EQ,ipAddress);
    }
    sc.addAnd("protocol",SearchCriteria.Op.EQ,NetUtils.NAT_PROTO);
    return _firewallRulesDao.search(sc,searchFilter);
  }
 else {
    if ((accountType == Account.ACCOUNT_TYPE_NORMAL) || (accountType == Account.ACCOUNT_TYPE_DOMAIN_ADMIN)) {
      SearchBuilder<FirewallRuleVO> sb=_firewallRulesDao.createSearchBuilder();
      SearchBuilder<IPAddressVO> sb1=_publicIpAddressDao.createSearchBuilder();
      sb1.and("accountId",sb1.entity().getAccountId(),SearchCriteria.Op.EQ);
      sb1.and("oneToOneNat",sb1.entity().isOneToOneNat(),SearchCriteria.Op.EQ);
      sb.join("sb1",sb1,sb.entity().getPublicIpAddress(),sb1.entity().getAddress(),JoinBuilder.JoinType.INNER);
      SearchCriteria<FirewallRuleVO> sc=sb.create();
      sc.setJoinParameters("sb1","oneToOneNat",new Long(1));
      sc.setJoinParameters("sb1","accountId",accountId);
      return _firewallRulesDao.search(sc,searchFilter);
    }
  }
  return new ArrayList<FirewallRuleVO>();
}
