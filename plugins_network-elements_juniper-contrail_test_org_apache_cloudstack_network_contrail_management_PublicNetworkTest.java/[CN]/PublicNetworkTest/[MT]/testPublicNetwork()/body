{
  DataCenter zone=_server.getZone();
  List<NetworkVO> networks=_networksDao.listByZoneAndTrafficType(zone.getId(),TrafficType.Public);
  assertNotNull(networks);
  assertFalse(networks.isEmpty());
  UserVm vm1=_server.createVM("test",networks.get(0));
  ArgumentCaptor<ApiObjectBase> createArg=ArgumentCaptor.forClass(ApiObjectBase.class);
  verify(_spy,times(4)).create(createArg.capture());
  List<ApiObjectBase> argumentList=createArg.getAllValues();
  ApiObjectBase vmObj=argumentList.get(0);
  assertEquals(VirtualNetwork.class,vmObj.getClass());
  assertEquals("__default_Public__",vmObj.getName());
  String vmiName=null;
  for (  ApiObjectBase obj : argumentList) {
    if (obj.getClass() == VirtualMachineInterface.class) {
      vmiName=obj.getName();
    }
  }
  assertEquals("test-0",vmiName);
}
