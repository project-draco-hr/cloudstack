{
  SnapshotVO snapshotVO=snapshotDao.findById(snapshotId);
  if (snapshotVO.getState() == Snapshot.State.Destroyed) {
    return true;
  }
  if (snapshotVO.getState() == Snapshot.State.CreatedOnPrimary) {
    s_logger.debug("delete snapshot on primary storage:");
    snapshotVO.setState(Snapshot.State.Destroyed);
    snapshotDao.update(snapshotId,snapshotVO);
    return true;
  }
  if (!Snapshot.State.BackedUp.equals(snapshotVO.getState())) {
    throw new InvalidParameterValueException("Can't delete snapshotshot " + snapshotId + " due to it is not in BackedUp Status");
  }
  SnapshotInfo snapshotOnImage=this.snapshotDataFactory.getSnapshot(snapshotId,DataStoreRole.Image);
  if (snapshotOnImage == null) {
    s_logger.debug("Can't find snapshot on backup storage, delete it in db");
    snapshotDao.remove(snapshotId);
  }
  SnapshotObject obj=(SnapshotObject)snapshotOnImage;
  try {
    obj.processEvent(Snapshot.Event.DestroyRequested);
  }
 catch (  NoTransitionException e) {
    s_logger.debug("Failed to set the state to destroying: ",e);
    return false;
  }
  try {
    boolean result=deleteSnapshotChain(snapshotOnImage);
    obj.processEvent(Snapshot.Event.OperationSucceeded);
    if (result) {
      SnapshotDataStoreVO snapshotOnPrimary=snapshotStoreDao.findBySnapshot(snapshotId,DataStoreRole.Primary);
      if (snapshotOnPrimary != null) {
        snapshotOnPrimary.setState(State.Destroyed);
        snapshotStoreDao.update(snapshotOnPrimary.getId(),snapshotOnPrimary);
      }
    }
  }
 catch (  Exception e) {
    s_logger.debug("Failed to delete snapshot: ",e);
    try {
      obj.processEvent(Snapshot.Event.OperationFailed);
    }
 catch (    NoTransitionException e1) {
      s_logger.debug("Failed to change snapshot state: " + e.toString());
    }
  }
  return true;
}
