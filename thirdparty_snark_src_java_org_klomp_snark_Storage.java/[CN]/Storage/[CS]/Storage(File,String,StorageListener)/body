{
  this.listener=listener;
  getFiles(baseFile);
  long total=0;
  ArrayList<Long> lengthsList=new ArrayList<Long>();
  for (  long length : lengths) {
    total+=length;
    lengthsList.add(length);
  }
  piece_size=MIN_PIECE_SIZE;
  pieces=(int)((total - 1) / piece_size) + 1;
  while (pieces > MAX_PIECES) {
    piece_size=piece_size * 2;
    pieces=(int)((total - 1) / piece_size) + 1;
  }
  byte[] piece_hashes=new byte[20 * pieces];
  bitfield=new BitField(pieces);
  needed=0;
  List<List<String>> files=new ArrayList<List<String>>();
  for (  String element : names) {
    List<String> file=new ArrayList<String>();
    StringTokenizer st=new StringTokenizer(element,File.separator);
    while (st.hasMoreTokens()) {
      String part=st.nextToken();
      file.add(part);
    }
    files.add(file);
  }
  if (files.size() == 1) {
    files=null;
    lengthsList=null;
  }
  metainfo=new MetaInfo(announce,baseFile.getName(),files,lengthsList,piece_size,piece_hashes,total);
}
