{
  DataOutputStream dos;
  if (os instanceof DataOutputStream)   dos=(DataOutputStream)os;
 else   dos=new DataOutputStream(os);
  PixelGrabber grabber=new PixelGrabber(memImage,0,0,-1,-1,false);
  try {
    if (grabber.grabPixels()) {
      dos.writeShort(x);
      dos.writeShort(y);
      dos.writeShort(w);
      dos.writeShort(h);
      dos.writeInt(RfbProto.EncodingRaw);
      if (bytesPixel == 1) {
        byte[] data=(byte[])grabber.getPixels();
        for (int dy=y; dy < y + h; dy++) {
          os.write(data,dy * rfb.framebufferWidth + x,w);
        }
      }
 else {
        int[] data=(int[])grabber.getPixels();
        int i, offset;
        for (int dy=y; dy < y + h; dy++) {
          offset=dy * rfb.framebufferWidth + x;
          for (i=0; i < w; i++) {
            int pixel=data[offset + i];
            dos.write(pixel & 0xFF);
            dos.write((pixel >> 8) & 0xFF);
            dos.write((pixel >> 16) & 0xFF);
            dos.write((pixel >> 24) & 0xFF);
          }
        }
      }
    }
  }
 catch (  InterruptedException e) {
    s_logger.warn("Exception whiel grabbering pixel data from memImage");
  }
}
