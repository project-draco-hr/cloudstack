{
  try {
    List<Integer> usedDeviceNums=new ArrayList<Integer>();
    Set<VIF> vifs=vm.getVIFs(conn);
    Iterator<VIF> vifIter=vifs.iterator();
    while (vifIter.hasNext()) {
      VIF vif=vifIter.next();
      try {
        usedDeviceNums.add(Integer.valueOf(vif.getDevice(conn)));
      }
 catch (      NumberFormatException e) {
        s_logger.debug("Obtained an invalid value for an allocated VIF device number for VM: " + vm.getNameLabel(conn));
        return null;
      }
    }
    for (Integer i=0; i < _maxNics; i++) {
      if (!usedDeviceNums.contains(i)) {
        s_logger.debug("Lowest available Vif device number: " + i + " for VM: "+ vm.getNameLabel(conn));
        return i.toString();
      }
    }
  }
 catch (  XmlRpcException e) {
    String msg="Caught XmlRpcException: " + e.getMessage();
    s_logger.warn(msg,e);
  }
catch (  XenAPIException e) {
    String msg="Caught XenAPIException: " + e.toString();
    s_logger.warn(msg,e);
  }
  return null;
}
