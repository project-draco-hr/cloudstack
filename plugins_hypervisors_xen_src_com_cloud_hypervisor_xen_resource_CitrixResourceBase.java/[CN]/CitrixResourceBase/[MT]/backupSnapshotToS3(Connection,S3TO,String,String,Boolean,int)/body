{
  final String filename=iSCSIFlag ? "VHD-" + snapshotUuid : snapshotUuid + ".vhd";
  final String dir=(iSCSIFlag ? "/dev/VG_XenStorage-" : "/var/run/sr-mount/") + srUuid;
  final String key=String.format("/snapshots/%1$s",snapshotUuid);
  try {
    final List<String> parameters=newArrayList(flattenProperties(s3,S3Utils.ClientOptions.class));
    parameters.addAll(Arrays.asList("operation","put","filename",dir + "/" + filename,"iSCSIFlag",iSCSIFlag.toString(),"bucket",s3.getBucketName(),"key",key,"https",s3.isHttps() != null ? s3.isHttps().toString() : "null"));
    final String result=callHostPluginAsync(connection,"s3xen","s3",wait,parameters.toArray(new String[parameters.size()]));
    if (result != null && result.equals("true")) {
      return true;
    }
  }
 catch (  Exception e) {
    s_logger.error(String.format("S3 upload failed of snapshot %1$s due to %2$s.",snapshotUuid,e.toString()),e);
  }
  return false;
}
