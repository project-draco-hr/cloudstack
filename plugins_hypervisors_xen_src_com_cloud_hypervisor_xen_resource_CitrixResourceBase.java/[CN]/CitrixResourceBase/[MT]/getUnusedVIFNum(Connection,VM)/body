{
  String vmName="";
  try {
    vmName=vm.getNameLabel(conn);
    Set<String> allowedVIFDevices=vm.getAllowedVIFDevices(conn);
    if (allowedVIFDevices.size() > 0) {
      return allowedVIFDevices.iterator().next();
    }
  }
 catch (  Exception e) {
    String msg="getUnusedVIFNum failed due to " + e.toString();
    s_logger.warn(msg,e);
  }
  throw new CloudRuntimeException("Could not find available VIF slot in VM with name: " + vmName + " to plug a VIF");
}
