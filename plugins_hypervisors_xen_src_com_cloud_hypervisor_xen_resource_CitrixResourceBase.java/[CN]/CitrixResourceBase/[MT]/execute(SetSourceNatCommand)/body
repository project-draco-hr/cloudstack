{
  Connection conn=getConnection();
  String routerName=cmd.getAccessDetail(NetworkElementCommand.ROUTER_NAME);
  IpAddressTO pubIp=cmd.getIpAddress();
  try {
    VM router=getVM(conn,routerName);
    VIF correctVif=getCorrectVif(conn,router,pubIp);
    String args="";
    args+=" -A ";
    args+=" -l ";
    args+=pubIp.getPublicIp();
    args+=" -c ";
    args+="eth" + correctVif.getDevice(conn);
    ExecutionResult result=executeInVR(cmd.getAccessDetail(NetworkElementCommand.ROUTER_IP),"vpc_snat.sh",args);
    if (!result.isSuccess()) {
      throw new InternalErrorException("Xen plugin \"vpc_snat\" failed." + result.getDetails());
    }
    return new SetSourceNatAnswer(cmd,true,"success");
  }
 catch (  Exception e) {
    String msg="Ip SNAT failure due to " + e.toString();
    s_logger.error(msg,e);
    return new SetSourceNatAnswer(cmd,false,msg);
  }
}
