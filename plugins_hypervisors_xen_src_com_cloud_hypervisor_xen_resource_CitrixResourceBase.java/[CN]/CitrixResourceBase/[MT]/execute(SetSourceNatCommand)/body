{
  Connection conn=getConnection();
  String routerName=cmd.getAccessDetail(NetworkElementCommand.ROUTER_NAME);
  String routerIp=cmd.getAccessDetail(NetworkElementCommand.ROUTER_IP);
  IpAddressTO pubIp=cmd.getIpAddress();
  try {
    VM router=getVM(conn,routerName);
    VIF correctVif=getCorrectVif(conn,router,pubIp);
    String args="vpc_snat.sh " + routerIp;
    args+=" -A ";
    args+=" -l ";
    args+=pubIp.getPublicIp();
    args+=" -c ";
    args+="eth" + correctVif.getDevice(conn);
    String result=callHostPlugin(conn,"vmops","routerProxy","args",args);
    if (result == null || result.isEmpty()) {
      throw new InternalErrorException("Xen plugin \"vpc_snat\" failed.");
    }
    return new SetSourceNatAnswer(cmd,true,"success");
  }
 catch (  Exception e) {
    String msg="Ip SNAT failure due to " + e.toString();
    s_logger.error(msg,e);
    return new SetSourceNatAnswer(cmd,false,msg);
  }
}
