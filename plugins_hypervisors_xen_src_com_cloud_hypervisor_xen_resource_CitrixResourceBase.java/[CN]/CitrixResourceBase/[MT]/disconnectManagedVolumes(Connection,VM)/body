{
  try {
    Set<VBD> vbds=vm.getVBDs(conn);
    for (    VBD vbd : vbds) {
      VDI vdi=vbd.getVDI(conn);
      SR sr=null;
      try {
        sr=vdi.getSR(conn);
      }
 catch (      Exception ex) {
        continue;
      }
      if (sr.getNameLabel(conn).startsWith("/iqn.")) {
        VBD.Record vbdr=vbd.getRecord(conn);
        if (vbdr.currentlyAttached) {
          vbd.unplug(conn);
        }
        vbd.destroy(conn);
        vdi.setNameLabel(conn,"detached");
        umount(conn,vdi);
        handleSrAndVdiDetach(sr.getNameLabel(conn));
      }
    }
  }
 catch (  Exception ex) {
    s_logger.debug(ex.getMessage());
  }
}
