{
  TemplateProfile profile=super.prepare(cmd);
  String url=profile.getUrl();
  String path=null;
  try {
    URL str=new URL(url);
    path=str.getPath();
  }
 catch (  MalformedURLException ex) {
    throw new InvalidParameterValueException("Please specify a valid URL. URL:" + url + " is invalid");
  }
  try {
    checkFormat(cmd.getFormat(),url);
  }
 catch (  InvalidParameterValueException ex) {
    checkFormat(cmd.getFormat(),path);
  }
  UriUtils.validateUrl(url);
  profile.setUrl(url);
  _resourceLimitMgr.checkResourceLimit(_accountMgr.getAccount(cmd.getEntityOwnerId()),ResourceType.secondary_storage,UriUtils.getRemoteSize(url));
  return profile;
}
