{
  while (true) {
synchronized (s_connectionForGlobalLocks) {
      if (forLock) {
        if (s_connectionForGlobalLocks.get(name) != null) {
          s_logger.error("Sanity check failed, global lock name " + name + " is in already in use");
        }
        Connection connection=Transaction.getStandaloneConnection();
        if (connection != null) {
          try {
            connection.setAutoCommit(true);
          }
 catch (          SQLException e) {
            try {
              connection.close();
            }
 catch (            SQLException sqlException) {
            }
            return null;
          }
          s_connectionForGlobalLocks.put(name,connection);
          return connection;
        }
      }
 else {
        Connection connection=s_connectionForGlobalLocks.get(name);
        s_connectionForGlobalLocks.remove(name);
        return connection;
      }
    }
    s_logger.warn("Unable to acquire dabase connection for global lock " + name + ", waiting for someone to release and retrying...");
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
    }
  }
}
