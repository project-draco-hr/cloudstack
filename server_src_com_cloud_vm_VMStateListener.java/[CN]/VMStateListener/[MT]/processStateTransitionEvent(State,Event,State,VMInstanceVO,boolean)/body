{
  if (oldState == State.Starting) {
    if (event == Event.OperationRetry || event == Event.OperationFailed) {
      releaseResource(vm,false,false);
    }
  }
  if (!transitionStatus) {
    return true;
  }
  if (oldState == State.Starting) {
    if (event == Event.OperationSucceeded) {
      vm.setLastHostId(vm.getHostId());
      _vmDao.update(vm.getId(),vm);
    }
  }
 else   if (oldState == State.Running) {
    if (event == Event.AgentReportStopped) {
      releaseResource(vm,false,true);
    }
  }
 else   if (oldState == State.Migrating) {
    if (event == Event.AgentReportStopped) {
      releaseResource(vm,false,true);
    }
  }
 else   if (oldState == State.Stopping) {
    if (event == Event.AgentReportStopped || event == Event.OperationSucceeded) {
      releaseResource(vm,false,true);
    }
  }
 else   if (oldState == State.Stopped) {
    if (event == Event.DestroyRequested) {
      releaseResource(vm,true,false);
      vm.setLastHostId(null);
      _vmDao.update(vm.getId(),vm);
    }
  }
  return true;
}
