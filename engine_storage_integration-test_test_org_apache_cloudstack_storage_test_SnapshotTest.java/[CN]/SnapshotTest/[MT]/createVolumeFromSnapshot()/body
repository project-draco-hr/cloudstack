{
  VolumeInfo vol=createCopyBaseImage();
  SnapshotVO snapshotVO=createSnapshotInDb(vol);
  SnapshotInfo snapshot=this.snapshotFactory.getSnapshot(snapshotVO.getId(),vol.getDataStore());
  boolean result=false;
  SnapshotStrategy snapshotStrategy=StrategyPriority.pickStrategy(snapshotStrategies,snapshot,SnapshotOperation.TAKE);
  if (snapshotStrategy != null) {
    snapshot=snapshotStrategy.takeSnapshot(snapshot);
    result=true;
  }
  AssertJUnit.assertTrue(result);
  VolumeVO volVO=createVolume(vol.getTemplateId(),vol.getPoolId());
  VolumeInfo newVol=this.volFactory.getVolume(volVO.getId());
  AsyncCallFuture<VolumeApiResult> volFuture=this.volumeService.createVolumeFromSnapshot(newVol,newVol.getDataStore(),snapshot);
  VolumeApiResult apiResult=volFuture.get();
  Assert.assertTrue(apiResult.isSuccess());
}
