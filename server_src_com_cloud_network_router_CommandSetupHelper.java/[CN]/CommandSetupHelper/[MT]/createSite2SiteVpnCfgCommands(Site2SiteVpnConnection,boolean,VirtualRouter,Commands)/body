{
  Site2SiteCustomerGatewayVO gw=_s2sCustomerGatewayDao.findById(conn.getCustomerGatewayId());
  Site2SiteVpnGatewayVO vpnGw=_s2sVpnGatewayDao.findById(conn.getVpnGatewayId());
  IpAddress ip=_ipAddressDao.findById(vpnGw.getAddrId());
  Vpc vpc=_vpcDao.findById(ip.getVpcId());
  String localPublicIp=ip.getAddress().toString();
  String localGuestCidr=vpc.getCidr();
  String localPublicGateway=_vlanDao.findById(ip.getVlanId()).getVlanGateway();
  String peerGatewayIp=gw.getGatewayIp();
  String peerGuestCidrList=gw.getGuestCidrList();
  String ipsecPsk=gw.getIpsecPsk();
  String ikePolicy=gw.getIkePolicy();
  String espPolicy=gw.getEspPolicy();
  Long ikeLifetime=gw.getIkeLifetime();
  Long espLifetime=gw.getEspLifetime();
  Boolean dpd=gw.getDpd();
  Site2SiteVpnCfgCommand cmd=new Site2SiteVpnCfgCommand(isCreate,localPublicIp,localPublicGateway,localGuestCidr,peerGatewayIp,peerGuestCidrList,ikePolicy,espPolicy,ipsecPsk,ikeLifetime,espLifetime,dpd,conn.isPassive());
  cmd.setAccessDetail(NetworkElementCommand.ROUTER_IP,_routerControlHelper.getRouterControlIp(router.getId()));
  cmd.setAccessDetail(NetworkElementCommand.ROUTER_IP,_routerControlHelper.getRouterControlIp(router.getId()));
  cmd.setAccessDetail(NetworkElementCommand.ROUTER_NAME,router.getInstanceName());
  DataCenterVO dcVo=_dcDao.findById(router.getDataCenterId());
  cmd.setAccessDetail(NetworkElementCommand.ZONE_NETWORK_TYPE,dcVo.getNetworkType().toString());
  cmds.addCommand("applyS2SVpn",cmd);
}
