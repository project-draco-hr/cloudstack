{
  Gson gson=GsonHelper.getBuilder().create();
  AsyncJobManager asyncMgr=getAsyncJobMgr();
  AsyncJobVO job=getJob();
  VMOperationParam param=gson.fromJson(job.getCmdInfo(),VMOperationParam.class);
  if (getSyncSource() == null) {
    asyncMgr.syncAsyncJobExecution(job.getId(),"UserVM",param.getVmId());
    return true;
  }
 else {
    ManagementServer managementServer=asyncMgr.getExecutorContext().getManagementServer();
    managementServer.saveStartedEvent(param.getUserId(),param.getAccountId(),EventTypes.EVENT_VM_STOP,"Stopping Vm with Id: " + param.getVmId(),param.getEventId());
    OperationResponse response=asyncMgr.getExecutorContext().getVmMgr().executeStopVM(this,param);
    UserVmVO vm=managementServer.findUserVMInstanceById(param.getVmId());
    String params="id=" + vm.getId() + "\nvmName="+ vm.getName()+ "\nsoId="+ vm.getServiceOfferingId()+ "\ntId="+ vm.getTemplateId()+ "\ndcId="+ vm.getDataCenterId();
    if (OperationResponse.STATUS_SUCCEEDED == response.getResultCode()) {
      managementServer.saveEvent(param.getUserId(),param.getAccountId(),EventVO.LEVEL_INFO,EventTypes.EVENT_VM_STOP,"Successfully stopped VM instance : " + param.getVmId(),params,param.getEventId());
      return true;
    }
 else     if (OperationResponse.STATUS_FAILED == response.getResultCode()) {
      managementServer.saveEvent(param.getUserId(),param.getAccountId(),EventVO.LEVEL_ERROR,EventTypes.EVENT_VM_STOP,"Failed to stop VM instance : " + response.getResultDescription(),params,param.getEventId());
      return true;
    }
  }
  return false;
}
