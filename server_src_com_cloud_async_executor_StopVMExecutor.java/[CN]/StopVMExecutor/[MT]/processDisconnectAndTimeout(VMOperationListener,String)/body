{
  UserVmVO vm=listener.getVm();
  VMOperationParam param=listener.getParam();
  AsyncJobManager asyncMgr=getAsyncJobMgr();
  EventVO event=new EventVO();
  event.setUserId(param.getUserId());
  event.setAccountId(vm.getAccountId());
  event.setType(EventTypes.EVENT_VM_STOP);
  event.setParameters("id=" + vm.getId() + "\nvmName="+ vm.getName()+ "\nsoId="+ vm.getServiceOfferingId()+ "\ntId="+ vm.getTemplateId()+ "\ndcId="+ vm.getDataCenterId());
  event.setDescription("failed to stop VM instance : " + vm.getName() + " due to "+ resultMessage);
  event.setLevel(EventVO.LEVEL_ERROR);
  asyncMgr.completeAsyncJob(getJob().getId(),AsyncJobResult.STATUS_FAILED,0,resultMessage);
  asyncMgr.getExecutorContext().getEventDao().persist(event);
  asyncMgr.releaseSyncSource(this);
}
