{
  Map<String,TemplateInfo> tmplts=cmd.getTemplateInfo();
  if ((tmplts != null) && !tmplts.isEmpty()) {
    TemplateInfo xenPVISO=tmplts.get("xs-tools");
    if (xenPVISO != null) {
      VMTemplateVO tmplt=_tmpltDao.findByName(xenPVISO.getTemplateName());
      Long id;
      if (tmplt == null) {
        id=_tmpltDao.getNextInSequence(Long.class,"id");
        VMTemplateVO template=new VMTemplateVO(id,xenPVISO.getTemplateName(),xenPVISO.getTemplateName(),ImageFormat.ISO,true,true,FileSystem.cdfs,"/opt/xensource/packages/iso/xs-tools-5.5.0.iso",null,true,64,Account.ACCOUNT_ID_SYSTEM,null,"xen-pv-drv-iso",false,1,false,HypervisorType.None);
        _tmpltDao.persist(template);
      }
 else {
        id=_tmpltDao.findByName(xenPVISO.getTemplateName()).getId();
      }
      VMTemplateHostVO tmpltHost=_vmTemplateHostDao.findByHostTemplate(Hostid,id);
      if (tmpltHost == null) {
        VMTemplateHostVO vmTemplateHost=new VMTemplateHostVO(Hostid,id,new Date(),100,VMTemplateStorageResourceAssoc.Status.DOWNLOADED,null,null,null,"iso/users/2/xs-tools",null);
        vmTemplateHost.setSize(xenPVISO.getSize());
        _vmTemplateHostDao.persist(vmTemplateHost);
      }
    }
  }
}
