{
  if (!initTopologySyncDone && _latestTopology != null) {
    initTopologySyncDone=true;
    if (_bigswitchBcfApi.isNatEnabled()) {
      try {
        executeRequest(new SyncBcfTopologyCommand(true,true),_numRetries);
      }
 catch (      Exception e) {
        logger.error("BigSwitch BCF sync error",e);
      }
    }
 else {
      try {
        executeRequest(new SyncBcfTopologyCommand(true,false),_numRetries);
      }
 catch (      Exception e) {
        logger.error("BigSwitch BCF sync error",e);
      }
    }
  }
  try {
    ControlClusterStatus ccs=_bigswitchBcfApi.getControlClusterStatus();
    if (!ccs.getStatus()) {
      logger.error("ControlCluster state is not ready: " + ccs.getStatus());
      return null;
    }
    if (ccs.isTopologySyncRequested()) {
      if (_latestTopology != null) {
        if (_bigswitchBcfApi.isNatEnabled()) {
          executeRequest(new SyncBcfTopologyCommand(true,true),_numRetries);
        }
 else {
          executeRequest(new SyncBcfTopologyCommand(true,false),_numRetries);
        }
      }
 else {
        logger.debug("topology sync needed but no topology history");
      }
    }
  }
 catch (  BigSwitchBcfApiException e) {
    logger.error("getControlClusterStatus failed",e);
    return null;
  }
  try {
    Capabilities cap=_bigswitchBcfApi.getCapabilities();
    if (cap.isTopologySyncRequested()) {
      if (_latestTopology != null) {
        if (_bigswitchBcfApi.isNatEnabled()) {
          executeRequest(new SyncBcfTopologyCommand(true,true),_numRetries);
        }
 else {
          executeRequest(new SyncBcfTopologyCommand(true,false),_numRetries);
        }
      }
    }
  }
 catch (  BigSwitchBcfApiException e) {
    logger.error("getCapabilities failed",e);
  }
  return new PingCommand(Host.Type.L2Networking,id);
}
