{
  if (rootVolumeOfVm.getPoolId() == null || volume.getPoolId() == null) {
    return false;
  }
  DataStore storeForRootVol=dataStoreMgr.getPrimaryDataStore(rootVolumeOfVm.getPoolId());
  DataStore storeForDataVol=dataStoreMgr.getPrimaryDataStore(volume.getPoolId());
  Scope storeForRootStoreScope=storeForRootVol.getScope();
  if (storeForRootStoreScope == null) {
    throw new CloudRuntimeException("Can't get scope of data store: " + storeForRootVol.getId());
  }
  Scope storeForDataStoreScope=storeForDataVol.getScope();
  if (storeForDataStoreScope == null) {
    throw new CloudRuntimeException("Can't get scope of data store: " + storeForDataVol.getId());
  }
  if (storeForDataStoreScope.getScopeType() == ScopeType.ZONE) {
    return false;
  }
  if (storeForRootStoreScope.getScopeType() != storeForDataStoreScope.getScopeType()) {
    if (storeForDataStoreScope.getScopeType() == ScopeType.CLUSTER) {
      Long vmClusterId=null;
      if (storeForRootStoreScope.getScopeType() == ScopeType.HOST) {
        HostScope hs=(HostScope)storeForRootStoreScope;
        vmClusterId=hs.getClusterId();
      }
 else       if (storeForRootStoreScope.getScopeType() == ScopeType.ZONE) {
        Long hostId=_vmInstanceDao.findById(rootVolumeOfVm.getInstanceId()).getHostId();
        if (hostId != null) {
          HostVO host=_hostDao.findById(hostId);
          vmClusterId=host.getClusterId();
        }
      }
      if (storeForDataStoreScope.getScopeId().equals(vmClusterId)) {
        return false;
      }
    }
 else     if (storeForDataStoreScope.getScopeType() == ScopeType.HOST && (storeForRootStoreScope.getScopeType() == ScopeType.CLUSTER || storeForRootStoreScope.getScopeType() == ScopeType.ZONE)) {
      Long hostId=_vmInstanceDao.findById(rootVolumeOfVm.getInstanceId()).getHostId();
      if (storeForDataStoreScope.getScopeId().equals(hostId)) {
        return false;
      }
    }
    throw new CloudRuntimeException("Can't move volume between scope: " + storeForDataStoreScope.getScopeType() + " and "+ storeForRootStoreScope.getScopeType());
  }
  return !storeForRootStoreScope.isSameScope(storeForDataStoreScope);
}
