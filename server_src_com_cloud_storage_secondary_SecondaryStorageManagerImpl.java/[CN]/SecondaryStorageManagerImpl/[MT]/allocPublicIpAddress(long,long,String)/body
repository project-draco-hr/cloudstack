{
  if (_IpAllocator != null && _IpAllocator.exteralIpAddressAllocatorEnabled()) {
    IpAddrAllocator.IpAddr ip=_IpAllocator.getPublicIpAddress(macAddr,dcId,podId);
    networkInfo net=new networkInfo(ip.ipaddr,ip.netMask,ip.gateway,null,"untagged");
    return net;
  }
  Pair<String,VlanVO> ipAndVlan=_vlanDao.assignIpAddress(dcId,Account.ACCOUNT_ID_SYSTEM,DomainVO.ROOT_DOMAIN,VlanType.VirtualNetwork,true);
  if (ipAndVlan == null) {
    s_logger.debug("Unable to get public ip address (type=Virtual) for secondary storage vm for data center  : " + dcId);
    ipAndVlan=_vlanDao.assignPodDirectAttachIpAddress(dcId,podId,Account.ACCOUNT_ID_SYSTEM,DomainVO.ROOT_DOMAIN);
    if (ipAndVlan == null) {
      s_logger.debug("Unable to get public ip address (type=DirectAttach) for secondary storage vm for data center  : " + dcId);
    }
  }
  if (ipAndVlan != null) {
    VlanVO vlan=ipAndVlan.second();
    networkInfo net=new networkInfo(ipAndVlan.first(),vlan.getVlanNetmask(),vlan.getVlanGateway(),vlan.getId(),vlan.getVlanId());
    return net;
  }
  return null;
}
