{
  if (ssAHostId == null) {
    return true;
  }
  HostVO ssAHost=_hostDao.findById(ssAHostId);
  Long zoneId=ssAHost.getDataCenterId();
  SecondaryStorageVmVO thisSecStorageVm=_secStorageVmDao.findByInstanceName(ssAHost.getName());
  if (thisSecStorageVm == null) {
    s_logger.warn("secondary storage VM " + ssAHost.getName() + " doesn't exist");
    return false;
  }
  String copyPort=_useSSlCopy ? "443" : Integer.toString(TemplateConstants.DEFAULT_TMPLT_COPY_PORT);
  SecStorageFirewallCfgCommand cpc=new SecStorageFirewallCfgCommand();
  SecStorageFirewallCfgCommand thiscpc=new SecStorageFirewallCfgCommand();
  thiscpc.addPortConfig(thisSecStorageVm.getPublicIpAddress(),copyPort,true,TemplateConstants.DEFAULT_TMPLT_COPY_INTF);
  SearchCriteriaService<HostVO,HostVO> sc=SearchCriteria2.create(HostVO.class);
  sc.addAnd(sc.getEntity().getDataCenterId(),Op.EQ,zoneId);
  sc.addAnd(sc.getEntity().getType(),Op.EQ,Host.Type.SecondaryStorageVM);
  sc.addAnd(sc.getEntity().getStatus(),Op.IN,com.cloud.host.Status.Up,com.cloud.host.Status.Connecting);
  List<HostVO> ssvms=sc.list();
  for (  HostVO ssvm : ssvms) {
    Answer answer=_agentMgr.easySend(ssvm.getId(),thiscpc);
    if (answer != null && answer.getResult()) {
      if (s_logger.isDebugEnabled()) {
        s_logger.debug("Successfully programmed firewall rules into SSVM " + ssvm.getName());
      }
    }
 else {
      if (s_logger.isDebugEnabled()) {
        s_logger.debug("failed to program firewall rules into secondary storage vm : " + ssvm.getName());
      }
      return false;
    }
  }
  Answer answer=_agentMgr.easySend(ssAHostId,cpc);
  if (answer != null && answer.getResult()) {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Successfully programmed firewall rules into " + thisSecStorageVm.getHostName());
    }
  }
 else {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("failed to program firewall rules into secondary storage vm : " + thisSecStorageVm.getHostName());
    }
    return false;
  }
  return true;
}
