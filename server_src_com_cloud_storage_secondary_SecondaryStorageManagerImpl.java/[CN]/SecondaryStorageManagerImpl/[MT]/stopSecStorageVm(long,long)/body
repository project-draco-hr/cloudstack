{
  AsyncJobExecutor asyncExecutor=BaseAsyncJobExecutor.getCurrentExecutor();
  if (asyncExecutor != null) {
    AsyncJobVO job=asyncExecutor.getJob();
    if (s_logger.isInfoEnabled())     s_logger.info("Stop secondary storage vm " + secStorageVmId + ", update async job-"+ job.getId());
    _asyncMgr.updateAsyncJobAttachment(job.getId(),"secStorageVm",secStorageVmId);
  }
  long eventId=saveStartedEvent(User.UID_SYSTEM,Account.ACCOUNT_ID_SYSTEM,EventTypes.EVENT_SSVM_STOP,"Stopping secondary storage Vm with Id: " + secStorageVmId,startEventId);
  if (startEventId == 0) {
    startEventId=eventId;
  }
  SecondaryStorageVmVO secStorageVm=_secStorageVmDao.findById(secStorageVmId);
  if (secStorageVm == null) {
    String msg="Stopping secondary storage vm failed: secondary storage vm " + secStorageVmId + " no longer exists";
    if (s_logger.isDebugEnabled())     s_logger.debug(msg);
    saveFailedEvent(User.UID_SYSTEM,Account.ACCOUNT_ID_SYSTEM,EventTypes.EVENT_SSVM_STOP,msg,startEventId);
    return false;
  }
  try {
    return stop(secStorageVm,startEventId);
  }
 catch (  AgentUnavailableException e) {
    if (s_logger.isDebugEnabled())     s_logger.debug("Stopping secondary storage vm " + secStorageVm.getHostName() + " faled : exception "+ e.toString());
    return false;
  }
}
