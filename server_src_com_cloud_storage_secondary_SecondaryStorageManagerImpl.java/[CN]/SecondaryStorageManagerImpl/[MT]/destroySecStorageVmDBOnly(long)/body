{
  Transaction txn=Transaction.currentTxn();
  try {
    txn.start();
    _volsDao.deleteVolumesByInstance(vmId);
    SecondaryStorageVmVO secStorageVm=_secStorageVmDao.findById(vmId);
    if (secStorageVm != null) {
      if (secStorageVm.getPublicIpAddress() != null)       freePublicIpAddress(secStorageVm.getPublicIpAddress(),secStorageVm.getDataCenterId(),secStorageVm.getPodId());
      _secStorageVmDao.remove(vmId);
      final EventVO event=new EventVO();
      event.setUserId(User.UID_SYSTEM);
      event.setAccountId(Account.ACCOUNT_ID_SYSTEM);
      event.setType(EventTypes.EVENT_SSVM_DESTROY);
      event.setLevel(EventVO.LEVEL_INFO);
      event.setDescription("Secondary Storage Vm destroyed - " + secStorageVm.getHostName());
      _eventDao.persist(event);
    }
    txn.commit();
    return true;
  }
 catch (  Exception e) {
    s_logger.error("Caught this error: ",e);
    txn.rollback();
    return false;
  }
 finally {
    s_logger.debug("secondary storage vm vm is destroyed from DB : " + vmId);
  }
}
