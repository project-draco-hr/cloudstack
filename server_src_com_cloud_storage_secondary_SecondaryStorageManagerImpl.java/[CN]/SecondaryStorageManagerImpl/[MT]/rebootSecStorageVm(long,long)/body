{
  AsyncJobExecutor asyncExecutor=BaseAsyncJobExecutor.getCurrentExecutor();
  if (asyncExecutor != null) {
    AsyncJobVO job=asyncExecutor.getJob();
    if (s_logger.isInfoEnabled())     s_logger.info("Reboot secondary storage vm " + secStorageVmId + ", update async job-"+ job.getId());
    _asyncMgr.updateAsyncJobAttachment(job.getId(),"secstorage_vm",secStorageVmId);
  }
  final SecondaryStorageVmVO secStorageVm=_secStorageVmDao.findById(secStorageVmId);
  long eventId=saveStartedEvent(User.UID_SYSTEM,Account.ACCOUNT_ID_SYSTEM,EventTypes.EVENT_SSVM_REBOOT,"Rebooting secondary storage Vm Id: " + secStorageVmId,startEventId);
  if (startEventId == 0) {
    startEventId=eventId;
  }
  if (secStorageVm == null || secStorageVm.getState() == State.Destroyed) {
    saveFailedEvent(User.UID_SYSTEM,Account.ACCOUNT_ID_SYSTEM,EventTypes.EVENT_SSVM_REBOOT,"Rebooting secondary storage Vm failed",startEventId);
    return false;
  }
  if (secStorageVm.getState() == State.Running && secStorageVm.getHostId() != null) {
    final RebootCommand cmd=new RebootCommand(secStorageVm.getInstanceName());
    final Answer answer=_agentMgr.easySend(secStorageVm.getHostId(),cmd);
    if (answer != null) {
      if (s_logger.isDebugEnabled())       s_logger.debug("Successfully reboot secondary storage vm " + secStorageVm.getName());
      SubscriptionMgr.getInstance().notifySubscribers(ALERT_SUBJECT,this,new SecStorageVmAlertEventArgs(SecStorageVmAlertEventArgs.SSVM_REBOOTED,secStorageVm.getDataCenterId(),secStorageVm.getId(),secStorageVm,null));
      final EventVO event=new EventVO();
      event.setUserId(User.UID_SYSTEM);
      event.setAccountId(Account.ACCOUNT_ID_SYSTEM);
      event.setType(EventTypes.EVENT_SSVM_REBOOT);
      event.setLevel(EventVO.LEVEL_INFO);
      event.setStartId(startEventId);
      event.setDescription("Secondary Storage Vm rebooted - " + secStorageVm.getName());
      _eventDao.persist(event);
      return true;
    }
 else {
      String msg="Rebooting Secondary Storage VM failed - " + secStorageVm.getName();
      saveFailedEvent(User.UID_SYSTEM,Account.ACCOUNT_ID_SYSTEM,EventTypes.EVENT_SSVM_REBOOT,msg,startEventId);
      if (s_logger.isDebugEnabled())       s_logger.debug(msg);
      return false;
    }
  }
 else {
    saveFailedEvent(User.UID_SYSTEM,Account.ACCOUNT_ID_SYSTEM,EventTypes.EVENT_SSVM_REBOOT,"Secondary Storage not in running state. Starting Vm",startEventId);
    return startSecStorageVm(secStorageVmId,0) != null;
  }
}
