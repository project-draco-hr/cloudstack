{
  UserVO dbUser=getUser(username);
  if ((dbUser == null) || (dbUser.getId().longValue() == id)) {
    UserVO ub=createForUpdate();
    ub.setUsername(username);
    ub.setPassword(password);
    ub.setFirstname(firstname);
    ub.setLastname(lastname);
    ub.setEmail(email);
    ub.setAccountId(accountId);
    ub.setTimezone(timezone);
    ub.setApiKey(apiKey);
    ub.setSecretKey(secretKey);
    update(id,ub);
  }
 else {
    throw new CloudRuntimeException("unable to update user -- a user with that name exists");
  }
}
