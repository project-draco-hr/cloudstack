{
  Boolean swiftEnable=Boolean.valueOf(_configDao.getValue(Config.SwiftEnable.key()));
  if (!swiftEnable) {
    return;
  }
  GlobalLock swiftTemplateSyncLock=GlobalLock.getInternLock("templatemgr.swiftTemplateSync");
  try {
    if (swiftTemplateSyncLock.lock(3)) {
      try {
        List<VMTemplateHostVO> templtHostRefs=_tmpltHostDao.listByState(VMTemplateHostVO.Status.DOWNLOADED);
        List<VMTemplateSwiftVO> templtSwiftRefs=_tmpltSwiftDao.listAll();
        for (        VMTemplateHostVO templtHostRef : templtHostRefs) {
          boolean found=false;
          for (          VMTemplateSwiftVO templtSwiftRef : templtSwiftRefs) {
            if (templtHostRef.getTemplateId() == templtSwiftRef.getTemplateId()) {
              found=true;
              break;
            }
          }
          if (!found) {
            try {
              uploadTemplateToSwiftFromSecondaryStorage(templtHostRef);
            }
 catch (            Exception e) {
              s_logger.debug("failed to upload template " + templtHostRef.getTemplateId() + " to Swift due to "+ e.toString());
            }
          }
        }
      }
 catch (      Throwable e) {
        s_logger.error("Problem with sync swift template due to " + e.toString(),e);
      }
 finally {
        swiftTemplateSyncLock.unlock();
      }
    }
  }
  finally {
    swiftTemplateSyncLock.releaseRef();
  }
}
