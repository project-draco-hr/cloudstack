{
  List<StoragePoolVO> pools=_poolDao.listByStatus(StoragePoolStatus.Up);
  for (  final StoragePoolVO pool : pools) {
    if (pool.getDataCenterId() == zoneId) {
      s_logger.info("Schedule to preload template " + template.getId() + " into primary storage "+ pool.getId());
      _preloadExecutor.execute(new ManagedContextRunnable(){
        @Override protected void runInContext(){
          try {
            reallyRun();
          }
 catch (          Throwable e) {
            s_logger.warn("Unexpected exception ",e);
          }
        }
        private void reallyRun(){
          s_logger.info("Start to preload template " + template.getId() + " into primary storage "+ pool.getId());
          StoragePool pol=(StoragePool)_dataStoreMgr.getPrimaryDataStore(pool.getId());
          prepareTemplateForCreate(template,pol);
          s_logger.info("End of preloading template " + template.getId() + " into primary storage "+ pool.getId());
        }
      }
);
    }
 else {
      s_logger.info("Skip loading template " + template.getId() + " into primary storage "+ pool.getId()+ " as pool zone "+ pool.getDataCenterId()+ " is different from the requested zone "+ zoneId);
    }
  }
}
