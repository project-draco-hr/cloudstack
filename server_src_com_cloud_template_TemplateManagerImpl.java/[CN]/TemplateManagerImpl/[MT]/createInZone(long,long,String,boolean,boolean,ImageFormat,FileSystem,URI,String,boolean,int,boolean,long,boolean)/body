{
  Long id=_tmpltDao.getNextInSequence(Long.class,"id");
  UserVO user=_userDao.findById(userId);
  long accountId=user.getAccountId();
  VMTemplateVO template=new VMTemplateVO(id,displayText,format,isPublic,featured,fs,url.toString(),requiresHvm,bits,accountId,chksum,displayText,enablePassword,guestOSId,bootable);
  Long templateId=_tmpltDao.addTemplateToZone(template,zoneId);
  UserAccount userAccount=_userAccountDao.findById(userId);
  saveEvent(userId,userAccount.getAccountId(),userAccount.getDomainId(),EventTypes.EVENT_TEMPLATE_DOWNLOAD_START,"Started download of template:  " + template.getName(),null,null);
  _downloadMonitor.downloadTemplateToStorage(id,zoneId);
  _accountMgr.incrementResourceCount(userAccount.getAccountId(),ResourceType.template);
  return templateId;
}
