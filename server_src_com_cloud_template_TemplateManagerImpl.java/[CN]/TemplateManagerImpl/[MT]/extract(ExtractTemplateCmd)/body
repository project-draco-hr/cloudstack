{
  Account caller=CallContext.current().getCallingAccount();
  Long templateId=cmd.getId();
  Long zoneId=cmd.getZoneId();
  String url=cmd.getUrl();
  String mode=cmd.getMode();
  Long eventId=cmd.getStartEventId();
  VirtualMachineTemplate template=getTemplate(templateId);
  if (template == null) {
    throw new InvalidParameterValueException("unable to find template with id " + templateId);
  }
  TemplateAdapter adapter=getAdapter(template.getHypervisorType());
  TemplateProfile profile=adapter.prepareExtractTemplate(cmd);
  return extract(caller,templateId,url,zoneId,mode,eventId,false);
}
