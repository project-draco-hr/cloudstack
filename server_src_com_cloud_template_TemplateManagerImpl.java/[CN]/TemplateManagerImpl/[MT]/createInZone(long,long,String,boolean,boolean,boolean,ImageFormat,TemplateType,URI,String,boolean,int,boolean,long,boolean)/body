{
  Long id=_tmpltDao.getNextInSequence(Long.class,"id");
  UserVO user=_userDao.findById(userId);
  long accountId=user.getAccountId();
  VMTemplateVO template=new VMTemplateVO(id,displayText,format,isPublic,featured,isExtractable,type,url.toString(),requiresHvm,bits,accountId,chksum,displayText,enablePassword,guestOSId,bootable,null);
  Long templateId=_tmpltDao.addTemplateToZone(template,zoneId);
  UserAccount userAccount=_userAccountDao.findById(userId);
  _downloadMonitor.downloadTemplateToStorage(id,zoneId);
  _accountMgr.incrementResourceCount(userAccount.getAccountId(),ResourceType.template);
  return templateId;
}
