{
  if (account != null) {
    if (!isAdmin(account.getType())) {
      if (account.getId().longValue() != vmInstanceCheck.getAccountId()) {
        throw new ServerApiException(BaseCmd.ACCOUNT_ERROR,msg + vmInstanceCheck != null ? vmInstanceCheck.getName() : template.getName() + " for this account");
      }
    }
 else     if (!_domainDao.isChildDomain(account.getDomainId(),vmInstanceCheck.getDomainId())) {
      throw new ServerApiException(BaseCmd.ACCOUNT_ERROR,msg + vmInstanceCheck != null ? vmInstanceCheck.getName() : template.getName() + ", permission denied.");
    }
  }
  if (userId == null)   userId=new Long(1);
  return userId;
}
