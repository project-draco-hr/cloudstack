{
  Long templateId=cmd.getId();
  Account caller=UserContext.current().getCaller();
  VMTemplateVO template=_tmpltDao.findById(templateId.longValue());
  if (template == null) {
    throw new InvalidParameterValueException("unable to find template with id " + templateId);
  }
  if (template != null) {
    Account templateOwner=_accountDao.findById(template.getAccountId());
    if (caller.getType() == Account.ACCOUNT_TYPE_NORMAL) {
      if (caller.getId() != templateOwner.getId()) {
        throw new PermissionDeniedException("Account " + caller + " can't operate with template id="+ template.getId());
      }
    }
 else     if (caller.getType() == Account.ACCOUNT_TYPE_DOMAIN_ADMIN) {
      _accountMgr.checkAccess(caller,templateOwner);
    }
  }
  if (template.getFormat() == ImageFormat.ISO) {
    throw new InvalidParameterValueException("Please specify a valid template.");
  }
  TemplateAdapter adapter=getAdapter(template.getHypervisorType());
  TemplateProfile profile=adapter.prepareDelete(cmd);
  return adapter.delete(profile);
}
