{
  SearchCriteria<VMTemplateHostVO> sc=HostTemplateStatesSearch.create();
  sc.setParameters("id",templateId);
  sc.setParameters("state",com.cloud.storage.VMTemplateStorageResourceAssoc.Status.DOWNLOADED);
  sc.setJoinParameters("host","dcId",zoneId);
  List<VMTemplateSwiftVO> tsvs=_tmpltSwiftDao.listByTemplateId(templateId);
  Long size=null;
  if (tsvs != null && tsvs.size() > 0) {
    size=tsvs.get(0).getSize();
  }
  if (size == null && _s3Mgr.isS3Enabled()) {
    VMTemplateS3VO vmTemplateS3VO=_vmS3TemplateDao.findOneByTemplateId(templateId);
    if (vmTemplateS3VO != null) {
      size=vmTemplateS3VO.getSize();
    }
  }
  if (size == null) {
    List<VMTemplateHostVO> sss=this.templateHostDao.search(sc,null);
    if (sss == null || sss.size() == 0) {
      throw new CloudRuntimeException("Template " + templateId + " has not been completely downloaded to zone "+ zoneId);
    }
    size=sss.get(0).getSize();
  }
  return size;
}
