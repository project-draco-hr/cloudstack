{
  TemplateAdapter adapter=getAdapter(HypervisorType.getType(cmd.getHypervisor()));
  TemplateProfile profile=adapter.prepare(cmd);
  List<TemplateOrVolumePostUploadCommand> payload=adapter.createTemplateForPostUpload(profile);
  if (CollectionUtils.isNotEmpty(payload)) {
    GetUploadParamsResponse response=new GetUploadParamsResponse();
    TemplateOrVolumePostUploadCommand firstCommand=payload.get(0);
    String url="https://" + firstCommand.getEndPoint().getPublicAddr() + "/upload/"+ firstCommand.getDataObject().getUuid();
    response.setPostURL(new URL(url));
    response.setId(UUID.fromString(firstCommand.getDataObject().getUuid()));
    DateTime currentDateTime=new DateTime(DateTimeZone.UTC);
    currentDateTime.plusHours(1);
    String expires=currentDateTime.toString();
    response.setTimeout(expires);
    Gson gson=new Gson();
    String jsonPayload=gson.toJson(payload);
    response.setMetadata(encodeData(jsonPayload));
    response.setSignature(encodeData(jsonPayload + url + expires));
    return response;
  }
 else {
    return null;
  }
}
