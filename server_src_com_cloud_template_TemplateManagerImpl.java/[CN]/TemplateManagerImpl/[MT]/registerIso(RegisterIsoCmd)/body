{
  Account account=(Account)UserContext.current().getAccountObject();
  Long userId=UserContext.current().getUserId();
  String name=cmd.getName();
  String displayText=cmd.getDisplayText();
  String url=cmd.getUrl();
  Boolean isPublic=cmd.isPublic();
  Boolean featured=cmd.isFeatured();
  Long guestOSId=cmd.getOsTypeId();
  Boolean bootable=cmd.isBootable();
  Long zoneId=cmd.getZoneId();
  if (isPublic == null) {
    isPublic=Boolean.FALSE;
  }
  if (zoneId.longValue() == -1) {
    zoneId=null;
  }
  long accountId=1L;
  if (account != null) {
    accountId=account.getId();
  }
  Account accountObj;
  if (account == null) {
    accountObj=_accountDao.findById(accountId);
  }
 else {
    accountObj=account;
  }
  boolean isAdmin=(accountObj.getType() == Account.ACCOUNT_TYPE_ADMIN);
  if (!isAdmin && zoneId == null) {
    throw new ServerApiException(BaseCmd.PARAM_ERROR,"Please specify a valid zone Id.");
  }
  if ((!url.toLowerCase().endsWith("iso")) && (!url.toLowerCase().endsWith("iso.zip")) && (!url.toLowerCase().endsWith("iso.bz2"))&& (!url.toLowerCase().endsWith("iso.gz"))) {
    throw new ServerApiException(BaseCmd.PARAM_ERROR,"Please specify a valid iso");
  }
  boolean allowPublicUserTemplates=Boolean.parseBoolean(_configDao.getValue("allow.public.user.templates"));
  if (!isAdmin && !allowPublicUserTemplates && isPublic) {
    throw new ServerApiException(BaseCmd.PARAM_ERROR,"Only private ISOs can be created.");
  }
  if (!isAdmin || featured == null) {
    featured=Boolean.FALSE;
  }
  if (userId == null) {
    userId=Long.valueOf(1);
  }
  if (bootable == null) {
    bootable=Boolean.TRUE;
  }
  if (url.toLowerCase().contains("file://")) {
    throw new ServerApiException(BaseCmd.PARAM_ERROR,"File:// type urls are currently unsupported");
  }
  return createTemplateOrIso(userId,zoneId,name,displayText,isPublic.booleanValue(),featured.booleanValue(),ImageFormat.ISO.toString(),FileSystem.cdfs.toString(),url,null,true,64,false,guestOSId,bootable);
}
