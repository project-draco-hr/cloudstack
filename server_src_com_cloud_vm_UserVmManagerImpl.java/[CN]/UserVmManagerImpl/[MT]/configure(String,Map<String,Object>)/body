{
  _name=name;
  ComponentLocator locator=ComponentLocator.getCurrentLocator();
  _configDao=locator.getDao(ConfigurationDao.class);
  if (_configDao == null) {
    throw new ConfigurationException("Unable to get the configuration dao.");
  }
  Map<String,String> configs=_configDao.getConfiguration("AgentManager",params);
  _defaultNetworkDomain=configs.get("domain");
  if (_defaultNetworkDomain == null) {
    _defaultNetworkDomain=".myvm.com";
  }
  if (!_defaultNetworkDomain.startsWith(".")) {
    _defaultNetworkDomain="." + _defaultNetworkDomain;
  }
  String value=configs.get("start.retry");
  _retry=NumbersUtil.parseInt(value,2);
  _instance=configs.get("instance.name");
  if (_instance == null) {
    _instance="DEFAULT";
  }
  String workers=configs.get("expunge.workers");
  int wrks=NumbersUtil.parseInt(workers,10);
  String time=configs.get("expunge.interval");
  _expungeInterval=NumbersUtil.parseInt(time,86400);
  time=configs.get("expunge.delay");
  _expungeDelay=NumbersUtil.parseInt(time,_expungeInterval);
  String maxCap=configs.get("cpu.uservm.cap");
  _userVMCap=NumbersUtil.parseInt(maxCap,0);
  _useNewNetworking=Boolean.parseBoolean(configs.get("use.new.networking"));
  _executor=Executors.newScheduledThreadPool(wrks,new NamedThreadFactory("UserVm-Scavenger"));
  _haMgr.registerHandler(Type.User,this);
  _itMgr.registerGuru(Type.User,this);
  s_logger.info("User VM Manager is configured.");
  Adapters<IpAddrAllocator> ipAllocators=locator.getAdapters(IpAddrAllocator.class);
  if (ipAllocators != null && ipAllocators.isSet()) {
    Enumeration<IpAddrAllocator> it=ipAllocators.enumeration();
    _IpAllocator=it.nextElement();
  }
  return true;
}
