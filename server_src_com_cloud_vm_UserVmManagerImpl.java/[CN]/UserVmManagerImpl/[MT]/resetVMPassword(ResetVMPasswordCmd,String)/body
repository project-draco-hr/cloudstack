{
  Account account=UserContext.current().getAccount();
  Long userId=UserContext.current().getUserId();
  Long vmId=cmd.getId();
  UserVmVO userVm=_vmDao.findById(cmd.getId());
  if (userVm == null) {
    throw new InvalidParameterValueException("unable to find a virtual machine with id " + cmd.getId());
  }
  VMTemplateVO template=_templateDao.findById(userVm.getTemplateId());
  if (template == null || !template.getEnablePassword()) {
    throw new InvalidParameterValueException("Fail to reset password for the virtual machine, the template is not password enabled");
  }
  userId=accountAndUserValidation(vmId,account,userId,userVm);
  boolean result=resetVMPasswordInternal(cmd,password);
  if (result) {
    userVm.setPassword(password);
    EventUtils.saveEvent(userId,userVm.getAccountId(),EventVO.LEVEL_INFO,EventTypes.EVENT_VM_RESETPASSWORD,"successfully reset password for VM : " + userVm.getName(),null);
  }
 else {
    EventUtils.saveEvent(userId,userVm.getAccountId(),EventVO.LEVEL_ERROR,EventTypes.EVENT_VM_RESETPASSWORD,"unable to reset password for VM : " + userVm.getName(),null);
  }
  return userVm;
}
