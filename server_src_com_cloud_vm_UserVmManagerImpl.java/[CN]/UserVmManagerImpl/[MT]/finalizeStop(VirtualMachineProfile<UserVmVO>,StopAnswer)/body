{
  VMInstanceVO vm=profile.getVirtualMachine();
  UsageEventVO usageEvent=new UsageEventVO(EventTypes.EVENT_VM_STOP,vm.getAccountId(),vm.getDataCenterId(),vm.getId(),vm.getName());
  _usageEventDao.persist(usageEvent);
  List<NicVO> nics=_nicDao.listByVmId(vm.getId());
  for (  NicVO nic : nics) {
    NetworkVO network=_networkDao.findById(nic.getNetworkId());
    usageEvent=new UsageEventVO(EventTypes.EVENT_NETWORK_OFFERING_REMOVE,vm.getAccountId(),vm.getDataCenterId(),vm.getId(),null,network.getNetworkOfferingId(),null,0L);
    _usageEventDao.persist(usageEvent);
  }
}
