{
  VMInstanceVO vm=profile.getVirtualMachine();
  UsageEventVO usageEvent=new UsageEventVO(EventTypes.EVENT_VM_STOP,vm.getAccountId(),vm.getDataCenterId(),vm.getId(),vm.getName(),vm.getServiceOfferingId(),vm.getTemplateId(),null);
  _usageEventDao.persist(usageEvent);
  List<NicVO> nics=_nicDao.listBy(vm.getId());
  for (  NicVO nic : nics) {
    NetworkVO network=_networkDao.findById(nic.getNetworkId());
    usageEvent=new UsageEventVO(EventTypes.EVENT_NETWORK_OFFERING_DELETE,vm.getAccountId(),vm.getDataCenterId(),vm.getId(),null,network.getNetworkOfferingId(),null,null);
    _usageEventDao.persist(usageEvent);
  }
}
