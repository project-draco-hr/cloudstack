{
  CheckVirtualMachineCommand cvm=new CheckVirtualMachineCommand(vm.getInstanceName());
  CheckVirtualMachineAnswer answer=(CheckVirtualMachineAnswer)_agentMgr.send(host.getId(),cvm);
  if (!answer.getResult()) {
    s_logger.debug("Unable to complete migration for " + vm.toString());
    _vmDao.updateIf(vm,Event.AgentReportStopped,null);
    return false;
  }
  State state=answer.getState();
  if (state == State.Stopped) {
    s_logger.warn("Unable to complete migration as we can not detect it on " + host.toString());
    _vmDao.updateIf(vm,Event.AgentReportStopped,null);
    return false;
  }
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Marking port " + answer.getVncPort() + " on "+ host.getId());
  }
  Transaction txn=Transaction.currentTxn();
  try {
    txn.start();
    _vmDao.updateIf(vm,Event.OperationSucceeded,host.getId());
    txn.commit();
    _networkGroupManager.handleVmStateTransition(vm,State.Running);
    return true;
  }
 catch (  Exception e) {
    s_logger.warn("Exception during completion of migration process " + vm.toString());
    return false;
  }
}
