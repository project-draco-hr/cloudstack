{
  boolean status=false;
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Stopping vm=" + vmId);
  }
  UserVmVO vm=_vmDao.findById(vmId);
  if (vm == null || vm.getRemoved() != null) {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("VM is either removed or deleted.");
    }
    return true;
  }
  long startEventId=EventUtils.saveStartedEvent(userId,vm.getAccountId(),EventTypes.EVENT_VM_STOP,"stopping Vm with Id: " + vmId);
  User user=_userDao.findById(userId);
  Account account=_accountDao.findById(user.getAccountId());
  try {
    status=_itMgr.stop(vm,user,account);
  }
 catch (  ResourceUnavailableException e) {
    s_logger.debug("Unable to stop due to ",e);
    status=false;
  }
  if (status) {
    EventUtils.saveEvent(userId,vm.getAccountId(),EventVO.LEVEL_INFO,EventTypes.EVENT_VM_STOP,"Successfully stopped VM instance : " + vmId,startEventId);
    return status;
  }
 else {
    EventUtils.saveEvent(userId,vm.getAccountId(),EventVO.LEVEL_ERROR,EventTypes.EVENT_VM_STOP,"Error stopping VM instance : " + vmId,startEventId);
    return status;
  }
}
