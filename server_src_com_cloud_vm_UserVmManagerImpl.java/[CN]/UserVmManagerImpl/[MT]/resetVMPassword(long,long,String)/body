{
  UserVmVO vm=_vmDao.findById(vmId);
  VMTemplateVO template=_templateDao.findById(vm.getTemplateId());
  if (template.getEnablePassword()) {
    if (vm.getDomainRouterId() == null)     return true;
    if (_networkMgr.savePasswordToRouter(vm.getDomainRouterId(),vm.getPrivateIpAddress(),password)) {
      if (!rebootVirtualMachine(userId,vmId)) {
        if (vm.getState() == State.Stopped) {
          return true;
        }
        return false;
      }
 else {
        return true;
      }
    }
 else {
      return false;
    }
  }
 else {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Reset password called for a vm that is not using a password enabled template");
    }
    return false;
  }
}
