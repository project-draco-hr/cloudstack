{
  long vmId=cmd.getEntityId();
  UserVmVO vm=_vmDao.findById(vmId);
  VMTemplateVO template=_templateDao.findById(vm.getTemplateId());
  String password="saved_password";
  if (template.getEnablePassword()) {
    password=generateRandomPassword();
  }
  if (password == null || password.equals("") || (!validPassword(password))) {
    throw new InvalidParameterValueException("A valid password for this virtual machine was not provided.");
  }
  vm.setPassword(password);
  long userId=UserContext.current().getUserId();
  UserVO caller=_userDao.findById(userId);
  AccountVO owner=_accountDao.findById(vm.getAccountId());
  try {
    vm=_itMgr.start(vm,null,caller,owner,cmd.getHypervisor());
  }
  finally {
    updateVmStateForFailedVmCreation(vm.getId());
  }
  vm.setPassword(password);
  return vm;
}
