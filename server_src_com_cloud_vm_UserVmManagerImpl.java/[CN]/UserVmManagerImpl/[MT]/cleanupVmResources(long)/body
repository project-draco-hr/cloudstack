{
  boolean success=true;
  _securityGroupMgr.removeInstanceFromGroups(vmId);
  removeInstanceFromInstanceGroup(vmId);
  if (_firewallMgr.revokeFirewallRulesForVm(vmId)) {
    logger.debug("Firewall rules are removed successfully as a part of vm id=" + vmId + " expunge");
  }
 else {
    success=false;
    logger.warn("Fail to remove firewall rules as a part of vm id=" + vmId + " expunge");
  }
  if (_rulesMgr.revokePortForwardingRulesForVm(vmId)) {
    logger.debug("Port forwarding rules are removed successfully as a part of vm id=" + vmId + " expunge");
  }
 else {
    success=false;
    logger.warn("Fail to remove port forwarding rules as a part of vm id=" + vmId + " expunge");
  }
  if (_lbMgr.removeVmFromLoadBalancers(vmId)) {
    logger.debug("Removed vm id=" + vmId + " from all load balancers as a part of expunge process");
  }
 else {
    success=false;
    logger.warn("Fail to remove vm id=" + vmId + " from load balancers as a part of expunge process");
  }
  List<IPAddressVO> ips=_ipAddressDao.findAllByAssociatedVmId(vmId);
  for (  IPAddressVO ip : ips) {
    try {
      if (_rulesMgr.disableStaticNat(ip.getId(),_accountMgr.getAccount(Account.ACCOUNT_ID_SYSTEM),User.UID_SYSTEM,true)) {
        logger.debug("Disabled 1-1 nat for ip address " + ip + " as a part of vm id="+ vmId+ " expunge");
      }
 else {
        logger.warn("Failed to disable static nat for ip address " + ip + " as a part of vm id="+ vmId+ " expunge");
        success=false;
      }
    }
 catch (    ResourceUnavailableException e) {
      success=false;
      logger.warn("Failed to disable static nat for ip address " + ip + " as a part of vm id="+ vmId+ " expunge because resource is unavailable",e);
    }
  }
  return success;
}
