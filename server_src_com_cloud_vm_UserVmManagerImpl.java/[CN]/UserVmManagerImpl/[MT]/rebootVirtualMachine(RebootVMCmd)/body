{
  Account caller=CallContext.current().getCallingAccount();
  Long vmId=cmd.getId();
  UserVmVO vmInstance=_vmDao.findById(vmId.longValue());
  if (vmInstance == null) {
    throw new InvalidParameterValueException("unable to find a virtual machine with id " + vmId);
  }
  _accountMgr.checkAccess(caller,null,true,vmInstance);
  long serviceOfferingId=vmInstance.getServiceOfferingId();
  ServiceOfferingVO offering=_serviceOfferingDao.findById(vmInstance.getId(),serviceOfferingId);
  if (offering != null && offering.getRemoved() == null) {
    if (offering.getVolatileVm()) {
      return restoreVMInternal(caller,vmInstance,null);
    }
  }
 else {
    throw new InvalidParameterValueException("Unable to find service offering: " + serviceOfferingId + " corresponding to the vm");
  }
  return rebootVirtualMachine(CallContext.current().getCallingUserId(),vmId);
}
