{
  UserVmVO vm=_vmDao.findById(vmId);
  if (vm == null) {
    return false;
  }
 else   if (vm.getState() != State.Running) {
    return true;
  }
  Pair<String,String> isoPathPair=_storageMgr.getAbsoluteIsoPath(isoId,vm.getDataCenterId());
  String isoPath;
  String isoName=_templateDao.findById(isoId).getName();
  if (isoPathPair == null) {
    if (isoName.startsWith("xs-tools"))     isoPath=isoName;
 else {
      s_logger.warn("Couldn't get absolute iso path");
      return false;
    }
  }
 else {
    isoPath=isoPathPair.first();
  }
  String vmName=vm.getInstanceName();
  HostVO host=_hostDao.findById(vm.getHostId());
  if (host == null)   return false;
  AttachIsoCommand cmd=new AttachIsoCommand(vmName,isoPath,attach);
  if (isoPathPair != null)   cmd.setStoreUrl(isoPathPair.second());
  Answer a=_agentMgr.easySend(vm.getHostId(),cmd);
  return (a != null);
}
