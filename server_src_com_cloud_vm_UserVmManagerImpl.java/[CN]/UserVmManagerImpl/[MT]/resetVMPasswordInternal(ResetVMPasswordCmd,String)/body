{
  Long vmId=cmd.getId();
  Long userId=UserContext.current().getUserId();
  UserVmVO vmInstance=_vmDao.findById(vmId);
  if (password == null || password.equals("")) {
    return false;
  }
  VMTemplateVO template=_templateDao.findById(vmInstance.getTemplateId());
  if (template.getEnablePassword()) {
    if (vmInstance.getDomainRouterId() == null) {
      return true;
    }
    if (_routerMgr.savePasswordToRouter(vmInstance.getDomainRouterId(),vmInstance.getPrivateIpAddress(),password)) {
      long startId=EventUtils.saveStartedEvent(userId,vmInstance.getAccountId(),EventTypes.EVENT_VM_REBOOT,"Reboot vm with id:" + vmId);
      if (!rebootVirtualMachine(userId,vmId)) {
        EventUtils.saveEvent(userId,vmInstance.getAccountId(),EventVO.LEVEL_ERROR,EventTypes.EVENT_VM_REBOOT,"Failed to reboot vm with id:" + vmId,startId);
        if (vmInstance.getState() == State.Stopped) {
          return true;
        }
        return false;
      }
 else {
        EventUtils.saveEvent(userId,vmInstance.getAccountId(),EventVO.LEVEL_INFO,EventTypes.EVENT_VM_REBOOT,"Successfully rebooted vm with id:" + vmId,startId);
        return true;
      }
    }
 else {
      return false;
    }
  }
 else {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Reset password called for a vm that is not using a password enabled template");
    }
    return false;
  }
}
