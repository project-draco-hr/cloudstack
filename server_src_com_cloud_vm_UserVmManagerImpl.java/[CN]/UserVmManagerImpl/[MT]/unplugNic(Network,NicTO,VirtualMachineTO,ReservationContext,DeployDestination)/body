{
  UserVmVO vmVO=_vmDao.findById(vm.getId());
  if (vmVO.getState() == State.Running) {
    try {
      UnPlugNicCommand unplugNicCmd=new UnPlugNicCommand(nic,vm.getName());
      Commands cmds=new Commands(OnError.Stop);
      cmds.addCommand("unplugnic",unplugNicCmd);
      _agentMgr.send(dest.getHost().getId(),cmds);
      UnPlugNicAnswer unplugNicAnswer=cmds.getAnswer(UnPlugNicAnswer.class);
      if (!(unplugNicAnswer != null && unplugNicAnswer.getResult())) {
        s_logger.warn("Unable to unplug nic for " + vmVO);
        return false;
      }
    }
 catch (    OperationTimedoutException e) {
      throw new AgentUnavailableException("Unable to unplug nic for " + vmVO + " in network "+ network,dest.getHost().getId(),e);
    }
  }
 else   if (vmVO.getState() == State.Stopped || vmVO.getState() == State.Stopping) {
    s_logger.warn(vmVO + " is Stopped, not sending UnPlugNicCommand.  Currently " + vmVO.getState());
  }
 else {
    s_logger.warn("Unable to unplug nic, " + vmVO + " is not in the right state "+ vmVO.getState());
    throw new ResourceUnavailableException("Unable to unplug nic on the backend," + vmVO + " is not in the right state",DataCenter.class,vmVO.getDataCenterIdToDeployIn());
  }
  return true;
}
