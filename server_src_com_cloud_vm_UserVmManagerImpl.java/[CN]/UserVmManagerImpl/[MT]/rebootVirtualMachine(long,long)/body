{
  UserVmVO vm=_vmDao.findById(vmId);
  if (vm == null || vm.getState() == State.Destroyed || vm.getState() == State.Expunging || vm.getRemoved() != null) {
    return false;
  }
  EventVO event=new EventVO();
  event.setUserId(userId);
  event.setAccountId(vm.getAccountId());
  event.setType(EventTypes.EVENT_VM_REBOOT);
  event.setParameters("id=" + vm.getId() + "\nvmName="+ vm.getName()+ "\nsoId="+ vm.getServiceOfferingId()+ "\ntId="+ vm.getTemplateId()+ "\ndcId="+ vm.getDataCenterId());
  if (vm.getState() == State.Running && vm.getHostId() != null) {
    RebootCommand cmd=new RebootCommand(vm.getInstanceName());
    RebootAnswer answer=(RebootAnswer)_agentMgr.easySend(vm.getHostId(),cmd);
    if (answer != null) {
      if (!vm.getName().equals(vm.getDisplayName())) {
        event.setDescription("Successfully rebooted VM instance : " + vm.getName() + "("+ vm.getDisplayName()+ ")");
      }
 else {
        event.setDescription("Successfully rebooted VM instance : " + vm.getName());
      }
      _eventDao.persist(event);
      return true;
    }
 else {
      if (!vm.getName().equals(vm.getDisplayName())) {
        event.setDescription("failed to reboot VM instance : " + vm.getName() + "("+ vm.getDisplayName()+ ")");
      }
 else {
        event.setDescription("failed to reboot VM instance : " + vm.getName());
      }
      event.setLevel(EventVO.LEVEL_ERROR);
      _eventDao.persist(event);
      return false;
    }
  }
 else {
    s_logger.error("Vm id=" + vmId + " is not in Running state, failed to reboot");
    return false;
  }
}
