{
  Account account=UserContext.current().getAccount();
  Long userId=UserContext.current().getUserId();
  UserVmVO vm=_vmDao.findById(vmId);
  if (vm == null) {
    throw new ServerApiException(BaseCmd.PARAM_ERROR,"unable to find a virtual machine with id " + vmId);
  }
  userId=accountAndUserValidation(vmId,account,userId,vm);
  User caller=_userDao.findById(userId);
  EventUtils.saveScheduledEvent(userId,vm.getAccountId(),EventTypes.EVENT_VM_DESTROY,"Destroying Vm with Id: " + vmId);
  boolean status;
  status=_itMgr.destroy(vm,caller,account);
  if (status) {
    EventUtils.saveEvent(userId,vm.getAccountId(),EventTypes.EVENT_VM_DESTROY,"Successfully destroyed vm with id:" + vmId);
    UsageEventVO usageEvent=new UsageEventVO(EventTypes.EVENT_VM_DESTROY,vm.getAccountId(),vm.getDataCenterId(),vm.getId(),vm.getName(),vm.getServiceOfferingId(),vm.getTemplateId(),null);
    _usageEventDao.persist(usageEvent);
    return _vmDao.findById(vmId);
  }
 else {
    EventUtils.saveEvent(userId,vm.getAccountId(),EventTypes.EVENT_VM_DESTROY,"Failed to destroy vm with id:" + vmId);
    throw new CloudRuntimeException("Failed to destroy vm with id " + vmId);
  }
}
