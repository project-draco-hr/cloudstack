{
  Long vmId=vm.getId();
  List<VMSnapshotVO> listSnapshot=_vmSnapshotDao.listByInstanceId(vmId,VMSnapshot.State.Ready,VMSnapshot.State.Creating,VMSnapshot.State.Reverting,VMSnapshot.State.Expunging);
  if (listSnapshot != null && listSnapshot.size() != 0) {
    throw new InvalidParameterValueException("The VM has VM snapshots, do not allowed to attach volume. Please delete the VM snapshots first.");
  }
}
