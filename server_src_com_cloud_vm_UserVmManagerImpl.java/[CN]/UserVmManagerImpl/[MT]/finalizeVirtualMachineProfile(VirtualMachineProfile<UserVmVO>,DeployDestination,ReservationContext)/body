{
  UserVmVO vo=profile.getVirtualMachine();
  VirtualMachineTemplate template=profile.getTemplate();
  if (vo.getIsoId() != null) {
    template=_templateDao.findById(vo.getIsoId());
  }
  if (template != null && template.getFormat() == ImageFormat.ISO) {
    String isoPath=null;
    Pair<String,String> isoPathPair=_storageMgr.getAbsoluteIsoPath(template.getId(),vo.getDataCenterId());
    if (isoPathPair == null) {
      s_logger.warn("Couldn't get absolute iso path");
      return false;
    }
 else {
      isoPath=isoPathPair.first();
    }
    if (template.isBootable())     profile.setBootLoaderType(BootloaderType.CD);
    GuestOSVO guestOS=_guestOSDao.findById(template.getGuestOSId());
    String displayName=null;
    if (guestOS != null) {
      displayName=guestOS.getDisplayName();
    }
    VolumeTO iso=new VolumeTO(profile.getId(),Volume.VolumeType.ISO,StorageResourceType.STORAGE_POOL,StoragePoolType.ISO,null,template.getName(),null,isoPath,0,null,displayName);
    iso.setDeviceId(3);
    profile.addDisk(iso);
    vo.setIsoId(template.getId());
  }
 else {
    VolumeTO iso=new VolumeTO(profile.getId(),Volume.VolumeType.ISO,StorageResourceType.STORAGE_POOL,StoragePoolType.ISO,null,template.getName(),null,null,0,null);
    iso.setDeviceId(3);
    profile.addDisk(iso);
  }
  return true;
}
