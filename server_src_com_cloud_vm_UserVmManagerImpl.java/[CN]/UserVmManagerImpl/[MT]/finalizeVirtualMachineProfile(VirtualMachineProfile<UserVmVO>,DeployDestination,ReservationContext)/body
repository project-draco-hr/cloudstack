{
  UserVmVO vm=profile.getVirtualMachine();
  Map<String,String> details=_vmDetailsDao.findDetails(vm.getId());
  vm.setDetails(details);
  if (vm.getIsoId() != null) {
    TemplateInfo template=templateFactory.getTemplate(vm.getIsoId(),DataStoreRole.Image,vm.getDataCenterId());
    if (template == null || template.getFormat() != ImageFormat.ISO) {
      throw new CloudRuntimeException("Can not find ISO in vm_template table for id " + vm.getIsoId());
    }
    if (template.isBootable()) {
      profile.setBootLoaderType(BootloaderType.CD);
    }
    GuestOSVO guestOS=_guestOSDao.findById(template.getGuestOSId());
    String displayName=null;
    if (guestOS != null) {
      displayName=guestOS.getDisplayName();
    }
    TemplateObjectTO iso=(TemplateObjectTO)template.getTO();
    iso.setGuestOsType(displayName);
    DiskTO disk=new DiskTO(iso,3L,Volume.Type.ISO);
    profile.addDisk(disk);
  }
 else {
    TemplateObjectTO iso=new TemplateObjectTO();
    iso.setFormat(ImageFormat.ISO);
    DiskTO disk=new DiskTO(iso,3L,Volume.Type.ISO);
    profile.addDisk(disk);
  }
  return true;
}
