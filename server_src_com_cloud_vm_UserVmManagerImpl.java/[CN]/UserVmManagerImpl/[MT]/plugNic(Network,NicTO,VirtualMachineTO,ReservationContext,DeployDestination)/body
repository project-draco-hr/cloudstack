{
  UserVmVO vmVO=_vmDao.findById(vm.getId());
  if (vmVO.getState() == State.Running) {
    try {
      PlugNicCommand plugNicCmd=new PlugNicCommand(nic,vm.getName());
      Commands cmds=new Commands(OnError.Stop);
      cmds.addCommand("plugnic",plugNicCmd);
      _agentMgr.send(dest.getHost().getId(),cmds);
      PlugNicAnswer plugNicAnswer=cmds.getAnswer(PlugNicAnswer.class);
      if (!(plugNicAnswer != null && plugNicAnswer.getResult())) {
        s_logger.warn("Unable to plug nic for " + vmVO + " due to: "+ " due to: "+ plugNicAnswer.getDetails());
        return false;
      }
    }
 catch (    OperationTimedoutException e) {
      throw new AgentUnavailableException("Unable to plug nic for " + vmVO + " in network "+ network,dest.getHost().getId(),e);
    }
  }
 else   if (vmVO.getState() == State.Stopped || vmVO.getState() == State.Stopping) {
    s_logger.warn(vmVO + " is Stopped, not sending PlugNicCommand.  Currently " + vmVO.getState());
  }
 else {
    s_logger.warn("Unable to plug nic, " + vmVO + " is not in the right state "+ vmVO.getState());
    throw new ResourceUnavailableException("Unable to plug nic on the backend," + vmVO + " is not in the right state",DataCenter.class,vmVO.getDataCenterId());
  }
  return true;
}
