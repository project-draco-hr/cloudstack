{
  Account account=(Account)UserContext.current().getAccountObject();
  Long userId=UserContext.current().getUserId();
  Long id=cmd.getId();
  UserVmVO vmInstance=_userVmDao.findById(id.longValue());
  if (vmInstance == null) {
    throw new ServerApiException(BaseCmd.VM_INVALID_PARAM_ERROR,"unable to find a virtual machine with id " + id);
  }
  long eventId=EventUtils.saveScheduledEvent(userId,vmInstance.getAccountId(),EventTypes.EVENT_VM_STOP,"stopping Vm with Id: " + id);
  userId=accountAndUserValidation(id,account,userId,vmInstance);
  return stopVirtualMachine(userId,id,eventId);
}
