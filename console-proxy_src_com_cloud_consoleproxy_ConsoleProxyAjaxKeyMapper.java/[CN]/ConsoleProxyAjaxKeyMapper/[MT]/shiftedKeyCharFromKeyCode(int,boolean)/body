{
  if (shiftDown) {
    if (code >= 'A' && code <= 'Z')     return (char)code;
    if (code >= 'a' && code <= 'z')     return (char)('A' + (code - (int)'a'));
    if (shiftedKeyCharMap.containsKey(code))     return (char)(shiftedKeyCharMap.get(code).intValue());
  }
 else {
    if (code >= 'A' && code <= 'Z')     return (char)('a' + (code - (int)'A'));
  }
  return (char)code;
}
