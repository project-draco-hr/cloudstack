{
  String datasetid;
  String tsmid;
  String qosgroupid;
  String VolumeName=storagePoolName;
  String totaliops=String.valueOf(capacityIops);
  String totalthroughput=String.valueOf(capacityIops * 4);
  String quotasize=convertCapacityBytes(capacityBytes);
  AddQosGroupCmd addQosGroupCmd=new AddQosGroupCmd();
  tsmid=cmdResponse.getTsm().getUuid();
  datasetid=cmdResponse.getTsm().getDatasetid();
  if (null != VolumeName)   addQosGroupCmd.putCommandParameter(ElastistorUtil.REST_PARAM_NAME,"QOS_" + VolumeName);
  if (null != totaliops)   addQosGroupCmd.putCommandParameter(ElastistorUtil.REST_PARAM_IOPS,totaliops);
  if (null != ElastistorUtil.ES_LATENCY_VAL)   addQosGroupCmd.putCommandParameter(ElastistorUtil.REST_PARAM_LATENCY,ElastistorUtil.ES_LATENCY_VAL);
  if (null != ElastistorUtil.ES_BLOCKSIZE_VAL)   addQosGroupCmd.putCommandParameter(ElastistorUtil.REST_PARAM_BLOCKSIZE,ElastistorUtil.ES_BLOCKSIZE_VAL);
  if (null != totalthroughput)   addQosGroupCmd.putCommandParameter(ElastistorUtil.REST_PARAM_THROUGHPUT,totalthroughput);
  if (null != ElastistorUtil.ES_MEMLIMIT_VAL)   addQosGroupCmd.putCommandParameter(ElastistorUtil.REST_PARAM_MEMLIMIT,ElastistorUtil.ES_MEMLIMIT_VAL);
  if (null != ElastistorUtil.ES_NETWORKSPEED_VAL)   addQosGroupCmd.putCommandParameter(ElastistorUtil.REST_PARAM_NETWORKSPEED,ElastistorUtil.ES_NETWORKSPEED_VAL);
  if (null != tsmid)   addQosGroupCmd.putCommandParameter(ElastistorUtil.REST_PARAM_TSMID,tsmid);
  if (null != datasetid)   addQosGroupCmd.putCommandParameter(ElastistorUtil.REST_PARAM_DATASETID,datasetid);
  if (null != ElastistorUtil.ES_GRACEALLOWED_VAL)   addQosGroupCmd.putCommandParameter(ElastistorUtil.REST_PARAM_GRACEALLOWED,ElastistorUtil.ES_GRACEALLOWED_VAL);
  AddQosGroupCmdResponse addQosGroupCmdResponse=(AddQosGroupCmdResponse)getElastistorRestClient(s_esIPVAL,s_esAPIKEYVAL).executeCommand(addQosGroupCmd);
  if (addQosGroupCmdResponse.getQoSGroup().getUuid() == null) {
    throw new CloudRuntimeException("adding qos group failed , contact elatistor admin");
  }
 else {
    CreateVolumeCmd createVolumeCmd=new CreateVolumeCmd();
    qosgroupid=addQosGroupCmdResponse.getQoSGroup().getUuid();
    if (null != ElastistorUtil.s_esACCOUNTIDVAL)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_ACCOUNTID,ElastistorUtil.s_esACCOUNTIDVAL);
    if (null != qosgroupid)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_QOSGROUPID,qosgroupid);
    if (null != tsmid)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_TSMID,tsmid);
    if (null != ElastistorUtil.s_esPOOLIDVAL)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_POOLID,ElastistorUtil.s_esPOOLIDVAL);
    if (null != VolumeName)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_NAME,VolumeName);
    if (null != quotasize)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_QUOTA_SIZE,quotasize);
    if (protocoltype.equalsIgnoreCase("nfs")) {
      if (null != ElastistorUtil.ES_BLOCKSIZE_VAL)       createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_BLOCKSIZE,ElastistorUtil.ES_BLOCKSIZE_VAL);
      if (null != ElastistorUtil.ES_BLOCKSIZE_VAL)       createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_RECORDSIZE,ElastistorUtil.ES_BLOCKSIZE_VAL);
    }
 else {
      if (null != ElastistorUtil.ES_BLOCKSIZE_VAL)       createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_BLOCKSIZE,"512B");
      if (null != ElastistorUtil.ES_BLOCKSIZE_VAL)       createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_RECORDSIZE,"512B");
    }
    if (null != ElastistorUtil.ES_DEDUPLICATION_VAL)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_DEDUPLICATION,ElastistorUtil.ES_DEDUPLICATION_VAL);
    if (null != ElastistorUtil.ES_SYNC_VAL)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_SYNC,ElastistorUtil.ES_SYNC_VAL);
    if (null != ElastistorUtil.ES_COMPRESSION_VAL)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_COMPRESSION,ElastistorUtil.ES_COMPRESSION_VAL);
    if (null != ElastistorUtil.ES_NOOFCOPIES_VAL)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_NOOFCOPIES,ElastistorUtil.ES_NOOFCOPIES_VAL);
    createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_MOUNTPOINT,mountpoint);
    if (null != ElastistorUtil.ES_CASESENSITIVITY_VAL)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_CASESENSITIVITY,ElastistorUtil.ES_CASESENSITIVITY_VAL);
    if (null != ElastistorUtil.ES_READONLY_VAL)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_READONLY,ElastistorUtil.ES_READONLY_VAL);
    if (null != datasetid)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_DATASETID,datasetid);
    if (null != ElastistorUtil.ES_UNICODE_VAL)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_UNICODE,ElastistorUtil.ES_UNICODE_VAL);
    createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_PROTOCOLTYPE,protocoltype);
    if (null != ElastistorUtil.ES_AUTHNETWORK_VAL)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_AUTHNETWORK,ElastistorUtil.ES_AUTHNETWORK_VAL);
    if (null != ElastistorUtil.ES_MAPUSERSTOROOT_VAL)     createVolumeCmd.putCommandParameter(ElastistorUtil.REST_PARAM_MAPUSERSTOROOT,ElastistorUtil.ES_MAPUSERSTOROOT_VAL);
    CreateVolumeCmdResponse createVolumeCmdResponse;
    try {
      createVolumeCmdResponse=(CreateVolumeCmdResponse)getElastistorRestClient(s_esIPVAL,s_esAPIKEYVAL).executeCommand(createVolumeCmd);
      if (createVolumeCmdResponse.getFileSystem().getUuid() == null) {
        throw new CloudRuntimeException("creating volume failed , contact elatistor admin");
      }
 else {
        return createVolumeCmdResponse;
      }
    }
 catch (    Exception e) {
      throw new CloudRuntimeException("creating volume failed , contact elatistor admin",e);
    }
  }
}
