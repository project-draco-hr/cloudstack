{
  UserContext ctx=UserContext.current();
  Account caller=ctx.getCaller();
  long gslbRuleId=removeFromGslbCmd.getGlobalLoadBalancerRuleId();
  GlobalLoadBalancerRuleVO gslbRule=_gslbRuleDao.findById(gslbRuleId);
  if (gslbRule == null) {
    throw new InvalidParameterValueException("Invalid global load balancer rule id: " + gslbRule.getUuid());
  }
  _accountMgr.checkAccess(caller,SecurityChecker.AccessType.ModifyEntry,true,gslbRule);
  if (gslbRule.getState() == GlobalLoadBalancerRule.State.Revoke) {
    throw new InvalidParameterValueException("global load balancer rule id: " + gslbRuleId + " is already in revoked state");
  }
  List<Long> lbRuleIdsToremove=removeFromGslbCmd.getLoadBalancerRulesIds();
  if (lbRuleIdsToremove == null || lbRuleIdsToremove.isEmpty()) {
    throw new InvalidParameterValueException("empty list of load balancer rule Ids specified to be un-assigned" + " to global load balancer rule");
  }
  List<Long> oldLbRuleIds=new ArrayList<Long>();
  List<Long> oldZones=new ArrayList<Long>();
  List<GlobalLoadBalancerLbRuleMapVO> gslbLbMapVos=_gslbLbMapDao.listByGslbRuleId(gslbRuleId);
  if (gslbLbMapVos == null) {
    throw new InvalidParameterValueException(" There are no load balancer rules that are assigned to global " + " load balancer rule id: " + gslbRule.getUuid() + " that are available for deletion");
  }
  for (  Long lbRuleId : lbRuleIdsToremove) {
    LoadBalancerVO loadBalancer=_lbDao.findById(lbRuleId);
    if (loadBalancer == null) {
      throw new InvalidParameterValueException("Specified load balancer rule ID does not exist.");
    }
    _accountMgr.checkAccess(caller,null,true,loadBalancer);
  }
  for (  GlobalLoadBalancerLbRuleMapVO gslbLbMapVo : gslbLbMapVos) {
    LoadBalancerVO loadBalancer=_lbDao.findById(gslbLbMapVo.getLoadBalancerId());
    Network network=_networkDao.findById(loadBalancer.getNetworkId());
    oldLbRuleIds.add(gslbLbMapVo.getLoadBalancerId());
    oldZones.add(network.getDataCenterId());
  }
  for (  Long lbRuleId : lbRuleIdsToremove) {
    LoadBalancerVO loadBalancer=_lbDao.findById(lbRuleId);
    if (oldLbRuleIds != null && !oldLbRuleIds.contains(loadBalancer.getId())) {
      throw new InvalidParameterValueException("Load balancer ID " + loadBalancer.getUuid() + " is not assigned"+ " to global load balancer rule: "+ gslbRule.getUuid());
    }
  }
  Transaction txn=Transaction.currentTxn();
  txn.start();
  for (  Long lbRuleId : lbRuleIdsToremove) {
    GlobalLoadBalancerLbRuleMapVO removeGslbLbMap=_gslbLbMapDao.findByGslbRuleIdAndLbRuleId(gslbRuleId,lbRuleId);
    removeGslbLbMap.setRevoke(true);
    _gslbLbMapDao.update(removeGslbLbMap.getId(),removeGslbLbMap);
  }
  if (gslbRule.getState() == GlobalLoadBalancerRule.State.Staged) {
    gslbRule.setState(GlobalLoadBalancerRule.State.Add);
    _gslbRuleDao.update(gslbRule.getId(),gslbRule);
  }
  txn.commit();
  boolean success=false;
  try {
    s_logger.debug("Attempting to configure global load balancer rule configuration on the gslb service providers ");
    applyGlobalLoadBalancerRuleConfig(gslbRuleId,false);
    gslbRule.setState(GlobalLoadBalancerRule.State.Active);
    _gslbRuleDao.update(gslbRule.getId(),gslbRule);
    success=true;
  }
 catch (  ResourceUnavailableException e) {
    throw new CloudRuntimeException("Failed to update removed load balancer details from gloabal load balancer");
  }
  return success;
}
