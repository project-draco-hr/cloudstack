{
  final S3TO s3=getS3TO();
  if (s3 == null) {
    return null;
  }
  final List<VMTemplateHostVO> templateHosts=vmTemplateHostDao.listByOnlyTemplateId(template.getId());
  if (templateHosts != null) {
    shuffle(templateHosts);
    for (    VMTemplateHostVO vmTemplateHostVO : templateHosts) {
      final HostVO host=hostDao.findById(vmTemplateHostVO.getHostId());
      if (host != null) {
        return host.getDataCenterId();
      }
      throw new CloudRuntimeException(format("Unable to find secondary storage host for template id %1$s.",template.getId()));
    }
  }
  final List<DataCenterVO> dataCenters=dataCenterDao.listAll();
  shuffle(dataCenters);
  return dataCenters.get(0).getId();
}
