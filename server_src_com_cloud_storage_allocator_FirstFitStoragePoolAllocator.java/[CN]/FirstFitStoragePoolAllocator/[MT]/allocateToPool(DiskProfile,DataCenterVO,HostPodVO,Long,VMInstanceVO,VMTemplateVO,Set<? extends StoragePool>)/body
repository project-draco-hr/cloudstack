{
  if (!allocatorIsCorrectType(dskCh,vm)) {
    return null;
  }
  List<StoragePoolVO> pools=_storagePoolDao.findPoolsByTags(dc.getId(),pod.getId(),clusterId,dskCh.getTags(),null);
  if (pools.size() == 0) {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("No storage pools available for pod id : " + pod.getId());
    }
    return null;
  }
  StatsCollector sc=StatsCollector.getInstance();
  Collections.shuffle(pools);
  for (  StoragePoolVO pool : pools) {
    if (checkPool(avoid,pool,dskCh,template,null,vm,sc)) {
      return pool;
    }
  }
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Unable to find any storage pool");
  }
  if (_dontMatter && pools.size() > 0) {
    return pools.get(0);
  }
 else {
    return null;
  }
}
