{
  String vlanGateway;
  String vlanNetmask;
  boolean sameSubnet=false;
  if (vlans != null && vlans.size() > 0) {
    for (    VlanVO vlan : vlans) {
      if (ipv4) {
        vlanGateway=vlan.getVlanGateway();
        vlanNetmask=vlan.getVlanNetmask();
        if (!NetUtils.sameSubnet(startIP,vlanGateway,vlanNetmask)) {
          if (!NetUtils.sameSubnet(endIP,vlanGateway,vlanNetmask)) {
            if (NetUtils.isNetworkAWithinNetworkB(NetUtils.getCidrFromGatewayAndNetmask(vlanGateway,vlanNetmask),NetUtils.ipAndNetMaskToCidr(startIP,newVlanNetmask))) {
              throw new InvalidParameterValueException("The new subnet is a superset of the existing subnet");
            }
            if (NetUtils.isNetworkAWithinNetworkB(NetUtils.ipAndNetMaskToCidr(startIP,newVlanNetmask),NetUtils.getCidrFromGatewayAndNetmask(vlanGateway,vlanNetmask))) {
              throw new InvalidParameterValueException("The new subnet is a subset of the existing subnet");
            }
          }
        }
 else         if (NetUtils.sameSubnet(endIP,vlanGateway,vlanNetmask)) {
          sameSubnet=true;
          if (newVlanGateway == null) {
            newVlanGateway=vlanGateway;
          }
          if (!newVlanGateway.equals(vlanGateway)) {
            throw new InvalidParameterValueException("The gateway of the ip range is not same as the gateway of the subnet.");
          }
          break;
        }
 else {
          throw new InvalidParameterValueException("Start ip and End ip is not in vlan range!");
        }
      }
      if (ipv6) {
        if (ip6Gateway != null && !ip6Gateway.equals(network.getIp6Gateway())) {
          throw new InvalidParameterValueException("The input gateway " + ip6Gateway + " is not same as network gateway "+ network.getIp6Gateway());
        }
        if (ip6Cidr != null && !ip6Cidr.equals(network.getIp6Cidr())) {
          throw new InvalidParameterValueException("The input cidr " + ip6Cidr + " is not same as network ciddr "+ network.getIp6Cidr());
        }
        ip6Gateway=network.getIp6Gateway();
        ip6Cidr=network.getIp6Cidr();
        _networkModel.checkIp6Parameters(startIPv6,endIPv6,ip6Gateway,ip6Cidr);
      }
    }
    if (sameSubnet == false) {
      if (newVlanGateway == null) {
        throw new MissingParameterValueException("The gateway for the new subnet is not specified.");
      }
    }
  }
  return sameSubnet;
}
