{
  tags=StringUtils.cleanupTags(tags);
  ServiceOfferingVO offering=new ServiceOfferingVO(name,cpu,ramSize,speed,networkRate,null,offerHA,limitResourceUse,volatileVm,displayText,localStorageRequired,false,tags,isSystem,vm_type,domainId,hostTag,deploymentPlanner);
  if ((bytesReadRate != null) && (bytesReadRate > 0))   offering.setBytesReadRate(bytesReadRate);
  if ((bytesWriteRate != null) && (bytesWriteRate > 0))   offering.setBytesWriteRate(bytesWriteRate);
  if ((iopsReadRate != null) && (iopsReadRate > 0))   offering.setIopsReadRate(iopsReadRate);
  if ((iopsWriteRate != null) && (iopsWriteRate > 0))   offering.setIopsWriteRate(iopsWriteRate);
  if ((offering=_serviceOfferingDao.persist(offering)) != null) {
    if (details != null) {
      List<ServiceOfferingDetailsVO> detailsVO=new ArrayList<ServiceOfferingDetailsVO>();
      for (      String key : details.keySet()) {
        detailsVO.add(new ServiceOfferingDetailsVO(offering.getId(),key,details.get(key)));
      }
      _serviceOfferingDetailsDao.saveDetails(detailsVO);
    }
    CallContext.current().setEventDetails("Service offering id=" + offering.getId());
    return offering;
  }
 else {
    return null;
  }
}
