{
  if (!validPod(podId)) {
    throw new InvalidParameterValueException("A pod with ID: " + podId + " does not exist.");
  }
  if (gateway != null || cidr != null || startIp != null || endIp != null) {
    if (podHasAllocatedPrivateIPs(podId)) {
      throw new InternalErrorException("The specified pod has allocated private IP addresses, so its CIDR and IP address range cannot be changed.");
    }
  }
  HostPodVO pod=_podDao.findById(podId);
  String oldPodName=pod.getName();
  long zoneId=pod.getDataCenterId();
  if (newPodName == null) {
    newPodName=oldPodName;
  }
  if (gateway == null) {
    gateway=pod.getGateway();
  }
  if (cidr == null) {
    cidr=pod.getCidrAddress() + "/" + pod.getCidrSize();
  }
  boolean checkForDuplicates=!oldPodName.equals(newPodName);
  checkPodAttributes(podId,newPodName,pod.getDataCenterId(),gateway,cidr,startIp,endIp,checkForDuplicates);
  String cidrAddress=getCidrAddress(cidr);
  long cidrSize=getCidrSize(cidr);
  if (startIp != null && endIp == null) {
    endIp=NetUtils.getIpRangeEndIpFromCidr(cidrAddress,cidrSize);
  }
  Transaction txn=Transaction.currentTxn();
  try {
    txn.start();
    String ipRange;
    if (startIp != null) {
      _zoneDao.deletePrivateIpAddressByPod(pod.getId());
      _zoneDao.addPrivateIpAddress(zoneId,pod.getId(),startIp,endIp);
      ipRange=startIp + "-";
      if (endIp != null) {
        ipRange+=endIp;
      }
    }
 else {
      ipRange=pod.getDescription();
    }
    pod.setName(newPodName);
    pod.setDataCenterId(zoneId);
    pod.setGateway(gateway);
    pod.setCidrAddress(cidrAddress);
    pod.setCidrSize(cidrSize);
    pod.setDescription(ipRange);
    if (!_podDao.update(podId,pod)) {
      throw new InternalErrorException("Failed to edit pod. Please contact Cloud Support.");
    }
    txn.commit();
  }
 catch (  Exception e) {
    s_logger.error("Unable to edit pod due to " + e.getMessage(),e);
    txn.rollback();
    throw new InternalErrorException("Failed to edit pod. Please contact Cloud Support.");
  }
  DataCenterVO zone=_zoneDao.findById(zoneId);
  saveConfigurationEvent(userId,null,EventTypes.EVENT_POD_EDIT,"Successfully edited pod. New pod name is: " + newPodName + " and new zone name is: "+ zone.getName()+ ".","podId=" + pod.getId(),"dcId=" + zone.getId(),"gateway=" + gateway,"cidr=" + cidr,"startIp=" + startIp,"endIp=" + endIp);
  return pod;
}
