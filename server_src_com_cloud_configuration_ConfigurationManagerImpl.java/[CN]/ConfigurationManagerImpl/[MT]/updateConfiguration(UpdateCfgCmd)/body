{
  Long userId=UserContext.current().getCallerUserId();
  String name=cmd.getCfgName();
  String value=cmd.getValue();
  Long zoneId=cmd.getZoneId();
  Long clusterId=cmd.getClusterId();
  Long storagepoolId=cmd.getStoragepoolId();
  Long accountId=cmd.getAccountId();
  UserContext.current().setEventDetails(" Name: " + name + " New Value: "+ (((name.toLowerCase()).contains("password")) ? "*****" : (((value == null) ? "" : value))));
  ConfigurationVO config=_configDao.findByName(name);
  if (config == null) {
    throw new InvalidParameterValueException("Config parameter with name " + name + " doesn't exist");
  }
  if (value == null) {
    return _configDao.findByName(name);
  }
  if (value.trim().isEmpty() || value.equals("null")) {
    value=null;
  }
  String scope=null;
  Long id=null;
  int paramCountCheck=0;
  if (zoneId != null) {
    scope=Config.ConfigurationParameterScope.zone.toString();
    id=zoneId;
    paramCountCheck++;
  }
  if (clusterId != null) {
    scope=Config.ConfigurationParameterScope.cluster.toString();
    id=clusterId;
    paramCountCheck++;
  }
  if (accountId != null) {
    scope=Config.ConfigurationParameterScope.account.toString();
    id=accountId;
    paramCountCheck++;
  }
  if (storagepoolId != null) {
    scope=Config.ConfigurationParameterScope.storagepool.toString();
    id=storagepoolId;
    paramCountCheck++;
  }
  if (paramCountCheck > 1) {
    throw new InvalidParameterValueException("cannot handle multiple IDs, provide only one ID corresponding to the scope");
  }
  String updatedValue=updateConfiguration(userId,name,config.getCategory(),value,scope,id);
  if ((value == null && updatedValue == null) || updatedValue.equalsIgnoreCase(value)) {
    return _configDao.findByName(name);
  }
 else {
    throw new CloudRuntimeException("Unable to update configuration parameter " + name);
  }
}
