{
  IPRangeConfig config=new IPRangeConfig();
  Transaction txn=Transaction.currentTxn();
  txn.start();
  long startIPLong=NetUtils.ip2Long(startIP);
  long endIPLong=NetUtils.ip2Long(endIP);
  Vector<String> ips=config.savePublicIPRange(txn,startIPLong,endIPLong,zoneId,vlanDbId);
  List<Long> skip=new ArrayList<Long>(ips.size());
  for (  String ip : ips) {
    skip.add(NetUtils.ip2Long(ip));
  }
  for (long ip=startIPLong; ip <= endIPLong; ip++) {
    if (skip.contains(ip)) {
      continue;
    }
    IPAddressVO addr=_publicIpAddressDao.findById(new Ip(ip));
    addr.setAllocatedInDomainId(domainId);
    addr.setAllocatedTime(new Date());
    addr.setAllocatedToAccountId(accountId);
    _publicIpAddressDao.update(addr.getAddress(),addr);
  }
  txn.commit();
  return true;
}
