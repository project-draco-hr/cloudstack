{
  Long userId=UserContext.current().getCallerUserId();
  String zoneName=cmd.getZoneName();
  String dns1=cmd.getDns1();
  String dns2=cmd.getDns2();
  String internalDns1=cmd.getInternalDns1();
  String internalDns2=cmd.getInternalDns2();
  String vnetRange=cmd.getVlan();
  String guestCidr=cmd.getGuestCidrAddress();
  Long domainId=cmd.getDomainId();
  String type=cmd.getNetworkType();
  Boolean isBasic=false;
  String allocationState=cmd.getAllocationState();
  if (allocationState == null) {
    allocationState=Grouping.AllocationState.Disabled.toString();
  }
  if (!(type.equalsIgnoreCase(NetworkType.Basic.toString())) && !(type.equalsIgnoreCase(NetworkType.Advanced.toString()))) {
    throw new InvalidParameterValueException("Invalid zone type; only Advanced and Basic values are supported");
  }
 else   if (type.equalsIgnoreCase(NetworkType.Basic.toString())) {
    isBasic=true;
  }
  Boolean securityGroupEnabled=cmd.isSecurityGroupEnabled();
  NetworkType zoneType=isBasic ? NetworkType.Basic : NetworkType.Advanced;
  if (zoneType == NetworkType.Advanced && guestCidr == null && !securityGroupEnabled) {
    throw new InvalidParameterValueException("guestCidrAddress parameter is required for Advanced zone creation");
  }
 else   if (zoneType == NetworkType.Basic && guestCidr != null) {
    throw new InvalidParameterValueException("guestCidrAddress parameter is not supported for Basic zone");
  }
  DomainVO domainVO=null;
  if (userId == null) {
    userId=User.UID_SYSTEM;
  }
  if (domainId != null) {
    domainVO=_domainDao.findById(domainId);
  }
  if (zoneType == NetworkType.Basic && vnetRange != null) {
    vnetRange=null;
  }
  if (zoneType == NetworkType.Basic) {
    securityGroupEnabled=true;
  }
  return createZone(userId,zoneName,dns1,dns2,internalDns1,internalDns2,vnetRange,guestCidr,domainVO != null ? domainVO.getName() : null,domainId,zoneType,securityGroupEnabled,allocationState);
}
