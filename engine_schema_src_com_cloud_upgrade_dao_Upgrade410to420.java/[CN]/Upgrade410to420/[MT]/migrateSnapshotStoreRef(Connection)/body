{
  PreparedStatement snapshotStoreInsert=null;
  try {
    snapshotStoreInsert=conn.prepareStatement("INSERT INTO `cloud`.`snapshot_store_ref` (store_id,  snapshot_id, created, size, parent_snapshot_id, install_path, volume_id, update_count, ref_cnt, store_role, state) select sechost_id, id, created, size, prev_snap_id, CONCAT('snapshots', '/', account_id, '/', volume_id, '/', path), volume_id, 0, 0, 'Image', 'Ready' from `cloud`.`snapshots` where status = 'BackedUp' and sechost_id is not null and removed is null");
    snapshotStoreInsert.executeUpdate();
  }
 catch (  SQLException e) {
    String msg="Unable to migrate snapshot_store_ref." + e.getMessage();
    s_logger.error(msg);
    throw new CloudRuntimeException(msg,e);
  }
 finally {
    try {
      if (snapshotStoreInsert != null) {
        snapshotStoreInsert.close();
      }
    }
 catch (    SQLException e) {
    }
  }
}
