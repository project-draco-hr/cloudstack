{
  PreparedStatement pstmt=null;
  ResultSet rsParams=null;
  ResultSet rsLabel=null;
  String newLabel;
  String trafficType=null;
  String trafficTypeVswitchParam;
  String trafficTypeVswitchParamValue;
  try {
    pstmt=conn.prepareStatement("select name,value from `cloud`.`configuration` where category='Hidden' and value is not NULL and name REGEXP 'vmware\\.*\\.vswitch';");
    rsParams=pstmt.executeQuery();
    while (rsParams.next()) {
      trafficTypeVswitchParam=rsParams.getString("name");
      trafficTypeVswitchParamValue=rsParams.getString("value");
      if (trafficTypeVswitchParam.equals("vmware.private.vswitch")) {
        trafficType="Management";
      }
 else       if (trafficTypeVswitchParam.equals("vmware.public.vswitch")) {
        trafficType="Public";
      }
 else       if (trafficTypeVswitchParam.equals("vmware.guest.vswitch")) {
        trafficType="Guest";
      }
      s_logger.debug("Updating vmware label for " + trafficType + " traffic. Update SQL statement is "+ pstmt);
      pstmt=conn.prepareStatement("select physical_network_id, traffic_type, vmware_network_label from physical_network_traffic_types where vmware_network_label is not NULL and traffic_type='" + trafficType + "';");
      rsLabel=pstmt.executeQuery();
      newLabel=getNewLabel(rsLabel,trafficTypeVswitchParamValue);
      pstmt=conn.prepareStatement("update physical_network_traffic_types set vmware_network_label = " + newLabel + " where traffic_type = '"+ trafficType+ "' and vmware_network_label is not NULL;");
      pstmt.executeUpdate();
    }
  }
 catch (  SQLException e) {
    throw new CloudRuntimeException("Unable to set vmware traffic labels ",e);
  }
 finally {
    try {
      if (rsParams != null) {
        rsParams.close();
      }
      if (pstmt != null) {
        pstmt.close();
      }
    }
 catch (    SQLException e) {
    }
  }
}
