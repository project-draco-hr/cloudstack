{
  long hostId=cmd.getId();
  User caller=_accountMgr.getActiveUser(UserContext.current().getCallerUserId());
  HostVO externalFirewall=_hostDao.findById(hostId);
  if (externalFirewall == null) {
    throw new InvalidParameterValueException("Could not find an external firewall with ID: " + hostId);
  }
  try {
    if (_agentMgr.maintain(hostId) && _agentMgr.deleteHost(hostId,false,false,caller)) {
      DataCenterVO zone=_dcDao.findById(externalFirewall.getDataCenterId());
      zone.setFirewallProvider(Network.Provider.VirtualRouter.getName());
      zone.setUserDataProvider(Network.Provider.VirtualRouter.getName());
      zone.setVpnProvider(Network.Provider.VirtualRouter.getName());
      if (zone.getGatewayProvider() != null && !zone.getGatewayProvider().equals(Network.Provider.ExternalGateWay)) {
        zone.setGatewayProvider(Network.Provider.VirtualRouter.getName());
      }
      if (zone.getDnsProvider() != null && !zone.getDnsProvider().equals(Network.Provider.ExternalDhcpServer)) {
        zone.setDnsProvider(Network.Provider.VirtualRouter.getName());
      }
      if (zone.getDhcpProvider() != null && !zone.getDhcpProvider().equals(Network.Provider.ExternalDhcpServer)) {
        zone.setDhcpProvider(Network.Provider.VirtualRouter.getName());
      }
      if (zone.getLoadBalancerProvider() != null && zone.getLoadBalancerProvider().equals(Network.Provider.None)) {
        if (zone.getNetworkType().equals(NetworkType.Advanced)) {
          zone.setLoadBalancerProvider(Network.Provider.VirtualRouter.getName());
        }
 else         if (zone.getNetworkType().equals(NetworkType.Basic)) {
          zone.setLoadBalancerProvider(null);
        }
      }
      return _dcDao.update(zone.getId(),zone);
    }
 else {
      return false;
    }
  }
 catch (  AgentUnavailableException e) {
    s_logger.debug(e);
    return false;
  }
}
