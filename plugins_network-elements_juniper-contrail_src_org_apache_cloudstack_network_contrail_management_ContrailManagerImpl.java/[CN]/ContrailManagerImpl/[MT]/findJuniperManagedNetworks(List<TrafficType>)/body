{
  SearchBuilder<NetworkVO> searchBuilder=_networksDao.createSearchBuilder();
  searchBuilder.and("trafficType",searchBuilder.entity().getTrafficType(),Op.IN);
  searchBuilder.and("networkOfferingId",searchBuilder.entity().getNetworkOfferingId(),Op.EQ);
  SearchCriteria<NetworkVO> sc=searchBuilder.create();
  sc.setParameters("networkOfferingId",getOffering().getId());
  if (types == null || types.isEmpty()) {
    types=new ArrayList<TrafficType>();
    types.add(TrafficType.Control);
    types.add(TrafficType.Management);
    types.add(TrafficType.Public);
    types.add(TrafficType.Storage);
    types.add(TrafficType.Guest);
  }
  sc.setParameters("trafficType",types.toArray());
  List<NetworkVO> dbNets=_networksDao.search(sc,null);
  if (dbNets == null) {
    s_logger.debug("no juniper managed networks for the given traffic types: " + types.toString());
    dbNets=new ArrayList<NetworkVO>();
  }
  List<PhysicalNetworkVO> phys_list=_physicalNetworkDao.listAll();
  final String provider=Network.Provider.JuniperContrail.getName();
  for (Iterator<PhysicalNetworkVO> iter=phys_list.iterator(); iter.hasNext(); ) {
    PhysicalNetworkVO phys=iter.next();
    if (_physProviderDao.findByServiceProvider(phys.getId(),provider) != null) {
      List<NetworkVO> infraNets=new ArrayList<NetworkVO>();
      findInfrastructureNetworks(phys,infraNets);
      for (      NetworkVO net : infraNets) {
        if (types == null || types.isEmpty()) {
          dbNets.add(net);
          continue;
        }
        for (        TrafficType type : types) {
          if (net.getTrafficType() == type) {
            dbNets.add(net);
            break;
          }
        }
      }
    }
  }
  return dbNets;
}
