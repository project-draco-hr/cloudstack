{
  Long accountId=cmd.getId();
  Long domainId=cmd.getDomainId();
  DomainVO domain=_domainDao.findById(domainId);
  String accountName=cmd.getAccountName();
  String newAccountName=cmd.getNewName();
  String networkDomain=cmd.getNetworkDomain();
  Map<String,String> details=cmd.getDetails();
  Account account=null;
  if (accountId != null) {
    account=_accountDao.findById(accountId);
  }
 else {
    account=_accountDao.findEnabledAccount(accountName,domainId);
  }
  if (account == null || account.getType() == Account.ACCOUNT_TYPE_PROJECT) {
    s_logger.error("Unable to find account by accountId: " + accountId + " OR by name: "+ accountName+ " in domain "+ domainId);
    throw new InvalidParameterValueException("Unable to find account by accountId: " + accountId + " OR by name: "+ accountName+ " in domain "+ domainId);
  }
  String command="updateAccount";
  List<NameValuePair> params=new ArrayList<NameValuePair>();
  params.add(new NameValuePair(ApiConstants.NEW_NAME,newAccountName));
  params.add(new NameValuePair(ApiConstants.ID,account.getUuid()));
  params.add(new NameValuePair(ApiConstants.ACCOUNT,accountName));
  params.add(new NameValuePair(ApiConstants.DOMAIN_ID,domain.getUuid()));
  params.add(new NameValuePair(ApiConstants.NETWORK_DOMAIN,networkDomain));
  params.add(new NameValuePair(ApiConstants.NEW_NAME,newAccountName));
  if (details != null) {
    params.add(new NameValuePair(ApiConstants.ACCOUNT_DETAILS,details.toString()));
  }
  int regionId=account.getRegionId();
  if (getId() == regionId) {
    Account updatedAccount=_accountMgr.updateAccount(cmd);
    if (updatedAccount != null) {
      List<RegionVO> regions=_regionDao.listAll();
      for (      Region region : regions) {
        if (region.getId() == getId()) {
          continue;
        }
        params.add(new NameValuePair(ApiConstants.IS_PROPAGATE,"true"));
        if (RegionsApiUtil.makeAPICall(region,command,params)) {
          s_logger.debug("Successfully updated account :" + account.getUuid() + " in Region: "+ region.getId());
        }
 else {
          s_logger.error("Error while updating account :" + account.getUuid() + " in Region: "+ region.getId());
        }
      }
    }
    return updatedAccount;
  }
 else {
    Region region=_regionDao.findById(regionId);
    RegionAccount updatedAccount=RegionsApiUtil.makeAccountAPICall(region,command,params);
    if (updatedAccount != null) {
      Long id=_identityDao.getIdentityId("account",updatedAccount.getUuid());
      updatedAccount.setId(id);
      Long domainID=_identityDao.getIdentityId("domain",updatedAccount.getDomainUuid());
      updatedAccount.setDomainId(domainID);
      s_logger.debug("Successfully updated account :" + account.getUuid() + " in source Region: "+ region.getId());
      return updatedAccount;
    }
 else {
      throw new CloudRuntimeException("Error while updating account :" + account.getUuid() + " in source Region: "+ region.getId());
    }
  }
}
