@attr(tags=['advanced', 'nuagevsp'], required_hardware='false')
def test_02_nuage_internallb_vpc_network_offering(self):
    'Test Nuage VSP VPC Network Offering with and without Internal LB service\n        '
    self.debug('Creating Nuage VSP VPC offering with Internal LB service...')
    vpc_off = self.create_VpcOffering(self.test_data['nuagevsp']['vpc_offering_lb'])
    self.validate_VpcOffering(vpc_off, state='Enabled')
    self.debug('Creating a VPC with Internal LB service...')
    vpc = self.create_Vpc(vpc_off, cidr='10.1.0.0/16')
    self.validate_Vpc(vpc, state='Enabled')
    self.debug('Creating Nuage VSP VPC Network offering with LB Service Provider as InternalLbVm and LB Service Capability lbSchemes as internal...')
    net_off_1 = self.create_NetworkOffering(self.test_data['nuagevsp']['vpc_network_offering_internal_lb'])
    self.validate_NetworkOffering(net_off_1, state='Enabled')
    self.debug('Recreating above Network offering with ispersistent False...')
    vpc_net_off_lb_non_persistent = copy.deepcopy(self.test_data['nuagevsp']['vpc_network_offering_internal_lb'])
    vpc_net_off_lb_non_persistent['ispersistent'] = 'False'
    net_off_2 = self.create_NetworkOffering(vpc_net_off_lb_non_persistent)
    self.validate_NetworkOffering(net_off_2, state='Enabled')
    self.debug('Recreating above Network offering with conserve mode On...')
    with self.assertRaises(Exception):
        self.create_NetworkOffering(self.test_data['nuagevsp']['vpc_network_offering_internal_lb'], conserve_mode=True)
    self.debug('Network offering creation failed as only networks with conserve mode Off can belong to VPC')
    self.debug('Creating Nuage VSP VPC Network offering with LB Service Provider as InternalLbVm and LB Service Capability lbSchemes as public...')
    network_offering_internal_lb = copy.deepcopy(self.test_data['nuagevsp']['vpc_network_offering_internal_lb'])
    network_offering_internal_lb['serviceCapabilityList']['Lb']['lbSchemes'] = 'public'
    with self.assertRaises(Exception):
        self.create_NetworkOffering(network_offering_internal_lb)
    self.debug('Network offering creation failed as public lbScheme is not supported for LB Service Provider InternalLbVm')
    self.debug('Creating Nuage VSP VPC Network offering without Internal LB service...')
    net_off_3 = self.create_NetworkOffering(self.test_data['nuagevsp']['vpc_network_offering'])
    self.validate_NetworkOffering(net_off_3, state='Enabled')
    self.debug('Recreating above Network offering with ispersistent False...')
    vpc_net_off_non_persistent = copy.deepcopy(self.test_data['nuagevsp']['vpc_network_offering'])
    vpc_net_off_non_persistent['ispersistent'] = 'False'
    net_off_4 = self.create_NetworkOffering(vpc_net_off_non_persistent)
    self.validate_NetworkOffering(net_off_4, state='Enabled')
    self.debug('Recreating above Network offering with conserve mode On...')
    with self.assertRaises(Exception):
        self.create_NetworkOffering(self.test_data['nuagevsp']['vpc_network_offering'], conserve_mode=True)
    self.debug('Network offering creation failed as only networks with conserve mode Off can belong to VPC')
    self.debug('Creating a persistent VPC network with Internal LB service...')
    internal_tier = self.create_Network(net_off_1, gateway='10.1.1.1', vpc=vpc)
    self.validate_Network(internal_tier, state='Implemented')
    vr = self.get_Router(internal_tier)
    self.check_Router_state(vr, state='Running')
    self.verify_vsd_network(self.domain.id, internal_tier, vpc)
    self.verify_vsd_router(vr)
    self.debug('Creating a non persistent VPC network with Internal LB service...')
    with self.assertRaises(Exception):
        self.create_Network(net_off_2, gateway='10.1.2.1', vpc=vpc)
    self.debug('Nuage VSP does not support non persistent VPC networks')
    self.debug('Creating a persistent VPC network without Internal LB service...')
    public_tier = self.create_Network(net_off_3, gateway='10.1.3.1', vpc=vpc)
    self.validate_Network(public_tier, state='Implemented')
    vr = self.get_Router(public_tier)
    self.check_Router_state(vr, state='Running')
    self.verify_vsd_network(self.domain.id, public_tier, vpc)
    self.verify_vsd_router(vr)
    self.debug('Creating a non persistent VPC network without Internal LB service...')
    with self.assertRaises(Exception):
        self.create_Network(net_off_4, gateway='10.1.4.1', vpc=vpc)
    self.debug('Nuage VSP does not support non persistent VPC networks')
