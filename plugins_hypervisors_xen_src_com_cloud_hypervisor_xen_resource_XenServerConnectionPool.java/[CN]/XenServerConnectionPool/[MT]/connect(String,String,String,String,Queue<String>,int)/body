{
  XenServerConnection mConn=null;
  if (hostUuid == null || poolUuid == null || ipAddress == null || username == null || password == null) {
    String msg="Connect some parameter are null hostUuid:" + hostUuid + " ,poolUuid:"+ poolUuid+ " ,ipAddress:"+ ipAddress;
    s_logger.debug(msg);
    throw new CloudRuntimeException(msg);
  }
synchronized (poolUuid.intern()) {
    mConn=getConnect(poolUuid);
    if (mConn != null) {
      try {
        Host.getByUuid(mConn,hostUuid);
      }
 catch (      Exception e) {
        if (s_logger.isDebugEnabled()) {
          s_logger.debug("connect through IP(" + mConn.getIp() + " for pool("+ poolUuid+ ") is broken due to "+ e.toString());
        }
        removeConnect(poolUuid);
        mConn=null;
      }
    }
    if (mConn == null) {
      mConn=new XenServerConnection(getURL(ipAddress),ipAddress,username,password,_retries,_interval,wait);
      try {
        loginWithPassword(mConn,username,password,APIVersion.latest().toString());
      }
 catch (      Types.HostIsSlave e) {
        String maddress=e.masterIPAddress;
        mConn=new XenServerConnection(getURL(maddress),maddress,username,password,_retries,_interval,wait);
        try {
          loginWithPassword(mConn,username,password,APIVersion.latest().toString());
        }
 catch (        Exception e1) {
          String msg="Unable to create master connection to host(" + maddress + ") , due to "+ e1.toString();
          s_logger.debug(msg);
          throw new CloudRuntimeException(msg,e1);
        }
      }
catch (      Exception e) {
        String msg="Unable to create master connection to host(" + ipAddress + ") , due to "+ e.toString();
        s_logger.debug(msg);
        throw new CloudRuntimeException(msg,e);
      }
      addConnect(poolUuid,mConn);
    }
  }
  return mConn;
}
