{
  final Map<String,VmState> states=cmd.getVmStates();
  final HashMap<Long,AgentVmInfo> map=new HashMap<Long,AgentVmInfo>();
  if (states == null) {
    return map;
  }
  for (  Map.Entry<String,VmState> entry : states.entrySet()) {
    String name=entry.getKey();
    VMInstanceVO vm=_vmDao.findVMByInstanceName(name);
    if (vm != null) {
      map.put(vm.getId(),new AgentVmInfo(entry.getKey(),vm,entry.getValue().getState(),entry.getValue().getHost()));
    }
  }
  return map;
}
