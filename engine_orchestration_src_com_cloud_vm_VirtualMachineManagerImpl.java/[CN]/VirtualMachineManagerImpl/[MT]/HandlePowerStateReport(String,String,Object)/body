{
  assert(args != null);
  Long vmId=(Long)args;
  List<VmWorkJobVO> pendingWorkJobs=_workJobDao.listPendingWorkJobs(VirtualMachine.Type.Instance,vmId);
  if (pendingWorkJobs.size() == 0) {
    VMInstanceVO vm=_vmDao.findById(vmId);
    if (vm != null) {
switch (vm.getPowerState()) {
case PowerOn:
        handlePowerOnReportWithNoPendingJobsOnVM(vm);
      break;
case PowerOff:
    handlePowerOffReportWithNoPendingJobsOnVM(vm);
  break;
case PowerUnknown:
default :
assert(false);
break;
}
}
 else {
s_logger.warn("VM " + vmId + " no longer exists when processing VM state report");
}
}
 else {
_vmDao.resetVmPowerStateTracking(vmId);
}
}
