{
  assert(args != null);
  Long vmId=(Long)args;
  List<VmWorkJobVO> pendingWorkJobs=_workJobDao.listPendingWorkJobs(VirtualMachine.Type.Instance,vmId);
  if (pendingWorkJobs.size() == 0 || _haMgr.hasPendingHaWork(vmId)) {
    VMInstanceVO vm=_vmDao.findById(vmId);
    if (vm != null) {
switch (vm.getPowerState()) {
case PowerOn:
        handlePowerOnReportWithNoPendingJobsOnVM(vm);
      break;
case PowerOff:
case PowerReportMissing:
    handlePowerOffReportWithNoPendingJobsOnVM(vm);
  break;
case PowerUnknown:
default :
assert(false);
break;
}
}
 else {
s_logger.warn("VM " + vmId + " no longer exists when processing VM state report");
}
}
 else {
s_logger.info("There is pending job or HA tasks working on the VM. vm id: " + vmId + ", postpone power-change report by resetting power-change counters");
_vmDao.resetVmPowerStateTracking(vmId);
}
}
