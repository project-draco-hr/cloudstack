{
  ZoneHostInfo zoneHostInfo=zoneHostInfoMap.get(dataCenterId);
  if (zoneHostInfo != null && isZoneHostReady(zoneHostInfo)) {
    VMTemplateVO template=_templateDao.findSystemVMTemplate(dataCenterId);
    TemplateDataStoreVO templateHostRef=this._vmTemplateStoreDao.findByTemplateZoneDownloadStatus(template.getId(),dataCenterId,Status.DOWNLOADED);
    if (templateHostRef != null) {
      List<Pair<Long,Integer>> l=_consoleProxyDao.getDatacenterStoragePoolHostInfo(dataCenterId,_use_lvm);
      if (l != null && l.size() > 0 && l.get(0).second().intValue() > 0) {
        return true;
      }
 else {
        if (s_logger.isDebugEnabled()) {
          s_logger.debug("Primary storage is not ready, wait until it is ready to launch console proxy");
        }
      }
    }
 else {
      if (s_logger.isDebugEnabled()) {
        if (template == null) {
          s_logger.debug("Zone host is ready, but console proxy template is null");
        }
 else {
          s_logger.debug("Zone host is ready, but console proxy template: " + template.getId() + " is not ready on secondary storage.");
        }
      }
    }
  }
  return false;
}
