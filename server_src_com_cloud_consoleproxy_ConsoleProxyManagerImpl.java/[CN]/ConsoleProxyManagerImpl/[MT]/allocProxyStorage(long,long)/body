{
  ConsoleProxyVO proxy=_consoleProxyDao.findById(proxyVmId);
  assert(proxy != null);
  DataCenterVO dc=_dcDao.findById(dataCenterId);
  HostPodVO pod=_podDao.findById(proxy.getPodId());
  final AccountVO account=_accountDao.findById(Account.ACCOUNT_ID_SYSTEM);
  try {
    List<VolumeVO> vols=_storageMgr.create(account,proxy,_template,dc,pod,_serviceOffering,null,0);
    if (vols == null) {
      s_logger.error("Unable to alloc storage for console proxy");
      return null;
    }
    Transaction txn=Transaction.currentTxn();
    txn.start();
    ConsoleProxyVO vo=_consoleProxyDao.findById(proxy.getId());
    _consoleProxyDao.update(proxy.getId(),vo);
    _consoleProxyDao.updateIf(proxy,Event.OperationSucceeded,null);
    txn.commit();
    return proxy;
  }
 catch (  StorageUnavailableException e) {
    s_logger.error("Unable to alloc storage for console proxy: ",e);
    return null;
  }
catch (  ExecutionException e) {
    s_logger.error("Unable to alloc storage for console proxy: ",e);
    return null;
  }
}
