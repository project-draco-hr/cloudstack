{
  long id=_consoleProxyDao.getNextInSequence(Long.class,"id");
  String name=VirtualMachineName.getConsoleProxyName(id,_instance);
  DataCenterVO dc=_dcDao.findById(dataCenterId);
  ConsoleProxyVO proxy=new ConsoleProxyVO(id,name,_template.getId(),_template.getGuestOSId(),dataCenterId,0);
  proxy=_consoleProxyDao.persist(proxy);
  List<NetworkProfileVO> profiles=_networkMgr.getSystemAccountNetworkProfiles(NetworkOfferingVO.SystemVmControlNetwork,NetworkOfferingVO.SystemVmManagementNetwork,NetworkOfferingVO.SystemVmPublicNetwork);
  try {
    proxy=_vmMgr.allocate(proxy,_template,_serviceOffering,profiles,dc,_accountMgr.getSystemAccount());
    proxy=_vmMgr.create(proxy);
  }
 catch (  InsufficientCapacityException e) {
    s_logger.warn("InsufficientCapacity",e);
    throw new CloudRuntimeException("Insufficient capcity exception",e);
  }
catch (  StorageUnavailableException e) {
    s_logger.warn("Unable to contact storage",e);
    throw new CloudRuntimeException("Unable to contact storage",e);
  }
  return null;
}
