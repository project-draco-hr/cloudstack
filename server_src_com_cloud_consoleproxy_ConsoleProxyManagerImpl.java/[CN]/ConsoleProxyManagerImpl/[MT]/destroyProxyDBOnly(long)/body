{
  Transaction txn=Transaction.currentTxn();
  try {
    txn.start();
    _volsDao.deleteVolumesByInstance(vmId);
    ConsoleProxyVO proxy=_consoleProxyDao.findById(vmId);
    if (proxy != null) {
      if (proxy.getPublicIpAddress() != null) {
        freePublicIpAddress(proxy.getPublicIpAddress(),proxy.getDataCenterId(),proxy.getPodId());
      }
      _consoleProxyDao.remove(vmId);
      final EventVO event=new EventVO();
      event.setUserId(User.UID_SYSTEM);
      event.setAccountId(Account.ACCOUNT_ID_SYSTEM);
      event.setType(EventTypes.EVENT_PROXY_DESTROY);
      event.setLevel(EventVO.LEVEL_INFO);
      event.setDescription("Console proxy destroyed - " + proxy.getHostName());
      _eventDao.persist(event);
    }
    txn.commit();
    return true;
  }
 catch (  Exception e) {
    s_logger.error("Caught this error: ",e);
    txn.rollback();
    return false;
  }
 finally {
    s_logger.debug("console proxy vm is destroyed from DB : " + vmId);
  }
}
