{
  long volumeId=snapshot.getVolumeId();
  VolumeVO volumeVO=_volumeDao.findById(volumeId);
  if (SnapshotOperation.REVERT.equals(op)) {
    if (volumeVO != null && ImageFormat.QCOW2.equals(volumeVO.getFormat()))     return StrategyPriority.DEFAULT;
 else     return StrategyPriority.CANT_HANDLE;
  }
  long storagePoolId;
  if (volumeVO == null) {
    SnapshotDataStoreVO snapshotStore=_snapshotStoreDao.findBySnapshot(snapshot.getId(),DataStoreRole.Primary);
    if (snapshotStore != null) {
      storagePoolId=snapshotStore.getDataStoreId();
    }
 else {
      throw new CloudRuntimeException("Unable to determine the storage pool of the snapshot");
    }
  }
 else {
    storagePoolId=volumeVO.getPoolId();
  }
  DataStore dataStore=_dataStoreMgr.getDataStore(storagePoolId,DataStoreRole.Primary);
  Map<String,String> mapCapabilities=dataStore.getDriver().getCapabilities();
  if (mapCapabilities != null) {
    String value=mapCapabilities.get(DataStoreCapabilities.STORAGE_SYSTEM_SNAPSHOT.toString());
    Boolean supportsStorageSystemSnapshots=new Boolean(value);
    if (supportsStorageSystemSnapshots) {
      return StrategyPriority.HIGHEST;
    }
  }
  return StrategyPriority.CANT_HANDLE;
}
