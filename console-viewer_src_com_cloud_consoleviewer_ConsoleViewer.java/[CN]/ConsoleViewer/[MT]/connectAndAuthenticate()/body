{
  showConnectionStatus("Initializing...");
  if (!inProxyMode) {
    if (inSeparateFrame) {
      vncFrame.pack();
      vncFrame.show();
    }
 else {
      applet.validate();
    }
  }
  if (proxyHost != null) {
    showConnectionStatus("Connecting to " + proxyHost + ", port "+ proxyPort+ "...");
    rfb=new RfbProto(proxyHost,proxyPort,this);
    rfb.readProxyVersion();
    rfb.writeProxyString(host,port,(passwordParam != null) ? passwordParam : "");
  }
 else {
    showConnectionStatus("Connecting to " + host + ", port "+ port+ "...");
    rfb=new RfbProto(host,port,this);
  }
  showConnectionStatus("Connected to server");
  rfb.readVersionMsg();
  showConnectionStatus("RFB server supports protocol version " + rfb.serverMajor + "."+ rfb.serverMinor);
  rfb.writeVersionMsg();
  showConnectionStatus("Using RFB protocol version " + rfb.clientMajor + "."+ rfb.clientMinor);
  int secType=rfb.negotiateSecurity();
  int authType;
  if (secType == RfbProto.SecTypeTight) {
    showConnectionStatus("Enabling TightVNC protocol extensions");
    rfb.initCapabilities();
    rfb.setupTunneling();
    authType=rfb.negotiateAuthenticationTight();
  }
 else {
    authType=secType;
  }
switch (authType) {
case RfbProto.AuthNone:
    showConnectionStatus("No authentication needed");
  rfb.authenticateNone();
break;
case RfbProto.AuthVNC:
showConnectionStatus("Performing standard VNC authentication");
if (passwordParam != null) {
rfb.authenticateVNC(passwordParam);
}
 else {
throw new AuthenticationException("Bad password");
}
break;
default :
throw new Exception("Unknown authentication scheme " + authType);
}
}
