{
  Map<String,TemplateInfo> result=new HashMap<String,TemplateInfo>();
  List<String> publicTmplts=listPublicTemplates();
  for (  String tmplt : publicTmplts) {
    String path=tmplt.substring(0,tmplt.lastIndexOf(File.separator));
    TemplateLocation loc=new TemplateLocation(_storage,path);
    try {
      if (!loc.load()) {
        s_logger.warn("Post download installation was not completed for " + path);
        loc.purge();
        _storage.cleanup(path,publicTemplateRepo);
        continue;
      }
    }
 catch (    IOException e) {
      s_logger.warn("Unable to load template location " + path,e);
      loc.purge();
      try {
        _storage.cleanup(path,publicTemplateRepo);
      }
 catch (      IOException e1) {
        s_logger.warn("Unable to cleanup " + path,e1);
      }
      continue;
    }
    TemplateInfo tInfo=loc.getTemplateInfo();
    result.put(tInfo.templateName,tInfo);
    s_logger.debug("Added template name: " + tInfo.templateName + ", path: "+ tmplt);
  }
  return result;
}
