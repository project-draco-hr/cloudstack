{
  Set<Long> affectedVms=new HashSet<Long>();
  int commandNum=0;
  for (  Answer ans : answers) {
    if (ans instanceof SecurityIngressRuleAnswer) {
      SecurityIngressRuleAnswer ruleAnswer=(SecurityIngressRuleAnswer)ans;
      if (ans.getResult()) {
        s_logger.debug("Successfully programmed rule " + ruleAnswer.toString() + " into host "+ agentId);
        _workDao.updateStep(ruleAnswer.getVmId(),ruleAnswer.getLogSequenceNumber(),Step.Done);
      }
 else {
        _workDao.updateStep(ruleAnswer.getVmId(),ruleAnswer.getLogSequenceNumber(),Step.Error);
        s_logger.debug("Failed to program rule " + ruleAnswer.toString() + " into host "+ agentId);
        affectedVms.add(ruleAnswer.getVmId());
      }
      commandNum++;
    }
  }
  if (affectedVms.size() > 0) {
    _securityGroupManager.scheduleRulesetUpdateToHosts(affectedVms,false,new Long(10 * 1000l));
  }
  return true;
}
