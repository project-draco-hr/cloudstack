{
  DedicatedResourceVO resource=null;
  if (zoneId != null) {
    resource=_dedicatedDao.findByZoneId(zoneId);
  }
  if (podId != null) {
    resource=_dedicatedDao.findByPodId(podId);
  }
  if (clusterId != null) {
    resource=_dedicatedDao.findByClusterId(clusterId);
  }
  if (hostId != null) {
    resource=_dedicatedDao.findByHostId(hostId);
  }
  if (resource == null) {
    throw new InvalidParameterValueException("No Dedicated Resource available to release");
  }
 else {
    final DedicatedResourceVO resourceFinal=resource;
    Transaction.execute(new TransactionCallbackNoReturn(){
      @Override public void doInTransactionWithoutResult(      TransactionStatus status){
        Long resourceId=resourceFinal.getId();
        if (!_dedicatedDao.remove(resourceId)) {
          throw new CloudRuntimeException("Failed to delete Resource " + resourceId);
        }
        if (zoneId != null) {
          DataCenterVO dc=_zoneDao.findById(zoneId);
          if (dc != null) {
            dc.setDomainId(null);
            dc.setDomain(null);
            if (!_zoneDao.update(zoneId,dc)) {
              throw new CloudRuntimeException("Failed to release dedicated zone, could not clear domainId. Please contact Cloud Support.");
            }
          }
        }
      }
    }
);
    List<DedicatedResourceVO> resourcesInGroup=_dedicatedDao.listByAffinityGroupId(resource.getAffinityGroupId());
    if (resourcesInGroup.isEmpty()) {
      _affinityGroupService.deleteAffinityGroup(resource.getAffinityGroupId(),null,null,null);
    }
  }
  return true;
}
