{
  if (!cap(buf,4,UNLIMITED,link,true))   return;
  int authType=buf.readSignedInt();
switch (authType) {
case RfbConstants.CONNECTION_FAILED:
{
      int length=buf.readSignedInt();
      String reason=new String(buf.data,buf.offset,length,RfbConstants.US_ASCII_CHARSET);
      throw new RuntimeException("Authentication to VNC server is failed. Reason: " + reason);
    }
case RfbConstants.NO_AUTH:
{
    switchOff();
    break;
  }
case RfbConstants.VNC_AUTH:
{
  responseToChallenge(buf,link);
  break;
}
default :
throw new RuntimeException("Unsupported VNC protocol authorization scheme, scheme code: " + authType + ".");
}
}
