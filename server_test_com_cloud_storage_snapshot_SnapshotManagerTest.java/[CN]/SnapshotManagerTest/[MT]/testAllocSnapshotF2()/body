{
  when(_vmDao.findById(anyLong())).thenReturn(vmMock);
  when(vmMock.getId()).thenReturn(TEST_VM_ID);
  when(vmMock.getState()).thenReturn(State.Stopped);
  when(vmMock.getHypervisorType()).thenReturn(Hypervisor.HypervisorType.KVM);
  when(volumeInfoMock.getInstanceId()).thenReturn(TEST_VM_ID);
  List<SnapshotVO> mockList=mock(List.class);
  when(mockList.size()).thenReturn(1);
  when(_snapshotDao.listByInstanceId(TEST_VM_ID,Snapshot.State.Creating,Snapshot.State.CreatedOnPrimary,Snapshot.State.BackingUp)).thenReturn(mockList);
  _snapshotMgr.allocSnapshot(TEST_VOLUME_ID,Snapshot.MANUAL_POLICY_ID,null,null);
}
