{
  if (logger.isTraceEnabled()) {
    logger.trace("Begin scanning directly connected hosts");
  }
  long cutSeconds=(System.currentTimeMillis() >> 10) - getTimeout();
  List<HostVO> hosts=_hostDao.findAndUpdateDirectAgentToLoad(cutSeconds,LoadSize.value().longValue(),_nodeId);
  List<HostVO> appliances=_hostDao.findAndUpdateApplianceToLoad(cutSeconds,_nodeId);
  if (hosts != null) {
    hosts.addAll(appliances);
    if (hosts.size() > 0) {
      logger.debug("Found " + hosts.size() + " unmanaged direct hosts, processing connect for them...");
      for (      HostVO host : hosts) {
        try {
          AgentAttache agentattache=findAttache(host.getId());
          if (agentattache != null) {
            if (agentattache.forForward()) {
              if (logger.isInfoEnabled()) {
                logger.info(host + " is detected down, but we have a forward attache running, disconnect this one before launching the host");
              }
              removeAgent(agentattache,Status.Disconnected);
            }
 else {
              continue;
            }
          }
          if (logger.isDebugEnabled()) {
            logger.debug("Loading directly connected host " + host.getId() + "("+ host.getName()+ ")");
          }
          loadDirectlyConnectedHost(host,false);
        }
 catch (        Throwable e) {
          logger.warn(" can not load directly connected host " + host.getId() + "("+ host.getName()+ ") due to ",e);
        }
      }
    }
  }
  if (logger.isTraceEnabled()) {
    logger.trace("End scanning directly connected hosts");
  }
}
