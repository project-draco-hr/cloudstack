{
  Domain domain;
  if (_domain != null) {
    domain=_domain;
  }
 else {
    if (domainId != null) {
      domain=_domain=_domainService.getDomain(domainId);
    }
 else {
      domain=_domain=getDomainForName(groupName);
      if (domain == null) {
        domain=getDomainForName(user.getDomain());
      }
    }
    if (domain == null) {
      domain=_domainService.getDomain(Domain.ROOT_DOMAIN);
    }
  }
  return domain;
}
