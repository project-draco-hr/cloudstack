{
  List<LdapUserResponse> ldapResponses=null;
  final ListResponse<LdapUserResponse> response=new ListResponse<LdapUserResponse>();
  try {
    final List<LdapUser> users=_ldapManager.getUsers();
    for (    LdapUser user : users) {
      Domain domain=_domainService.getDomainByName(user.getDomain(),Domain.ROOT_DOMAIN);
      if (domain == null) {
        domain=_domainService.createDomain(user.getDomain(),Domain.ROOT_DOMAIN,user.getDomain(),UUID.randomUUID().toString());
      }
      _accountService.createUserAccount(user.getUsername(),generatePassword(),user.getFirstname(),user.getLastname(),user.getEmail(),timezone,user.getUsername(),accountType,domain.getId(),domain.getNetworkDomain(),details,UUID.randomUUID().toString(),UUID.randomUUID().toString());
    }
    ldapResponses=createLdapUserResponse(users);
  }
 catch (  final NoLdapUserMatchingQueryException ex) {
    ldapResponses=new ArrayList<LdapUserResponse>();
  }
 finally {
    response.setResponses(ldapResponses);
    response.setResponseName(getCommandName());
    setResponseObject(response);
  }
}
