{
  List<LdapUserResponse> ldapResponses=null;
  final ListResponse<LdapUserResponse> response=new ListResponse<LdapUserResponse>();
  try {
    List<LdapUser> users;
    if (StringUtils.isNotBlank(groupName)) {
      users=_ldapManager.getUsersInGroup(groupName);
    }
 else {
      users=_ldapManager.getUsers();
    }
    for (    LdapUser user : users) {
      Domain domain=getDomain(user);
      _accountService.createUserAccount(user.getUsername(),generatePassword(),user.getFirstname(),user.getLastname(),user.getEmail(),timezone,user.getUsername(),accountType,domain.getId(),domain.getNetworkDomain(),details,UUID.randomUUID().toString(),UUID.randomUUID().toString());
    }
    ldapResponses=createLdapUserResponse(users);
  }
 catch (  final NoLdapUserMatchingQueryException ex) {
    ldapResponses=new ArrayList<LdapUserResponse>();
  }
 finally {
    response.setResponses(ldapResponses);
    response.setResponseName(getCommandName());
    setResponseObject(response);
  }
}
