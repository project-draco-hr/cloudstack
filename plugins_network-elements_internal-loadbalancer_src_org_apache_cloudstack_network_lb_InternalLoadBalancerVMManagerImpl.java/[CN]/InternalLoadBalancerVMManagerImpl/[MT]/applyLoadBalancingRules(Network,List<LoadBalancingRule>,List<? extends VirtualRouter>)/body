{
  if (rules == null || rules.isEmpty()) {
    s_logger.debug("No lb rules to be applied for network " + network);
    return true;
  }
  if (internalLbVms == null || internalLbVms.isEmpty()) {
    throw new CloudRuntimeException("Can't apply the lb rules on network " + network + " as the list of internal lb vms is empty");
  }
  VirtualRouter lbVm=internalLbVms.get(0);
  if (lbVm.getState() == State.Running) {
    return sendLBRules(lbVm,rules,network.getId());
  }
 else   if (lbVm.getState() == State.Stopped || lbVm.getState() == State.Stopping) {
    s_logger.debug("Internal LB VM " + lbVm.getInstanceName() + " is in "+ lbVm.getState()+ ", so not sending apply lb rules commands to the backend");
    return true;
  }
 else {
    s_logger.warn("Unable to apply lb rules, Internal LB VM is not in the right state " + lbVm.getState());
    throw new ResourceUnavailableException("Unable to apply lb rules; Internal LB VM is not in the right state",DataCenter.class,lbVm.getDataCenterId());
  }
}
