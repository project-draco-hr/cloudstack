{
  List<Pair<NetworkVO,NicProfile>> networks=new ArrayList<Pair<NetworkVO,NicProfile>>(3);
  if (guestNetwork != null) {
    s_logger.debug("Adding nic for Internal LB in Guest network " + guestNetwork);
    NicProfile guestNic=new NicProfile();
    if (guestIp != null) {
      guestNic.setIp4Address(guestIp.addr());
    }
 else {
      guestNic.setIp4Address(_ntwkMgr.acquireGuestIpAddress(guestNetwork,null));
    }
    guestNic.setGateway(guestNetwork.getGateway());
    guestNic.setBroadcastUri(guestNetwork.getBroadcastUri());
    guestNic.setBroadcastType(guestNetwork.getBroadcastDomainType());
    guestNic.setIsolationUri(guestNetwork.getBroadcastUri());
    guestNic.setMode(guestNetwork.getMode());
    String gatewayCidr=guestNetwork.getCidr();
    guestNic.setNetmask(NetUtils.getCidrNetmask(gatewayCidr));
    guestNic.setDefaultNic(true);
    networks.add(new Pair<NetworkVO,NicProfile>((NetworkVO)guestNetwork,guestNic));
  }
  s_logger.debug("Adding nic for Internal LB vm in Control network ");
  List<? extends NetworkOffering> offerings=_ntwkModel.getSystemAccountNetworkOfferings(NetworkOffering.SystemControlNetwork);
  NetworkOffering controlOffering=offerings.get(0);
  NetworkVO controlConfig=_ntwkMgr.setupNetwork(_accountMgr.getSystemAccount(),controlOffering,plan,null,null,false).get(0);
  networks.add(new Pair<NetworkVO,NicProfile>(controlConfig,null));
  return networks;
}
