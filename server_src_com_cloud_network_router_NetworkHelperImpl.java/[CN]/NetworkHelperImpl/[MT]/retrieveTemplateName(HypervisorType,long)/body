{
  if (hType == HypervisorType.BareMetal) {
    String peerHvType=_configDao.getValue(Config.BaremetalPeerHypervisorType.key());
    if (peerHvType == null) {
      throw new CloudRuntimeException(String.format("To use baremetal in advanced networking, you must set %s to type of hypervisor(e.g XenServer)" + " that exists in the same zone with baremetal host. That hyperivsor is used to spring up virtual router for baremetal instance",Config.BaremetalPeerHypervisorType.key()));
    }
    hType=HypervisorType.getType(peerHvType);
    if (HypervisorType.XenServer != hType && HypervisorType.KVM != hType && HypervisorType.VMware != hType) {
      throw new CloudRuntimeException(String.format("Baremetal only supports peer hypervisor(XenServer/KVM/VMWare) right now, you specified %s",peerHvType));
    }
  }
  return hypervisorsMap.get(hType).valueIn(datacenterId);
}
