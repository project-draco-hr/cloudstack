{
  final String vmName=cmd.getVmName();
  String result=null;
  if (cmd.getVnet() != null && !isDirectAttachedNetwork(cmd.getVnet())) {
    final String vnet=getVnetId(cmd.getVnet());
    if (vnet != null) {
      try {
        createVnet(vnet,_pifs.first());
      }
 catch (      InternalErrorException e) {
        return new PrepareForMigrationAnswer(cmd,false,result);
      }
    }
  }
synchronized (_vms) {
    _vms.put(vmName,State.Migrating);
  }
  return new PrepareForMigrationAnswer(cmd,result == null,result);
}
