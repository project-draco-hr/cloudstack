{
  String secondaryStorageURL=cmd.getSecondaryStorageURL();
  String snapshotUUID=cmd.getSnapshotPath();
  StoragePool secondaryStorage=null;
  StoragePool privateTemplStorage=null;
  StorageVol privateTemplateVol=null;
  StorageVol snapshotVol=null;
  try {
    String templateFolder=cmd.getAccountId() + File.separator + cmd.getTemplateId()+ File.separator;
    String templateInstallFolder="/template/tmpl/" + templateFolder;
    secondaryStorage=getNfsSPbyURI(_conn,new URI(secondaryStorageURL));
    String mountPath=_mountPoint + File.separator + secondaryStorage.getUUIDString()+ templateInstallFolder;
    File mpfile=new File(mountPath);
    if (!mpfile.exists()) {
      mpfile.mkdir();
    }
    privateTemplStorage=getNfsSPbyURI(_conn,new URI(secondaryStorageURL + templateInstallFolder));
    snapshotVol=getVolume(snapshotUUID);
    LibvirtStorageVolumeDef vol=new LibvirtStorageVolumeDef(UUID.randomUUID().toString(),snapshotVol.getInfo().capacity,volFormat.QCOW2,null,null);
    s_logger.debug(vol.toString());
    privateTemplateVol=copyVolume(privateTemplStorage,vol,snapshotVol);
    return new CreatePrivateTemplateAnswer(cmd,true,null,templateInstallFolder + privateTemplateVol.getName(),privateTemplateVol.getInfo().capacity / 1024 * 1024,privateTemplateVol.getName(),ImageFormat.QCOW2);
  }
 catch (  URISyntaxException e) {
    return new CreatePrivateTemplateAnswer(cmd,false,e.toString(),null,0,null,null);
  }
catch (  LibvirtException e) {
    s_logger.debug("Failed to get secondary storage pool: " + e.toString());
    return new CreatePrivateTemplateAnswer(cmd,false,e.toString(),null,0,null,null);
  }
}
