{
  InterfaceDef intf=new InterfaceDef();
  String vlanId=null;
  if (nic.getBroadcastType() == BroadcastDomainType.Vlan) {
    URI broadcastUri=nic.getBroadcastUri();
    vlanId=broadcastUri.getHost();
    s_logger.debug("vlanId: " + vlanId);
  }
  InterfaceDef.nicModel model=getGuestNicModel(vm.getGuestOSType());
  if (nic.getType() == TrafficType.Guest) {
    if (nic.getBroadcastType() == BroadcastDomainType.Vlan && !vlanId.equalsIgnoreCase("untagged")) {
      String brName=createVlanBr(vlanId,_pifs.first());
      intf.defBridgeNet(brName,null,nic.getMac(),model);
    }
 else {
      intf.defBridgeNet(_privBridgeName,null,nic.getMac(),model);
    }
  }
 else   if (nic.getType() == TrafficType.Control) {
    createControlNetwork(conn);
    intf.defPrivateNet(_privNwName,null,nic.getMac(),model);
  }
 else   if (nic.getType() == TrafficType.Public) {
    if (nic.getBroadcastType() == BroadcastDomainType.Vlan && !vlanId.equalsIgnoreCase("untagged")) {
      String brName=createVlanBr(vlanId,_pifs.second());
      intf.defBridgeNet(brName,null,nic.getMac(),model);
    }
 else {
      intf.defBridgeNet(_publicBridgeName,null,nic.getMac(),model);
    }
  }
 else   if (nic.getType() == TrafficType.Management) {
    intf.defBridgeNet(_privBridgeName,null,nic.getMac(),model);
  }
  vm.getDevices().addDevice(intf);
  return intf;
}
