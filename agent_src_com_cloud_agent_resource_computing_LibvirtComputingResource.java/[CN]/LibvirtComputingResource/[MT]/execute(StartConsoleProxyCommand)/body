{
  final ConsoleProxyVO router=cmd.getProxy();
  String result=null;
  State state=State.Stopped;
synchronized (_vms) {
    _vms.put(cmd.getVmName(),State.Starting);
  }
  try {
    result=startConsoleProxy(cmd);
    if (result != null) {
      throw new ExecutionException(result,null);
    }
    result=_virtRouterResource.connect(router.getPrivateIpAddress(),cmd.getProxyCmdPort());
    if (result != null) {
      throw new ExecutionException(result,null);
    }
    state=State.Running;
    return new StartConsoleProxyAnswer(cmd,router.getPrivateIpAddress(),router.getPrivateMacAddress());
  }
 catch (  final ExecutionException e) {
    return new Answer(cmd,false,e.getMessage());
  }
catch (  final Throwable th) {
    s_logger.warn("Exception while starting router.",th);
    return createErrorAnswer(cmd,"Unable to start router",th);
  }
 finally {
synchronized (_vms) {
      _vms.put(cmd.getVmName(),state);
    }
  }
}
