{
  boolean copyToSecondary=cmd.toSecondaryStorage();
  String volumePath=cmd.getVolumePath();
  StorageFilerTO pool=cmd.getPool();
  String secondaryStorageUrl=cmd.getSecondaryStorageURL();
  try {
    KVMStoragePool primaryPool=_storagePoolMgr.getStoragePool(pool.getUuid());
    String volumeName=UUID.randomUUID().toString();
    if (copyToSecondary) {
      KVMPhysicalDisk volume=primaryPool.getPhysicalDisk(cmd.getVolumePath());
      String volumeDestPath="/volumes/" + cmd.getVolumeId() + File.separator;
      KVMStoragePool secondaryStoragePool=_storagePoolMgr.getStoragePoolByURI(secondaryStorageUrl + volumeDestPath);
      _storagePoolMgr.copyPhysicalDisk(volume,volumeName,secondaryStoragePool);
      return new CopyVolumeAnswer(cmd,true,null,null,volumeName);
    }
 else {
      volumePath="/volumes/" + cmd.getVolumeId() + File.separator+ volumePath;
      KVMStoragePool secondaryStoragePool=_storagePoolMgr.getStoragePoolByURI(secondaryStorageUrl + volumePath);
      KVMPhysicalDisk volume=secondaryStoragePool.getPhysicalDisk(cmd.getVolumePath());
      _storagePoolMgr.copyPhysicalDisk(volume,volumeName,primaryPool);
      return new CopyVolumeAnswer(cmd,true,null,null,volumeName);
    }
  }
 catch (  CloudRuntimeException e) {
    return new CopyVolumeAnswer(cmd,false,e.toString(),null,null);
  }
}
