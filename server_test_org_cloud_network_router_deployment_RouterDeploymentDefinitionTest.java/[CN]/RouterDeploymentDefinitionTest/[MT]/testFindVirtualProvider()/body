{
  when(this.mockNetworkModel.getPhysicalNetworkId(this.deployment.guestNetwork)).thenReturn(PHYSICAL_NW_ID);
  Type type=Type.VirtualRouter;
  PhysicalNetworkServiceProviderVO physicalNwSrvProvider=mock(PhysicalNetworkServiceProviderVO.class);
  when(this.physicalProviderDao.findByServiceProvider(PHYSICAL_NW_ID,type.toString())).thenReturn(physicalNwSrvProvider);
  when(physicalNwSrvProvider.getId()).thenReturn(PROVIDER_ID);
  VirtualRouterProviderVO vrProvider=mock(VirtualRouterProviderVO.class);
  when(this.mockVrProviderDao.findByNspIdAndType(PROVIDER_ID,type)).thenReturn(vrProvider);
  this.deployment.findVirtualProvider();
  assertEquals("Didn't find and set the VirtualRouterProvider as expected",vrProvider,this.deployment.getVirtualProvider());
}
