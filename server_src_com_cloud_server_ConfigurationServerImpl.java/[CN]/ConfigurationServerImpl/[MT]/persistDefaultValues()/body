{
  saveUser();
  String init=_configDao.getValue("init");
  if (init == null || init.equals("false")) {
    s_logger.debug("ConfigurationServer is saving default values to the database.");
    List<String> categories=Config.getCategories();
    for (    String category : categories) {
      if (!_configDao.isPremium() && category.equals("Premium")) {
        continue;
      }
      List<Config> configs=Config.getConfigs(category);
      for (      Config c : configs) {
        String name=c.key();
        if (_configDao.findByName(name) != null) {
          continue;
        }
        String instance="DEFAULT";
        String component=c.getComponent();
        String value=c.getDefaultValue();
        String description=c.getDescription();
        ConfigurationVO configVO=new ConfigurationVO(category,instance,component,name,value,description);
        _configDao.persist(configVO);
      }
    }
    _configDao.update("secondary.storage.vm","true");
    s_logger.debug("ConfigurationServer made secondary storage vm required.");
    _configDao.update("secstorage.encrypt.copy","true");
    s_logger.debug("ConfigurationServer made secondary storage copy encrypted.");
    _configDao.update("secstorage.secure.copy.cert","realhostip");
    s_logger.debug("ConfigurationServer made secondary storage copy use realhostip.");
    createServiceOffering(User.UID_SYSTEM,"Small Instance",1,512,500,"Small Instance, $0.05 per hour",false,false,null);
    createServiceOffering(User.UID_SYSTEM,"Medium Instance",1,1024,1000,"Medium Instance, $0.10 per hour",false,false,null);
    createDiskOffering(null,"Small","Small Disk, 5 GB",5,null);
    createDiskOffering(null,"Medium","Medium Disk, 20 GB",20,null);
    createDiskOffering(null,"Large","Large Disk, 100 GB",100,null);
    String mountParent=getMountParent();
    if (mountParent != null) {
      _configDao.update("mount.parent",mountParent);
      s_logger.debug("ConfigurationServer saved \"" + mountParent + "\" as mount.parent.");
    }
 else {
      s_logger.debug("ConfigurationServer could not detect mount.parent.");
    }
    String hostIpAdr=NetUtils.getDefaultHostIp();
    if (hostIpAdr != null) {
      _configDao.update("host",hostIpAdr);
      s_logger.debug("ConfigurationServer saved \"" + hostIpAdr + "\" as host.");
    }
    updateSSOKey();
    createDefaultNetworkOfferings();
    createDefaultNetworks();
    Transaction txn=Transaction.currentTxn();
    List<VlanVO> vlans=_vlanDao.listAll();
    if (vlans != null && !vlans.isEmpty()) {
      for (      VlanVO vlan : vlans) {
        if (vlan.getNetworkId().longValue() == 0) {
          updateVlanWithNetworkId(vlan);
        }
        String ipPange=vlan.getIpRange();
        String[] range=ipPange.split("-");
        String startIp=range[0];
        String endIp=range[1];
        txn.start();
        IPRangeConfig config=new IPRangeConfig();
        long startIPLong=NetUtils.ip2Long(startIp);
        long endIPLong=NetUtils.ip2Long(endIp);
        config.savePublicIPRange(txn,startIPLong,endIPLong,vlan.getDataCenterId(),vlan.getId(),vlan.getNetworkId());
        txn.commit();
      }
    }
  }
  updateSSLKeystore();
  updateKeyPairs();
  generateSecStorageVmCopyPassword();
  updateCloudIdentifier();
  _configDao.update("init","true");
}
