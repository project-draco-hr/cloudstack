{
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Retrieving user: " + username);
  }
  UserAccount user=_userAccountDao.getUserAccount(username,domainId);
  if (user == null) {
    s_logger.debug("Unable to find user with " + username + " in domain "+ domainId);
    return false;
  }
  try {
    String storedPassword[]=user.getPassword().split(":");
    if (storedPassword.length != 2) {
      s_logger.warn("The stored password for " + username + " isn't in the right format for this authenticator");
      return false;
    }
    byte salt[]=Base64.decode(storedPassword[0]);
    String hashedPassword=encode(password,salt);
    return storedPassword[1].equals(hashedPassword);
  }
 catch (  NoSuchAlgorithmException e) {
    throw new CloudRuntimeException("Unable to hash password",e);
  }
catch (  UnsupportedEncodingException e) {
    throw new CloudRuntimeException("Unable to hash password",e);
  }
}
