{
  DataStore store=createDataStore();
  FakePrimaryDataStoreDriver dataStoreDriver=(FakePrimaryDataStoreDriver)store.getDriver();
  dataStoreDriver.makeTakeSnapshotSucceed(true);
  final VolumeInfo volumeInfo=createVolume(1L,store);
  Assert.assertTrue(volumeInfo.getState() == Volume.State.Ready);
  vol=volumeInfo;
  ExecutorService pool=Executors.newFixedThreadPool(2);
  boolean result=false;
  Future<Boolean> future=null;
  for (int i=0; i < 1; i++) {
    future=pool.submit(new Callable<Boolean>(){
      @Override public Boolean call() throws Exception {
        boolean r=false;
        try {
          SnapshotInfo newSnapshot=volumeService.takeSnapshot(vol);
          Assert.assertTrue(newSnapshot != null);
        }
 catch (        Exception e) {
          r=false;
        }
        return true;
      }
    }
);
  }
  future.get();
}
