{
  String path=t.getRequestURI().getPath();
  Logger.log(Logger.INFO,"Get JAR request for " + path);
  int i=path.indexOf("/",1);
  String filepath=path.substring(i + 1);
  i=path.lastIndexOf(".");
  String extension=(i == -1) ? "" : path.substring(i + 1);
  if (!extension.equals("jar")) {
    throw new IllegalArgumentException();
  }
  File f=new File(jarDir + filepath);
  long lastModified=f.lastModified();
  String ifModifiedSince=t.getRequestHeaders().getFirst("If-Modified-Since");
  if (ifModifiedSince != null) {
    long d=Date.parse(ifModifiedSince);
    if (d + 1000 >= lastModified) {
      Headers hds=t.getResponseHeaders();
      hds.set("Content-Type","application/java-archive");
      t.sendResponseHeaders(304,-1);
      Logger.log(Logger.INFO,"Sent 304 JAR file has not been " + "modified since " + ifModifiedSince);
      return;
    }
  }
  long length=f.length();
  FileInputStream fis=new FileInputStream(f);
  Headers hds=t.getResponseHeaders();
  hds.set("Content-Type","application/java-archive");
  hds.set("Last-Modified",new Date(lastModified).toGMTString());
  t.sendResponseHeaders(200,length);
  OutputStream os=t.getResponseBody();
  while (true) {
    byte[] b=new byte[8192];
    int n=fis.read(b);
    if (n < 0) {
      break;
    }
    os.write(b,0,n);
  }
  os.close();
  fis.close();
  Logger.log(Logger.INFO,"Sent JAR file " + path);
}
