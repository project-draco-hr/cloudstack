{
  try {
    GlobalLock lock=GlobalLock.getInternLock("AccountCleanup");
    if (lock == null) {
      s_logger.debug("Couldn't get the global lock");
      return;
    }
    if (!lock.lock(30)) {
      s_logger.debug("Couldn't lock the db");
      return;
    }
    Transaction txn=null;
    try {
      txn=Transaction.open(Transaction.CLOUD_DB);
      List<AccountVO> accounts=_accountDao.findCleanups();
      s_logger.info("Found " + accounts.size() + " accounts to cleanup");
      for (      AccountVO account : accounts) {
        s_logger.debug("Cleaning up " + account.getId());
        try {
          cleanupAccount(account,getSystemUser().getId(),getSystemAccount());
        }
 catch (        Exception e) {
          s_logger.error("Skipping due to error on account " + account.getId(),e);
        }
      }
    }
 catch (    Exception e) {
      s_logger.error("Exception ",e);
    }
 finally {
      if (txn != null) {
        txn.close();
      }
      lock.unlock();
    }
  }
 catch (  Exception e) {
    s_logger.error("Exception ",e);
  }
}
