{
  long numResources=((count.length == 0) ? 1 : count[0]);
  long accountType=account.getType();
  if (accountType == Account.ACCOUNT_TYPE_ADMIN || accountType == Account.ACCOUNT_ID_SYSTEM) {
    return false;
  }
  if (m_resourceCountLock.lock(120)) {
    try {
      ResourceLimitVO limit=_resourceLimitDao.findByAccountIdAndType(account.getId(),type);
      if (limit != null) {
        long potentialCount=_resourceCountDao.getAccountCount(account.getId(),type) + numResources;
        if (potentialCount > limit.getMax().longValue()) {
          return true;
        }
      }
      Long domainId=account.getDomainId();
      while (domainId != null) {
        ResourceLimitVO domainLimit=_resourceLimitDao.findByDomainIdAndType(domainId,type);
        if (domainLimit != null) {
          long domainCount=_resourceCountDao.getDomainCount(domainId,type);
          if ((domainCount + numResources) > domainLimit.getMax().longValue()) {
            return true;
          }
        }
        DomainVO domain=_domainDao.findById(domainId);
        domainId=domain.getParent();
      }
    }
  finally {
      m_resourceCountLock.unlock();
    }
  }
  return false;
}
