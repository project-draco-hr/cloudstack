{
  List<VMInstanceVO> vms=_vmDao.listByAccountId(accountId);
  boolean success=true;
  for (  VMInstanceVO vm : vms) {
    try {
      try {
        if (vm.getType() == Type.User) {
          _itMgr.advanceStop(vm.getUuid(),false);
        }
 else         if (vm.getType() == Type.DomainRouter) {
          _itMgr.advanceStop(vm.getUuid(),false);
        }
 else {
          _itMgr.advanceStop(vm.getUuid(),false);
        }
      }
 catch (      OperationTimedoutException ote) {
        s_logger.warn("Operation for stopping vm timed out, unable to stop vm " + vm.getHostName(),ote);
        success=false;
      }
    }
 catch (    AgentUnavailableException aue) {
      s_logger.warn("Agent running on host " + vm.getHostId() + " is unavailable, unable to stop vm "+ vm.getHostName(),aue);
      success=false;
    }
  }
  return success;
}
