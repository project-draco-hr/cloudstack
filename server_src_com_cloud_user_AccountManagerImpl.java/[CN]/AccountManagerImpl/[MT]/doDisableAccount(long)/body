{
  List<VMInstanceVO> vms=_vmDao.listByAccountId(accountId);
  boolean success=true;
  for (  VMInstanceVO vm : vms) {
    try {
      success=(success && _itMgr.stop(vm,getSystemUser(),getSystemAccount()));
    }
 catch (    AgentUnavailableException aue) {
      s_logger.warn("Agent running on host " + vm.getHostId() + " is unavailable, unable to stop vm "+ vm.getName());
      success=false;
    }
  }
  return success;
}
