{
  Account currentAccount=UserContext.current().getCaller();
  String accountName=cmd.getAccountName();
  Long domainId=cmd.getDomainId();
  Long accountId=null;
  long count=0;
  ResourceType resourceType;
  Integer type=cmd.getResourceType();
  try {
    resourceType=ResourceType.values()[type];
  }
 catch (  ArrayIndexOutOfBoundsException e) {
    throw new InvalidParameterValueException("Please specify a valid resource type.");
  }
  if ((domainId == null) && (accountName == null)) {
    throw new InvalidParameterValueException("Either a domainId or account name with domainId must be passed in.");
  }
  if (domainId != null) {
    DomainVO domain=_domainDao.findById(domainId);
    if (domain == null) {
      throw new InvalidParameterValueException("Please specify a valid domain ID.");
    }
 else     if (domain.getRemoved() != null) {
      throw new InvalidParameterValueException("Please specify an active domain.");
    }
    checkAccess(currentAccount,domain);
  }
  if (accountName != null) {
    if (domainId == null) {
      throw new InvalidParameterValueException("domainId parameter is required if account name is specified");
    }
    Account userAccount=_accountDao.findActiveAccount(accountName,domainId);
    if (userAccount == null) {
      throw new InvalidParameterValueException("unable to find account by name " + accountName + " in domain with id "+ domainId);
    }
    accountId=userAccount.getId();
    checkAccess(currentAccount,userAccount);
  }
  try {
    if (accountId != null) {
      count=updateAccountResourceCount(accountId,resourceType);
    }
 else {
      count=updateDomainResourceCount(domainId,resourceType);
    }
  }
 catch (  Exception e) {
    throw new CloudRuntimeException(e.getMessage());
  }
  return new ResourceCountVO(accountId,domainId,resourceType,count);
}
