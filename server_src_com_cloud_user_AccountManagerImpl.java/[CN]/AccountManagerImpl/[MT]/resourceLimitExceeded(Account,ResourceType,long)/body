{
  long numResources=((count.length == 0) ? 1 : count[0]);
  long accountType=account.getType();
  if (accountType == Account.ACCOUNT_TYPE_ADMIN || accountType == Account.ACCOUNT_ID_SYSTEM) {
    return false;
  }
  if (m_resourceCountLock.lock(120)) {
    try {
      AccountVO accountVo=_accountDao.findById(account.getAccountId());
      long accountLimit=findCorrectResourceLimit(accountVo,type);
      long potentialCount=_resourceCountDao.getAccountCount(account.getId(),type) + numResources;
      if (potentialCount > accountLimit) {
        return true;
      }
      Long domainId=account.getDomainId();
      while (domainId != null) {
        ResourceLimitVO domainLimit=_resourceLimitDao.findByDomainIdAndType(domainId,type);
        if (domainLimit != null) {
          long domainCount=_resourceCountDao.getDomainCount(domainId,type);
          if ((domainCount + numResources) > domainLimit.getMax().longValue()) {
            return true;
          }
        }
        DomainVO domain=_domainDao.findById(domainId);
        domainId=domain.getParent();
      }
    }
  finally {
      m_resourceCountLock.unlock();
    }
  }
  return false;
}
