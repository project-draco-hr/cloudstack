{
  Long domainId=cmd.getDomainId();
  String accountName=cmd.getAccountName();
  String newAccountName=cmd.getNewName();
  boolean success=false;
  Account account=_accountDao.findAccount(accountName,domainId);
  if (account == null) {
    s_logger.error("Unable to find account " + accountName + " in domain "+ domainId);
    throw new InvalidParameterValueException("Unable to find account " + accountName + " in domain "+ domainId);
  }
  if (account.getId() == Account.ACCOUNT_ID_SYSTEM) {
    throw new InvalidParameterValueException("Can not modify system account");
  }
  Account adminAccount=UserContext.current().getAccount();
  if ((adminAccount != null) && _domainDao.isChildDomain(adminAccount.getDomainId(),account.getDomainId())) {
    throw new PermissionDeniedException("Invalid account " + accountName + " in domain "+ domainId+ " given, permission denied");
  }
  Account duplicateAcccount=_accountDao.findAccount(newAccountName,domainId);
  if (duplicateAcccount != null && duplicateAcccount.getId() != account.getId()) {
    throw new PermissionDeniedException("There already exists an account with the name:" + newAccountName + " in the domain:"+ domainId+ " with existing account id:"+ duplicateAcccount.getId());
  }
  if (account.getAccountName().equals(newAccountName)) {
    success=true;
  }
 else {
    AccountVO acctForUpdate=_accountDao.createForUpdate();
    acctForUpdate.setAccountName(newAccountName);
    success=_accountDao.update(Long.valueOf(account.getId()),acctForUpdate);
  }
  if (success)   return _accountDao.findById(account.getId());
 else   throw new CloudRuntimeException("Unable to update account " + accountName + " in domain "+ domainId);
}
