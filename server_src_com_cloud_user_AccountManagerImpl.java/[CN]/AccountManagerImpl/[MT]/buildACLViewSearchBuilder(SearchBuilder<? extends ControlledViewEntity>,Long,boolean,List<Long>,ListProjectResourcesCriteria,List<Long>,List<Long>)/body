{
  if (!revokedIds.isEmpty()) {
    sb.and("idNIN",sb.entity().getId(),SearchCriteria.Op.NIN);
  }
  if (permittedAccounts.isEmpty() && domainId == null && listProjectResourcesCriteria == null) {
    return;
  }
  boolean hasOp=true;
  if (!permittedAccounts.isEmpty()) {
    sb.and().op("accountIdIN",sb.entity().getAccountId(),SearchCriteria.Op.IN);
  }
 else   if (domainId != null) {
    if (isRecursive) {
      sb.and().op("domainPath",sb.entity().getDomainPath(),SearchCriteria.Op.LIKE);
    }
 else {
      sb.and().op("domainId",sb.entity().getDomainId(),SearchCriteria.Op.EQ);
    }
  }
 else {
    hasOp=false;
  }
  if (listProjectResourcesCriteria != null) {
    if (hasOp) {
      if (listProjectResourcesCriteria == Project.ListProjectResourcesCriteria.ListProjectResourcesOnly) {
        sb.and("accountType",sb.entity().getAccountType(),SearchCriteria.Op.EQ);
      }
 else       if (listProjectResourcesCriteria == Project.ListProjectResourcesCriteria.SkipProjectResources) {
        sb.and("accountType",sb.entity().getAccountType(),SearchCriteria.Op.NEQ);
      }
    }
 else {
      if (listProjectResourcesCriteria == Project.ListProjectResourcesCriteria.ListProjectResourcesOnly) {
        sb.and().op("accountType",sb.entity().getAccountType(),SearchCriteria.Op.EQ);
      }
 else       if (listProjectResourcesCriteria == Project.ListProjectResourcesCriteria.SkipProjectResources) {
        sb.and().op("accountType",sb.entity().getAccountType(),SearchCriteria.Op.NEQ);
      }
    }
  }
  if (!grantedIds.isEmpty()) {
    sb.or("idIN",sb.entity().getId(),SearchCriteria.Op.IN);
  }
  sb.cp();
}
