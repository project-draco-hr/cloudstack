{
  if (isAdmin(caller.getType()) && accountName != null && domainId != null) {
    DomainVO domain=_domainDao.findById(domainId);
    if (domain == null) {
      throw new InvalidParameterValueException("Unable to find the domain by id=" + domainId);
    }
    Account owner=_accountDao.findActiveAccount(accountName,domainId);
    if (owner == null) {
      throw new InvalidParameterValueException("Unable to find account " + accountName + " in domain "+ domainId);
    }
    checkAccess(caller,domain);
    return owner;
  }
 else   if (!isAdmin(caller.getType()) && accountName != null && domainId != null) {
    if (!accountName.equals(caller.getAccountName()) || domainId.longValue() != caller.getDomainId()) {
      throw new PermissionDeniedException("Can't create/list resources for account " + accountName + " in domain "+ domainId+ ", permission denied");
    }
 else {
      return caller;
    }
  }
 else {
    if ((accountName == null && domainId != null) || (accountName != null && domainId == null)) {
      throw new InvalidParameterValueException("AccountName and domainId must be specified together");
    }
    return caller;
  }
}
