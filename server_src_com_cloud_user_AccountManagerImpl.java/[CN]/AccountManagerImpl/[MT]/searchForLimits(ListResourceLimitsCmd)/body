{
  String accountName=cmd.getAccountName();
  Long domainId=cmd.getDomainId();
  Long accountId=null;
  Account account=UserContext.current().getCaller();
  if ((account == null) || isAdmin(account.getType())) {
    if (accountName != null) {
      if (domainId == null) {
        throw new InvalidParameterValueException("Failed to list limits for account " + accountName + " no domain id specified.");
      }
      Account userAccount=_accountDao.findActiveAccount(accountName,domainId);
      if (userAccount == null) {
        throw new InvalidParameterValueException("Unable to find account " + accountName + " in domain "+ domainId);
      }
 else       if (account != null && (account.getType() == Account.ACCOUNT_TYPE_DOMAIN_ADMIN || account.getType() == Account.ACCOUNT_TYPE_READ_ONLY_ADMIN || account.getType() == Account.ACCOUNT_TYPE_READ_ONLY_ADMIN)) {
        if (account.getDomainId() != userAccount.getDomainId() && !_domainDao.isChildDomain(account.getDomainId(),userAccount.getDomainId())) {
          throw new PermissionDeniedException("You do not have permission to access limits for this account: " + accountName);
        }
      }
      accountId=userAccount.getId();
      domainId=null;
    }
 else     if (domainId != null) {
      accountId=null;
    }
 else     if (account == null) {
      domainId=DomainVO.ROOT_DOMAIN;
    }
 else {
      accountId=account.getId();
      domainId=null;
    }
  }
 else {
    accountId=account.getId();
    domainId=null;
  }
  ResourceType resourceType=null;
  Integer type=cmd.getResourceType();
  try {
    if (type != null) {
      resourceType=ResourceType.values()[type];
    }
  }
 catch (  ArrayIndexOutOfBoundsException e) {
    throw new InvalidParameterValueException("Invalid resource type " + type + " given.  Please specify a valid resource type.");
  }
  Criteria c=new Criteria("id",Boolean.FALSE,cmd.getStartIndex(),cmd.getPageSizeVal());
  c.addCriteria(Criteria.ID,cmd.getId());
  c.addCriteria(Criteria.DOMAINID,domainId);
  c.addCriteria(Criteria.ACCOUNTID,accountId);
  c.addCriteria(Criteria.TYPE,resourceType);
  return searchForLimits(c);
}
