{
  String accountName=cmd.getAccountName();
  Long domainId=cmd.getDomainId();
  Long accountId=null;
  Account account=UserContext.current().getCaller();
  if ((account == null) || isAdmin(account.getType())) {
    if (accountName != null) {
      if (domainId == null) {
        throw new InvalidParameterValueException("Failed to list limits for account " + accountName + " no domain id specified.");
      }
      DomainVO domain=_domainDao.findById(domainId);
      if (domain == null) {
        throw new InvalidParameterValueException("Unable to find domain by id " + domainId);
      }
      Account userAccount=_accountDao.findActiveAccount(accountName,domainId);
      if (userAccount == null) {
        throw new InvalidParameterValueException("Unable to find account " + accountName + " in domain "+ domainId);
      }
      if (account != null) {
        checkAccess(account,domain);
      }
      accountId=userAccount.getId();
      domainId=null;
    }
 else     if (domainId != null) {
      DomainVO domain=_domainDao.findById(domainId);
      if (domain == null) {
        throw new InvalidParameterValueException("Unable to find domain by id " + domainId);
      }
      if (account != null) {
        checkAccess(account,domain);
      }
      accountId=null;
    }
 else     if (account == null) {
      domainId=DomainVO.ROOT_DOMAIN;
    }
 else {
      accountId=account.getId();
      domainId=null;
    }
  }
 else {
    accountId=account.getId();
    domainId=null;
  }
  ResourceType resourceType=null;
  Integer type=cmd.getResourceType();
  try {
    if (type != null) {
      resourceType=ResourceType.values()[type];
    }
  }
 catch (  ArrayIndexOutOfBoundsException e) {
    throw new InvalidParameterValueException("Invalid resource type " + type + " given.  Please specify a valid resource type.");
  }
  Criteria c=new Criteria("id",Boolean.FALSE,cmd.getStartIndex(),cmd.getPageSizeVal());
  c.addCriteria(Criteria.ID,cmd.getId());
  c.addCriteria(Criteria.DOMAINID,domainId);
  c.addCriteria(Criteria.ACCOUNTID,accountId);
  c.addCriteria(Criteria.TYPE,resourceType);
  return searchForLimits(c);
}
