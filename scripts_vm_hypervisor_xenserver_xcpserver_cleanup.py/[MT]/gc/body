def gc(session, srUuid, inBackground, dryRun=False):
    'Garbage collect all deleted VDIs in SR "srUuid". Fork & return \n    immediately if inBackground=True. \n    \n    The following algorithm is used:\n    1. If we are already GC\'ing in this SR, return\n    2. If we are already coalescing a VDI pair:\n        a. Scan the SR and determine if the VDI pair is GC\'able\n        b. If the pair is not GC\'able, return\n        c. If the pair is GC\'able, abort coalesce\n    3. Scan the SR\n    4. If there is nothing to collect, nor to coalesce, return\n    5. If there is something to collect, GC all, then goto 3\n    6. If there is something to coalesce, coalesce one pair, then goto 3\n    '
    Util.log(('=== SR %s: gc ===' % srUuid))
    if inBackground:
        if daemonize():
            try:
                _gc(None, srUuid, dryRun)
            except AbortException:
                Util.log('Aborted')
            except Exception:
                Util.logException('gc')
                Util.log(('* * * * * SR %s: ERROR\n' % srUuid))
            os._exit(0)
    else:
        _gc(session, srUuid, dryRun)
