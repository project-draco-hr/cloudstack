def _buildTree(self, force):
    self.vdiTrees = []
    for vdi in self.vdis.values():
        if vdi.parentUuid:
            parent = self.getVDI(vdi.parentUuid)
            if (not parent):
                if vdi.uuid.startswith(self.TMP_RENAME_PREFIX):
                    self.vdiTrees.append(vdi)
                    continue
                if force:
                    Util.log(('ERROR: Parent VDI %s not found! (for %s)' % (vdi.parentUuid, vdi.uuid)))
                    self.vdiTrees.append(vdi)
                    continue
                else:
                    raise util.SMException(('Parent VDI %s of %s not found' % (vdi.parentUuid, vdi.uuid)))
            vdi.parent = parent
            parent.children.append(vdi)
        else:
            self.vdiTrees.append(vdi)
