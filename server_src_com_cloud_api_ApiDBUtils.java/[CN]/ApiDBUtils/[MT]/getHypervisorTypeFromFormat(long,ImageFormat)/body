{
  HypervisorType type=s_storageMgr.getHypervisorTypeFromFormat(format);
  if (format == ImageFormat.VHD) {
    List<ClusterVO> xenClusters=s_clusterDao.listByDcHyType(dcId,HypervisorType.XenServer.toString());
    if (xenClusters.isEmpty()) {
      type=HypervisorType.Hyperv;
    }
  }
  return type;
}
