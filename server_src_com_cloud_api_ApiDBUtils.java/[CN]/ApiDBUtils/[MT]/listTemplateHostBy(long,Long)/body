{
  if (zoneId != null) {
    VMTemplateVO vmTemplate=findTemplateById(templateId);
    if (vmTemplate.getHypervisorType() == HypervisorType.BareMetal) {
      return _templateHostDao.listByTemplateId(templateId);
    }
 else {
      HostVO secondaryStorageHost=_storageMgr.getSecondaryStorageHost(zoneId);
      if (secondaryStorageHost == null) {
        return new ArrayList<VMTemplateHostVO>();
      }
 else {
        return _templateHostDao.listByHostTemplate(secondaryStorageHost.getId(),templateId);
      }
    }
  }
 else {
    return _templateHostDao.listByOnlyTemplateId(templateId);
  }
}
