{
  final StoragePool pool=Mockito.mock(StoragePool.class);
  final String secondaryStoragePoolURL="/opt/storage/";
  final Long dcId=1l;
  final Long accountId=1l;
  final Long volumeId=1l;
  final String backedUpSnapshotUuid="uuid:/8edb1156-a851-4914-afc6-468ee52ac861/";
  final String backedUpSnapshotName="uuid:/8edb1156-a851-4914-afc6-468ee52ac862/";
  final int wait=0;
  final CreateVolumeFromSnapshotCommand command=new CreateVolumeFromSnapshotCommand(pool,secondaryStoragePoolURL,dcId,accountId,volumeId,backedUpSnapshotUuid,backedUpSnapshotName,wait);
  final KVMStoragePoolManager storagePoolMgr=Mockito.mock(KVMStoragePoolManager.class);
  final KVMStoragePool secondaryPool=Mockito.mock(KVMStoragePool.class);
  final KVMPhysicalDisk snapshot=Mockito.mock(KVMPhysicalDisk.class);
  String snapshotPath=command.getSnapshotUuid();
  final int index=snapshotPath.lastIndexOf("/");
  snapshotPath=snapshotPath.substring(0,index);
  final String primaryUuid=command.getPrimaryStoragePoolNameLabel();
  when(libvirtComputingResource.getStoragePoolMgr()).thenReturn(storagePoolMgr);
  when(storagePoolMgr.getStoragePoolByURI(command.getSecondaryStorageUrl() + snapshotPath)).thenReturn(secondaryPool);
  when(secondaryPool.getPhysicalDisk(command.getSnapshotName())).thenReturn(snapshot);
  when(storagePoolMgr.getStoragePool(command.getPool().getType(),primaryUuid)).thenThrow(CloudRuntimeException.class);
  final LibvirtRequestWrapper wrapper=LibvirtRequestWrapper.getInstance();
  assertNotNull(wrapper);
  final Answer answer=wrapper.execute(command,libvirtComputingResource);
  assertFalse(answer.getResult());
  verify(libvirtComputingResource,times(1)).getStoragePoolMgr();
  verify(storagePoolMgr,times(1)).getStoragePoolByURI(command.getSecondaryStorageUrl() + snapshotPath);
  verify(secondaryPool,times(1)).getPhysicalDisk(command.getSnapshotName());
  verify(storagePoolMgr,times(1)).getStoragePool(command.getPool().getType(),primaryUuid);
}
