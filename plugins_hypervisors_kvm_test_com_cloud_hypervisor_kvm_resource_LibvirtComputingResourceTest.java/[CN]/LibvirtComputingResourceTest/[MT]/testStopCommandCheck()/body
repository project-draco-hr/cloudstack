{
  final Connect conn=Mockito.mock(Connect.class);
  final LibvirtConnectionWrapper libvirtConnectionWrapper=Mockito.mock(LibvirtConnectionWrapper.class);
  final Domain domain=Mockito.mock(Domain.class);
  final String vmName="Test";
  final StopCommand stopCommand=new StopCommand(vmName,false,true);
  when(libvirtComputingResource.getLibvirtConnectionWrapper()).thenReturn(libvirtConnectionWrapper);
  try {
    when(libvirtConnectionWrapper.getConnectionByName(vmName)).thenReturn(conn);
    when(conn.domainLookupByName(stopCommand.getVmName())).thenReturn(domain);
  }
 catch (  final LibvirtException e) {
    fail(e.getMessage());
  }
  final LibvirtRequestWrapper wrapper=LibvirtRequestWrapper.getInstance();
  assertNotNull(wrapper);
  final Answer answer=wrapper.execute(stopCommand,libvirtComputingResource);
  assertTrue(answer.getResult());
  verify(libvirtComputingResource,times(1)).getLibvirtConnectionWrapper();
  try {
    verify(libvirtConnectionWrapper,times(2)).getConnectionByName(vmName);
  }
 catch (  final LibvirtException e) {
    fail(e.getMessage());
  }
}
