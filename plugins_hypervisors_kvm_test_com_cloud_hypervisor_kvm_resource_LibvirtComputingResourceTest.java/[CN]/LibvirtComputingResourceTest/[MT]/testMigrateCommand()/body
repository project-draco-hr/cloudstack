{
  final Connect conn=Mockito.mock(Connect.class);
  final Connect dconn=Mockito.mock(Connect.class);
  final LibvirtUtilitiesHelper libvirtUtilitiesHelper=Mockito.mock(LibvirtUtilitiesHelper.class);
  final String vmName="Test";
  final String destIp="127.0.0.100";
  final boolean isWindows=false;
  final VirtualMachineTO vmTO=Mockito.mock(VirtualMachineTO.class);
  final boolean executeInSequence=false;
  final MigrateCommand command=new MigrateCommand(vmName,destIp,isWindows,vmTO,executeInSequence);
  when(libvirtComputingResource.getLibvirtUtilitiesHelper()).thenReturn(libvirtUtilitiesHelper);
  try {
    when(libvirtUtilitiesHelper.getConnectionByVmName(vmName)).thenReturn(conn);
    when(libvirtUtilitiesHelper.retrieveQemuConnection("qemu+tcp://" + command.getDestinationIp() + "/system")).thenReturn(dconn);
  }
 catch (  final LibvirtException e) {
    fail(e.getMessage());
  }
  final InterfaceDef interfaceDef=Mockito.mock(InterfaceDef.class);
  final List<InterfaceDef> ifaces=new ArrayList<InterfaceDef>();
  ifaces.add(interfaceDef);
  when(libvirtComputingResource.getInterfaces(conn,vmName)).thenReturn(ifaces);
  final DiskDef diskDef=Mockito.mock(DiskDef.class);
  final List<DiskDef> disks=new ArrayList<DiskDef>();
  disks.add(diskDef);
  when(libvirtComputingResource.getDisks(conn,vmName)).thenReturn(disks);
  final Domain dm=Mockito.mock(Domain.class);
  try {
    when(conn.domainLookupByName(vmName)).thenReturn(dm);
    when(libvirtComputingResource.getPrivateIp()).thenReturn("127.0.0.1");
    when(dm.getXMLDesc(8)).thenReturn("host_domain");
    when(dm.getXMLDesc(1)).thenReturn("host_domain");
    when(dm.isPersistent()).thenReturn(1);
    doNothing().when(dm).undefine();
  }
 catch (  final LibvirtException e) {
    fail(e.getMessage());
  }
catch (  final Exception e) {
    fail(e.getMessage());
  }
  final LibvirtRequestWrapper wrapper=LibvirtRequestWrapper.getInstance();
  assertNotNull(wrapper);
  final Answer answer=wrapper.execute(command,libvirtComputingResource);
  assertTrue(answer.getResult());
  verify(libvirtComputingResource,times(1)).getLibvirtUtilitiesHelper();
  try {
    verify(libvirtUtilitiesHelper,times(1)).getConnectionByVmName(vmName);
    verify(libvirtUtilitiesHelper,times(1)).retrieveQemuConnection("qemu+tcp://" + command.getDestinationIp() + "/system");
  }
 catch (  final LibvirtException e) {
    fail(e.getMessage());
  }
  verify(libvirtComputingResource,times(1)).getInterfaces(conn,vmName);
  verify(libvirtComputingResource,times(1)).getDisks(conn,vmName);
  try {
    verify(conn,times(1)).domainLookupByName(vmName);
  }
 catch (  final LibvirtException e) {
    fail(e.getMessage());
  }
  try {
    verify(dm,times(1)).getXMLDesc(8);
  }
 catch (  final Throwable t) {
    try {
      verify(dm,times(1)).getXMLDesc(1);
    }
 catch (    final LibvirtException e) {
      fail(e.getMessage());
    }
  }
}
