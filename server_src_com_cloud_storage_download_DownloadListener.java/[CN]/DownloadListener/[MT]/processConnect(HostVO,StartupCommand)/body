{
  if (!((cmd instanceof StartupStorageCommand) || (cmd instanceof StartupRoutingCommand))) {
    return;
  }
  if (cmd instanceof StartupRoutingCommand) {
    downloadMonitor.handleSysTemplateDownload(agent);
  }
 else {
    if (cmd.getGuid().startsWith("iso:")) {
      return;
    }
    long agentId=agent.getId();
    StartupStorageCommand storage=(StartupStorageCommand)cmd;
    if (storage.getResourceType() == Storage.StorageResourceType.STORAGE_HOST || storage.getResourceType() == Storage.StorageResourceType.SECONDARY_STORAGE) {
      downloadMonitor.handleTemplateSync(agentId,storage.getTemplateInfo());
    }
  }
}
