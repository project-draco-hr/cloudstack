{
  NetworkOffering offering=_configService.getNetworkOffering(networkOfferingId);
  if (offering == null) {
    throw new InvalidParameterValueException("Unable to find network offering by id " + networkOfferingId);
  }
  if (offering.getGuestType() == GuestType.Shared) {
    if (physicalNetworkId != null) {
      return physicalNetworkId;
    }
 else     if (zoneId != null) {
      return _networkService.findPhysicalNetworkId(zoneId,offering.getTags());
    }
 else {
      throw new InvalidParameterValueException("Either zoneId or physicalNetworkId have to be specified for the network of type " + GuestType.Shared);
    }
  }
 else   if (physicalNetworkId != null) {
    throw new InvalidParameterValueException("Physical network id can be specified for networks of guest ip type " + GuestType.Shared + " only.");
  }
 else {
    return null;
  }
}
