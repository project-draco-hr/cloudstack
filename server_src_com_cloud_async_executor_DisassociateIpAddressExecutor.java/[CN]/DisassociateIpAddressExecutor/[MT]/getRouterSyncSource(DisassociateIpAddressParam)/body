{
  IPAddressDao ipAddressDao=getAsyncJobMgr().getExecutorContext().getIpAddressDao();
  DomainRouterDao routerDao=getAsyncJobMgr().getExecutorContext().getRouterDao();
  IPAddressVO ip=null;
  try {
    ip=ipAddressDao.acquireInLockTable(param.getIpAddress());
    DomainRouterVO router=null;
    if (ip.isSourceNat()) {
      router=routerDao.findByPublicIpAddress(param.getIpAddress());
    }
 else {
      router=routerDao.findBy(ip.getAccountId(),ip.getDataCenterId());
    }
    return router;
  }
  finally {
    if (ip != null) {
      ipAddressDao.releaseFromLockTable(param.getIpAddress());
    }
  }
}
