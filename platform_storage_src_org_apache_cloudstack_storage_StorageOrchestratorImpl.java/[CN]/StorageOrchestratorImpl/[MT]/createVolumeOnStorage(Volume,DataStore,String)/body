{
  VolumeStrategy vs=destStore.getVolumeStrategy();
  volume.setReservationId(reservationId);
  volume=_volumeMgr.processEvent(volume,Volume.Event.CreateRequested);
  if (volume.getTemplateId() != null) {
    VirtualMachineTemplate template=_templateDao.findById(volume.getTemplateId());
    DataStore ds=_secondaryStorageMgr.getImageStore(destStore);
    TemplateProfile tp=ds.prepareTemplate(template,destStore);
    if (!destStore.contains(tp)) {
      tp=_templateMgr.AssociateTemplateStoragePool(tp,destStore);
      tp=destStore.getTemplateStrategy().install(tp);
    }
 else {
      tp=destStore.getTemplateStrategy().get(tp.getId());
    }
    volume=vs.createVolumeFromBaseTemplate(volume,tp);
  }
 else {
    volume=vs.createDataVolume(volume);
  }
  volume=_volumeMgr.processEvent(volume,Volume.Event.OperationSucceeded);
  return volume;
}
