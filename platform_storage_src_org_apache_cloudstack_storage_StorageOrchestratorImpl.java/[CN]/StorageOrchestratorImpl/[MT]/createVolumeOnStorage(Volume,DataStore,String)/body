{
  VolumeStrategy vs=destStore.getVolumeStrategy();
  volume.setReservationId(reservationId);
  volume=_volumeMgr.processEvent(volume,Volume.Event.CreateRequested);
  if (volume.getTemplateId() != null) {
    VirtualMachineTemplate template=_templateDao.findById(volume.getTemplateId());
    DataStore ds=_secondaryStorageMgr.getBackupDataStore(template);
    TemplateProfile tp=ds.prepareTemplate(template,destStore);
    if (!destStore.contains(template)) {
      tp=vs.createBaseVolume(tp,destStore);
    }
 else {
      tp=destStore.get(template);
    }
    volume=vs.createVolumeFromBaseTemplate(tp,destStore);
  }
 else {
    volume=vs.createDataVolume(volume,destStore);
  }
  volume=_volumeMgr.processEvent(volume,Volume.Event.OperationSucceeded);
  return volume;
}
