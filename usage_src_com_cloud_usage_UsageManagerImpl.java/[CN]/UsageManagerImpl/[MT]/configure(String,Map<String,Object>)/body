{
  final String run="usage.vmops.pid";
  if (logger.isDebugEnabled()) {
    logger.debug("Checking to see if " + run + " exists.");
  }
  final Class<?> c=UsageServer.class;
  _version=c.getPackage().getImplementationVersion();
  if (_version == null)   _version="unknown";
  if (logger.isInfoEnabled()) {
    logger.info("Implementation Version is " + _version);
  }
  Map<String,String> configs=_configDao.getConfiguration(params);
  if (params != null) {
    mergeConfigs(configs,params);
  }
  String execTime=configs.get("usage.stats.job.exec.time");
  String aggregationRange=configs.get("usage.stats.job.aggregation.range");
  String execTimeZone=configs.get("usage.execution.timezone");
  String aggreagationTimeZone=configs.get("usage.aggregation.timezone");
  String sanityCheckInterval=configs.get("usage.sanity.check.interval");
  if (sanityCheckInterval != null) {
    _sanityCheckInterval=Integer.parseInt(sanityCheckInterval);
  }
  if (aggreagationTimeZone != null && !aggreagationTimeZone.isEmpty()) {
    _usageTimezone=TimeZone.getTimeZone(aggreagationTimeZone);
  }
  logger.debug("Usage stats aggregation time zone: " + aggreagationTimeZone);
  try {
    if ((execTime == null) || (aggregationRange == null)) {
      logger.error("missing configuration values for usage job, usage.stats.job.exec.time = " + execTime + ", usage.stats.job.aggregation.range = "+ aggregationRange);
      throw new ConfigurationException("Missing configuration values for usage job, usage.stats.job.exec.time = " + execTime + ", usage.stats.job.aggregation.range = "+ aggregationRange);
    }
    String[] execTimeSegments=execTime.split(":");
    if (execTimeSegments.length != 2) {
      logger.error("Unable to parse usage.stats.job.exec.time");
      throw new ConfigurationException("Unable to parse usage.stats.job.exec.time '" + execTime + "'");
    }
    int hourOfDay=Integer.parseInt(execTimeSegments[0]);
    int minutes=Integer.parseInt(execTimeSegments[1]);
    _jobExecTime.setTime(new Date());
    _jobExecTime.set(Calendar.HOUR_OF_DAY,hourOfDay);
    _jobExecTime.set(Calendar.MINUTE,minutes);
    _jobExecTime.set(Calendar.SECOND,0);
    _jobExecTime.set(Calendar.MILLISECOND,0);
    if (execTimeZone != null && !execTimeZone.isEmpty()) {
      _jobExecTime.setTimeZone(TimeZone.getTimeZone(execTimeZone));
    }
    Date execDate=_jobExecTime.getTime();
    if (execDate.before(new Date())) {
      _jobExecTime.roll(Calendar.DAY_OF_YEAR,true);
    }
    logger.debug("Execution Time: " + execDate.toString());
    Date currentDate=new Date(System.currentTimeMillis());
    logger.debug("Current Time: " + currentDate.toString());
    _aggregationDuration=Integer.parseInt(aggregationRange);
    if (_aggregationDuration < UsageUtils.USAGE_AGGREGATION_RANGE_MIN) {
      logger.warn("Usage stats job aggregation range is to small, using the minimum value of " + UsageUtils.USAGE_AGGREGATION_RANGE_MIN);
      _aggregationDuration=UsageUtils.USAGE_AGGREGATION_RANGE_MIN;
    }
    _hostname=InetAddress.getLocalHost().getHostName() + "/" + InetAddress.getLocalHost().getHostAddress();
  }
 catch (  NumberFormatException ex) {
    throw new ConfigurationException("Unable to parse usage.stats.job.exec.time '" + execTime + "' or usage.stats.job.aggregation.range '"+ aggregationRange+ "', please check configuration values");
  }
catch (  Exception e) {
    logger.error("Unhandled exception configuring UsageManger",e);
    throw new ConfigurationException("Unhandled exception configuring UsageManager " + e.toString());
  }
  _pid=Integer.parseInt(System.getProperty("pid"));
  return true;
}
