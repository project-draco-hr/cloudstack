{
  final List<NameValuePair> paramsCopy=new ArrayList<NameValuePair>(params.size() + 1);
  paramsCopy.addAll(params);
  paramsCopy.add(new NameValuePair(APIKEY_KEY,urlSafe(apiKey)));
  Collections.sort(paramsCopy,new Comparator<NameValuePair>(){
    @Override public int compare(    final NameValuePair nameValuePair,    final NameValuePair nameValuePair2){
      return nameValuePair.getName().compareTo(nameValuePair2.getName());
    }
  }
);
  final List<String> serializedParameters=new ArrayList<String>(paramsCopy.size());
  for (  final NameValuePair pair : paramsCopy) {
    serializedParameters.add(pair.getName() + "=" + urlSafe(pair.getValue()));
  }
  final String toSign=StringUtils.join(serializedParameters,"&").toLowerCase();
  return calculateRFC2104HMAC(toSign,secretKey);
}
