{
  Map<Ip,List<LoadBalancingRule>> groupedRules=new HashMap<Ip,List<LoadBalancingRule>>();
  for (  LoadBalancingRule rule : rules) {
    Ip sourceIp=rule.getSourceIp();
    if (!groupedRules.containsKey(sourceIp)) {
      groupedRules.put(sourceIp,null);
    }
    List<LoadBalancingRule> rulesToApply=groupedRules.get(sourceIp);
    if (rulesToApply == null) {
      rulesToApply=new ArrayList<LoadBalancingRule>();
    }
    rulesToApply.add(rule);
    groupedRules.put(sourceIp,rulesToApply);
  }
  return groupedRules;
}
