{
  Map<Ip,List<LoadBalancingRule>> groupedRules=groupBySourceIp(rules);
  Set<Ip> vmsToDestroy=new HashSet<Ip>();
  for (  Ip sourceIp : groupedRules.keySet()) {
    List<LoadBalancingRule> rulesToCheck=groupedRules.get(sourceIp);
    if (_appLbDao.countBySourceIpAndNotRevoked(sourceIp,rulesToCheck.get(0).getNetworkId()) == 0) {
      s_logger.debug("Have to destroy internal lb vm for source ip " + sourceIp + " as it has 0 rules in non-Revoke state");
      vmsToDestroy.add(sourceIp);
    }
  }
  return vmsToDestroy;
}
