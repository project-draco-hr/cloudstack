{
  Map<Ip,List<LoadBalancingRule>> groupedRules=groupBySourceIp(rules);
  Set<Ip> vmsToDestroy=new HashSet<Ip>();
  for (  Ip sourceIp : groupedRules.keySet()) {
    List<LoadBalancingRule> rulesToCheck=groupedRules.get(sourceIp);
    int revoke=0;
    for (    LoadBalancingRule ruleToCheck : rulesToCheck) {
      if (ruleToCheck.getState() == FirewallRule.State.Revoke) {
        revoke++;
      }
    }
    if (revoke == rulesToCheck.size()) {
      s_logger.debug("Have to destroy internal lb vm for source ip " + sourceIp);
      vmsToDestroy.add(sourceIp);
    }
  }
  return vmsToDestroy;
}
