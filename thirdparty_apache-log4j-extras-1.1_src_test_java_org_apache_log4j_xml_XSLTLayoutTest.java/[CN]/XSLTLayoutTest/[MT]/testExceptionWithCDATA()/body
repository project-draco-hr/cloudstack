{
  Logger logger=Logger.getLogger("com.example.bar");
  Level level=Level.INFO;
  String exceptionMessage="<envelope><faultstring><![CDATA[The EffectiveDate]]></faultstring><envelope>";
  LoggingEvent event=new LoggingEvent("com.example.bar",logger,level,"Hello, World",new Exception(exceptionMessage));
  Layout layout=createLayout();
  String result=layout.format(event);
  Element parsedResult=parse(result);
  NodeList throwables=parsedResult.getElementsByTagName("log4j:throwable");
  assertEquals(1,throwables.getLength());
  StringBuffer buf=new StringBuffer();
  for (Node child=throwables.item(0).getFirstChild(); child != null; child=child.getNextSibling()) {
    buf.append(child.getNodeValue());
  }
  assertTrue(buf.toString().indexOf(exceptionMessage) != -1);
}
