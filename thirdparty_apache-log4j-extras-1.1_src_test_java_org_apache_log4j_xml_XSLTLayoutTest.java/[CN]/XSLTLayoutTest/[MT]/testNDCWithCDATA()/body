{
  Logger logger=Logger.getLogger("com.example.bar");
  Level level=Level.INFO;
  String ndcMessage="<envelope><faultstring><![CDATA[The EffectiveDate]]></faultstring><envelope>";
  NDC.push(ndcMessage);
  LoggingEvent event=new LoggingEvent("com.example.bar",logger,level,"Hello, World",null);
  Layout layout=createLayout();
  String result=layout.format(event);
  NDC.clear();
  Element parsedResult=parse(result);
  NodeList ndcs=parsedResult.getElementsByTagName("log4j:NDC");
  assertEquals(1,ndcs.getLength());
  StringBuffer buf=new StringBuffer();
  for (Node child=ndcs.item(0).getFirstChild(); child != null; child=child.getNextSibling()) {
    buf.append(child.getNodeValue());
  }
  assertEquals(ndcMessage,buf.toString());
}
