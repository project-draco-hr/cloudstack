{
  Marshaller marshaller=null;
  org.w3c.dom.Element authDOM=null;
  StringWriter requestWriter=null;
  String requestMessage=null;
  Deflater deflater=null;
  ByteArrayOutputStream byteArrayOutputStream=null;
  DeflaterOutputStream deflaterOutputStream=null;
  String encodedRequestMessage=null;
  marshaller=org.opensaml.Configuration.getMarshallerFactory().getMarshaller(authnRequest);
  authDOM=marshaller.marshall(authnRequest);
  requestWriter=new StringWriter();
  XMLHelper.writeNode(authDOM,requestWriter);
  requestMessage=requestWriter.toString();
  deflater=new Deflater(Deflater.DEFLATED,true);
  byteArrayOutputStream=new ByteArrayOutputStream();
  deflaterOutputStream=new DeflaterOutputStream(byteArrayOutputStream,deflater);
  deflaterOutputStream.write(requestMessage.getBytes());
  deflaterOutputStream.close();
  encodedRequestMessage=Base64.encodeBytes(byteArrayOutputStream.toByteArray(),Base64.DONT_BREAK_LINES);
  encodedRequestMessage=URLEncoder.encode(encodedRequestMessage,"UTF-8").trim();
  return encodedRequestMessage;
}
