{
  _router=router;
  boolean result=false;
  try {
    _network=_networkModel.getNetwork(_privateGateway.getNetworkId());
    NicProfile requested=_vpcNetworkHelper.createPrivateNicProfileForGateway(_privateGateway);
    if (!_networkHelper.checkRouterVersion(router)) {
      s_logger.warn("Router requires upgrade. Unable to send command to router: " + router.getId());
      return false;
    }
    _nicProfile=_itMgr.addVmToNetwork(router,_network,requested);
    if (_nicProfile != null) {
      _isAddOperation=true;
      result=visitor.visit(this);
    }
  }
 catch (  Exception ex) {
    s_logger.warn("Failed to create private gateway " + _privateGateway + " on router "+ router+ " due to ",ex);
  }
 finally {
    if (!result) {
      s_logger.debug("Failed to setup gateway " + _privateGateway + " on router "+ router+ " with the source nat. Will now remove the gateway.");
      _isAddOperation=false;
      boolean isRemoved=destroyPrivateGateway(visitor);
      if (isRemoved) {
        s_logger.debug("Removed the gateway " + _privateGateway + " from router "+ router+ " as a part of cleanup");
      }
 else {
        s_logger.warn("Failed to remove the gateway " + _privateGateway + " from router "+ router+ " as a part of cleanup");
      }
    }
  }
  return result;
}
