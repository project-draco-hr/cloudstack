{
  URI uri;
  try {
    uri=new URI(url);
  }
 catch (  URISyntaxException e) {
    throw new InvalidParameterValueException("invalide url" + url);
  }
  String protocol=uri.getScheme();
  if (protocol == null) {
    throw new InvalidParameterValueException("the protocol can't be null");
  }
  ClusterVO cluster=_clusterDao.findById(spool.getClusterId());
  Map<String,DataStoreConfigurator> dscs=_supportedProtocols.get(cluster.getHypervisorType());
  if (dscs.isEmpty()) {
    throw new InvalidParameterValueException("Doesn't support this hypervisor");
  }
  DataStoreConfigurator dsc=dscs.get(protocol);
  if (dsc == null) {
    throw new InvalidParameterValueException("Doesn't support this protocol");
  }
  Map<String,String> configs=dsc.getConfigs(uri,params);
  dsc.validate(configs);
  DataStore ds=dsc.getDataStore(spool);
  return ds;
}
