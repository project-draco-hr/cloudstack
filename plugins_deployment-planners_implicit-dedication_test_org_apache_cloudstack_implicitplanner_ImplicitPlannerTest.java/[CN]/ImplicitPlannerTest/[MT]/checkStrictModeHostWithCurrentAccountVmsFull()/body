{
  @SuppressWarnings("unchecked") VirtualMachineProfileImpl<VMInstanceVO> vmProfile=mock(VirtualMachineProfileImpl.class);
  DataCenterDeployment plan=mock(DataCenterDeployment.class);
  ExcludeList avoids=new ExcludeList();
  initializeForTest(vmProfile,plan);
  initializeForImplicitPlannerTest(false);
  avoids.addHost(5L);
  List<Long> clusterList=planner.orderClusters(vmProfile,plan,avoids);
  assertFalse("Cluster list should not be null/empty",(clusterList == null || clusterList.isEmpty()));
  boolean foundNeededCluster=false;
  for (  Long cluster : clusterList) {
    if (cluster != 2) {
      fail("Found a cluster that shouldn't have been present, cluster id : " + cluster);
    }
 else {
      foundNeededCluster=true;
      break;
    }
  }
  assertTrue("Didn't find cluster 2 in the list. It should have been present",foundNeededCluster);
  Set<Long> hostsInAvoidList=avoids.getHostsToAvoid();
  assertFalse("Host 6 shouldn't have be in the avoid list, but it is present",hostsInAvoidList.contains(6L));
  Set<Long> hostsThatShouldBeInAvoidList=new HashSet<Long>();
  hostsThatShouldBeInAvoidList.add(5L);
  hostsThatShouldBeInAvoidList.add(7L);
  assertFalse("Hosts 5 and 7 that should have been present were not found in avoid list",hostsInAvoidList.containsAll(hostsThatShouldBeInAvoidList));
}
