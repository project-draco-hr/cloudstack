{
  PreparedStatement pstmt=null;
  ResultSet rs=null;
  try {
    pstmt=conn.prepareStatement("select id from vm_template where name = 'systemvm-xenserver-3.0.0' and removed is null");
    rs=pstmt.executeQuery();
    if (rs.next()) {
      long templateId=rs.getLong(1);
      pstmt=conn.prepareStatement("update vm_instance set vm_template_id = ? where type <> 'User' and hypervisor_type = 'XenServer'");
      pstmt.setLong(1,templateId);
      pstmt.executeUpdate();
    }
 else {
      throw new CloudRuntimeException("3.0.0 XenServer SystemVm template not found. Cannout upgrade system Vms");
    }
  }
 catch (  SQLException e) {
    throw new CloudRuntimeException("Error while updating XenServer systemVm template",e);
  }
}
