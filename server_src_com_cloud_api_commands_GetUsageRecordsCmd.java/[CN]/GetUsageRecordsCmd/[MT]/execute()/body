{
  ManagementServerExt _mgrExt=(ManagementServerExt)_mgr;
  List<UsageVO> usageRecords=_mgrExt.getUsageRecords(this);
  ListResponse<UsageRecordResponse> response=new ListResponse<UsageRecordResponse>();
  List<UsageRecordResponse> usageResponses=new ArrayList<UsageRecordResponse>();
  for (  Object usageRecordGeneric : usageRecords) {
    UsageRecordResponse usageRecResponse=new UsageRecordResponse();
    if (usageRecordGeneric instanceof UsageVO) {
      UsageVO usageRecord=(UsageVO)usageRecordGeneric;
      Account account=ApiDBUtils.findAccountByIdIncludingRemoved(usageRecord.getAccountId());
      if (account.getType() == Account.ACCOUNT_TYPE_PROJECT) {
        Project project=ApiDBUtils.findProjectByProjectAccountId(account.getId());
        usageRecResponse.setProjectId(project.getId());
        usageRecResponse.setProjectName(project.getName());
      }
 else {
        usageRecResponse.setAccountId(account.getId());
        usageRecResponse.setAccountName(account.getAccountName());
      }
      usageRecResponse.setDomainId(usageRecord.getDomainId());
      usageRecResponse.setZoneId(usageRecord.getZoneId());
      usageRecResponse.setDescription(usageRecord.getDescription());
      usageRecResponse.setUsage(usageRecord.getUsageDisplay());
      usageRecResponse.setUsageType(usageRecord.getUsageType());
      usageRecResponse.setVirtualMachineId(usageRecord.getVmInstanceId());
      usageRecResponse.setVmName(usageRecord.getVmName());
      usageRecResponse.setServiceOfferingId(usageRecord.getOfferingId());
      usageRecResponse.setTemplateId(usageRecord.getTemplateId());
      usageRecResponse.setUsageId(usageRecord.getUsageId());
      if (usageRecord.getUsageType() == UsageTypes.IP_ADDRESS) {
        usageRecResponse.setSourceNat((usageRecord.getType().equals("SourceNat")) ? true : false);
      }
 else {
        usageRecResponse.setType(usageRecord.getType());
      }
      usageRecResponse.setSize(usageRecord.getSize());
      if (usageRecord.getRawUsage() != null) {
        DecimalFormat decimalFormat=new DecimalFormat("###########.######");
        usageRecResponse.setRawUsage(decimalFormat.format(usageRecord.getRawUsage()));
      }
      if (usageRecord.getStartDate() != null) {
        usageRecResponse.setStartDate(getDateStringInternal(usageRecord.getStartDate()));
      }
      if (usageRecord.getEndDate() != null) {
        usageRecResponse.setEndDate(getDateStringInternal(usageRecord.getEndDate()));
      }
    }
    usageRecResponse.setObjectName("usagerecord");
    usageResponses.add(usageRecResponse);
  }
  response.setResponses(usageResponses);
  response.setResponseName(getCommandName());
  this.setResponseObject(response);
}
