def check_vm_state(self, vm, state=None):
    self.debug(('Check if the VM instance is in state - %s' % state))
    vms = VirtualMachine.list(self.api_client, id=vm.id, listall=True)
    self.assertEqual(isinstance(vms, list), True, 'List virtual machine should return a valid list')
    if state:
        self.assertEqual(vms[0].state, state, 'Virtual machine is not in the expected state')
    self.debug(('Virtual machine is in the expected state - %s' % state))
