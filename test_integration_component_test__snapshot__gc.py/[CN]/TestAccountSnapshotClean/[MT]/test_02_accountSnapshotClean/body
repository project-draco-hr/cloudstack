@attr(speed='slow')
@attr(tags=['advanced', 'advancedns', 'basic', 'sg', 'provisioning'])
def test_02_accountSnapshotClean(self):
    'Test snapshot cleanup after account deletion\n        '
    accounts = list_accounts(self.apiclient, id=self.account.id)
    self.assertEqual(isinstance(accounts, list), True, 'Check list response returns a valid list')
    self.assertNotEqual(len(accounts), 0, 'Check list Accounts response')
    virtual_machines = list_virtual_machines(self.apiclient, id=self.virtual_machine.id)
    self.assertEqual(isinstance(virtual_machines, list), True, 'Check list response returns a valid list')
    self.assertNotEqual(len(virtual_machines), 0, 'Check list virtual machines response')
    for virtual_machine in virtual_machines:
        self.debug(('VM ID: %s, VM state: %s' % (virtual_machine.id, virtual_machine.state)))
        self.assertEqual(virtual_machine.state, 'Running', 'Check list VM response for Running state')
    snapshots = list_snapshots(self.apiclient, id=self.snapshot.id)
    self.assertEqual(isinstance(snapshots, list), True, 'Check list response returns a valid list')
    self.assertNotEqual(snapshots, None, ('No such snapshot %s found' % self.snapshot.id))
    self.assertEqual(snapshots[0].id, self.snapshot.id, 'Check snapshot id in list resources call')
    self.assertTrue(is_snapshot_on_nfs(self.apiclient, self.dbclient, self.config, self.zone.id, self.snapshot.id), 'Snapshot was not found on NFS')
    self.debug(('Deleting account: %s' % self.account.name))
    self.account.delete(self.apiclient)
    wait_for_cleanup(self.apiclient, configs=['account.cleanup.interval'])
    with self.assertRaises(Exception):
        accounts = list_accounts(self.apiclient, id=self.account.id)
    self.assertFalse(is_snapshot_on_nfs(self.apiclient, self.dbclient, self.config, self.zone.id, self.snapshot.id), 'Snapshot was still found on NFS after account gc')
    return
