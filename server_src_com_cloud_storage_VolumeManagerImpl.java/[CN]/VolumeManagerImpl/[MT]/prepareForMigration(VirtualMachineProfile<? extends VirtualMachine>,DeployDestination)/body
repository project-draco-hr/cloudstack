{
  List<VolumeVO> vols=_volsDao.findUsableVolumesForInstance(vm.getId());
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Preparing " + vols.size() + " volumes for "+ vm);
  }
  for (  VolumeVO vol : vols) {
    DataTO volTO=this.volFactory.getVolume(vol.getId()).getTO();
    DiskTO disk=new DiskTO(volTO,vol.getDeviceId(),vol.getVolumeType());
    vm.addDisk(disk);
  }
  if (vm.getType() == VirtualMachine.Type.User) {
    UserVmVO userVM=(UserVmVO)vm.getVirtualMachine();
    if (userVM.getIsoId() != null) {
      DataTO dataTO=this.tmplFactory.getTemplate(userVM.getIsoId(),DataStoreRole.Image,userVM.getDataCenterId()).getTO();
      DiskTO iso=new DiskTO(dataTO,3L,Volume.Type.ISO);
      vm.addDisk(iso);
    }
  }
}
