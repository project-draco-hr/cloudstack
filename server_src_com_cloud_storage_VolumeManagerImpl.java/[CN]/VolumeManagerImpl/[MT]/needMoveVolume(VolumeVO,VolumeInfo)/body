{
  if (rootVolumeOfVm.getPoolId() == null || volume.getPoolId() == null) {
    return false;
  }
  DataStore storeForRootVol=dataStoreMgr.getPrimaryDataStore(rootVolumeOfVm.getPoolId());
  DataStore storeForDataVol=dataStoreMgr.getPrimaryDataStore(volume.getPoolId());
  Scope storeForRootStoreScope=storeForRootVol.getScope();
  if (storeForRootStoreScope == null) {
    throw new CloudRuntimeException("Can't get scope of data store: " + storeForRootVol.getId());
  }
  Scope storeForDataStoreScope=storeForDataVol.getScope();
  if (storeForDataStoreScope == null) {
    throw new CloudRuntimeException("Can't get scope of data store: " + storeForDataVol.getId());
  }
  if (storeForDataStoreScope.getScopeType() == ScopeType.ZONE) {
    return false;
  }
  if (storeForRootStoreScope.getScopeType() != storeForDataStoreScope.getScopeType()) {
    if (storeForDataStoreScope.getScopeType() == ScopeType.CLUSTER && storeForRootStoreScope.getScopeType() == ScopeType.HOST) {
      HostScope hs=(HostScope)storeForRootStoreScope;
      if (storeForDataStoreScope.getScopeId().equals(hs.getClusterId())) {
        return false;
      }
    }
    if (storeForRootStoreScope.getScopeType() == ScopeType.CLUSTER && storeForDataStoreScope.getScopeType() == ScopeType.HOST) {
      HostScope hs=(HostScope)storeForDataStoreScope;
      if (storeForRootStoreScope.getScopeId().equals(hs.getClusterId())) {
        return false;
      }
    }
    throw new CloudRuntimeException("Can't move volume between scope: " + storeForDataStoreScope.getScopeType() + " and "+ storeForRootStoreScope.getScopeType());
  }
  return !storeForRootStoreScope.isSameScope(storeForDataStoreScope);
}
