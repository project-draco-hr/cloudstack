{
  Long volumeId=cmd.getVolumeId();
  Long storagePoolId=cmd.getStoragePoolId();
  VolumeVO vol=_volsDao.findById(volumeId);
  if (vol == null) {
    throw new InvalidParameterValueException("Failed to find the volume id: " + volumeId);
  }
  if (vol.getState() != Volume.State.Ready) {
    throw new InvalidParameterValueException("Volume must be in ready state");
  }
  if (vol.getInstanceId() != null) {
    throw new InvalidParameterValueException("Volume needs to be dettached from VM");
  }
  StoragePool destPool=(StoragePool)this.dataStoreMgr.getDataStore(storagePoolId,DataStoreRole.Primary);
  if (destPool == null) {
    throw new InvalidParameterValueException("Failed to find the destination storage pool: " + storagePoolId);
  }
  if (!volumeOnSharedStoragePool(vol)) {
    throw new InvalidParameterValueException("Migration of volume from local storage pool is not supported");
  }
  Volume newVol=migrateVolume(vol,destPool);
  return newVol;
}
