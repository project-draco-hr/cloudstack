{
  Account caller=UserContext.current().getCaller();
  long ownerId=cmd.getEntityOwnerId();
  Long zoneId=cmd.getZoneId();
  String volumeName=cmd.getVolumeName();
  String url=cmd.getUrl();
  String format=cmd.getFormat();
  String imageStoreUuid=cmd.getImageStoreUuid();
  DataStore store=this._tmpltMgr.getImageStore(imageStoreUuid,zoneId);
  validateVolume(caller,ownerId,zoneId,volumeName,url,format);
  VolumeVO volume=persistVolume(caller,ownerId,zoneId,volumeName,url,cmd.getFormat());
  VolumeInfo vol=this.volFactory.getVolume(volume.getId());
  RegisterVolumePayload payload=new RegisterVolumePayload(cmd.getUrl(),cmd.getChecksum(),cmd.getFormat());
  vol.addPayload(payload);
  this.volService.registerVolume(vol,store);
  return volume;
}
