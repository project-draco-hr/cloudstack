{
  VolumeDataStoreVO volStoreVO=_volumeStoreDao.findByStoreVolume(volume.getDataStore().getId(),volume.getId());
  if (!volStoreVO.getFormat().getFileExtension().equals(getSupportedImageFormatForCluster(rootDiskPool.getClusterId()))) {
    throw new InvalidParameterValueException("Failed to attach volume to VM since volumes format " + volStoreVO.getFormat().getFileExtension() + " is not compatible with the vm hypervisor type");
  }
  VolumeInfo volumeOnPrimary=copyVolumeFromSecToPrimary(volume,vm,rootDiskTmplt,dcVO,pod,rootDiskPool.getClusterId(),svo,diskVO,new ArrayList<StoragePool>(),volume.getSize(),rootDiskHyperType);
  return volumeOnPrimary;
}
