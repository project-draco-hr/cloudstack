{
  Connection slaveConn=null;
  try {
    slaveConn=new Connection(getURL(ip));
    Session.slaveLocalLoginWithPassword(slaveConn,username,password);
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Slave logon to " + ip);
    }
    String masterIp=null;
    Pool.Record pr=getPoolRecord(slaveConn);
    Host master=pr.master;
    masterIp=master.getAddress(slaveConn);
    return masterIp;
  }
 catch (  Exception e) {
    s_logger.debug("Failed to slave local login to " + ip + " due to "+ e.toString());
  }
 finally {
    if (slaveConn != null) {
      try {
        Session.localLogout(slaveConn);
      }
 catch (      Exception e1) {
      }
      slaveConn.dispose();
      slaveConn=null;
    }
  }
  throw new RuntimeException("can not get master ip");
}
