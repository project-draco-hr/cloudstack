{
  CheckVirtualMachineCommand cmd=new CheckVirtualMachineCommand(vm.getInstanceName());
  try {
    Answer answer=_agentMgr.send(vm.getHostId(),cmd);
    if (!answer.getResult()) {
      s_logger.debug("Unable to get vm state on " + vm.toString());
      return null;
    }
    CheckVirtualMachineAnswer cvmAnswer=(CheckVirtualMachineAnswer)answer;
    s_logger.debug("Agent responded with state " + cvmAnswer.getState().toString());
    return cvmAnswer.getState() == State.Running;
  }
 catch (  AgentUnavailableException e) {
    s_logger.debug("Unable to reach the agent for " + vm.toString() + ": "+ e.getMessage());
    return null;
  }
catch (  OperationTimedoutException e) {
    s_logger.debug("Operation timed out for " + vm.toString() + ": "+ e.getMessage());
    return null;
  }
}
