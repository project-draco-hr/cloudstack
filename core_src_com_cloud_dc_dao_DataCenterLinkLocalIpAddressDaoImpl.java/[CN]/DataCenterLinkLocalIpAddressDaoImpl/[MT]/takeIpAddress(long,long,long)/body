{
  SearchCriteria<DataCenterLinkLocalIpAddressVO> sc=FreeIpSearch.create();
  sc.setParameters("dc",dcId);
  sc.setParameters("pod",podId);
  sc.setParameters("ipAddr",NetUtils.getLinkLocalGateway());
  Transaction txn=Transaction.currentTxn();
  try {
    txn.start();
    DataCenterLinkLocalIpAddressVO vo=lock(sc,true);
    if (vo == null) {
      txn.rollback();
      return vo;
    }
    vo.setTakenAt(new Date());
    vo.setInstanceId(instanceId);
    update(vo.getId(),vo);
    txn.commit();
    return vo;
  }
 catch (  Exception e) {
    txn.rollback();
    throw new CloudRuntimeException("Caught Exception ",e);
  }
}
