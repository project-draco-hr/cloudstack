{
  final Connection conn=citrixResourceBase.getConnection();
  final StorageFilerTO pool=command.getPool();
  final boolean add=command.getAdd();
  if (add) {
    try {
      final String srName=command.getStoragePath() != null ? command.getStoragePath() : pool.getUuid();
      final SR sr=citrixResourceBase.getStorageRepository(conn,srName);
      citrixResourceBase.setupHeartbeatSr(conn,sr,false);
      final long capacity=sr.getPhysicalSize(conn);
      final long available=capacity - sr.getPhysicalUtilisation(conn);
      if (capacity == -1) {
        final String msg="Pool capacity is -1! pool: " + pool.getHost() + pool.getPath();
        s_logger.warn(msg);
        return new Answer(command,false,msg);
      }
      final Map<String,TemplateProp> tInfo=new HashMap<String,TemplateProp>();
      final ModifyStoragePoolAnswer answer=new ModifyStoragePoolAnswer(command,capacity,available,tInfo);
      return answer;
    }
 catch (    final XenAPIException e) {
      final String msg="ModifyStoragePoolCommand add XenAPIException:" + e.toString() + " host:"+ citrixResourceBase.getHost().getUuid()+ " pool: "+ pool.getHost()+ pool.getPath();
      s_logger.warn(msg,e);
      return new Answer(command,false,msg);
    }
catch (    final Exception e) {
      final String msg="ModifyStoragePoolCommand add XenAPIException:" + e.getMessage() + " host:"+ citrixResourceBase.getHost().getUuid()+ " pool: "+ pool.getHost()+ pool.getPath();
      s_logger.warn(msg,e);
      return new Answer(command,false,msg);
    }
  }
 else {
    try {
      final SR sr=citrixResourceBase.getStorageRepository(conn,pool.getUuid());
      final String srUuid=sr.getUuid(conn);
      final String result=citrixResourceBase.callHostPluginPremium(conn,"setup_heartbeat_file","host",citrixResourceBase.getHost().getUuid(),"sr",srUuid,"add","false");
      if (result == null || !result.split("#")[1].equals("0")) {
        throw new CloudRuntimeException("Unable to remove heartbeat file entry for SR " + srUuid + " due to "+ result);
      }
      return new Answer(command,true,"success");
    }
 catch (    final XenAPIException e) {
      final String msg="ModifyStoragePoolCommand remove XenAPIException:" + e.toString() + " host:"+ citrixResourceBase.getHost().getUuid()+ " pool: "+ pool.getHost()+ pool.getPath();
      s_logger.warn(msg,e);
      return new Answer(command,false,msg);
    }
catch (    final Exception e) {
      final String msg="ModifyStoragePoolCommand remove XenAPIException:" + e.getMessage() + " host:"+ citrixResourceBase.getHost().getUuid()+ " pool: "+ pool.getHost()+ pool.getPath();
      s_logger.warn(msg,e);
      return new Answer(command,false,msg);
    }
  }
}
