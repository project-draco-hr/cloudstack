{
  DataStore srcStore=srcTemplate.getDataStore();
  EndPoint ep=_epSelector.select(srcTemplate);
  if (ep != null) {
    if (ep.getPublicAddr() == null) {
      s_logger.warn("A running secondary storage vm has a null public ip?");
      return null;
    }
    return generateCopyUrl(ep.getPublicAddr(),((ImageStoreEntity)srcStore).getMountPoint(),srcTemplate.getInstallPath());
  }
  VMTemplateVO tmplt=_templateDao.findById(srcTemplate.getId());
  HypervisorType hyperType=tmplt.getHypervisorType();
  if (hyperType != null && hyperType == HypervisorType.KVM) {
    return "file://" + ((ImageStoreEntity)srcStore).getMountPoint() + "/"+ srcTemplate.getInstallPath();
  }
  return null;
}
