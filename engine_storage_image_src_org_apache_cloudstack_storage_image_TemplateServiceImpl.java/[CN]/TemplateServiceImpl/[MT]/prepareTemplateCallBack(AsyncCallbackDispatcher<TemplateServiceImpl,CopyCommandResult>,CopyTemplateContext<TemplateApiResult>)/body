{
  TemplateInfo srcTemplate=context.getSrcTemplate();
  TemplateInfo destTemplate=context.getDestTemplate();
  CopyCommandResult result=callback.getResult();
  AsyncCallFuture<TemplateApiResult> future=context.getFuture();
  TemplateApiResult res=new TemplateApiResult(destTemplate);
  try {
    if (result.isFailed()) {
      res.setResult(result.getResult());
      destTemplate.processEvent(Event.OperationFailed);
      srcTemplate.processEvent(Event.OperationFailed);
      VMTemplateStoragePoolVO destTmpltPool=_tmpltPoolDao.findByPoolTemplate(context.getDestStore().getId(),destTemplate.getId());
      _vmTemplateStoreDao.remove(destTmpltPool.getId());
      future.complete(res);
      return null;
    }
    srcTemplate.processEvent(Event.OperationSuccessed);
    destTemplate.processEvent(Event.OperationSuccessed);
    future.complete(res);
    return null;
  }
 catch (  Exception e) {
    s_logger.debug("Failed to process prepare template callback",e);
    res.setResult(e.toString());
    future.complete(res);
  }
  return null;
}
