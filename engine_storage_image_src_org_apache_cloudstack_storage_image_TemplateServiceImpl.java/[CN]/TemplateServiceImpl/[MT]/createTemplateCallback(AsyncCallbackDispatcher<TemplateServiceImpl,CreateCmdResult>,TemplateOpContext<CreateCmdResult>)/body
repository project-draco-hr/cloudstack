{
  TemplateObject template=(TemplateObject)context.getTemplate();
  AsyncCallFuture<TemplateApiResult> future=context.getFuture();
  TemplateApiResult result=new TemplateApiResult(template);
  CreateCmdResult callbackResult=callback.getResult();
  if (callbackResult.isFailed()) {
    try {
      template.processEvent(ObjectInDataStoreStateMachine.Event.OperationFailed);
      template.stateTransit(TemplateEvent.OperationFailed);
    }
 catch (    NoTransitionException e) {
      s_logger.debug("Failed to update template state",e);
    }
    result.setResult(callbackResult.getResult());
    future.complete(result);
    return null;
  }
  try {
    template.processEvent(ObjectInDataStoreStateMachine.Event.OperationSuccessed);
    template.stateTransit(TemplateEvent.OperationSucceeded);
  }
 catch (  NoTransitionException e) {
    s_logger.debug("Failed to transit state",e);
    result.setResult(e.toString());
    future.complete(result);
    return null;
  }
  future.complete(result);
  return null;
}
