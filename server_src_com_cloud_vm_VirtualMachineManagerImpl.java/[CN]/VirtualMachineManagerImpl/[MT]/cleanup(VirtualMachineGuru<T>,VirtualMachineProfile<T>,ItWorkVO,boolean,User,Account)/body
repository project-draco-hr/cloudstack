{
  T vm=profile.getVirtualMachine();
  State state=vm.getState();
  if (state == State.Starting) {
    Step step=work.getStep();
    if (step == Step.Start && !force) {
      return false;
    }
    if (step == Step.Started || step == Step.Start) {
      if (vm.getHostId() != null) {
        if (!sendStop(guru,profile,force)) {
          return false;
        }
      }
    }
    if (step != Step.Release && step != Step.Prepare && step != Step.Started && step != Step.Start) {
      return true;
    }
  }
 else   if (state == State.Stopping) {
    if (vm.getHostId() != null) {
      if (!sendStop(guru,profile,force)) {
        return false;
      }
    }
  }
 else   if (state == State.Migrating) {
    if (vm.getHostId() != null) {
      if (!sendStop(guru,profile,force)) {
        return false;
      }
    }
    if (vm.getLastHostId() != null) {
      if (!sendStop(guru,profile,force)) {
        return false;
      }
    }
  }
 else   if (state == State.Running) {
    if (!sendStop(guru,profile,force)) {
      return false;
    }
  }
  _networkMgr.release(profile,force);
  _storageMgr.release(profile);
  return true;
}
