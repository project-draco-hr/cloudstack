{
  if (vm == null || vm.getRemoved() != null) {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Unable to find vm or vm is destroyed: " + vm);
    }
    return true;
  }
  if (!stateTransitTo(vm,VirtualMachine.Event.ExpungeOperation,vm.getHostId())) {
    s_logger.debug("Unable to destroy the vm because it is not in the correct state: " + vm.toString());
    return false;
  }
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Destroying vm " + vm);
  }
  long userId=caller.getId();
  long startEventId=EventUtils.saveStartedEvent(userId,vm.getAccountId(),EventTypes.EVENT_VM_STOP,"stopping Vm with Id: " + vm.getId());
  if (!stop(vm,caller,account)) {
    s_logger.error("Unable to stop vm so we can't destroy it: " + vm);
    EventUtils.saveEvent(userId,vm.getAccountId(),EventVO.LEVEL_ERROR,EventTypes.EVENT_VM_STOP,"Error stopping VM instance : " + vm.getId(),startEventId);
    return false;
  }
 else {
    EventUtils.saveEvent(userId,vm.getAccountId(),EventVO.LEVEL_INFO,EventTypes.EVENT_VM_STOP,"Successfully stopped VM instance : " + vm.getId(),startEventId);
  }
  VirtualMachineProfile<T> profile=new VirtualMachineProfileImpl<T>(vm);
  _networkMgr.cleanupNics(profile);
  _storageMgr.cleanupVolumes(vm.getId());
  VirtualMachineGuru<T> guru=getVmGuru(vm);
  vm=guru.findById(vm.getId());
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Destroying vm " + vm);
  }
  if (!stateTransitTo(vm,VirtualMachine.Event.DestroyRequested,vm.getHostId())) {
    s_logger.debug("Unable to destroy the vm because it is not in the correct state: " + vm.toString());
    return false;
  }
  return true;
}
