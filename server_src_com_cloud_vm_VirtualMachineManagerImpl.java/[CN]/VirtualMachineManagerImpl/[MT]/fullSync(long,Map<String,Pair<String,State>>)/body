{
  Commands commands=new Commands(OnError.Continue);
  Map<Long,AgentVmInfo> infos=convertToInfos(newStates);
  long hId=0;
  final List<VMInstanceVO> vms=_vmDao.listByClusterId(clusterId);
  for (  VMInstanceVO vm : vms) {
    AgentVmInfo info=infos.remove(vm.getId());
  }
  for (  final AgentVmInfo left : infos.values()) {
    s_logger.warn("Stopping a VM that we have no record of: " + left.name);
    commands.addCommand(cleanup(left.name));
  }
  return commands;
}
