{
  List<StoragePool> suitablePools=new ArrayList<StoragePool>();
  HypervisorType hypervisor=dskCh.getHypersorType();
  if (hypervisor != null) {
    if (hypervisor != HypervisorType.KVM) {
      s_logger.debug("Only kvm supports zone wide storage");
      return suitablePools;
    }
  }
  List<StoragePoolVO> storagePools=_storagePoolDao.findZoneWideStoragePoolsByTags(plan.getDataCenterId(),dskCh.getTags());
  for (  StoragePoolVO storage : storagePools) {
    if (suitablePools.size() == returnUpTo) {
      break;
    }
    StoragePool pol=(StoragePool)this.dataStoreMgr.getPrimaryDataStore(storage.getId());
    if (filter(avoid,pol,dskCh,plan)) {
      suitablePools.add(pol);
    }
  }
  return suitablePools;
}
