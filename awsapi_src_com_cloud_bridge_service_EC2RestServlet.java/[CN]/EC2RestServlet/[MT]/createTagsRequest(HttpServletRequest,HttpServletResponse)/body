{
  EC2Tags ec2Request=new EC2Tags();
  ArrayList<String> resourceIdList=new ArrayList<String>();
  Map<String,String> resourceTagList=new HashMap<String,String>();
  int nCount=1;
  do {
    String[] resourceIds=request.getParameterValues("ResourceId." + nCount);
    if (resourceIds != null && resourceIds.length > 0)     resourceIdList.add(resourceIds[0]);
 else     break;
    nCount++;
  }
 while (true);
  if (resourceIdList.isEmpty()) {
    response.sendError(530,"At least one Resource is required");
    return null;
  }
  ec2Request=EC2SoapServiceImpl.toResourceTypeAndIds(ec2Request,resourceIdList);
  nCount=1;
  do {
    String[] tagKey=request.getParameterValues("Tag." + nCount + ".Key");
    if (tagKey != null && tagKey.length > 0) {
      String[] tagValue=request.getParameterValues("Tag." + nCount + ".Value");
      if (tagValue != null && tagValue.length > 0) {
        resourceTagList.put(tagKey[0],tagValue[0]);
      }
 else       resourceTagList.put(tagKey[0],null);
    }
 else     break;
    nCount++;
  }
 while (true);
  if (resourceTagList.isEmpty()) {
    response.sendError(530,"At least one Tag is required");
    return null;
  }
  ec2Request=EC2SoapServiceImpl.toResourceTag(ec2Request,resourceTagList);
  return ec2Request;
}
