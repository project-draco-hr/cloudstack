{
  String[] users={".UserId",".Group"};
  String[] operations={"LaunchPermission.Add.","LaunchPermission.Remove."};
  int nCount=1;
  for (int i=0; i < 2; i++) {
    for (int j=0; j < 2; j++) {
      List<String> launchPermissionList=new ArrayList<String>();
      do {
        String[] launchPermissionAddGroup=request.getParameterValues(operations[j] + nCount + users[i]);
        if (launchPermissionAddGroup != null && launchPermissionAddGroup.length > 0)         launchPermissionList.add(launchPermissionAddGroup[0]);
 else         break;
        nCount++;
      }
 while (true);
      if (nCount != 1) {
        EC2ImageLaunchPermission ec2LaunchPermission=new EC2ImageLaunchPermission();
        if (operations[j].contains("Add"))         ec2LaunchPermission.setLaunchPermOp(EC2ImageLaunchPermission.Operation.add);
 else         ec2LaunchPermission.setLaunchPermOp(EC2ImageLaunchPermission.Operation.remove);
        for (        String launchPerm : launchPermissionList) {
          ec2LaunchPermission.addLaunchPermission(launchPerm);
        }
        ec2request.addLaunchPermission(ec2LaunchPermission);
        nCount=1;
      }
    }
  }
  return ec2request;
}
