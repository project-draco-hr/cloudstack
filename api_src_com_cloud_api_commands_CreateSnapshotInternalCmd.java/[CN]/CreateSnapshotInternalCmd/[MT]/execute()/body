{
  try {
    Snapshot snapshot=_snapshotMgr.createSnapshotInternal(this);
    if (snapshot != null) {
      SnapshotResponse response=new SnapshotResponse();
      response.setId(snapshot.getId());
      Account account=_entityMgr.findById(Account.class,snapshot.getAccountId());
      if (account != null) {
        response.setAccountName(account.getAccountName());
        response.setDomainId(account.getDomainId());
        response.setDomainName(_entityMgr.findById(Domain.class,account.getDomainId()).getName());
      }
      Volume volume=_entityMgr.findById(Volume.class,snapshot.getVolumeId());
      String snapshotTypeStr=Type.values()[snapshot.getSnapshotType()].name();
      response.setSnapshotType(snapshotTypeStr);
      response.setVolumeId(snapshot.getVolumeId());
      response.setVolumeName(volume.getName());
      response.setVolumeType(volume.getVolumeType().toString());
      response.setCreated(snapshot.getCreated());
      response.setName(snapshot.getName());
      response.setObjectName("snapshot");
      response.setResponseName(getName());
      this.setResponseObject(response);
    }
 else {
      throw new ServerApiException(BaseCmd.INTERNAL_ERROR,"Failed to create snapshot");
    }
  }
 catch (  ResourceAllocationException ex) {
    throw new ServerApiException(BaseCmd.RESOURCE_ALLOCATION_ERROR,ex.getMessage());
  }
}
