{
  if (!_isEnabled) {
    return;
  }
  VirtualMachine.Type vmType=instance.getType();
  if (vmType != VirtualMachine.Type.User && vmType != VirtualMachine.Type.DomainRouter) {
    return;
  }
  String tag=Long.toString(askVlanId(instance.getAccountId(),instance.getHostId()));
  String vlans=getVlanMapping(instance.getAccountId());
  CheckAndUpdateDhcpFlow(instance);
  VmFlowLogVO log=_flowLogDao.findOrNewByVmId(instance.getId(),instance.getName());
  cmds.addCommand(new OvsSetTagAndFlowCommand(instance.getName(),tag,vlans,Long.toString(log.getLogsequence()),instance.getId()));
}
