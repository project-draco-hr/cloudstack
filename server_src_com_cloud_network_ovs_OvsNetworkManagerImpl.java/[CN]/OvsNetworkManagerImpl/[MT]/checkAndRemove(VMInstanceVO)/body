{
  long accountId=instance.getAccountId();
  long hostId=instance.getHostId();
  final Transaction txn=Transaction.currentTxn();
  txn.start();
  VlanMappingVO vo=_vlanMappingDao.findByAccountIdAndHostId(accountId,hostId);
  if (vo.unref() == 0) {
    _vlanMappingDao.remove(vo.getId());
    s_logger.debug(instance.getName() + " is the last one on host " + hostId+ " for account "+ accountId+ ", remove vlan in ovs_host_vlan_alloc");
    _vlanMappingDirtyDao.markDirty(accountId);
  }
 else {
    _vlanMappingDao.update(vo.getId(),vo);
    s_logger.debug(instance.getName() + " reduces reference count of (account,host) = (" + accountId+ ","+ hostId+ ") to "+ vo.getRef());
  }
  _flowLogDao.deleteByVmId(instance.getId());
  txn.commit();
  try {
    Commands cmds=new Commands(new OvsDeleteFlowCommand(instance.getName()));
    _agentMgr.send(hostId,cmds,_ovsListener);
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
}
