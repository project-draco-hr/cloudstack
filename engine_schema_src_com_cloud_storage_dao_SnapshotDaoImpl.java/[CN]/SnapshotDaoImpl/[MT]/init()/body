{
  VolumeIdSearch=createSearchBuilder();
  VolumeIdSearch.and("volumeId",VolumeIdSearch.entity().getVolumeId(),SearchCriteria.Op.EQ);
  VolumeIdSearch.done();
  VolumeIdTypeSearch=createSearchBuilder();
  VolumeIdTypeSearch.and("volumeId",VolumeIdTypeSearch.entity().getVolumeId(),SearchCriteria.Op.EQ);
  VolumeIdTypeSearch.and("type",VolumeIdTypeSearch.entity().getsnapshotType(),SearchCriteria.Op.EQ);
  VolumeIdTypeSearch.done();
  VolumeIdVersionSearch=createSearchBuilder();
  VolumeIdVersionSearch.and("volumeId",VolumeIdVersionSearch.entity().getVolumeId(),SearchCriteria.Op.EQ);
  VolumeIdVersionSearch.and("version",VolumeIdVersionSearch.entity().getVersion(),SearchCriteria.Op.EQ);
  VolumeIdVersionSearch.done();
  AccountIdSearch=createSearchBuilder();
  AccountIdSearch.and("accountId",AccountIdSearch.entity().getAccountId(),SearchCriteria.Op.EQ);
  AccountIdSearch.done();
  StatusSearch=createSearchBuilder();
  StatusSearch.and("volumeId",StatusSearch.entity().getVolumeId(),SearchCriteria.Op.EQ);
  StatusSearch.and("status",StatusSearch.entity().getState(),SearchCriteria.Op.IN);
  StatusSearch.done();
  CountSnapshotsByAccount=createSearchBuilder(Long.class);
  CountSnapshotsByAccount.select(null,Func.COUNT,null);
  CountSnapshotsByAccount.and("account",CountSnapshotsByAccount.entity().getAccountId(),SearchCriteria.Op.EQ);
  CountSnapshotsByAccount.and("removed",CountSnapshotsByAccount.entity().getRemoved(),SearchCriteria.Op.NULL);
  CountSnapshotsByAccount.done();
  InstanceIdSearch=createSearchBuilder();
  InstanceIdSearch.and("status",InstanceIdSearch.entity().getState(),SearchCriteria.Op.IN);
  SearchBuilder<VMInstanceVO> instanceSearch=_instanceDao.createSearchBuilder();
  instanceSearch.and("instanceId",instanceSearch.entity().getId(),SearchCriteria.Op.EQ);
  SearchBuilder<VolumeVO> volumeSearch=_volumeDao.createSearchBuilder();
  volumeSearch.and("state",volumeSearch.entity().getState(),SearchCriteria.Op.EQ);
  volumeSearch.join("instanceVolumes",instanceSearch,instanceSearch.entity().getId(),volumeSearch.entity().getInstanceId(),JoinType.INNER);
  InstanceIdSearch.join("instanceSnapshots",volumeSearch,volumeSearch.entity().getId(),InstanceIdSearch.entity().getVolumeId(),JoinType.INNER);
  InstanceIdSearch.done();
  secondaryStorageSearch=createSearchBuilder(SumCount.class);
  secondaryStorageSearch.select("sum",Func.SUM,secondaryStorageSearch.entity().getSize());
  secondaryStorageSearch.and("accountId",secondaryStorageSearch.entity().getAccountId(),Op.EQ);
  secondaryStorageSearch.and("isRemoved",secondaryStorageSearch.entity().getRemoved(),Op.NULL);
  secondaryStorageSearch.done();
}
