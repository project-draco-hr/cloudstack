{
  Mockito.when(_accountMgr.getAccount(1L)).thenReturn(new AccountVO());
  ServiceOfferingVO off=new ServiceOfferingVO("alena",1,1,1,1,1,false,"alena",false,false,null,false,VirtualMachine.Type.InternalLoadBalancerVm,false);
  off=setId(off,1);
  Mockito.when(_svcOffDao.persistSystemServiceOffering(Mockito.any(ServiceOfferingVO.class))).thenReturn(off);
  ComponentContext.initComponentsLifeCycle();
  vm=new DomainRouterVO(1L,off.getId(),1,"alena",1,HypervisorType.XenServer,1,1,1,false,0,false,null,false,false,VirtualMachine.Type.InternalLoadBalancerVm,null);
  vm.setRole(Role.INTERNAL_LB_VM);
  vm=setId(vm,1);
  vm.setPrivateIpAddress("10.2.2.2");
  NicVO nic=new NicVO("somereserver",1L,1L,VirtualMachine.Type.InternalLoadBalancerVm);
  nic.setIp4Address(requestedIp);
  List<DomainRouterVO> emptyList=new ArrayList<DomainRouterVO>();
  List<DomainRouterVO> nonEmptyList=new ArrayList<DomainRouterVO>();
  nonEmptyList.add(vm);
  Mockito.when(_domainRouterDao.listByNetworkAndRole(invalidNtwkId,Role.INTERNAL_LB_VM)).thenReturn(emptyList);
  Mockito.when(_domainRouterDao.listByNetworkAndRole(validNtwkId,Role.INTERNAL_LB_VM)).thenReturn(nonEmptyList);
  Mockito.when(_nicDao.findByNtwkIdAndInstanceId(validNtwkId,1)).thenReturn(nic);
  Mockito.when(_nicDao.findByNtwkIdAndInstanceId(invalidNtwkId,1)).thenReturn(nic);
  Answer answer=new Answer(null,true,null);
  Answer[] answers=new Answer[1];
  answers[0]=answer;
  try {
    Mockito.when(_agentMgr.send(Mockito.anyLong(),Mockito.any(Commands.class))).thenReturn(answers);
  }
 catch (  AgentUnavailableException e) {
    e.printStackTrace();
  }
catch (  OperationTimedoutException e) {
    e.printStackTrace();
  }
  createNetwork();
  Mockito.when(_ntwkModel.getNetwork(Mockito.anyLong())).thenReturn(ntwk);
  Mockito.when(_itMgr.toNicTO(Mockito.any(NicProfile.class),Mockito.any(HypervisorType.class))).thenReturn(null);
  Mockito.when(_domainRouterDao.findById(Mockito.anyLong())).thenReturn(vm);
  DataCenterVO dc=new DataCenterVO(1L,null,null,null,null,null,null,null,null,null,NetworkType.Advanced,null,null);
  Mockito.when(_dcDao.findById(Mockito.anyLong())).thenReturn(dc);
  NetworkOfferingVO networkOfferingVO=new NetworkOfferingVO();
  networkOfferingVO.setConcurrentConnections(500);
  Mockito.when(_offeringDao.findById(Mockito.anyLong())).thenReturn(networkOfferingVO);
  try {
    Mockito.when(_itMgr.expunge(Mockito.any(DomainRouterVO.class),Mockito.any(User.class),Mockito.any(Account.class))).thenReturn(true);
  }
 catch (  ResourceUnavailableException e) {
    e.printStackTrace();
  }
  Mockito.when(_domainRouterDao.findById(validVmId)).thenReturn(vm);
  Mockito.when(_domainRouterDao.findById(invalidVmId)).thenReturn(null);
}
