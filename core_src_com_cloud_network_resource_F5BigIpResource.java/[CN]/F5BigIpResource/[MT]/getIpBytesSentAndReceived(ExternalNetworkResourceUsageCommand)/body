{
  ExternalNetworkResourceUsageAnswer answer=new ExternalNetworkResourceUsageAnswer(cmd);
  try {
    LocalLBVirtualServerVirtualServerStatistics stats=_virtualServerApi.get_all_statistics();
    for (    LocalLBVirtualServerVirtualServerStatisticEntry entry : stats.getStatistics()) {
      String virtualServerIp=entry.getVirtual_server().getAddress();
      if (_inline) {
        virtualServerIp=stripRouteDomainFromAddress(virtualServerIp);
      }
      long[] bytesSentAndReceived=answer.ipBytes.get(virtualServerIp);
      if (bytesSentAndReceived == null) {
        bytesSentAndReceived=new long[]{0,0};
      }
      for (      CommonStatistic stat : entry.getStatistics()) {
        int index;
        if (stat.getType().equals(CommonStatisticType.STATISTIC_CLIENT_SIDE_BYTES_OUT)) {
          index=0;
        }
 else         if (stat.getType().equals(CommonStatisticType.STATISTIC_CLIENT_SIDE_BYTES_IN)) {
          index=1;
        }
 else {
          continue;
        }
        long high=stat.getValue().getHigh();
        long low=stat.getValue().getLow();
        long full;
        long rollOver=0x7fffffff + 1;
        if (high >= 0) {
          full=(high << 32) & 0xffff0000;
        }
 else {
          full=((high & 0x7fffffff) << 32) + (0x80000000 << 32);
        }
        if (low >= 0) {
          full+=low;
        }
 else {
          full+=(low & 0x7fffffff) + rollOver;
        }
        bytesSentAndReceived[index]+=full;
      }
      if (bytesSentAndReceived[0] >= 0 && bytesSentAndReceived[1] >= 0) {
        answer.ipBytes.put(virtualServerIp,bytesSentAndReceived);
      }
    }
  }
 catch (  Exception e) {
    s_logger.error(e);
    throw new ExecutionException(e.getMessage());
  }
  return answer;
}
