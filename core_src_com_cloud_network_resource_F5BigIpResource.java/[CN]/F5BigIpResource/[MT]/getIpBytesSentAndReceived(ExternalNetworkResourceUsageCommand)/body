{
  ExternalNetworkResourceUsageAnswer answer=new ExternalNetworkResourceUsageAnswer(cmd);
  try {
    LocalLBVirtualServerVirtualServerStatistics stats=_virtualServerApi.get_all_statistics();
    for (    LocalLBVirtualServerVirtualServerStatisticEntry entry : stats.getStatistics()) {
      String virtualServerIp=entry.getVirtual_server().getAddress();
      if (_inline) {
        virtualServerIp=stripRouteDomainFromAddress(virtualServerIp);
      }
      long[] bytesSentAndReceived=answer.ipBytes.get(virtualServerIp);
      if (bytesSentAndReceived == null) {
        bytesSentAndReceived=new long[]{0,0};
      }
      for (      CommonStatistic stat : entry.getStatistics()) {
        if (stat.getType().equals(CommonStatisticType.STATISTIC_CLIENT_SIDE_BYTES_OUT)) {
          bytesSentAndReceived[0]+=stat.getValue().getLow();
        }
 else         if (stat.getType().equals(CommonStatisticType.STATISTIC_CLIENT_SIDE_BYTES_IN)) {
          bytesSentAndReceived[1]+=stat.getValue().getLow();
        }
      }
      if (bytesSentAndReceived[0] >= 0 && bytesSentAndReceived[1] >= 0) {
        answer.ipBytes.put(virtualServerIp,bytesSentAndReceived);
      }
    }
  }
 catch (  Exception e) {
    s_logger.error(e);
    throw new ExecutionException(e.getMessage());
  }
  return answer;
}
