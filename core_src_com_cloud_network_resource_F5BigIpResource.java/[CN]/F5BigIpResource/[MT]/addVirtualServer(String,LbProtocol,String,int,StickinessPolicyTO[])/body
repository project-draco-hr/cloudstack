{
  try {
    if (!virtualServerExists(virtualServerName)) {
      s_logger.debug("Adding virtual server " + virtualServerName);
      _virtualServerApi.create(genVirtualServerDefinition(virtualServerName,protocol,srcIp,srcPort),new String[]{"255.255.255.255"},genVirtualServerResource(virtualServerName),genVirtualServerProfile(protocol));
      _virtualServerApi.set_snat_automap(genStringArray(virtualServerName));
      if (!virtualServerExists(virtualServerName)) {
        throw new ExecutionException("Failed to add virtual server " + virtualServerName);
      }
    }
    if ((stickyPolicies != null) && (stickyPolicies[0] != null)) {
      StickinessPolicyTO stickinessPolicy=stickyPolicies[0];
      if (stickinessPolicy.getMethodName().equalsIgnoreCase(StickinessMethodType.LBCookieBased.getName())) {
        _virtualServerApi.add_persistence_profile(genStringArray(virtualServerName),genPersistenceProfile("cookie"));
      }
 else       if (stickinessPolicy.getMethodName().equalsIgnoreCase(StickinessMethodType.SourceBased.getName())) {
        _virtualServerApi.add_persistence_profile(genStringArray(virtualServerName),genPersistenceProfile("source_addr"));
      }
    }
 else {
      _virtualServerApi.remove_all_persistence_profiles(genStringArray(virtualServerName));
    }
  }
 catch (  RemoteException e) {
    throw new ExecutionException(e.getMessage());
  }
}
