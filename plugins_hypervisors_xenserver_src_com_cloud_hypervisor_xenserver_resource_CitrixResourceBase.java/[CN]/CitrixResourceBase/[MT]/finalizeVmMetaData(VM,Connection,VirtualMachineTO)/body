{
  Map<String,String> details=vmSpec.getDetails();
  if (details != null) {
    String platformstring=details.get("platform");
    if (platformstring != null && !platformstring.isEmpty()) {
      Map<String,String> platform=StringUtils.stringToMap(platformstring);
      vm.setPlatform(conn,platform);
    }
 else {
      String timeoffset=details.get("timeoffset");
      if (timeoffset != null) {
        Map<String,String> platform=vm.getPlatform(conn);
        platform.put("timeoffset",timeoffset);
        vm.setPlatform(conn,platform);
      }
      String coresPerSocket=details.get("cpu.corespersocket");
      if (coresPerSocket != null) {
        Map<String,String> platform=vm.getPlatform(conn);
        platform.put("cores-per-socket",coresPerSocket);
        vm.setPlatform(conn,platform);
      }
    }
    String xenservertoolsversion=details.get("hypervisortoolsversion");
    if (xenservertoolsversion == null || !xenservertoolsversion.equalsIgnoreCase("xenserver61")) {
      Map<String,String> platform=vm.getPlatform(conn);
      platform.remove("device_id");
      vm.setPlatform(conn,platform);
    }
  }
}
