{
  SR sr=null;
  try {
    sr=SR.introduce(conn,pooluuid,srNameLabel,srNameLabel,type,"user",true,smConfig);
  }
 catch (  final XenAPIException ex) {
    if (ignoreIntroduceException) {
      return sr;
    }
    throw ex;
  }
  final Set<Host> setHosts=Host.getAll(conn);
  if (setHosts == null) {
    final String msg="Unable to create iSCSI SR " + deviceConfig + " due to hosts not available.";
    s_logger.warn(msg);
    throw new CloudRuntimeException(msg);
  }
  for (  final Host currentHost : setHosts) {
    final PBD.Record rec=new PBD.Record();
    rec.deviceConfig=deviceConfig;
    rec.host=currentHost;
    rec.SR=sr;
    final PBD pbd=PBD.create(conn,rec);
    pbd.plug(conn);
  }
  return sr;
}
