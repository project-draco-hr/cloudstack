{
  final Connection conn=getConnection();
  final StorageFilerTO pool=cmd.getPool();
  final boolean add=cmd.getAdd();
  if (add) {
    try {
      final SR sr=getStorageRepository(conn,pool.getUuid());
      setupHeartbeatSr(conn,sr,false);
      final long capacity=sr.getPhysicalSize(conn);
      final long available=capacity - sr.getPhysicalUtilisation(conn);
      if (capacity == -1) {
        final String msg="Pool capacity is -1! pool: " + pool.getHost() + pool.getPath();
        s_logger.warn(msg);
        return new Answer(cmd,false,msg);
      }
      final Map<String,TemplateProp> tInfo=new HashMap<String,TemplateProp>();
      final ModifyStoragePoolAnswer answer=new ModifyStoragePoolAnswer(cmd,capacity,available,tInfo);
      return answer;
    }
 catch (    final XenAPIException e) {
      final String msg="ModifyStoragePoolCommand add XenAPIException:" + e.toString() + " host:"+ _host.uuid+ " pool: "+ pool.getHost()+ pool.getPath();
      s_logger.warn(msg,e);
      return new Answer(cmd,false,msg);
    }
catch (    final Exception e) {
      final String msg="ModifyStoragePoolCommand add XenAPIException:" + e.getMessage() + " host:"+ _host.uuid+ " pool: "+ pool.getHost()+ pool.getPath();
      s_logger.warn(msg,e);
      return new Answer(cmd,false,msg);
    }
  }
 else {
    try {
      final SR sr=getStorageRepository(conn,pool.getUuid());
      final String srUuid=sr.getUuid(conn);
      final String result=callHostPluginPremium(conn,"setup_heartbeat_file","host",_host.uuid,"sr",srUuid,"add","false");
      if (result == null || !result.split("#")[1].equals("0")) {
        throw new CloudRuntimeException("Unable to remove heartbeat file entry for SR " + srUuid + " due to "+ result);
      }
      return new Answer(cmd,true,"seccuss");
    }
 catch (    final XenAPIException e) {
      final String msg="ModifyStoragePoolCommand remove XenAPIException:" + e.toString() + " host:"+ _host.uuid+ " pool: "+ pool.getHost()+ pool.getPath();
      s_logger.warn(msg,e);
      return new Answer(cmd,false,msg);
    }
catch (    final Exception e) {
      final String msg="ModifyStoragePoolCommand remove XenAPIException:" + e.getMessage() + " host:"+ _host.uuid+ " pool: "+ pool.getHost()+ pool.getPath();
      s_logger.warn(msg,e);
      return new Answer(cmd,false,msg);
    }
  }
}
