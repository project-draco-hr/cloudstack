{
  try {
    if (_host.vswitchNetwork == null) {
      Network vswitchNw=null;
      Network.Record rec=new Network.Record();
      String nwName=Networks.BroadcastScheme.VSwitch.toString();
      Set<Network> networks=Network.getByNameLabel(conn,nwName);
      if (networks.size() == 0) {
        rec.nameDescription="vswitch network for " + nwName;
        rec.nameLabel=nwName;
        vswitchNw=Network.create(conn,rec);
      }
 else {
        vswitchNw=networks.iterator().next();
      }
      if (!is_xcp())       enableXenServerNetwork(conn,vswitchNw,"vswitch","vswitch network");
      _host.vswitchNetwork=vswitchNw;
    }
    return _host.vswitchNetwork;
  }
 catch (  BadServerResponse e) {
    s_logger.error("Failed to setup vswitch network",e);
  }
catch (  XenAPIException e) {
    s_logger.error("Failed to setup vswitch network",e);
  }
catch (  XmlRpcException e) {
    s_logger.error("Failed to setup vswitch network",e);
  }
  return null;
}
