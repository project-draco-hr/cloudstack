{
  final String secondaryStorageUrl=cmd.getSecondaryStorageUrl();
  final String backedUpSnapshotUuid=cmd.getSnapshotUuid();
  final Long volumeId=cmd.getVolumeId();
  final Long accountId=cmd.getAccountId();
  final Long templateId=cmd.getTemplateId();
  final Long tmpltAcountId=cmd.getTmpltAccountId();
  final String version=cmd.getVersion();
  if (!version.equals("2.1")) {
    return new Answer(cmd,true,"success");
  }
  try {
    final Connection conn=getConnection();
    final URI uri=new URI(secondaryStorageUrl);
    final String secondaryStorageMountPath=uri.getHost() + ":" + uri.getPath();
    final String snapshotPath=secondaryStorageMountPath + "/snapshots/" + accountId+ "/"+ volumeId+ "/"+ backedUpSnapshotUuid+ ".vhd";
    final String templatePath=secondaryStorageMountPath + "/template/tmpl/" + tmpltAcountId+ "/"+ templateId;
    upgradeSnapshot(conn,templatePath,snapshotPath);
    return new Answer(cmd,true,"success");
  }
 catch (  final Exception e) {
    final String details="upgrading snapshot " + backedUpSnapshotUuid + " failed due to "+ e.toString();
    s_logger.error(details,e);
  }
  return new Answer(cmd,false,"failure");
}
