{
  String vmName=vm.getNameLabel(conn);
  String isoURL=_configDriveIsopath + vmName + ".iso";
  VDI srVdi;
  try {
    Set<VDI> vdis=VDI.getByNameLabel(conn,vmName + ".iso");
    if (vdis.isEmpty()) {
      throw new CloudRuntimeException("Could not find ISO with URL: " + isoURL);
    }
    srVdi=vdis.iterator().next();
  }
 catch (  XenAPIException e) {
    s_logger.debug("Unable to get config drive iso: " + isoURL + " due to "+ e.toString());
    return false;
  }
catch (  Exception e) {
    s_logger.debug("Unable to get config drive iso: " + isoURL + " due to "+ e.toString());
    return false;
  }
  VBD isoVBD=null;
  Set<VBD> vbds=vm.getVBDs(conn);
  for (  VBD vbd : vbds) {
    Types.VbdType type=vbd.getType(conn);
    VBD.Record vbdr=vbd.getRecord(conn);
    if (!vbdr.userdevice.equals(_attachIsoDeviceNum) && type == Types.VbdType.CD) {
      isoVBD=vbd;
      break;
    }
  }
  if (isoVBD == null) {
    VBD.Record cfgDriveVbdr=new VBD.Record();
    cfgDriveVbdr.VM=vm;
    cfgDriveVbdr.empty=true;
    cfgDriveVbdr.bootable=false;
    cfgDriveVbdr.userdevice="autodetect";
    cfgDriveVbdr.mode=Types.VbdMode.RO;
    cfgDriveVbdr.type=Types.VbdType.CD;
    VBD cfgDriveVBD=VBD.create(conn,cfgDriveVbdr);
    isoVBD=cfgDriveVBD;
    s_logger.debug("Created CD-ROM VBD for VM: " + vm);
  }
  if (isoVBD != null) {
    if (isoVBD.getEmpty(conn) == false) {
      isoVBD.eject(conn);
    }
    try {
      isoVBD.insert(conn,srVdi);
      s_logger.debug("Attached config drive iso to vm " + vmName);
    }
 catch (    XmlRpcException ex) {
      s_logger.debug("Failed to attach config drive iso to vm " + vmName);
      return false;
    }
  }
  return true;
}
