{
  final Connection conn=getConnection();
  final String vmName=cmd.getVmName();
  try {
    final Set<VM> vms=VM.getByNameLabel(conn,vmName);
    if (vms == null || vms.isEmpty()) {
      return new UnPlugNicAnswer(cmd,false,"Can not find VM " + vmName);
    }
    final VM vm=vms.iterator().next();
    final NicTO nic=cmd.getNic();
    final String mac=nic.getMac();
    final VIF vif=getVifByMac(conn,vm,mac);
    if (vif != null) {
      vif.unplug(conn);
      final Network network=vif.getNetwork(conn);
      vif.destroy(conn);
      try {
        if (network.getNameLabel(conn).startsWith("VLAN")) {
          disableVlanNetwork(conn,network);
        }
      }
 catch (      final Exception e) {
      }
    }
    return new UnPlugNicAnswer(cmd,true,"success");
  }
 catch (  final Exception e) {
    final String msg=" UnPlug Nic failed due to " + e.toString();
    s_logger.warn(msg,e);
    return new UnPlugNicAnswer(cmd,false,msg);
  }
}
