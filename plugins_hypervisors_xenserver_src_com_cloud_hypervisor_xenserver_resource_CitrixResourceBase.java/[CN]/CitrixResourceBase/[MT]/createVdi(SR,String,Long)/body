{
  final Connection conn=getConnection();
  final VDI.Record vdir=new VDI.Record();
  vdir.nameLabel=vdiNameLabel;
  vdir.SR=sr;
  vdir.type=Types.VdiType.USER;
  final long totalSrSpace=sr.getPhysicalSize(conn);
  final long unavailableSrSpace=sr.getPhysicalUtilisation(conn);
  final long availableSrSpace=totalSrSpace - unavailableSrSpace;
  if (availableSrSpace < volumeSize) {
    throw new CloudRuntimeException("Available space for SR cannot be less than " + volumeSize + ".");
  }
  vdir.virtualSize=volumeSize;
  return VDI.create(conn,vdir);
}
