{
  VIF dom0vif=null;
  Pair<VM,VM.Record> vm=getControlDomain(conn);
  VM dom0=vm.first();
  Set<VIF> dom0Vifs=dom0.getVIFs(conn);
  for (  VIF vif : dom0Vifs) {
    vif.getRecord(conn);
    if (vif.getNetwork(conn).getUuid(conn).equals(nw.getUuid(conn))) {
      dom0vif=vif;
      s_logger.debug("A VIF for dom0 has already been found - No need to create one");
    }
  }
  int domuVifCount=0;
  Set<VIF> domUVifs=nw.getVIFs(conn);
  Host host=Host.getByUuid(conn,_host.uuid);
  for (  VIF vif : domUVifs) {
    vif.getRecord(conn);
    if (vif.getVM(conn).getResidentOn(conn).equals(host)) {
      domuVifCount++;
    }
  }
  if (dom0vif == null && domuVifCount == 0) {
    s_logger.debug("Create a vif on dom0 for " + networkDesc);
    VIF.Record vifr=new VIF.Record();
    vifr.VM=dom0;
    vifr.device=getLowestAvailableVIFDeviceNum(conn,dom0);
    if (vifr.device == null) {
      s_logger.debug("Failed to create " + networkDesc + ", no vif available");
      return;
    }
    Map<String,String> config=new HashMap<String,String>();
    config.put("nameLabel",vifNameLabel);
    vifr.otherConfig=config;
    vifr.MAC="FE:FF:FF:FF:FF:FF";
    vifr.network=nw;
    vifr.lockingMode=Types.VifLockingMode.NETWORK_DEFAULT;
    dom0vif=VIF.create(conn,vifr);
synchronized (_tmpDom0Vif) {
      _tmpDom0Vif.add(dom0vif);
    }
    try {
      dom0vif.plug(conn);
    }
 catch (    Exception e) {
    }
    dom0vif.unplug(conn);
  }
  if (dom0vif != null && domuVifCount > 1) {
    dom0vif.destroy(conn);
  }
}
