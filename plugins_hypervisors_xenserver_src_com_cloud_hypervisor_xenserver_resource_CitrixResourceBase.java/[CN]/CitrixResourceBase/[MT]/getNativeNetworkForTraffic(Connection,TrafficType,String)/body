{
  if (name != null) {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Looking for network named " + name);
    }
    return getNetworkByName(conn,name);
  }
  if (type == TrafficType.Guest) {
    return new XsLocalNetwork(Network.getByUuid(conn,_host.getGuestNetwork()),null,PIF.getByUuid(conn,_host.getGuestPif()),null);
  }
 else   if (type == TrafficType.Control) {
    setupLinkLocalNetwork(conn);
    return new XsLocalNetwork(Network.getByUuid(conn,_host.getLinkLocalNetwork()));
  }
 else   if (type == TrafficType.Management) {
    return new XsLocalNetwork(Network.getByUuid(conn,_host.getPrivateNetwork()),null,PIF.getByUuid(conn,_host.getPrivatePif()),null);
  }
 else   if (type == TrafficType.Public) {
    return new XsLocalNetwork(Network.getByUuid(conn,_host.getPublicNetwork()),null,PIF.getByUuid(conn,_host.getPublicPif()),null);
  }
 else   if (type == TrafficType.Storage) {
    return new XsLocalNetwork(Network.getByUuid(conn,_host.getStorageNetwork1()),null,PIF.getByUuid(conn,_host.getStoragePif1()),null);
  }
  throw new CloudRuntimeException("Unsupported network type: " + type);
}
