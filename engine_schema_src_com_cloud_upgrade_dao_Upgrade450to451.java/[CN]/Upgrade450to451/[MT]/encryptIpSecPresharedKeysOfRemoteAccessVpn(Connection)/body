{
  PreparedStatement selectStatement=null;
  PreparedStatement updateStatement=null;
  ResultSet resultSet=null;
  try {
    selectStatement=conn.prepareStatement("SELECT id, ipsec_psk FROM `cloud`.`remote_access_vpn`");
    resultSet=selectStatement.executeQuery();
    while (resultSet.next()) {
      String preSharedKey=resultSet.getString(2);
      updateStatement=conn.prepareStatement("UPDATE `cloud`.`remote_access_vpn` SET ipsec_psk=? WHERE id=?");
      updateStatement.setString(1,DBEncryptionUtil.encrypt(preSharedKey));
      updateStatement.setLong(2,resultSet.getLong(1));
      updateStatement.executeUpdate();
      updateStatement.close();
    }
  }
 catch (  SQLException e) {
    throw new CloudRuntimeException("Unable to update the remote_access_vpn's preshared key ipsec_psk column",e);
  }
 finally {
    try {
      if (resultSet != null) {
        resultSet.close();
      }
      if ((selectStatement != null) && (!selectStatement.isClosed())) {
        selectStatement.close();
      }
      if ((updateStatement != null) && (!updateStatement.isClosed()))       updateStatement.close();
    }
 catch (    SQLException e) {
    }
  }
  s_logger.debug("Done encrypting remote_access_vpn's ipsec_psk column");
}
