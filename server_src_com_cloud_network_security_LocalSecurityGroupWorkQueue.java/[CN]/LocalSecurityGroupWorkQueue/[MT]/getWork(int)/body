{
  List<SecurityGroupWork> work=new ArrayList<SecurityGroupWork>(numberOfWorkItems);
  _lock.lock();
  int i=0;
  try {
    while (_count.get() == 0) {
      _notEmpty.await();
    }
    int n=Math.min(numberOfWorkItems,_count.get());
    while (i < n) {
      SecurityGroupWork w=_currentWork.first();
      w.setStep(Step.Processing);
      work.add(w);
      _currentWork.remove(w);
      ++i;
    }
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
 finally {
    int c=_count.addAndGet(-i);
    if (c > 0)     _notEmpty.signal();
    _lock.unlock();
  }
  return work;
}
