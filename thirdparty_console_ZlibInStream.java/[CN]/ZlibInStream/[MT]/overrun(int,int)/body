{
  if (itemSize > bufSize)   throw new Exception("ZlibInStream overrun: max itemSize exceeded");
  if (underlying == null)   throw new Exception("ZlibInStream overrun: no underlying stream");
  if (end - ptr != 0)   System.arraycopy(b,ptr,b,0,end - ptr);
  ptrOffset+=ptr;
  end-=ptr;
  ptr=0;
  while (end < itemSize) {
    decompress();
  }
  if (itemSize * nItems > end)   nItems=end / itemSize;
  return nItems;
}
