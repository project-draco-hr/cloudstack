{
  DataCenter dc=_dataCenterDao.findById(config.getDataCenterId());
  if (canHandle(config.getGuestType(),dc)) {
    if (rules != null && !rules.isEmpty()) {
      if (rules.get(0).getPurpose() == Purpose.LoadBalancing) {
        List<LoadBalancerVO> lbs=_lbDao.listByNetworkId(config.getId());
        List<LoadBalancingRule> lbRules=new ArrayList<LoadBalancingRule>();
        for (        LoadBalancerVO lb : lbs) {
          List<LbDestination> dstList=_lbMgr.getExistingDestinations(lb.getId());
          LoadBalancingRule loadBalancing=new LoadBalancingRule(lb,dstList);
          lbRules.add(loadBalancing);
        }
        return _routerMgr.applyLBRules(config,lbRules);
      }
 else       if (rules.get(0).getPurpose() == Purpose.PortForwarding) {
        return _routerMgr.applyPortForwardingRules(config,rules);
      }
    }
 else {
      return true;
    }
  }
  return false;
}
