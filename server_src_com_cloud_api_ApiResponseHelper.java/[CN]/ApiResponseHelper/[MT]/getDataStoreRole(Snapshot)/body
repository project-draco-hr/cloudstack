{
  SnapshotDataStoreVO snapshotStore=_snapshotStoreDao.findBySnapshot(snapshot.getId(),DataStoreRole.Primary);
  if (snapshotStore == null) {
    return DataStoreRole.Image;
  }
  long storagePoolId=snapshotStore.getDataStoreId();
  DataStore dataStore=_dataStoreMgr.getDataStore(storagePoolId,DataStoreRole.Primary);
  Map<String,String> mapCapabilities=dataStore.getDriver().getCapabilities();
  String value=mapCapabilities.get(DataStoreCapabilities.STORAGE_SYSTEM_SNAPSHOT.toString());
  Boolean supportsStorageSystemSnapshots=new Boolean(value);
  if (supportsStorageSystemSnapshots) {
    return DataStoreRole.Primary;
  }
  return DataStoreRole.Image;
}
