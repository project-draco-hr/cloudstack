{
  SystemVmResponse vmResponse=new SystemVmResponse();
  if (systemVM instanceof SystemVm) {
    SystemVm vm=(SystemVm)systemVM;
    vmResponse.setId(vm.getId());
    vmResponse.setSystemVmType(vm.getType().toString().toLowerCase());
    vmResponse.setZoneId(vm.getDataCenterId());
    vmResponse.setNetworkDomain(vm.getDomain());
    vmResponse.setName(vm.getHostName());
    vmResponse.setPodId(vm.getPodId());
    vmResponse.setTemplateId(vm.getTemplateId());
    vmResponse.setCreated(vm.getCreated());
    if (vm.getHostId() != null) {
      vmResponse.setHostId(vm.getHostId());
      vmResponse.setHostName(ApiDBUtils.findHostById(vm.getHostId()).getName());
    }
    if (vm.getState() != null) {
      vmResponse.setState(vm.getState().toString());
    }
    String instanceType="console_proxy";
    if (systemVM instanceof SecondaryStorageVmVO) {
      instanceType="sec_storage_vm";
    }
    if (systemVM instanceof ConsoleProxyVO) {
      ConsoleProxyVO proxy=(ConsoleProxyVO)systemVM;
      vmResponse.setActiveViewerSessions(proxy.getActiveSession());
    }
    DataCenter zone=ApiDBUtils.findZoneById(vm.getDataCenterId());
    if (zone != null) {
      vmResponse.setZoneName(zone.getName());
      vmResponse.setDns1(zone.getDns1());
      vmResponse.setDns2(zone.getDns2());
    }
    List<? extends Nic> nics=ApiDBUtils.getNics(systemVM);
    List<NicResponse> nicResponses=new ArrayList<NicResponse>();
    for (    Nic singleNic : nics) {
      NicResponse nicResponse=new NicResponse();
      nicResponse.setId(singleNic.getId());
      nicResponse.setIpaddress(singleNic.getIp4Address());
      nicResponse.setGateway(singleNic.getGateway());
      nicResponse.setNetmask(singleNic.getNetmask());
      nicResponse.setNetworkid(singleNic.getNetworkId());
      if (singleNic.getBroadcastUri() != null) {
        nicResponse.setBroadcastUri(singleNic.getBroadcastUri().toString());
      }
      if (singleNic.getIsolationUri() != null) {
        nicResponse.setIsolationUri(singleNic.getIsolationUri().toString());
      }
      Network network=ApiDBUtils.findNetworkById(singleNic.getNetworkId());
      nicResponse.setTrafficType(network.getTrafficType().toString());
      NetworkOffering networkOffering=ApiDBUtils.findNetworkOfferingById(network.getNetworkOfferingId());
      if (networkOffering.getGuestIpType() != null) {
        nicResponse.setType(networkOffering.getGuestIpType().toString());
      }
      nicResponse.setObjectName("nic");
      nicResponses.add(nicResponse);
    }
    vmResponse.setNics(nicResponses);
  }
  vmResponse.setObjectName("systemvm");
  return vmResponse;
}
