{
  VolumeResponse volResponse=new VolumeResponse();
  volResponse.setId(volume.getId());
  if (volume.getName() != null) {
    volResponse.setName(volume.getName());
  }
 else {
    volResponse.setName("");
  }
  volResponse.setZoneId(volume.getDataCenterId());
  volResponse.setZoneName(ApiDBUtils.findZoneById(volume.getDataCenterId()).getName());
  volResponse.setVolumeType(volume.getVolumeType().toString());
  volResponse.setDeviceId(volume.getDeviceId());
  Long instanceId=volume.getInstanceId();
  if (instanceId != null && volume.getState() != Volume.State.Destroy) {
    VMInstanceVO vm=ApiDBUtils.findVMInstanceById(instanceId);
    volResponse.setVirtualMachineId(vm.getId());
    volResponse.setVirtualMachineName(vm.getName());
    if (vm.getType().equals(VirtualMachine.Type.User)) {
      UserVm userVm=ApiDBUtils.findUserVmById(vm.getId());
      volResponse.setVirtualMachineDisplayName(userVm.getDisplayName());
    }
 else {
      volResponse.setVirtualMachineDisplayName(vm.getName());
    }
    volResponse.setVirtualMachineState(vm.getState().toString());
  }
  volResponse.setSize(volume.getSize());
  volResponse.setCreated(volume.getCreated());
  volResponse.setState(volume.getState().toString());
  Account accountTemp=ApiDBUtils.findAccountById(volume.getAccountId());
  if (accountTemp != null) {
    volResponse.setAccountName(accountTemp.getAccountName());
    volResponse.setDomainId(accountTemp.getDomainId());
    volResponse.setDomainName(ApiDBUtils.findDomainById(accountTemp.getDomainId()).getName());
  }
  String storageType;
  try {
    if (volume.getPoolId() == null) {
      if (volume.getState() == Volume.State.Allocated) {
        storageType="shared";
      }
 else {
        storageType="unknown";
      }
    }
 else {
      storageType=ApiDBUtils.volumeIsOnSharedStorage(volume.getId()) ? "shared" : "local";
    }
  }
 catch (  InvalidParameterValueException e) {
    s_logger.error(e.getMessage(),e);
    throw new ServerApiException(BaseCmd.INTERNAL_ERROR,"Volume " + volume.getName() + " does not have a valid ID");
  }
  volResponse.setStorageType(storageType);
  if (volume.getVolumeType().equals(Volume.VolumeType.ROOT)) {
    volResponse.setServiceOfferingId(volume.getDiskOfferingId());
  }
 else {
    volResponse.setDiskOfferingId(volume.getDiskOfferingId());
  }
  DiskOfferingVO diskOffering=ApiDBUtils.findDiskOfferingById(volume.getDiskOfferingId());
  if (volume.getVolumeType().equals(Volume.VolumeType.ROOT)) {
    volResponse.setServiceOfferingName(diskOffering.getName());
    volResponse.setServiceOfferingDisplayText(diskOffering.getDisplayText());
  }
 else {
    volResponse.setDiskOfferingName(diskOffering.getName());
    volResponse.setDiskOfferingDisplayText(diskOffering.getDisplayText());
  }
  Long poolId=volume.getPoolId();
  String poolName=(poolId == null) ? "none" : ApiDBUtils.findStoragePoolById(poolId).getName();
  volResponse.setStoragePoolName(poolName);
  volResponse.setSourceId(volume.getSourceId());
  if (volume.getSourceType() != null) {
    volResponse.setSourceType(volume.getSourceType().toString());
  }
  volResponse.setHypervisor(ApiDBUtils.getVolumeHyperType(volume.getId()).toString());
  volResponse.setAttached(volume.getAttached());
  volResponse.setDestroyed(volume.getState() == Volume.State.Destroy);
  VMTemplateVO template=ApiDBUtils.findTemplateById(volume.getTemplateId());
  boolean isExtractable=template != null && template.isExtractable() && !(template.getTemplateType() == TemplateType.SYSTEM);
  volResponse.setExtractable(isExtractable);
  volResponse.setObjectName("volume");
  return volResponse;
}
