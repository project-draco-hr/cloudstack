{
  List<VMTemplateHostVO> templateHostRefsForTemplate=ApiDBUtils.listTemplateHostBy(templateZonePair.first(),templateZonePair.second());
  VMTemplateVO template=ApiDBUtils.findTemplateById(templateZonePair.first());
  for (  VMTemplateHostVO templateHostRef : templateHostRefsForTemplate) {
    TemplateResponse templateResponse=new TemplateResponse();
    templateResponse.setId(template.getId());
    templateResponse.setName(template.getName());
    templateResponse.setDisplayText(template.getDisplayText());
    templateResponse.setPublic(template.isPublicTemplate());
    templateResponse.setCreated(templateHostRef.getCreated());
    templateResponse.setReady(templateHostRef.getDownloadState() == Status.DOWNLOADED);
    templateResponse.setFeatured(template.isFeatured());
    templateResponse.setExtractable(template.isExtractable() && !(template.getTemplateType() == TemplateType.SYSTEM));
    templateResponse.setPasswordEnabled(template.getEnablePassword());
    templateResponse.setCrossZones(template.isCrossZones());
    templateResponse.setFormat(template.getFormat());
    if (template.getTemplateType() != null) {
      templateResponse.setTemplateType(template.getTemplateType().toString());
    }
    templateResponse.setHypervisor(template.getHypervisorType().toString());
    GuestOS os=ApiDBUtils.findGuestOSById(template.getGuestOSId());
    if (os != null) {
      templateResponse.setOsTypeId(os.getId());
      templateResponse.setOsTypeName(os.getDisplayName());
    }
 else {
      templateResponse.setOsTypeId(-1L);
      templateResponse.setOsTypeName("");
    }
    Account owner=ApiDBUtils.findAccountById(template.getAccountId());
    if (owner != null) {
      templateResponse.setAccount(owner.getAccountName());
      templateResponse.setDomainId(owner.getDomainId());
      templateResponse.setDomainName(ApiDBUtils.findDomainById(owner.getDomainId()).getName());
    }
    HostVO host=ApiDBUtils.findHostById(templateHostRef.getHostId());
    DataCenterVO datacenter=ApiDBUtils.findZoneById(host.getDataCenterId());
    templateResponse.setZoneId(host.getDataCenterId());
    templateResponse.setZoneName(datacenter.getName());
    if (isAdmin || account.getId() == template.getAccountId()) {
      if (templateHostRef.getDownloadState() != Status.DOWNLOADED) {
        String templateStatus="Processing";
        if (templateHostRef.getDownloadState() == VMTemplateHostVO.Status.DOWNLOAD_IN_PROGRESS) {
          if (templateHostRef.getDownloadPercent() == 100) {
            templateStatus="Installing Template";
          }
 else {
            templateStatus=templateHostRef.getDownloadPercent() + "% Downloaded";
          }
        }
 else {
          templateStatus=templateHostRef.getErrorString();
        }
        templateResponse.setStatus(templateStatus);
      }
 else       if (templateHostRef.getDownloadState() == VMTemplateHostVO.Status.DOWNLOADED) {
        templateResponse.setStatus("Download Complete");
      }
 else {
        templateResponse.setStatus("Successfully Installed");
      }
    }
    Long templateSize=templateHostRef.getSize();
    if (templateSize > 0) {
      templateResponse.setSize(templateSize);
    }
    templateResponse.setChecksum(template.getChecksum());
    templateResponse.setSourceTemplateId(template.getSourceTemplateId());
    templateResponse.setChecksum(template.getChecksum());
    templateResponse.setObjectName("template");
    responses.add(templateResponse);
  }
}
