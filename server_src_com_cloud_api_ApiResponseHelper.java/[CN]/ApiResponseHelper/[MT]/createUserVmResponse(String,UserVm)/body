{
  Account caller=UserContext.current().getCaller();
  List<UserVmResponse> vmResponses=new ArrayList<UserVmResponse>();
  DecimalFormat decimalFormat=new DecimalFormat("#.##");
  for (  UserVm userVm : userVms) {
    UserVmResponse userVmResponse=ApiDBUtils.listVmDetails(userVm,(((caller == null) || (caller.getType() == Account.ACCOUNT_TYPE_ADMIN)) && (userVm.getHostId() != null)));
    String cpuUsed=null;
    VmStats vmStats=ApiDBUtils.getVmStatistics(userVm.getId());
    if (vmStats != null) {
      float cpuUtil=(float)vmStats.getCPUUtilization();
      cpuUsed=decimalFormat.format(cpuUtil) + "%";
      userVmResponse.setCpuUsed(cpuUsed);
      Double networkKbRead=Double.valueOf(vmStats.getNetworkReadKBs());
      userVmResponse.setNetworkKbsRead(networkKbRead.longValue());
      Double networkKbWrite=Double.valueOf(vmStats.getNetworkWriteKBs());
      userVmResponse.setNetworkKbsWrite(networkKbWrite.longValue());
    }
    userVmResponse.setObjectName(objectName);
    vmResponses.add(userVmResponse);
  }
  return vmResponses;
}
