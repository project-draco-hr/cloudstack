{
  SystemVmResponse vmResponse=new SystemVmResponse();
  if (systemVM instanceof SystemVm) {
    SystemVm vm=(SystemVm)systemVM;
    vmResponse.setId(vm.getId());
    vmResponse.setSystemVmType(vm.getType().toString().toLowerCase());
    String instanceType="console_proxy";
    if (systemVM instanceof SecondaryStorageVmVO) {
      instanceType="sec_storage_vm";
    }
    AsyncJobVO asyncJob=ApiDBUtils.findInstancePendingAsyncJob(instanceType,vm.getId());
    if (asyncJob != null) {
      vmResponse.setJobId(asyncJob.getId());
      vmResponse.setJobStatus(asyncJob.getStatus());
    }
    vmResponse.setZoneId(vm.getDataCenterId());
    vmResponse.setZoneName(ApiDBUtils.findZoneById(vm.getDataCenterId()).getName());
    vmResponse.setDns1(vm.getDns1());
    vmResponse.setDns2(vm.getDns2());
    vmResponse.setNetworkDomain(vm.getDomain());
    vmResponse.setGateway(vm.getGateway());
    vmResponse.setName(vm.getName());
    vmResponse.setPodId(vm.getPodId());
    if (vm.getHostId() != null) {
      vmResponse.setHostId(vm.getHostId());
      vmResponse.setHostName(ApiDBUtils.findHostById(vm.getHostId()).getName());
    }
    vmResponse.setPrivateIp(vm.getPrivateIpAddress());
    vmResponse.setPrivateMacAddress(vm.getPrivateMacAddress());
    vmResponse.setPrivateNetmask(vm.getPrivateNetmask());
    vmResponse.setPublicIp(vm.getPublicIpAddress());
    vmResponse.setPublicMacAddress(vm.getPublicMacAddress());
    vmResponse.setPublicNetmask(vm.getPublicNetmask());
    vmResponse.setTemplateId(vm.getTemplateId());
    vmResponse.setCreated(vm.getCreated());
    if (vm.getState() != null) {
      vmResponse.setState(vm.getState().toString());
    }
  }
  if (systemVM instanceof ConsoleProxyVO) {
    ConsoleProxyVO proxy=(ConsoleProxyVO)systemVM;
    vmResponse.setActiveViewerSessions(proxy.getActiveSession());
  }
  return vmResponse;
}
