{
  ListResponse<TemplateResponse> response=new ListResponse<TemplateResponse>();
  List<TemplateResponse> responses=new ArrayList<TemplateResponse>();
  List<DataCenterVO> zones=null;
  if ((zoneId != null) && (zoneId != -1)) {
    zones=new ArrayList<DataCenterVO>();
    zones.add(ApiDBUtils.findZoneById(zoneId));
  }
 else {
    zones=ApiDBUtils.listZones();
  }
  for (  DataCenterVO zone : zones) {
    TemplateResponse templateResponse=new TemplateResponse();
    templateResponse.setId(template.getId());
    templateResponse.setName(template.getName());
    templateResponse.setDisplayText(template.getDisplayText());
    templateResponse.setPublic(template.isPublicTemplate());
    templateResponse.setCrossZones(template.isCrossZones());
    VMTemplateHostVO isoHostRef=ApiDBUtils.findTemplateHostRef(template.getId(),zone.getId());
    if (isoHostRef != null) {
      templateResponse.setCreated(isoHostRef.getCreated());
      templateResponse.setReady(isoHostRef.getDownloadState() == Status.DOWNLOADED);
    }
    templateResponse.setFeatured(template.isFeatured());
    templateResponse.setPasswordEnabled(template.getEnablePassword());
    templateResponse.setFormat(template.getFormat());
    templateResponse.setStatus("Processing");
    GuestOS os=ApiDBUtils.findGuestOSById(template.getGuestOSId());
    if (os != null) {
      templateResponse.setOsTypeId(os.getId());
      templateResponse.setOsTypeName(os.getDisplayName());
    }
 else {
      templateResponse.setOsTypeId(-1L);
      templateResponse.setOsTypeName("");
    }
    Account owner=ApiDBUtils.findAccountById(template.getAccountId());
    if (owner != null) {
      templateResponse.setAccountId(owner.getId());
      templateResponse.setAccount(owner.getAccountName());
      templateResponse.setDomainId(owner.getDomainId());
    }
    templateResponse.setZoneId(zone.getId());
    templateResponse.setZoneName(zone.getName());
    templateResponse.setHypervisor(template.getHypervisorType().toString());
    templateResponse.setObjectName("template");
    responses.add(templateResponse);
  }
  response.setResponses(responses);
  return response;
}
