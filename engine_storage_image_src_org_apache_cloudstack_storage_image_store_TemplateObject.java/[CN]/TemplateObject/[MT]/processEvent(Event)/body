{
  try {
    if (this.getDataStore().getRole() == DataStoreRole.Image || this.getDataStore().getRole() == DataStoreRole.ImageCache) {
      TemplateEvent templEvent=null;
      if (event == ObjectInDataStoreStateMachine.Event.CreateOnlyRequested) {
        templEvent=TemplateEvent.CreateRequested;
      }
 else       if (event == ObjectInDataStoreStateMachine.Event.DestroyRequested) {
        templEvent=TemplateEvent.DestroyRequested;
      }
 else       if (event == ObjectInDataStoreStateMachine.Event.OperationSuccessed) {
        templEvent=TemplateEvent.OperationSucceeded;
      }
 else       if (event == ObjectInDataStoreStateMachine.Event.OperationFailed) {
        templEvent=TemplateEvent.OperationFailed;
      }
      if (templEvent != null && this.getDataStore().getRole() == DataStoreRole.Image) {
        this.stateTransit(templEvent);
      }
    }
    ojbectInStoreMgr.update(this,event);
  }
 catch (  NoTransitionException e) {
    s_logger.debug("failed to update state",e);
    throw new CloudRuntimeException("Failed to update state" + e.toString());
  }
}
