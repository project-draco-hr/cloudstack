{
  while (!serverSocket.isClosed()) {
    try {
      Socket newClient=serverSocket.accept();
      PrintWriter pw=new PrintWriter(newClient.getOutputStream());
      if (connections.size() < MAX_CONNECTIONS) {
synchronized (this) {
          connections.addElement(newClient);
          writers.addElement(pw);
          pw.print("TelnetAppender v1.0 (" + connections.size() + " active connections)\r\n\r\n");
          pw.flush();
        }
      }
 else {
        pw.print("Too many connections.\r\n");
        pw.flush();
        newClient.close();
      }
    }
 catch (    Exception e) {
      if (e instanceof InterruptedIOException || e instanceof InterruptedException) {
        Thread.currentThread().interrupt();
      }
      if (!serverSocket.isClosed()) {
        LogLog.error("Encountered error while in SocketHandler loop.",e);
      }
      break;
    }
  }
  try {
    serverSocket.close();
  }
 catch (  InterruptedIOException ex) {
    Thread.currentThread().interrupt();
  }
catch (  IOException ex) {
  }
}
