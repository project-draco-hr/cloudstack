{
  Account callerAccount=UserContext.current().getCaller();
  String accountName=cmd.getAccountName();
  Long domainId=cmd.getDomainId();
  Long accountId=null;
  long count=0;
  List<ResourceCountVO> counts=new ArrayList<ResourceCountVO>();
  List<ResourceType> resourceTypes=new ArrayList<ResourceType>();
  ResourceType resourceType=null;
  Integer typeId=cmd.getResourceType();
  if (typeId != null) {
    for (    ResourceType type : resourceTypes) {
      if (type.getOrdinal() == typeId.intValue()) {
        resourceType=type;
      }
    }
    if (resourceType == null) {
      throw new InvalidParameterValueException("Please specify valid resource type");
    }
  }
  DomainVO domain=_domainDao.findById(domainId);
  if (domain == null) {
    throw new InvalidParameterValueException("Please specify a valid domain ID.");
  }
  _accountMgr.checkAccess(callerAccount,domain,null);
  if (accountName != null) {
    Account userAccount=_accountMgr.getActiveAccountByName(accountName,domainId);
    if (userAccount == null) {
      throw new InvalidParameterValueException("unable to find account by name " + accountName + " in domain with id "+ domainId);
    }
    accountId=userAccount.getId();
  }
  if (resourceType != null) {
    resourceTypes.add(resourceType);
  }
 else {
    resourceTypes=Arrays.asList(Resource.ResourceType.values());
  }
  for (  ResourceType type : resourceTypes) {
    if (accountId != null) {
      if (type.supportsOwner(ResourceOwnerType.Account)) {
        count=recalculateAccountResourceCount(accountId,type);
        counts.add(new ResourceCountVO(type,count,accountId,ResourceOwnerType.Account));
      }
    }
 else {
      if (type.supportsOwner(ResourceOwnerType.Domain)) {
        count=recalculateDomainResourceCount(domainId,type);
        counts.add(new ResourceCountVO(type,count,domainId,ResourceOwnerType.Domain));
      }
    }
  }
  return counts;
}
