{
  try {
    _eventBus=ComponentContext.getComponent(EventBus.class);
  }
 catch (  NoSuchBeanDefinitionException nbe) {
    return;
  }
  String resourceName=getEntityFromClassName(VirtualMachine.class.getName());
  org.apache.cloudstack.framework.events.Event eventMsg=new org.apache.cloudstack.framework.events.Event(ManagementServer.Name,EventCategory.RESOURCE_STATE_CHANGE_EVENT.getName(),event,resourceName,vo.getUuid());
  Map<String,String> eventDescription=new HashMap<String,String>();
  eventDescription.put("resource",resourceName);
  eventDescription.put("id",vo.getUuid());
  eventDescription.put("old-state",oldState.name());
  eventDescription.put("new-state",newState.name());
  String eventDate=new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new Date());
  eventDescription.put("eventDateTime",eventDate);
  eventMsg.setDescription(eventDescription);
  try {
    _eventBus.publish(eventMsg);
  }
 catch (  org.apache.cloudstack.framework.events.EventBusException e) {
    s_logger.warn("Failed to publish state change event on the the event bus.");
  }
}
