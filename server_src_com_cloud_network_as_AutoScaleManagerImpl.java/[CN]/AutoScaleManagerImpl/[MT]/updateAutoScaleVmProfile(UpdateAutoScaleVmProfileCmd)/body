{
  Long profileId=cmd.getId();
  Long templateId=cmd.getTemplateId();
  Long autoscaleUserId=cmd.getAutoscaleUserId();
  Map counterParamList=cmd.getCounterParamList();
  Integer destroyVmGraceperiod=cmd.getDestroyVmGraceperiod();
  AutoScaleVmProfileVO vmProfile=getEntityInDatabase(CallContext.current().getCallingAccount(),"Auto Scale Vm Profile",profileId,_autoScaleVmProfileDao);
  boolean physicalParameterUpdate=(templateId != null || autoscaleUserId != null || counterParamList != null || destroyVmGraceperiod != null);
  if (templateId != null) {
    vmProfile.setTemplateId(templateId);
  }
  if (autoscaleUserId != null) {
    vmProfile.setAutoscaleUserId(autoscaleUserId);
  }
  if (counterParamList != null) {
    vmProfile.setCounterParamsForUpdate(counterParamList);
  }
  if (destroyVmGraceperiod != null) {
    vmProfile.setDestroyVmGraceperiod(destroyVmGraceperiod);
  }
  if (cmd.getCustomId() != null) {
    vmProfile.setUuid(cmd.getCustomId());
  }
  List<AutoScaleVmGroupVO> vmGroupList=_autoScaleVmGroupDao.listByAll(null,profileId);
  for (  AutoScaleVmGroupVO vmGroupVO : vmGroupList) {
    if (physicalParameterUpdate && !vmGroupVO.getState().equals(AutoScaleVmGroup.State_Disabled)) {
      throw new InvalidParameterValueException("The AutoScale Vm Profile can be updated only if the Vm Group it is associated with is disabled in state");
    }
  }
  vmProfile=checkValidityAndPersist(vmProfile);
  s_logger.info("Updated Auto Scale Vm Profile id:" + vmProfile.getId());
  return vmProfile;
}
