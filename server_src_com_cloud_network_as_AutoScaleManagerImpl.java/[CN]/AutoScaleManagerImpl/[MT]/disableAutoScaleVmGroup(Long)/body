{
  AutoScaleVmGroupVO vmGroup=getEntityInDatabase(UserContext.current().getCaller(),"AutoScale Vm Group",id,_autoScaleVmGroupDao);
  boolean success=false;
  if (!vmGroup.getState().equals(AutoScaleVmGroup.State_Enabled)) {
    throw new InvalidParameterValueException("Only a AutoScale Vm Group which is in Enabled state can be disabled.");
  }
  try {
    vmGroup.setState(AutoScaleVmGroup.State_Disabled);
    vmGroup=_autoScaleVmGroupDao.persist(vmGroup);
    success=configureAutoScaleVmGroup(id);
  }
  finally {
    if (!success) {
      vmGroup.setState(AutoScaleVmGroup.State_Enabled);
      _autoScaleVmGroupDao.persist(vmGroup);
      s_logger.warn("Failed to disable AutoScale Vm Group id : " + id);
      return null;
    }
    s_logger.info("Successfully disabled AutoScale Vm Group with Id:" + id);
  }
  return vmGroup;
}
