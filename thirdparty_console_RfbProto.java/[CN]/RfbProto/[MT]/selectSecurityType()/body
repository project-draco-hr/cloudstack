{
  int secType=SecTypeInvalid;
  int nSecTypes=is.readUnsignedByte();
  if (nSecTypes == 0) {
    readConnFailedReason();
    return SecTypeInvalid;
  }
  byte[] secTypes=new byte[nSecTypes];
  readFully(secTypes);
  for (int i=0; i < nSecTypes; i++) {
    if (secTypes[i] == SecTypeTight) {
      protocolTightVNC=true;
      os.write(SecTypeTight);
      return SecTypeTight;
    }
  }
  for (int i=0; i < nSecTypes; i++) {
    if (secTypes[i] == SecTypeNone || secTypes[i] == SecTypeVncAuth) {
      secType=secTypes[i];
      break;
    }
  }
  if (secType == SecTypeInvalid) {
    throw new Exception("Server did not offer supported security type");
  }
 else {
    os.write(secType);
  }
  return secType;
}
