{
  NetworkOffering guestNtwkOff=_entityMgr.findById(NetworkOffering.class,network.getNetworkOfferingId());
  if (guestNtwkOff == null) {
    throw new InvalidParameterValueException("Can't find network offering associated with network: " + network.getUuid());
  }
  if (!_ntwkModel.areServicesSupportedByNetworkOffering(guestNtwkOff.getId(),Service.NetworkACL)) {
    throw new InvalidParameterValueException("Cannot apply NetworkACL. Network Offering does not support NetworkACL service");
  }
  if (network.getNetworkACLId() != null) {
    List<NetworkACLItemVO> aclItems=_networkACLItemDao.listByACL(acl.getId());
    if (aclItems == null || aclItems.isEmpty()) {
      s_logger.debug("New network ACL is empty. Revoke existing rules before applying ACL");
      if (!revokeACLItemsForNetwork(network.getId())) {
        throw new CloudRuntimeException("Failed to replace network ACL. Error while removing existing ACL items for network: " + network.getId());
      }
    }
  }
  network.setNetworkACLId(acl.getId());
  if (_networkDao.update(network.getId(),network)) {
    s_logger.debug("Updated network: " + network.getId() + " with Network ACL Id: "+ acl.getId()+ ", Applying ACL items");
    return applyACLToNetwork(network.getId());
  }
  return false;
}
