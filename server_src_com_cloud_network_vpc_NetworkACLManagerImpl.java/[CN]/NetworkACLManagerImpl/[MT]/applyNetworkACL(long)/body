{
  boolean handled=true;
  boolean aclApplyStatus=true;
  List<NetworkACLItemVO> rules=_networkACLItemDao.listByACL(aclId);
  List<NetworkVO> networks=_networkDao.listByAclId(aclId);
  for (  NetworkVO network : networks) {
    if (!applyACLItemsToNetwork(network.getId(),rules)) {
      handled=false;
      break;
    }
  }
  List<VpcGatewayVO> vpcGateways=_vpcGatewayDao.listByAclIdAndType(aclId,VpcGateway.Type.Private);
  for (  VpcGatewayVO vpcGateway : vpcGateways) {
    PrivateGateway privateGateway=_vpcMgr.getVpcPrivateGateway(vpcGateway.getId());
    if (!applyACLToPrivateGw(privateGateway)) {
      aclApplyStatus=false;
      s_logger.debug("failed to apply network acl item on private gateway " + privateGateway.getId() + "acl id "+ aclId);
      break;
    }
  }
  if (handled && aclApplyStatus) {
    for (    NetworkACLItem rule : rules) {
      if (rule.getState() == NetworkACLItem.State.Revoke) {
        removeRule(rule);
      }
 else       if (rule.getState() == NetworkACLItem.State.Add) {
        NetworkACLItemVO ruleVO=_networkACLItemDao.findById(rule.getId());
        ruleVO.setState(NetworkACLItem.State.Active);
        _networkACLItemDao.update(ruleVO.getId(),ruleVO);
      }
    }
  }
  return handled && aclApplyStatus;
}
