{
  String text=this.layout.format(event);
  if (event.throwable != null) {
    event.throwable.printStackTrace(tp);
    for (int i=0; i < sw.getBuffer().length(); i++) {
      if (sw.getBuffer().charAt(i) == '\t')       sw.getBuffer().replace(i,i + 1,"        ");
    }
    text+=sw.toString();
    sw.getBuffer().delete(0,sw.getBuffer().length());
  }
 else   if (!text.endsWith("\n"))   text+="\n";
  logPublisher.publishEvent(event.priority,text);
}
