{
  CallContext.current().setEventDetails("Account Name: " + accountName + ", Domain Id:"+ domainId);
  try {
    LdapUser user=_ldapManager.getUser(userName);
    validateUser(user);
    UserAccount userAccount=_accountService.createUserAccount(userName,generatePassword(),user.getFirstname(),user.getLastname(),user.getEmail(),timeZone,accountName,accountType,domainId,networkDomain,details,accountUUID,userUUID);
    if (userAccount != null) {
      AccountResponse response=_responseGenerator.createUserAccountResponse(userAccount);
      response.setResponseName(getCommandName());
      setResponseObject(response);
    }
 else {
      throw new ServerApiException(ApiErrorCode.INTERNAL_ERROR,"Failed to create a user account");
    }
  }
 catch (  NamingException e) {
    throw new ServerApiException(ApiErrorCode.RESOURCE_UNAVAILABLE_ERROR,"No LDAP user exists with the username of " + userName);
  }
}
