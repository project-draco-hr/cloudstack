{
  assert(disks != null);
  assert(disks.length >= 1);
  HostMO hostMo=getRunningHost();
  VirtualMachineMO clonedVmMo=HypervisorHostHelper.createWorkerVM(hostMo,new DatastoreMO(hostMo.getContext(),morDs),clonedVmName);
  if (clonedVmMo == null)   throw new Exception("Unable to find just-created blank VM");
  boolean bSuccess=false;
  try {
    VirtualMachineConfigSpec vmConfigSpec=new VirtualMachineConfigSpec();
    VirtualDeviceConfigSpec deviceConfigSpec=new VirtualDeviceConfigSpec();
    VirtualDevice device=VmwareHelper.prepareDiskDevice(clonedVmMo,null,-1,disks,morDs,-1,1);
    deviceConfigSpec.setDevice(device);
    deviceConfigSpec.setOperation(VirtualDeviceConfigSpecOperation.ADD);
    vmConfigSpec.getDeviceChange().add(deviceConfigSpec);
    clonedVmMo.configureVm(vmConfigSpec);
    bSuccess=true;
    return clonedVmMo;
  }
  finally {
    if (!bSuccess) {
      clonedVmMo.detachAllDisks();
      clonedVmMo.destroy();
    }
  }
}
