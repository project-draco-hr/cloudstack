{
  checkArgument(dbVersion != null);
  checkArgument(currentVersion != null);
  checkArgument(currentVersion.compareTo(dbVersion) > 0);
  final DbUpgrade[] upgrades=_upgradeMap.containsKey(dbVersion) ? _upgradeMap.get(dbVersion) : findMostRecentUpgradePath(dbVersion);
  final CloudStackVersion tailVersion=upgrades.length > 0 ? CloudStackVersion.parse(upgrades[upgrades.length - 1].getUpgradedVersion()) : dbVersion;
  if (currentVersion.compareTo(tailVersion) != 0) {
    return concat(upgrades,new NoopDbUpgrade(tailVersion,currentVersion));
  }
  return upgrades;
}
