{
  Transaction txn=Transaction.open(Transaction.SIMULATOR_DB);
  try {
    txn.start();
    String vmName=cmd.getVmName();
    String destGuid=cmd.getHostGuid();
    MockVMVO vm=_mockVmDao.findByVmNameAndHost(vmName,info.getHostUuid());
    if (vm == null) {
      return new MigrateAnswer(cmd,false,"can't find vm:" + vmName + " on host:"+ info.getHostUuid(),null);
    }
 else {
      if (vm.getState() == State.Migrating) {
        vm.setState(State.Running);
      }
    }
    MockHost destHost=_mockHostDao.findByGuid(destGuid);
    if (destHost == null) {
      return new MigrateAnswer(cmd,false,"can;t find host:" + info.getHostUuid(),null);
    }
    vm.setHostId(destHost.getId());
    _mockVmDao.update(vm.getId(),vm);
    txn.commit();
    return new MigrateAnswer(cmd,true,null,0);
  }
 catch (  Exception ex) {
    txn.rollback();
    throw new CloudRuntimeException("unable to migrate vm " + cmd.getVmName(),ex);
  }
 finally {
    txn.close();
    txn=Transaction.open(Transaction.CLOUD_DB);
    txn.close();
  }
}
