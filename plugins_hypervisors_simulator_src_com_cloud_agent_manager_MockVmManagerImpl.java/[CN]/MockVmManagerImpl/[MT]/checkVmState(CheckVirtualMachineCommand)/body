{
  Transaction txn=Transaction.open(Transaction.SIMULATOR_DB);
  try {
    txn.start();
    MockVMVO vm=_mockVmDao.findByVmName(cmd.getVmName());
    if (vm == null) {
      return new CheckVirtualMachineAnswer(cmd,"can't find vm:" + cmd.getVmName());
    }
    txn.commit();
    return new CheckVirtualMachineAnswer(cmd,vm.getState(),vm.getVncPort());
  }
 catch (  Exception ex) {
    txn.rollback();
    throw new CloudRuntimeException("unable to fetch vm state " + cmd.getVmName(),ex);
  }
 finally {
    txn.close();
    txn=Transaction.open(Transaction.CLOUD_DB);
    txn.close();
  }
}
