{
  Transaction txn=Transaction.open(Transaction.SIMULATOR_DB);
  VirtualMachineTO vmTo=cmd.getVirtualMachine();
  try {
    txn.start();
    MockVMVO vm=_mockVmDao.findById(vmTo.getId());
    vm.setState(State.Migrating);
    _mockVmDao.update(vm.getId(),vm);
    txn.commit();
  }
 catch (  Exception ex) {
    txn.rollback();
    throw new CloudRuntimeException("unable to find vm " + vmTo.getName(),ex);
  }
 finally {
    txn.close();
    txn=Transaction.open(Transaction.CLOUD_DB);
    txn.close();
    return new PrepareForMigrationAnswer(cmd);
  }
}
