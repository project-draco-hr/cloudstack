{
  Account caller=UserContext.current().getCaller();
  Long aclId=aclItemCmd.getACLId();
  if (aclId == null) {
    if (aclItemCmd.getNetworkId() == null) {
      throw new InvalidParameterValueException("Cannot create Network ACL Item. ACL Id or network Id is required");
    }
    Network network=_networkMgr.getNetwork(aclItemCmd.getNetworkId());
    if (network.getVpcId() == null) {
      throw new InvalidParameterValueException("Network: " + network.getUuid() + " does not belong to VPC");
    }
    aclId=network.getNetworkACLId();
  }
  NetworkACL acl=_networkAclMgr.getNetworkACL(aclId);
  if (acl == null) {
    throw new InvalidParameterValueException("Unable to find specified ACL");
  }
  Vpc vpc=_vpcMgr.getVpc(acl.getVpcId());
  if (vpc == null) {
    throw new InvalidParameterValueException("Unable to find Vpc associated with the NetworkACL");
  }
  _accountMgr.checkAccess(caller,null,true,vpc);
  Account aclOwner=_accountMgr.getAccount(vpc.getAccountId());
  _accountMgr.checkAccess(aclOwner,SecurityChecker.AccessType.ModifyEntry,false,acl);
  validateNetworkACLItem(aclItemCmd.getSourcePortStart(),aclItemCmd.getSourcePortEnd(),aclItemCmd.getSourceCidrList(),aclItemCmd.getProtocol(),aclItemCmd.getIcmpCode(),aclItemCmd.getIcmpType(),aclItemCmd.getAction());
  return _networkAclMgr.createNetworkACLItem(aclItemCmd.getSourcePortStart(),aclItemCmd.getSourcePortEnd(),aclItemCmd.getProtocol(),aclItemCmd.getSourceCidrList(),aclItemCmd.getIcmpCode(),aclItemCmd.getIcmpType(),aclItemCmd.getTrafficType(),aclId,aclItemCmd.getAction(),aclItemCmd.getNumber());
}
