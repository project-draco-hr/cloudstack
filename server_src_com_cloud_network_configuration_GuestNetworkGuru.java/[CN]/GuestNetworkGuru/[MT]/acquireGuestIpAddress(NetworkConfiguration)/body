{
  List<String> ips=_nicDao.listIpAddressInNetworkConfiguration(config.getId());
  String[] cidr=config.getCidr().split("/");
  Set<Long> allPossibleIps=NetUtils.getAllIpsFromCidr(cidr[0],Integer.parseInt(cidr[1]));
  Set<Long> usedIps=new TreeSet<Long>();
  for (  String ip : ips) {
    usedIps.add(NetUtils.ip2Long(ip));
  }
  if (usedIps.size() != 0) {
    allPossibleIps.removeAll(usedIps);
  }
  if (allPossibleIps.isEmpty()) {
    return null;
  }
  Long[] array=allPossibleIps.toArray(new Long[allPossibleIps.size()]);
  return NetUtils.long2Ip(array[_rand.nextInt() % array.length]);
}
