{
  ComponentLocator locator=ComponentLocator.getCurrentLocator();
  TaskManagerImpl taskMgr=ComponentLocator.inject(TaskManagerImpl.class);
  assertTrue(taskMgr.configure("TaskManager",new HashMap<String,Object>()));
  assertTrue(taskMgr.start());
  MockMaid delegate=new MockMaid();
  delegate.setValue("first");
  long taskId=taskMgr.addTask(delegate);
  StackMaidDao maidDao=locator.getDao(StackMaidDao.class);
  TaskVO task=maidDao.findById(taskId);
  assertEquals(task.getDelegate(),MockMaid.class.getName());
  MockMaid retrieved=(MockMaid)SerializerHelper.fromSerializedString(task.getContext());
  assertEquals(retrieved.getValue(),delegate.getValue());
  delegate.setValue("second");
  taskMgr.updateTask(taskId,delegate);
  task=maidDao.findById(taskId);
  assertEquals(task.getDelegate(),MockMaid.class.getName());
  retrieved=(MockMaid)SerializerHelper.fromSerializedString(task.getContext());
  assertEquals(retrieved.getValue(),delegate.getValue());
  taskMgr.taskCompleted(taskId);
  assertNull(maidDao.findById(taskId));
}
