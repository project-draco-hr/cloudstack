{
  try {
    if (BaseCmd.RESPONSE_TYPE_JSON.equalsIgnoreCase(responseType)) {
      resp.setContentType("text/javascript");
    }
 else {
      resp.setContentType("text/xml");
    }
    resp.setStatus(isError ? HttpServletResponse.SC_INTERNAL_SERVER_ERROR : HttpServletResponse.SC_OK);
    byte[] respBytes=response.getBytes();
    resp.setContentLength(respBytes.length);
    OutputStream os=resp.getOutputStream();
    os.write(respBytes);
    os.flush();
    os.close();
    resp.flushBuffer();
  }
 catch (  IOException ioex) {
    if (s_logger.isTraceEnabled()) {
      s_logger.trace("exception writing response: " + ioex);
    }
  }
catch (  Exception ex) {
    if (!(ex instanceof IllegalStateException)) {
      s_logger.error("unknown exception writing api response",ex);
    }
  }
}
