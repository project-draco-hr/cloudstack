{
  final StringBuilder sb=new StringBuilder();
  final int inactiveInterval=session.getMaxInactiveInterval();
  final String user_UUID=(String)session.getAttribute("user_UUID");
  session.removeAttribute("user_UUID");
  final String domain_UUID=(String)session.getAttribute("domain_UUID");
  session.removeAttribute("domain_UUID");
  if (BaseCmd.RESPONSE_TYPE_JSON.equalsIgnoreCase(responseType)) {
    sb.append("{ \"loginresponse\" : { ");
    final Enumeration attrNames=session.getAttributeNames();
    if (attrNames != null) {
      sb.append("\"timeout\" : \"").append(inactiveInterval).append("\"");
      while (attrNames.hasMoreElements()) {
        final String attrName=(String)attrNames.nextElement();
        if ("userid".equalsIgnoreCase(attrName)) {
          sb.append(", \"" + attrName + "\" : \""+ user_UUID+ "\"");
        }
 else         if ("domainid".equalsIgnoreCase(attrName)) {
          sb.append(", \"" + attrName + "\" : \""+ domain_UUID+ "\"");
        }
 else {
          final Object attrObj=session.getAttribute(attrName);
          if ((attrObj instanceof String) || (attrObj instanceof Long)) {
            sb.append(", \"" + attrName + "\" : \""+ attrObj.toString()+ "\"");
          }
        }
      }
    }
    sb.append(" } }");
  }
 else {
    sb.append("<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>");
    sb.append("<loginresponse cloud-stack-version=\"").append(ApiDBUtils.getVersion()).append("\">");
    sb.append("<timeout>").append(inactiveInterval).append("</timeout>");
    final Enumeration attrNames=session.getAttributeNames();
    if (attrNames != null) {
      while (attrNames.hasMoreElements()) {
        final String attrName=(String)attrNames.nextElement();
        if (ApiConstants.USER_ID.equalsIgnoreCase(attrName)) {
          sb.append("<").append(attrName).append(">").append(user_UUID).append("</").append(attrName).append(">");
        }
 else         if ("domainid".equalsIgnoreCase(attrName)) {
          sb.append("<").append(attrName).append(">").append(domain_UUID).append("</").append(attrName).append(">");
        }
 else {
          final Object attrObj=session.getAttribute(attrName);
          if (attrObj instanceof String || attrObj instanceof Long || attrObj instanceof Short) {
            sb.append("<").append(attrName).append(">").append(attrObj.toString()).append("</").append(attrName).append(">");
          }
        }
      }
    }
    sb.append("</loginresponse>");
  }
  return sb.toString();
}
