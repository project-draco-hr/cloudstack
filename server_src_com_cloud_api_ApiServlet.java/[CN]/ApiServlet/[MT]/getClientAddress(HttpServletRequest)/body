{
  String ip=null;
  ip=request.getHeader("X-Forwarded-For");
  ip=getCorrectIPAddress(ip);
  if (ip != null) {
    return ip;
  }
  ip=request.getHeader("HTTP_CLIENT_IP");
  ip=getCorrectIPAddress(ip);
  if (ip != null) {
    return ip;
  }
  ip=request.getHeader("HTTP_X_FORWARDED_FOR");
  ip=getCorrectIPAddress(ip);
  if (ip != null) {
    return ip;
  }
  ip=request.getHeader("Remote_Addr");
  ip=getCorrectIPAddress(ip);
  if (ip != null) {
    return ip;
  }
  ip=request.getRemoteAddr();
  return ip;
}
