{
  if (!(offering.getTrafficType() == TrafficType.Guest && offering.getGuestIpType() == GuestIpType.Direct)) {
    s_logger.trace("We only take care of public direct network, so this is no ours");
    return null;
  }
  NetworkVO config=new NetworkVO(offering.getTrafficType(),offering.getGuestIpType(),Mode.Dhcp,BroadcastDomainType.Vlan,offering.getId(),plan.getDataCenterId());
  DataCenterVO dc=_dcDao.findById(plan.getDataCenterId());
  if (userSpecified != null) {
    if ((userSpecified.getCidr() == null && userSpecified.getGateway() != null) || (userSpecified.getCidr() != null && userSpecified.getGateway() == null)) {
      throw new InvalidParameterValueException("cidr and gateway must be specified together.");
    }
    if (userSpecified.getCidr() != null) {
      config.setCidr(userSpecified.getCidr());
      config.setGateway(userSpecified.getGateway());
    }
    if (userSpecified.getBroadcastUri() != null) {
      config.setBroadcastUri(userSpecified.getBroadcastUri());
      config.setState(State.Setup);
    }
  }
  config.setDns1(dc.getDns1());
  config.setDns2(dc.getDns2());
  return config;
}
