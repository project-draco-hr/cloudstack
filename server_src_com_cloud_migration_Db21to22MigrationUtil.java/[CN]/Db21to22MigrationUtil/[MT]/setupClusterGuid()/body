{
  List<ClusterVO> clusters=_clusterDao.listByHyTypeWithoutGuid(HypervisorType.XenServer.toString());
  for (  ClusterVO cluster : clusters) {
    List<HostVO> hosts=_hostDao.listByCluster(cluster.getId());
    for (    HostVO host : hosts) {
      String ip=host.getPrivateIpAddress();
      String username=host.getDetail("username");
      String password=host.getDetail("password");
      if (ip == null || ip.isEmpty() || username == null || username.isEmpty() || password == null || password.isEmpty()) {
        continue;
      }
      Connection conn=XenServerConnectionPool.slaveConnect(ip,username,password);
      if (conn == null)       continue;
      Pool.Record pr=null;
      try {
        pr=XenServerConnectionPool.getPoolRecord(conn);
      }
 catch (      Exception e) {
        continue;
      }
 finally {
        try {
          Session.localLogout(conn);
        }
 catch (        Exception e) {
        }
      }
      cluster.setGuid(pr.uuid);
      _clusterDao.update(cluster.getId(),cluster);
      break;
    }
  }
}
