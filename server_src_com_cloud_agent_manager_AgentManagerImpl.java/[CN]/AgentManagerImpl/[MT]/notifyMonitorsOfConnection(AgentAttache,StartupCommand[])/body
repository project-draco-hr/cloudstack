{
  long hostId=attache.getId();
  HostVO host=_hostDao.findById(hostId);
  for (  Pair<Integer,Listener> monitor : _hostMonitors) {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Sending Connect to listener: " + monitor.second().getClass().getSimpleName());
    }
    for (int i=0; i < cmd.length; i++) {
      try {
        monitor.second().processConnect(host,cmd[i]);
      }
 catch (      ConnectionException e) {
        if (e.isSetupError()) {
          s_logger.warn("Monitor " + monitor.second().getClass().getSimpleName() + " says there is an error in the connect process for "+ hostId+ " due to "+ e.getMessage());
          handleDisconnect(attache,Event.AgentDisconnected,false);
          throw e;
        }
 else {
          s_logger.info("Monitor " + monitor.second().getClass().getSimpleName() + " says not to continue the connect process for "+ hostId+ " due to "+ e.getMessage());
          handleDisconnect(attache,Event.ShutdownRequested,false);
          return attache;
        }
      }
    }
  }
  Long dcId=host.getDataCenterId();
  ReadyCommand ready=new ReadyCommand(dcId);
  Answer answer=easySend(hostId,ready);
  if (answer == null) {
    handleDisconnect(attache,Event.AgentDisconnected,false);
  }
  _hostDao.updateStatus(host,Event.Ready,_nodeId);
  attache.ready();
  return attache;
}
