{
  StartupCommand[] cmds=resource.initialize();
  if (cmds == null) {
    return null;
  }
  if (id != null) {
    HostVO host=_hostDao.findById(id);
    if (!_hostDao.directConnect(host,_nodeId)) {
      s_logger.info("Someone else is loading " + host);
      return null;
    }
  }
  AgentAttache attache=null;
  if (s_logger.isDebugEnabled()) {
    new Request(0l,-1l,-1l,cmds,true,false,true).log(-1,"Startup request from directly connected host: ");
  }
  try {
    attache=handleDirectConnect(resource,cmds,details,old,hostTags,allocationState);
  }
 catch (  IllegalArgumentException ex) {
    s_logger.warn("Unable to connect due to ",ex);
    throw ex;
  }
catch (  Exception e) {
    s_logger.warn("Unable to connect due to ",e);
  }
  if (attache == null) {
    resource.disconnected();
    return null;
  }
  if (attache.isReady()) {
    StartupAnswer[] answers=new StartupAnswer[cmds.length];
    for (int i=0; i < answers.length; i++) {
      answers[i]=new StartupAnswer(cmds[i],attache.getId(),_pingInterval);
    }
    attache.process(answers);
  }
  return attache;
}
