{
  HostVO host=null;
  if (id != null) {
    host=_hostDao.findById(id);
    if (host.getManagementServerId() != null) {
      s_logger.info("MS " + host.getManagementServerId() + " is loading "+ host);
      return null;
    }
  }
  StartupCommand[] cmds=resource.initialize();
  if (cmds == null) {
    return null;
  }
  if (host != null) {
    if (!_hostDao.directConnect(host,_nodeId)) {
      s_logger.info("Someone else is loading " + host);
      resource.disconnected();
      return null;
    }
  }
  AgentAttache attache=null;
  if (s_logger.isDebugEnabled()) {
    new Request(0l,-1l,-1l,cmds,true,false,true).log(-1,"Startup request from directly connected host: ");
  }
  try {
    attache=handleDirectConnect(resource,cmds,details,old,hostTags,allocationState);
  }
 catch (  IllegalArgumentException ex) {
    s_logger.warn("Unable to connect due to ",ex);
    throw ex;
  }
catch (  Exception e) {
    s_logger.warn("Unable to connect due to ",e);
  }
  if (attache == null) {
    resource.disconnected();
    return null;
  }
  return attache;
}
