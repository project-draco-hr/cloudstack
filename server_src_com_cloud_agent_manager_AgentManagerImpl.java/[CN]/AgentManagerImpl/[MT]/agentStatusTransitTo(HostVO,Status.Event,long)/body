{
  if (!isAgentEventAllowedByResourceState(host,e)) {
    String err=String.format("Cannot proceed agent event %1$s because it is not allowed by current resource state %2$s fort host %3$s",e,host.getResourceState(),host.getId());
    s_logger.debug(err);
    throw new CloudRuntimeException(err);
  }
  host.setManagementServerId(msId);
  try {
    return _statusStateMachine.transitTo(host,e,host.getId(),_hostDao);
  }
 catch (  NoTransitionException e1) {
    s_logger.debug("Cannot transit agent status with event " + e + " for host "+ host.getId()+ ", mangement server id is "+ msId);
    throw new CloudRuntimeException("Cannot transit agent status with event " + e + " for host "+ host.getId()+ ", mangement server id is "+ msId+ ","+ e1.getMessage());
  }
}
