{
  _name=name;
  Request.initBuilder();
  final ComponentLocator locator=ComponentLocator.getCurrentLocator();
  ConfigurationDao configDao=locator.getDao(ConfigurationDao.class);
  if (configDao == null) {
    throw new ConfigurationException("Unable to get the configuration dao.");
  }
  final Map<String,String> configs=configDao.getConfiguration("AgentManager",params);
  _port=NumbersUtil.parseInt(configs.get("port"),8250);
  final int workers=NumbersUtil.parseInt(configs.get("workers"),5);
  String value=configs.get("ping.interval");
  _pingInterval=NumbersUtil.parseInt(value,60);
  value=configs.get("wait");
  _wait=NumbersUtil.parseInt(value,1800) * 1000;
  value=configs.get("alert.wait");
  _alertWait=NumbersUtil.parseInt(value,1800);
  value=configs.get("update.wait");
  _updateWait=NumbersUtil.parseInt(value,600);
  value=configs.get("ping.timeout");
  final float multiplier=value != null ? Float.parseFloat(value) : 2.5f;
  _pingTimeout=(long)(multiplier * _pingInterval);
  s_logger.info("Ping Timeout is " + _pingTimeout);
  _instance=configs.get("instance.name");
  if (_instance == null) {
    _instance="DEFAULT";
  }
  _hostAllocators=locator.getAdapters(HostAllocator.class);
  if (_hostAllocators == null || !_hostAllocators.isSet()) {
    throw new ConfigurationException("Unable to find an host allocator.");
  }
  _podAllocators=locator.getAdapters(PodAllocator.class);
  if (_podAllocators == null || !_podAllocators.isSet()) {
    throw new ConfigurationException("Unable to find an pod allocator.");
  }
  _discoverers=locator.getAdapters(Discoverer.class);
  if (_nodeId == -1) {
    _nodeId=MacAddress.getMacAddress().toLong();
  }
  _hostDao.markHostsAsDisconnected(_nodeId,Status.Up,Status.Connecting,Status.Updating,Status.Disconnected,Status.Down);
  _monitor=new AgentMonitor(_nodeId,_hostDao,_volDao,_vmDao,_dcDao,_podDao,this,_alertMgr,_pingTimeout);
  registerForHostEvents(_monitor,true,true,false);
  _executor=new ThreadPoolExecutor(10,100,60l,TimeUnit.SECONDS,new LinkedBlockingQueue<Runnable>(),new NamedThreadFactory("AgentTaskPool"));
  String overProvisioningFactorStr=configs.get("storage.overprovisioning.factor");
  _overProvisioningFactor=NumbersUtil.parseFloat(overProvisioningFactorStr,1);
  String cpuOverProvisioningFactorStr=configs.get("cpu.overprovisioning.factor");
  _cpuOverProvisioningFactor=NumbersUtil.parseFloat(cpuOverProvisioningFactorStr,1);
  if (_cpuOverProvisioningFactor < 1) {
    _cpuOverProvisioningFactor=1;
  }
  _connection=new NioServer("AgentManager",_port,workers + 10,this);
  s_logger.info("Listening on " + _port + " with "+ workers+ " workers");
  return true;
}
