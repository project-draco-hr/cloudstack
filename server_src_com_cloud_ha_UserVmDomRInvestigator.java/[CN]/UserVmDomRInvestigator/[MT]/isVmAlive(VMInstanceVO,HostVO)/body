{
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("testing if vm (" + vm.getId() + ") is alive");
  }
  if (vm.getType() == VirtualMachine.Type.User) {
    UserVmVO userVm=_userVmDao.findById(vm.getId());
    Nic nic=_networkMgr.getNicForTraffic(userVm.getId(),TrafficType.Guest);
    if (nic == null) {
      if (s_logger.isDebugEnabled()) {
        s_logger.debug("Unable to find a guest nic for " + vm);
      }
      return null;
    }
    VirtualRouter router=_vnaMgr.getRouterForNetwork(nic.getNetworkId());
    if (router == null) {
      if (s_logger.isDebugEnabled()) {
        s_logger.debug("Unable to find a router in network " + nic.getNetworkId() + " to ping "+ vm);
      }
      return null;
    }
    return testUserVM(vm,nic,router);
  }
 else {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Not a User Vm, unable to determine state of vm (" + vm.getId() + "), returning null");
    }
  }
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("unable to determine state of vm (" + vm.getId() + "), returning null");
  }
  return null;
}
