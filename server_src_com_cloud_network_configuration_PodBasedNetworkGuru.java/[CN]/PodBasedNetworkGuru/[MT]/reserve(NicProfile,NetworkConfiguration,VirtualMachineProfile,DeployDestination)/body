{
  DataCenter dc=dest.getDataCenter();
  Pod pod=dest.getPod();
  String ip=_dcDao.allocatePrivateIpAddress(dest.getDataCenter().getId(),dest.getPod().getId(),nic.getId());
  if (ip == null) {
    throw new InsufficientAddressCapacityException("Unable to get a management ip address");
  }
  String[] macs=_dcDao.getNextAvailableMacAddressPair(dc.getId());
  nic.setIp4Address(ip);
  nic.setGateway(pod.getGateway());
  nic.setMacAddress(macs[0]);
  nic.setFormat(AddressFormat.Ip4);
  String netmask=NetUtils.getCidrSubNet(pod.getCidrAddress(),pod.getCidrSize());
  nic.setNetmask(netmask);
  return Long.toString(nic.getId());
}
