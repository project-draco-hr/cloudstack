{
  int priority;
  if (routers.size() == 0) {
    priority=DEFAULT_PRIORITY;
  }
 else {
    int maxPriority=0;
    final DomainRouterVO router0=routers.get(0);
    if (router0.getId() == masterRouter.getId()) {
      if (!router0.getIsRedundantRouter()) {
        throw new CloudRuntimeException("Redundant router is mixed with single router in one network!");
      }
      maxPriority=_nwHelper.getRealPriority(router0);
    }
 else {
      maxPriority=DEFAULT_PRIORITY;
    }
    if (maxPriority == 0) {
      return DEFAULT_PRIORITY;
    }
    if (maxPriority < 20) {
      s_logger.error("Current maximum priority is too low!");
      throw new InsufficientVirtualNetworkCapacityException("Current maximum priority is too low as " + maxPriority + "!",network.getId());
    }
 else     if (maxPriority > 200) {
      s_logger.error("Too many times fail-over happened! Current maximum priority is too high as " + maxPriority + "!");
      throw new InsufficientVirtualNetworkCapacityException("Too many times fail-over happened! Current maximum priority is too high as " + maxPriority + "!",network.getId());
    }
    priority=maxPriority - DEFAULT_DELTA + 1;
  }
  return priority;
}
