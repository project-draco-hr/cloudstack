{
  int priority;
  if (routers.size() == 0) {
    priority=DEFAULT_PRIORITY;
  }
 else {
    int maxPriority=0;
    for (    final DomainRouterVO r : routers) {
      if (!r.getIsRedundantRouter()) {
        throw new CloudRuntimeException("Redundant router is mixed with single router in one network!");
      }
      if (r.getId() != exclude.getId() && _nwHelper.getRealPriority(r) > maxPriority) {
        maxPriority=_nwHelper.getRealPriority(r);
      }
    }
    if (maxPriority == 0) {
      return DEFAULT_PRIORITY;
    }
    if (maxPriority < 20) {
      s_logger.error("Current maximum priority is too low!");
      throw new InsufficientVirtualNetworkCapacityException("Current maximum priority is too low as " + maxPriority + "!",network.getId());
    }
 else     if (maxPriority > 200) {
      s_logger.error("Too many times fail-over happened! Current maximum priority is too high as " + maxPriority + "!");
      throw new InsufficientVirtualNetworkCapacityException("Too many times fail-over happened! Current maximum priority is too high as " + maxPriority + "!",network.getId());
    }
    priority=maxPriority - DEFAULT_DELTA + 1;
  }
  return priority;
}
