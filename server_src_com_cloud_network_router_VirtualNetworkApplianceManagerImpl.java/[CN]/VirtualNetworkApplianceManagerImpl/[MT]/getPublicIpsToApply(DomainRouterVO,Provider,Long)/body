{
  long ownerId=router.getAccountId();
  final List<IPAddressVO> userIps=_networkMgr.listPublicIpsAssignedToGuestNtwk(ownerId,guestNetworkId,null);
  List<PublicIp> allPublicIps=new ArrayList<PublicIp>();
  if (userIps != null && !userIps.isEmpty()) {
    for (    IPAddressVO userIp : userIps) {
      PublicIp publicIp=new PublicIp(userIp,_vlanDao.findById(userIp.getVlanId()),NetUtils.createSequenceBasedMacAddress(userIp.getMacAddress()));
      allPublicIps.add(publicIp);
    }
  }
  Network network=_networkDao.findById(guestNetworkId);
  Map<PublicIp,Set<Service>> ipToServices=_networkMgr.getIpToServices(allPublicIps,false,false);
  Map<Provider,ArrayList<PublicIp>> providerToIpList=_networkMgr.getProviderToIpList(network,ipToServices);
  ArrayList<PublicIp> publicIps=providerToIpList.get(provider);
  return publicIps;
}
