{
  DomainRouterVO router=getRouter(vpn.getAccountId(),network.getDataCenterId());
  if (router == null) {
    s_logger.warn("Failed to delete remote access VPN: no router found for account and zone");
    throw new ResourceUnavailableException("Unable to apply lb rules",DataCenter.class,network.getDataCenterId());
  }
  if (router.getState() != State.Running) {
    s_logger.warn("Failed to delete remote access VPN: router not in running state");
    throw new ResourceUnavailableException("Failed to delete remote access VPN: domR is not in right state " + router.getState(),DataCenter.class,network.getDataCenterId());
  }
  Commands cmds=new Commands(OnError.Continue);
  IpAddress ip=_networkMgr.getIp(vpn.getServerAddressId());
  RemoteAccessVpnCfgCommand removeVpnCmd=new RemoteAccessVpnCfgCommand(false,ip.getAddress().addr(),vpn.getLocalIp(),vpn.getIpRange(),vpn.getIpsecPresharedKey());
  removeVpnCmd.setAccessDetail(NetworkElementCommand.ROUTER_IP,router.getPrivateIpAddress());
  removeVpnCmd.setAccessDetail(NetworkElementCommand.ROUTER_NAME,router.getInstanceName());
  cmds.addCommand(removeVpnCmd);
  return sendCommandsToRouter(router,cmds);
}
