{
  long ownerId=router.getAccountId();
  final List<IPAddressVO> userIps=_networkMgr.listPublicIpsAssignedToGuestNtwk(ownerId,guestNetworkId,null);
  List<PrivateIp> allPublicIps=new ArrayList<PrivateIp>();
  if (userIps != null && !userIps.isEmpty()) {
    for (    IPAddressVO userIp : userIps) {
      PrivateIp publicIp=new PrivateIp(userIp,_vlanDao.findById(userIp.getVlanId()),NetUtils.createSequenceBasedMacAddress(userIp.getMacAddress()));
      allPublicIps.add(publicIp);
    }
  }
  Network network=_networkDao.findById(guestNetworkId);
  Map<PrivateIp,Set<Service>> ipToServices=_networkMgr.getIpToServices(allPublicIps,false,false);
  Map<Provider,ArrayList<PrivateIp>> providerToIpList=_networkMgr.getProviderToIpList(network,ipToServices);
  ArrayList<PrivateIp> publicIps=providerToIpList.get(provider);
  return publicIps;
}
