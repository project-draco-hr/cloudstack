{
  final Transaction txn=Transaction.currentTxn();
  try {
    txn.start();
    final UserStatisticsVO userStats=_userStatsDao.lock(router.getAccountId(),router.getDataCenterIdToDeployIn(),router.getNetworkId(),null,router.getId(),router.getType().toString());
    if (userStats != null) {
      final long currentBytesRcvd=userStats.getCurrentBytesReceived();
      userStats.setCurrentBytesReceived(0);
      userStats.setNetBytesReceived(userStats.getNetBytesReceived() + currentBytesRcvd);
      final long currentBytesSent=userStats.getCurrentBytesSent();
      userStats.setCurrentBytesSent(0);
      userStats.setNetBytesSent(userStats.getNetBytesSent() + currentBytesSent);
      _userStatsDao.update(userStats.getId(),userStats);
      s_logger.debug("Successfully updated user statistics as a part of domR " + router + " reboot/stop");
    }
 else {
      s_logger.warn("User stats were not created for account " + router.getAccountId() + " and dc "+ router.getDataCenterIdToDeployIn());
    }
    txn.commit();
  }
 catch (  final Exception e) {
    txn.rollback();
    throw new CloudRuntimeException("Problem updating stats after reboot/stop ",e);
  }
}
