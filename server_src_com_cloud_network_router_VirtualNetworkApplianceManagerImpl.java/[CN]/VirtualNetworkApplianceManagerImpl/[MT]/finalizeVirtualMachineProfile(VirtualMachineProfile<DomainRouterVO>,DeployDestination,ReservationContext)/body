{
  DomainRouterVO router=profile.getVirtualMachine();
  NetworkVO network=_networkDao.findById(router.getNetworkId());
  String type=null;
  String dhcpRange=null;
  DataCenter dc=dest.getDataCenter();
  if (dc.getNetworkType() == NetworkType.Advanced) {
    String cidr=network.getCidr();
    dhcpRange=NetUtils.getDhcpRange(cidr);
  }
  String domain=network.getNetworkDomain();
  if (router.getRole() == Role.DHCP_USERDATA) {
    type="dhcpsrvr";
  }
 else {
    type="router";
  }
  StringBuilder buf=profile.getBootArgsBuilder();
  buf.append(" template=domP type=" + type);
  buf.append(" name=").append(profile.getHostName());
  NicProfile controlNic=null;
  NicProfile managementNic=null;
  for (  NicProfile nic : profile.getNics()) {
    int deviceId=nic.getDeviceId();
    buf.append(" eth").append(deviceId).append("ip=").append(nic.getIp4Address());
    buf.append(" eth").append(deviceId).append("mask=").append(nic.getNetmask());
    if (nic.isDefaultNic()) {
      buf.append(" gateway=").append(nic.getGateway());
      buf.append(" dns1=").append(nic.getDns1());
      if (nic.getDns2() != null) {
        buf.append(" dns2=").append(nic.getDns2());
      }
      if (dc.getNetworkType() == NetworkType.Basic) {
        long cidrSize=NetUtils.getCidrSize(nic.getNetmask());
        String cidr=NetUtils.getCidrSubNet(nic.getGateway(),cidrSize);
        if (cidr != null) {
          dhcpRange=NetUtils.getIpRangeStartIpFromCidr(cidr,cidrSize);
        }
      }
    }
    if (nic.getTrafficType() == TrafficType.Management) {
      buf.append(" localgw=").append(dest.getPod().getGateway());
      managementNic=nic;
    }
 else     if (nic.getTrafficType() == TrafficType.Control) {
      if (dest.getHost().getHypervisorType() == HypervisorType.VmWare) {
        buf.append(" mgmtcidr=").append(_mgmt_host);
        buf.append(" localgw=").append(dest.getPod().getGateway());
      }
      controlNic=nic;
    }
  }
  if (dhcpRange != null) {
    buf.append(" dhcprange=" + dhcpRange);
  }
  if (domain != null) {
    buf.append(" domain=" + router.getDomain());
  }
  if (_noDefaultRouteForDirectNetwork && network.getGuestType() == GuestIpType.Direct) {
    buf.append(" defaultroute=false");
  }
 else {
    buf.append(" defaultroute=true");
  }
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Boot Args for " + profile + ": "+ buf.toString());
  }
  if (controlNic == null) {
    throw new CloudRuntimeException("Didn't start a control port");
  }
  profile.setParameter("control.nic",controlNic);
  return true;
}
