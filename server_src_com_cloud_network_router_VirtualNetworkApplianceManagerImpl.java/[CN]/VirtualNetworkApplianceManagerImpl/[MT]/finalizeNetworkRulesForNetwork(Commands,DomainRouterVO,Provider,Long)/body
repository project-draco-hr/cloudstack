{
  s_logger.debug("Resending ipAssoc, port forwarding, load balancing rules as a part of Virtual router start");
  ArrayList<? extends PublicIpAddress> publicIps=getPublicIpsToApply(router,provider,guestNetworkId);
  if (publicIps != null && !publicIps.isEmpty()) {
    List<RemoteAccessVpn> vpns=new ArrayList<RemoteAccessVpn>();
    List<PortForwardingRule> pfRules=new ArrayList<PortForwardingRule>();
    List<FirewallRule> staticNatFirewallRules=new ArrayList<FirewallRule>();
    List<StaticNat> staticNats=new ArrayList<StaticNat>();
    List<FirewallRule> firewallRules=new ArrayList<FirewallRule>();
    for (    PublicIpAddress ip : publicIps) {
      if (_networkMgr.isProviderSupportServiceInNetwork(guestNetworkId,Service.PortForwarding,provider)) {
        pfRules.addAll(_pfRulesDao.listForApplication(ip.getId()));
      }
      if (_networkMgr.isProviderSupportServiceInNetwork(guestNetworkId,Service.StaticNat,provider)) {
        staticNatFirewallRules.addAll(_rulesDao.listByIpAndPurpose(ip.getId(),Purpose.StaticNat));
      }
      if (_networkMgr.isProviderSupportServiceInNetwork(guestNetworkId,Service.Firewall,provider)) {
        firewallRules.addAll(_rulesDao.listByIpAndPurpose(ip.getId(),Purpose.Firewall));
      }
      if (_networkMgr.isProviderSupportServiceInNetwork(guestNetworkId,Service.Vpn,provider)) {
        RemoteAccessVpn vpn=_vpnDao.findById(ip.getId());
        if (vpn != null) {
          vpns.add(vpn);
        }
      }
      if (_networkMgr.isProviderSupportServiceInNetwork(guestNetworkId,Service.StaticNat,provider)) {
        if (ip.isOneToOneNat()) {
          String dstIp=_networkMgr.getIpInNetwork(ip.getAssociatedWithVmId(),guestNetworkId);
          StaticNatImpl staticNat=new StaticNatImpl(ip.getAccountId(),ip.getDomainId(),guestNetworkId,ip.getId(),dstIp,false);
          staticNats.add(staticNat);
        }
      }
    }
    s_logger.debug("Found " + staticNats.size() + " static nat(s) to apply as a part of domR "+ router+ " start.");
    if (!staticNats.isEmpty()) {
      createApplyStaticNatCommands(staticNats,router,cmds,guestNetworkId);
    }
    s_logger.debug("Found " + staticNats.size() + " firewall rule(s) to apply as a part of domR "+ router+ " start.");
    if (!firewallRules.isEmpty()) {
      createFirewallRulesCommands(firewallRules,router,cmds,guestNetworkId);
    }
    s_logger.debug("Found " + pfRules.size() + " port forwarding rule(s) to apply as a part of domR "+ router+ " start.");
    if (!pfRules.isEmpty()) {
      createApplyPortForwardingRulesCommands(pfRules,router,cmds,guestNetworkId);
    }
    s_logger.debug("Found " + staticNatFirewallRules.size() + " static nat rule(s) to apply as a part of domR "+ router+ " start.");
    if (!staticNatFirewallRules.isEmpty()) {
      List<StaticNatRule> staticNatRules=new ArrayList<StaticNatRule>();
      for (      FirewallRule rule : staticNatFirewallRules) {
        staticNatRules.add(_rulesMgr.buildStaticNatRule(rule,false));
      }
      createApplyStaticNatRulesCommands(staticNatRules,router,cmds,guestNetworkId);
    }
    s_logger.debug("Found " + vpns.size() + " vpn(s) to apply as a part of domR "+ router+ " start.");
    if (!vpns.isEmpty()) {
      for (      RemoteAccessVpn vpn : vpns) {
        createApplyVpnCommands(vpn,router,cmds);
      }
    }
    List<LoadBalancerVO> lbs=_loadBalancerDao.listByNetworkId(guestNetworkId);
    List<LoadBalancingRule> lbRules=new ArrayList<LoadBalancingRule>();
    if (_networkMgr.isProviderSupportServiceInNetwork(guestNetworkId,Service.Lb,provider)) {
      for (      LoadBalancerVO lb : lbs) {
        List<LbDestination> dstList=_lbMgr.getExistingDestinations(lb.getId());
        List<LbStickinessPolicy> policyList=_lbMgr.getStickinessPolicies(lb.getId());
        LoadBalancingRule loadBalancing=new LoadBalancingRule(lb,dstList,policyList);
        lbRules.add(loadBalancing);
      }
    }
    s_logger.debug("Found " + lbRules.size() + " load balancing rule(s) to apply as a part of domR "+ router+ " start.");
    if (!lbRules.isEmpty()) {
      createApplyLoadBalancingRulesCommands(lbRules,router,cmds,guestNetworkId);
    }
  }
}
