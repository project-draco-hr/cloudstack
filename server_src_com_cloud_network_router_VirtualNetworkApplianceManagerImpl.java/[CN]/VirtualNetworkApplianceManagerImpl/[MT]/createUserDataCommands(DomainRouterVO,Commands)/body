{
  long networkId=router.getNetworkId();
  List<UserVmVO> vms=_userVmDao.listByNetworkId(networkId);
  if (vms != null && !vms.isEmpty()) {
    for (    UserVmVO vm : vms) {
      if (vm.getUserData() != null) {
        NicVO nic=_nicDao.findByInstanceIdAndNetworkId(networkId,vm.getId());
        if (nic != null) {
          s_logger.debug("Creating user data entry for vm " + vm + " on domR "+ router);
          String serviceOffering=_serviceOfferingDao.findByIdIncludingRemoved(vm.getServiceOfferingId()).getDisplayText();
          String zoneName=_dcDao.findById(router.getDataCenterId()).getName();
          cmds.addCommand("vmdata",generateVmDataCommand(router,nic.getIp4Address(),vm.getUserData(),serviceOffering,zoneName,nic.getIp4Address(),vm.getName(),vm.getInstanceName(),vm.getId(),null));
        }
      }
    }
  }
}
