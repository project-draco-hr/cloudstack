{
  DhcpEntryCommand dhcpCommand=new DhcpEntryCommand(nic.getMacAddress(),nic.getIp4Address(),vm.getHostName());
  DataCenterVO dcVo=_dcDao.findById(router.getDataCenterIdToDeployIn());
  String gatewayIp=findGatewayIp(vm.getId());
  boolean needGateway=true;
  if (!gatewayIp.equals(nic.getGateway())) {
    needGateway=false;
    GuestOSVO guestOS=_guestOSDao.findById(vm.getGuestOSId());
    for (    String name : _guestOSNeedGatewayOnNonDefaultNetwork) {
      if (guestOS.getDisplayName().startsWith(name)) {
        needGateway=true;
        break;
      }
    }
  }
  if (!needGateway) {
    gatewayIp="0.0.0.0";
  }
  dhcpCommand.setDefaultRouter(gatewayIp);
  dhcpCommand.setDefaultDns(findDefaultDnsIp(vm.getId()));
  dhcpCommand.setAccessDetail(NetworkElementCommand.ROUTER_IP,getRouterControlIp(router.getId()));
  dhcpCommand.setAccessDetail(NetworkElementCommand.ROUTER_NAME,router.getInstanceName());
  dhcpCommand.setAccessDetail(NetworkElementCommand.ROUTER_GUEST_IP,getRouterIpInNetwork(nic.getNetworkId(),router.getId()));
  dhcpCommand.setAccessDetail(NetworkElementCommand.ZONE_NETWORK_TYPE,dcVo.getNetworkType().toString());
  cmds.addCommand("dhcp",dhcpCommand);
}
