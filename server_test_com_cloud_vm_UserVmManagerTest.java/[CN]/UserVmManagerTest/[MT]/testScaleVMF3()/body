{
  ScaleVMCmd cmd=new ScaleVMCmd();
  Class<?> _class=cmd.getClass();
  Field idField=_class.getDeclaredField("id");
  idField.setAccessible(true);
  idField.set(cmd,1L);
  Field serviceOfferingIdField=_class.getDeclaredField("serviceOfferingId");
  serviceOfferingIdField.setAccessible(true);
  serviceOfferingIdField.set(cmd,1L);
  when(_vmInstanceDao.findById(anyLong())).thenReturn(_vmInstance);
  doReturn(Hypervisor.HypervisorType.XenServer).when(_vmInstance).getHypervisorType();
  ServiceOffering so1=(ServiceOffering)getSvcoffering(512);
  ServiceOffering so2=(ServiceOffering)getSvcoffering(256);
  when(_configMgr.getServiceOffering(anyLong())).thenReturn(so2);
  when(_configMgr.getServiceOffering(1L)).thenReturn(so1);
  doReturn(VirtualMachine.State.Stopped).when(_vmInstance).getState();
  doReturn(true).when(_itMgr).upgradeVmDb(anyLong(),anyLong());
  when(_vmDao.findById(anyLong())).thenReturn(_vmMock);
  _userVmMgr.upgradeVirtualMachine(cmd);
}
