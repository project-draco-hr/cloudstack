{
  EC2InstanceFilterSet ifs=new EC2InstanceFilterSet();
  FilterType[] items=fst.getItem();
  if (null != items) {
    for (int j=0; j < items.length; j++) {
      String filterName=items[j].getName();
      ValueSetType vst=items[j].getValueSet();
      ValueType[] valueItems=vst.getItem();
      if (filterName.startsWith("tag:")) {
        String key=filterName.split(":")[1];
        for (        ValueType valueItem : valueItems) {
          EC2TagKeyValue tag=new EC2TagKeyValue();
          tag.setKey(key);
          tag.setValue(valueItem.getValue());
          request.addResourceTag(tag);
        }
      }
 else {
        EC2Filter oneFilter=new EC2Filter();
        oneFilter.setName(filterName);
        for (int k=0; k < valueItems.length; k++)         oneFilter.addValueEncoded(valueItems[k].getValue());
        ifs.addFilter(oneFilter);
      }
    }
    request.setFilterSet(ifs);
  }
  return request;
}
