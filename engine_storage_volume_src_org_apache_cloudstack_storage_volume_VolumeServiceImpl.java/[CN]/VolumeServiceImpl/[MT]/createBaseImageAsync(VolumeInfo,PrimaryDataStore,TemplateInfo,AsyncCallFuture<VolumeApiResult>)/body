{
  TemplateOnPrimaryDataStoreObject templateOnPrimaryStoreObj=(TemplateOnPrimaryDataStoreObject)templatePrimaryStoreMgr.createTemplateOnPrimaryDataStore(template,dataStore);
  templateOnPrimaryStoreObj.stateTransit(TemplateOnPrimaryDataStoreStateMachine.Event.CreateRequested);
  templateOnPrimaryStoreObj.updateStatus(Status.CREATING);
  try {
    dataStore.installTemplate(templateOnPrimaryStoreObj);
    templateOnPrimaryStoreObj.updateStatus(Status.CREATED);
  }
 catch (  Exception e) {
    templateOnPrimaryStoreObj.updateStatus(Status.ABANDONED);
    templateOnPrimaryStoreObj.stateTransit(TemplateOnPrimaryDataStoreStateMachine.Event.OperationFailed);
    VolumeApiResult result=new VolumeApiResult(volume);
    result.setResult(e.toString());
    future.complete(result);
    return;
  }
  templateOnPrimaryStoreObj.updateStatus(Status.DOWNLOAD_IN_PROGRESS);
  CreateBaseImageContext<VolumeApiResult> context=new CreateBaseImageContext<VolumeApiResult>(null,volume,dataStore,templateOnPrimaryStoreObj,future);
  AsyncCallbackDispatcher<VolumeServiceImpl,CommandResult> caller=AsyncCallbackDispatcher.create(this);
  caller.setCallback(caller.getTarget().createBaseImageCallback(null,null)).setContext(context);
  imageMotion.copyTemplateAsync(templateOnPrimaryStoreObj,caller);
}
