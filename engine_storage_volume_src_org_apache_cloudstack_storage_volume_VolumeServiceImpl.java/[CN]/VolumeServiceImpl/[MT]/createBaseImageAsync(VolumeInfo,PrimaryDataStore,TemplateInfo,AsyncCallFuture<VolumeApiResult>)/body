{
  DataObject templateOnPrimaryStoreObj=dataStore.create(template);
  CreateBaseImageContext<CreateCmdResult> context=new CreateBaseImageContext<CreateCmdResult>(null,volume,dataStore,template,future,templateOnPrimaryStoreObj);
  AsyncCallbackDispatcher<VolumeServiceImpl,CopyCommandResult> caller=AsyncCallbackDispatcher.create(this);
  caller.setCallback(caller.getTarget().copyBaseImageCallback(null,null)).setContext(context);
  try {
    templateOnPrimaryStoreObj.processEvent(Event.CreateOnlyRequested);
  }
 catch (  Exception e) {
    try {
      templateOnPrimaryStoreObj=waitForTemplateDownloaded(dataStore,template);
    }
  finally {
      if (templateOnPrimaryStoreObj == null) {
        VolumeApiResult result=new VolumeApiResult(volume);
        result.setResult(e.toString());
        caller.complete(result);
        return;
      }
    }
  }
  try {
    motionSrv.copyAsync(template,templateOnPrimaryStoreObj,caller);
  }
 catch (  Exception e) {
    s_logger.debug("failed to create template on storage",e);
    templateOnPrimaryStoreObj.processEvent(Event.OperationFailed);
    VolumeApiResult result=new VolumeApiResult(volume);
    result.setResult(e.toString());
    caller.complete(result);
  }
  return;
}
