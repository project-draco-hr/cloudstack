{
  TemplateOnPrimaryDataStoreObject templateOnPrimaryStoreObj=(TemplateOnPrimaryDataStoreObject)templatePrimaryStoreMgr.createTemplateOnPrimaryDataStore(template,dataStore);
  templateOnPrimaryStoreObj.stateTransit(TemplateOnPrimaryDataStoreStateMachine.Event.CreateRequested);
  templateOnPrimaryStoreObj.updateStatus(Status.CREATING);
  try {
    dataStore.installTemplate(templateOnPrimaryStoreObj);
    templateOnPrimaryStoreObj.updateStatus(Status.CREATED);
  }
 catch (  Exception e) {
    templateOnPrimaryStoreObj.updateStatus(Status.ABANDONED);
    templateOnPrimaryStoreObj.stateTransit(TemplateOnPrimaryDataStoreStateMachine.Event.OperationFailed);
    throw new CloudRuntimeException(e.toString());
  }
  templateOnPrimaryStoreObj.updateStatus(Status.DOWNLOAD_IN_PROGRESS);
  AsyncCallbackDispatcher caller=new AsyncCallbackDispatcher(this).setParentCallback(callback).setOperationName("volumeservice.createbaseimage.callback").setContextParam("volume",volume).setContextParam("primary",dataStore).setContextParam("templateOnPrimary",templateOnPrimaryStoreObj);
  imageMotion.copyTemplateAsync(templateOnPrimaryStoreObj,caller);
}
