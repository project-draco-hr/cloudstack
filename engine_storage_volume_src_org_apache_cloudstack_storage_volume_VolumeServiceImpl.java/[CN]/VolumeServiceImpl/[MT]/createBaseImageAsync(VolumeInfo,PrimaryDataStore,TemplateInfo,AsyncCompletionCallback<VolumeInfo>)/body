{
  TemplateOnPrimaryDataStoreObject templateOnPrimaryStoreObj=(TemplateOnPrimaryDataStoreObject)templatePrimaryStoreMgr.createTemplateOnPrimaryDataStore(template,dataStore);
  templateOnPrimaryStoreObj.stateTransit(TemplateOnPrimaryDataStoreStateMachine.Event.CreateRequested);
  templateOnPrimaryStoreObj.updateStatus(Status.CREATING);
  try {
    dataStore.installTemplate(templateOnPrimaryStoreObj);
    templateOnPrimaryStoreObj.updateStatus(Status.CREATED);
  }
 catch (  Exception e) {
    templateOnPrimaryStoreObj.updateStatus(Status.ABANDONED);
    templateOnPrimaryStoreObj.stateTransit(TemplateOnPrimaryDataStoreStateMachine.Event.OperationFailed);
    throw new CloudRuntimeException(e.toString());
  }
  templateOnPrimaryStoreObj.updateStatus(Status.DOWNLOAD_IN_PROGRESS);
  CreateBaseImageContext<VolumeInfo> context=new CreateBaseImageContext<VolumeInfo>(callback,volume,dataStore,templateOnPrimaryStoreObj);
  AsyncCallbackDispatcher<VolumeServiceImpl,CommandResult> caller=AsyncCallbackDispatcher.create(this);
  caller.setCallback(caller.getTarget().createBaseImageCallback(null,null)).setContext(context);
  imageMotion.copyTemplateAsync(templateOnPrimaryStoreObj,caller);
}
