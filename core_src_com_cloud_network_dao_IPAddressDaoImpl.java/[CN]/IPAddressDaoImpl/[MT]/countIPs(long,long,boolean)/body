{
  Transaction txn=Transaction.currentTxn();
  PreparedStatement pstmt=null;
  int ipCount=0;
  try {
    String sql="SELECT count(*) from `cloud`.`user_ip_address` where data_center_id = " + dcId;
    if (vlanDbId != -1) {
      sql+=" AND vlan_db_id = " + vlanDbId;
    }
    if (onlyCountAllocated) {
      sql+=" AND allocated IS NOT NULL";
    }
    pstmt=txn.prepareAutoCloseStatement(sql);
    ResultSet rs=pstmt.executeQuery();
    if (rs.next()) {
      ipCount=rs.getInt(1);
    }
  }
 catch (  Exception e) {
    s_logger.warn("Exception counting IP addresses",e);
  }
  return ipCount;
}
