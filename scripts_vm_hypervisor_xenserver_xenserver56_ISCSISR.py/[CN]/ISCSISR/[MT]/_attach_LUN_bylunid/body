def _attach_LUN_bylunid(self, lunid):
    if (not self.attached):
        raise xs_errors.XenError('SRUnavailable')
    connected = []
    for val in self.adapter:
        if (not self.pathdict.has_key(val)):
            continue
        rec = self.pathdict[val]
        path = os.path.join(rec['path'], ('LUN%s' % lunid))
        util.SMlog(('path: %s' % path))
        realpath = os.path.realpath(path)
        util.SMlog(('realpath: %s' % realpath))
        host = self.adapter[val]
        if (not self.devs.has_key(realpath)):
            l = [realpath, host, 0, 0, lunid]
            scsiutil.scsi_dev_ctrl(l, 'add')
            if (not util.wait_for_path(path, MAX_LUNID_TIMEOUT)):
                util.SMlog(('Unable to detect LUN attached to host on path [%s]' % path))
                continue
        else:
            try:
                real_SCSIid = scsiutil.getSCSIid(realpath)
                cur_scsibuspath = glob.glob(('/dev/disk/by-scsibus/*-%s:0:0:%s' % (host, lunid)))
                cur_SCSIid = os.path.basename(cur_scsibuspath[0]).split('-')[0]
                assert (cur_SCSIid == real_SCSIid)
            except:
                scsiutil.rescan([host])
                if (not os.path.exists(('/dev/disk/by-scsibus/%s-%s:0:0:%s' % (real_SCSIid, host, lunid)))):
                    util.SMlog('Unable to detect LUN attached to host after bus re-probe')
                    continue
        connected.append(path)
    return connected
