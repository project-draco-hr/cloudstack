def _detach_LUN_bylunid(self, lunid, SCSIid):
    if (not self.attached):
        raise xs_errors.XenError('SRUnavailable')
    if ((self.mpath == 'true') and len(SCSIid)):
        self.mpathmodule.reset(SCSIid, True)
        util.remove_mpathcount_field(self.session, self.host_ref, self.sr_ref, SCSIid)
    for val in self.adapter:
        if (not self.pathdict.has_key(val)):
            continue
        rec = self.pathdict[val]
        path = os.path.join(rec['path'], ('LUN%s' % lunid))
        realpath = os.path.realpath(path)
        if self.devs.has_key(realpath):
            util.SMlog(('Found key: %s' % realpath))
            scsiutil.scsi_dev_ctrl(self.devs[realpath], 'remove')
            if (not util.wait_for_nopath(realpath, MAX_LUNID_TIMEOUT)):
                util.SMlog(('Device has not disappeared after %d seconds' % MAX_LUNID_TIMEOUT))
            else:
                util.SMlog(('Device [%s,%s] disappeared' % (realpath, path)))
