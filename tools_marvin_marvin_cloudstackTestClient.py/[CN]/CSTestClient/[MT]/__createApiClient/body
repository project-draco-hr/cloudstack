def __createApiClient(self):
    try:
        '\n            Step1 : Create a CS Connection Object\n            '
        self.__csConnection = CSConnection(self.__mgmtDetails, self.__asyncTimeOut, self.__logger)
        '\n            Step2 : Create API Client with earlier created connection object\n            '
        self.__apiClient = CloudStackAPIClient(self.__csConnection)
        '\n            Step3:  If API Key is not provided as part of Management Details,\n                    then verify and register\n            '
        if (self.__mgmtDetails.apiKey is None):
            list_user = listUsers.listUsersCmd()
            list_user.account = 'admin'
            list_user_res = self.__apiClient.listUsers(list_user)
            if ((list_user_res == FAILED) or (list_user_res is None) or (validateList(list_user_res)[0] != PASS)):
                self.__logger.error('__createApiClient: API Client Creation Failed')
                return FAILED
            user_id = list_user_res[0].id
            api_key = list_user_res[0].apikey
            security_key = list_user_res[0].secretkey
            if (api_key is None):
                ret = self.__getKeys(user_id)
                if (ret != FAILED):
                    self.__mgmtDetails.port = 8080
                    self.__mgmtDetails.apiKey = ret[0]
                    self.__mgmtDetails.securityKey = ret[1]
                else:
                    self.__logger.error('__createApiClient: API Client Creation Failed while Registering User')
                    return FAILED
            '\n                Now Create the Connection objects and Api Client using\n                new details\n                '
            self.__csConnection = CSConnection(self.__mgmtDetails, self.__asyncTimeOut, self.__logger)
            self.__apiClient = CloudStackAPIClient(self.__csConnection)
        '\n            Set the HyperVisor Details to Client default to Xen\n            '
        self.__setHypervisorToClient()
        return SUCCESS
    except Exception as e:
        self.__logger.exception((' Exception Occurred Under __createApiClient: %s' % GetDetailExceptionInfo(e)))
        return FAILED
