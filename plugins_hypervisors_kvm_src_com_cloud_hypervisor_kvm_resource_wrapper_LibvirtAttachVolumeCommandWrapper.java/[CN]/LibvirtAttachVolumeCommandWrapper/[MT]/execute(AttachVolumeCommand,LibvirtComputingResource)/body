{
  try {
    final LibvirtUtilitiesHelper libvirtUtilitiesHelper=libvirtComputingResource.getLibvirtUtilitiesHelper();
    final Connect conn=libvirtUtilitiesHelper.getConnectionByVmName(command.getVmName());
    final KVMStoragePool primary=libvirtComputingResource.getStoragePoolMgr().getStoragePool(command.getPooltype(),command.getPoolUuid());
    final KVMPhysicalDisk disk=primary.getPhysicalDisk(command.getVolumePath());
    libvirtComputingResource.attachOrDetachDisk(conn,command.getAttach(),command.getVmName(),disk,command.getDeviceId().intValue(),command.getBytesReadRate(),command.getBytesWriteRate(),command.getIopsReadRate(),command.getIopsWriteRate(),command.getCacheMode());
  }
 catch (  final LibvirtException e) {
    return new AttachVolumeAnswer(command,e.toString());
  }
catch (  final InternalErrorException e) {
    return new AttachVolumeAnswer(command,e.toString());
  }
  return new AttachVolumeAnswer(command,command.getDeviceId(),command.getVolumePath());
}
