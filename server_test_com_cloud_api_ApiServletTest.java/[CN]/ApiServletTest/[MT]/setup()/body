{
  servlet=new ApiServlet();
  responseWriter=new StringWriter();
  Mockito.when(response.getWriter()).thenReturn(new PrintWriter(responseWriter));
  Mockito.when(request.getRemoteAddr()).thenReturn("127.0.0.1");
  Mockito.when(accountService.getSystemUser()).thenReturn(user);
  Mockito.when(accountService.getSystemAccount()).thenReturn(account);
  Field accountMgrField=ApiServlet.class.getDeclaredField("_accountMgr");
  accountMgrField.setAccessible(true);
  accountMgrField.set(servlet,accountService);
  Field apiServerField=ApiServlet.class.getDeclaredField("_apiServer");
  apiServerField.setAccessible(true);
  apiServerField.set(servlet,apiServer);
}
