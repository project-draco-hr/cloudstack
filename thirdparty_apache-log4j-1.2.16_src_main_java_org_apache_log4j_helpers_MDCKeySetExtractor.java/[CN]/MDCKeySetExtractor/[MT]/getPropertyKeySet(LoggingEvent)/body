{
  Set keySet=null;
  if (getKeySetMethod != null) {
    keySet=(Set)getKeySetMethod.invoke(event,null);
  }
 else {
    ByteArrayOutputStream outBytes=new ByteArrayOutputStream();
    ObjectOutputStream os=new ObjectOutputStream(outBytes);
    os.writeObject(event);
    os.close();
    byte[] raw=outBytes.toByteArray();
    final String subClassName=LogEvent.class.getName();
    if (raw[6] == 0 || raw[7] == subClassName.length()) {
      for (int i=0; i < subClassName.length(); i++) {
        raw[8 + i]=(byte)subClassName.charAt(i);
      }
      ByteArrayInputStream inBytes=new ByteArrayInputStream(raw);
      ObjectInputStream is=new ObjectInputStream(inBytes);
      Object cracked=is.readObject();
      if (cracked instanceof LogEvent) {
        keySet=((LogEvent)cracked).getPropertyKeySet();
      }
      is.close();
    }
  }
  return keySet;
}
