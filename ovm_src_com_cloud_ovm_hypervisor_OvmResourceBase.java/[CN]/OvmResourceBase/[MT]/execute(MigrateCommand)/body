{
  final String vmName=cmd.getVmName();
  State state=null;
synchronized (_vms) {
    state=_vms.get(vmName);
    _vms.put(vmName,State.Stopping);
  }
  try {
    OvmVm.Details vm=OvmVm.getDetails(_conn,vmName);
    String destIp=cmd.getDestinationIp();
    OvmVm.migrate(_conn,vmName,destIp);
    state=State.Stopping;
    cleanup(vm);
    return new MigrateAnswer(cmd,true,"migration succeeded",null);
  }
 catch (  Exception e) {
    String msg="Catch Exception " + e.getClass().getName() + ": Migration failed due to "+ e.toString();
    s_logger.debug(msg,e);
    return new MigrateAnswer(cmd,false,msg,null);
  }
 finally {
synchronized (_vms) {
      _vms.put(vmName,state);
    }
  }
}
