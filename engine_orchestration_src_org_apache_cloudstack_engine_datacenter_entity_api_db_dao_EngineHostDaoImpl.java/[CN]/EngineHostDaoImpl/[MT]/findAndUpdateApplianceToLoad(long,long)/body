{
  Transaction txn=Transaction.currentTxn();
  txn.start();
  SearchCriteria<EngineHostVO> sc=UnmanagedApplianceSearch.create();
  sc.setParameters("lastPinged",lastPingSecondsAfter);
  sc.setParameters("types",Type.ExternalDhcp,Type.ExternalFirewall,Type.ExternalLoadBalancer,Type.PxeServer,Type.TrafficMonitor,Type.L2Networking);
  List<EngineHostVO> hosts=lockRows(sc,null,true);
  for (  EngineHostVO host : hosts) {
    host.setManagementServerId(managementServerId);
    update(host.getId(),host);
  }
  txn.commit();
  return hosts;
}
