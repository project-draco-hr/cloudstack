def virshdomstate(domain):
    libvirt_states = {libvirt.VIR_DOMAIN_RUNNING: 'running', libvirt.VIR_DOMAIN_SHUTOFF: 'shut off', libvirt.VIR_DOMAIN_SHUTDOWN: 'shut down', libvirt.VIR_DOMAIN_PAUSED: 'paused', libvirt.VIR_DOMAIN_NOSTATE: 'no state', libvirt.VIR_DOMAIN_BLOCKED: 'blocked', libvirt.VIR_DOMAIN_CRASHED: 'crashed', }
    conn = libvirt.openReadOnly('qemu:///system')
    if (conn == None):
        print 'Failed to open connection to the hypervisor'
        sys.exit(3)
    try:
        dom = conn.lookupByName(domain)
    except libvirt.libvirtError:
        return None
    state = libvirt_states[dom.info()[0]]
    conn.close()
    return state
