{
  VMTemplateVO templ=imageDataDao.findById(templateId);
  if (store == null) {
    TemplateObject tmpl=TemplateObject.getTemplate(templ,null);
    return tmpl;
  }
  boolean found=false;
  if (store.getRole() == DataStoreRole.Primary) {
    VMTemplateStoragePoolVO templatePoolVO=templatePoolDao.findByPoolTemplate(store.getId(),templateId);
    if (templatePoolVO != null) {
      found=true;
    }
  }
 else {
    DataObjectInStore obj=objMap.findObject(templ.getUuid(),DataObjectType.TEMPLATE,store.getUuid(),store.getRole());
    if (obj != null) {
      found=true;
    }
  }
  if (!found) {
    s_logger.debug("template " + templateId + " is not in store:"+ store.getId()+ ", type:"+ store.getRole());
  }
  TemplateObject tmpl=TemplateObject.getTemplate(templ,store);
  return tmpl;
}
