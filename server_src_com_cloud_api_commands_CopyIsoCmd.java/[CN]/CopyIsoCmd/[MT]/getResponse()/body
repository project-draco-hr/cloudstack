{
  TemplateResponse isoResponse=new TemplateResponse();
  VMTemplateVO iso=(VMTemplateVO)getResponseObject();
  if (iso != null) {
    isoResponse.setId(iso.getId());
    isoResponse.setName(iso.getName());
    isoResponse.setDisplayText(iso.getDisplayText());
    isoResponse.setPublic(iso.isPublicTemplate());
    isoResponse.setBootable(iso.isBootable());
    isoResponse.setFeatured(iso.isFeatured());
    isoResponse.setCrossZones(iso.isCrossZones());
    isoResponse.setCreated(iso.getCreated());
    isoResponse.setZoneId(destZoneId);
    isoResponse.setZoneName(ApiDBUtils.findZoneById(destZoneId).getName());
    GuestOS os=ApiDBUtils.findGuestOSById(iso.getGuestOSId());
    if (os != null) {
      isoResponse.setOsTypeId(os.getId());
      isoResponse.setOsTypeName(os.getDisplayName());
    }
 else {
      isoResponse.setOsTypeId(-1L);
      isoResponse.setOsTypeName("");
    }
    Account owner=ApiDBUtils.findAccountById(iso.getAccountId());
    if (owner != null) {
      isoResponse.setAccount(owner.getAccountName());
      isoResponse.setDomainId(owner.getDomainId());
      isoResponse.setDomainName(ApiDBUtils.findDomainById(owner.getDomainId()).getName());
    }
    Account account=(Account)UserContext.current().getAccountObject();
    boolean isAdmin=false;
    if ((account == null) || (account.getType() == Account.ACCOUNT_TYPE_ADMIN) || (account.getType() == Account.ACCOUNT_TYPE_DOMAIN_ADMIN)) {
      isAdmin=true;
    }
    VMTemplateHostVO templateHostRef=ApiDBUtils.findTemplateHostRef(iso.getId(),destZoneId);
    if (isAdmin || iso.getAccountId() == account.getId()) {
      if (templateHostRef.getDownloadState() != Status.DOWNLOADED) {
        String templateStatus="Processing";
        if (templateHostRef.getDownloadState() == VMTemplateHostVO.Status.DOWNLOAD_IN_PROGRESS) {
          if (templateHostRef.getDownloadPercent() == 100) {
            templateStatus="Installing Template";
          }
 else {
            templateStatus=templateHostRef.getDownloadPercent() + "% Downloaded";
          }
        }
 else {
          templateStatus=templateHostRef.getErrorString();
        }
        isoResponse.setStatus(templateStatus);
      }
 else       if (templateHostRef.getDownloadState() == VMTemplateHostVO.Status.DOWNLOADED) {
        isoResponse.setStatus("Download Complete");
      }
 else {
        isoResponse.setStatus("Successfully Installed");
      }
    }
    isoResponse.setReady(templateHostRef.getDownloadState() == VMTemplateHostVO.Status.DOWNLOADED);
  }
 else {
    throw new ServerApiException(BaseCmd.INTERNAL_ERROR,"Failed to copy iso");
  }
  isoResponse.setResponseName(getName());
  return isoResponse;
}
