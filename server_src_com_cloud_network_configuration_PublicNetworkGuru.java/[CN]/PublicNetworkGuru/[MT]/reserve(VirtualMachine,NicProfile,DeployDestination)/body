{
  long dcId=dest.getDataCenter().getId();
  long podId=dest.getPod().getId();
  Pair<String,VlanVO> ipAndVlan=_vlanDao.assignIpAddress(dcId,vm.getAccountId(),vm.getDomainId(),VlanType.VirtualNetwork,true);
  if (ipAndVlan == null) {
    s_logger.debug("Unable to get public ip address (type=Virtual) for console proxy vm for data center  : " + dcId);
    ipAndVlan=_vlanDao.assignPodDirectAttachIpAddress(dcId,podId,Account.ACCOUNT_ID_SYSTEM,DomainVO.ROOT_DOMAIN);
    if (ipAndVlan == null)     s_logger.debug("Unable to get public ip address (type=DirectAttach) for console proxy vm for data center  : " + dcId);
  }
  if (ipAndVlan != null) {
    VlanVO vlan=ipAndVlan.second();
    return null;
  }
  return null;
}
