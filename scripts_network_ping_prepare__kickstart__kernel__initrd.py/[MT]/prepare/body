def prepare():
    try:
        kernel = os.path.join(copy_to, 'vmlinuz')
        initrd = os.path.join(copy_to, 'initrd.img')
        if (os.path.exists(kernel) and os.path.exists(initrd)):
            print ('Having template(%s) prepared already, skip copying' % copy_to)
            return 0
        elif (not os.path.exists(copy_to)):
            os.makedirs(copy_to)
        mnt_path = tempfile.mkdtemp()
        try:
            mnt = ('mount %s %s' % (iso_folder, mnt_path))
            cmd(mnt)
            kernel = os.path.join(mnt_path, 'vmlinuz')
            initrd = os.path.join(mnt_path, 'initrd.img')
            cp = ('cp -f %s %s/' % (kernel, copy_to))
            cmd(cp)
            cp = ('cp -f %s %s/' % (initrd, copy_to))
            cmd(cp)
        finally:
            umnt = ('umount %s' % mnt_path)
            cmd(umnt, False)
            rm = ('rm -r %s' % mnt_path)
            cmd(rm, False)
        return 0
    except Exception as e:
        print e
        return 1
