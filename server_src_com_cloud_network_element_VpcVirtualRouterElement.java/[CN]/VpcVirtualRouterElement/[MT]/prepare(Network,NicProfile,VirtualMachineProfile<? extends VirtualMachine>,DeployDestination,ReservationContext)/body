{
  Long vpcId=network.getVpcId();
  if (vpcId == null) {
    s_logger.warn("Network " + network + " is not associated with any VPC");
    return false;
  }
  boolean success=super.prepare(network,nic,vm,dest,context);
  if (success) {
    List<? extends VirtualRouter> routers=_routerDao.listRoutersByVpcId(vpcId);
    for (    VirtualRouter router : routers) {
      if (_ntwkService.isVmPartOfNetwork(router.getId(),network.getId())) {
        s_logger.debug("Router " + router + " is already part of the network "+ network);
        continue;
      }
      success=success && _vpcElementService.addVmToNetwork(router,network);
    }
    if (!success) {
      s_logger.warn("Failed to plug nic in network " + network + " for virtual router in vpc id="+ vpcId);
    }
 else {
      s_logger.debug("Successfully plugged nic in network " + network + " for virtual router in vpc id="+ vpcId);
    }
  }
  return success;
}
