{
  Long vpcId=network.getVpcId();
  if (vpcId == null) {
    s_logger.warn("Network " + network + " is not associated with any VPC");
    return false;
  }
  Vpc vpc=_vpcMgr.getActiveVpc(vpcId);
  if (vpc == null) {
    s_logger.warn("Unable to find Enabled VPC by id " + vpcId);
    return false;
  }
  if (vm.getType() == Type.User) {
    Map<VirtualMachineProfile.Param,Object> params=new HashMap<VirtualMachineProfile.Param,Object>(1);
    params.put(VirtualMachineProfile.Param.ReProgramGuestNetworks,true);
    List<DomainRouterVO> routers=_vpcRouterMgr.deployVirtualRouterInVpc(vpc,dest,_accountMgr.getAccount(vpc.getAccountId()),params);
    if ((routers == null) || (routers.size() == 0)) {
      throw new ResourceUnavailableException("Can't find at least one running router!",DataCenter.class,network.getDataCenterId());
    }
  }
  return true;
}
