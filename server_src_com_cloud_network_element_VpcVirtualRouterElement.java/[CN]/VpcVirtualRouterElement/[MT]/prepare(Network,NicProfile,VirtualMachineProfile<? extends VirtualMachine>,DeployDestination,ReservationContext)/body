{
  Long vpcId=network.getVpcId();
  if (vpcId == null) {
    s_logger.warn("Network " + network + " is not associated with any VPC");
    return false;
  }
  Vpc vpc=_vpcService.getActiveVpc(vpcId);
  if (vpc == null) {
    s_logger.warn("Unable to find Enabled VPC by id " + vpcId);
    return false;
  }
  Map<VirtualMachineProfile.Param,Object> params=new HashMap<VirtualMachineProfile.Param,Object>(1);
  params.put(VirtualMachineProfile.Param.ReProgramGuestNetworks,true);
  List<DomainRouterVO> routers=_vpcRouterMgr.deployVirtualRouterInVpc(vpc,dest,_accountMgr.getAccount(vpc.getAccountId()),params);
  if ((routers == null) || (routers.size() == 0)) {
    throw new ResourceUnavailableException("Can't find at least one running router!",DataCenter.class,network.getDataCenterId());
  }
  boolean success=true;
  for (  VirtualRouter router : routers) {
    if (_ntwkService.isVmPartOfNetwork(router.getId(),network.getId())) {
      s_logger.debug("Router " + router + " is already part of the network "+ network);
      continue;
    }
    success=success && _vpcElementService.addVmToNetwork(router,network);
  }
  if (!success) {
    s_logger.warn("Failed to plug nic in network " + network + " for virtual router in vpc id="+ vpcId);
  }
 else {
    s_logger.debug("Successfully plugged nic in network " + network + " for virtual router in vpc id="+ vpcId);
  }
  return success;
}
