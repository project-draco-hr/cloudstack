{
  Site2SiteVpnGateway vpnGw=_vpnGatewayDao.findById(conn.getVpnGatewayId());
  IpAddress ip=_ipAddressDao.findById(vpnGw.getAddrId());
  Map<Capability,String> vpnCapabilities=capabilities.get(Service.Vpn);
  if (!vpnCapabilities.get(Capability.VpnTypes).contains("s2svpn")) {
    s_logger.error("try to start site 2 site vpn on unsupported network element?");
    return false;
  }
  Long vpcId=ip.getVpcId();
  Vpc vpc=_vpcMgr.getVpc(vpcId);
  if (!_vpcMgr.vpcProviderEnabledInZone(vpc.getZoneId())) {
    throw new ResourceUnavailableException("VPC provider is not enabled in zone " + vpc.getZoneId(),DataCenter.class,vpc.getZoneId());
  }
  List<DomainRouterVO> routers=_vpcMgr.getVpcRouters(ip.getVpcId());
  if (routers == null || routers.size() != 1) {
    throw new ResourceUnavailableException("Cannot enable site-to-site VPN on the backend; virtual router doesn't exist in the vpc " + ip.getVpcId(),DataCenter.class,vpc.getZoneId());
  }
  return _vpcRouterMgr.startSite2SiteVpn(conn,routers.get(0));
}
