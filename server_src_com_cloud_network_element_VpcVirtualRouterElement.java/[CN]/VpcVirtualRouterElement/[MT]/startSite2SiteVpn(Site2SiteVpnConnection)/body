{
  Site2SiteVpnGateway vpnGw=_vpnGatewayDao.findById(conn.getVpnGatewayId());
  IpAddress ip=_ipAddressDao.findById(vpnGw.getAddrId());
  Map<Capability,String> vpnCapabilities=capabilities.get(Service.Vpn);
  if (!vpnCapabilities.get(Capability.VpnTypes).contains("s2svpn")) {
    return false;
  }
  List<DomainRouterVO> routers=_vpcMgr.getVpcRouters(ip.getVpcId());
  if (routers == null || routers.size() != 1) {
    s_logger.debug("Cannot enable site-to-site VPN on the backend; virtual router doesn't exist in the vpc " + ip.getVpcId());
    return true;
  }
  if (!_vpcRouterMgr.startSite2SiteVpn(conn,routers.get(0))) {
    throw new CloudRuntimeException("Failed to apply site-to-site VPN in VPC " + ip.getVpcId());
  }
  return true;
}
