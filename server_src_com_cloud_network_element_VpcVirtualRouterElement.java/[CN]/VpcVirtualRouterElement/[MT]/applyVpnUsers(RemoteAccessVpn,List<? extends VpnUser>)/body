{
  if (vpn.getVpcId() == null) {
    return null;
  }
  List<DomainRouterVO> routers=_vpcRouterMgr.getVpcRouters(vpn.getVpcId());
  if (routers == null || routers.size() != 1) {
    s_logger.debug("Cannot apply vpn users on the backend; virtual router doesn't exist in the network " + vpn.getVpcId());
    return null;
  }
  Vpc vpc=_entityMgr.findById(Vpc.class,vpn.getVpcId());
  DataCenterVO dcVO=_dcDao.findById(vpc.getZoneId());
  NetworkTopology networkTopology=networkTopologyContext.retrieveNetworkTopology(dcVO);
  return networkTopology.applyVpnUsers(vpn,users,routers.get(0));
}
