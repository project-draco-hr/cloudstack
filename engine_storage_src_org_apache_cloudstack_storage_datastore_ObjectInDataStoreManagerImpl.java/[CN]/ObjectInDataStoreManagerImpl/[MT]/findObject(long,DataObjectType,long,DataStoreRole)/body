{
  DataObjectInStore vo=null;
  if (role == DataStoreRole.Image) {
switch (type) {
case TEMPLATE:
      SearchCriteria<TemplateDataStoreVO> ts=templateDataStoreDao.createSearchCriteria();
    ts.addAnd("templateId",SearchCriteria.Op.EQ,objId);
  ts.addAnd("dataStoreId",SearchCriteria.Op.EQ,dataStoreId);
vo=templateDataStoreDao.findOneBy(ts);
case SNAPSHOT:
SearchCriteria<SnapshotDataStoreVO> ss=snapshotDataStoreDao.createSearchCriteria();
ss.addAnd("snapshotId",SearchCriteria.Op.EQ,objId);
ss.addAnd("dataStoreId",SearchCriteria.Op.EQ,objId);
vo=snapshotDataStoreDao.findOneBy(ss);
case VOLUME:
SearchCriteria<VolumeDataStoreVO> vs=volumeDataStoreDao.createSearchCriteria();
vs.addAnd("volumeId",SearchCriteria.Op.EQ,objId);
vs.addAnd("dataStoreId",SearchCriteria.Op.EQ,objId);
vo=volumeDataStoreDao.findOneBy(vs);
}
}
 else if (type == DataObjectType.TEMPLATE && role == DataStoreRole.Primary) {
vo=templatePoolDao.findByPoolTemplate(dataStoreId,objId);
}
 else if (role == DataStoreRole.ImageCache) {
SearchCriteriaService<ObjectInDataStoreVO,ObjectInDataStoreVO> sc=SearchCriteria2.create(ObjectInDataStoreVO.class);
sc.addAnd(sc.getEntity().getObjectId(),Op.EQ,objId);
sc.addAnd(sc.getEntity().getObjectType(),Op.EQ,type);
sc.addAnd(sc.getEntity().getDataStoreId(),Op.EQ,dataStoreId);
sc.addAnd(sc.getEntity().getDataStoreRole(),Op.EQ,role);
vo=sc.find();
}
 else {
s_logger.debug("Invalid data or store type: " + type + " "+ role);
throw new CloudRuntimeException("Invalid data or store type: " + type + " "+ role);
}
return vo;
}
