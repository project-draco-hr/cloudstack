{
  if (dataStore.getRole() == DataStoreRole.Primary) {
    if (obj.getType() == DataObjectType.TEMPLATE) {
      VMTemplateStoragePoolVO vo=new VMTemplateStoragePoolVO(dataStore.getId(),obj.getId());
      vo=templatePoolDao.persist(vo);
    }
 else     if (obj.getType() == DataObjectType.SNAPSHOT) {
      SnapshotDataStoreVO ss=new SnapshotDataStoreVO();
      ss.setSnapshotId(obj.getId());
      ss.setDataStoreId(dataStore.getId());
      ss.setRole(dataStore.getRole());
      ss=snapshotDataStoreDao.persist(ss);
    }
  }
 else {
switch (obj.getType()) {
case TEMPLATE:
      TemplateDataStoreVO ts=new TemplateDataStoreVO();
    ts.setTemplateId(obj.getId());
  ts.setDataStoreId(dataStore.getId());
if (dataStore.getRole() == DataStoreRole.ImageCache) {
  ts.setInstallPath("template/tmpl/" + templateDao.findById(obj.getId()).getAccountId() + "/"+ obj.getId());
}
ts=templateDataStoreDao.persist(ts);
break;
case SNAPSHOT:
SnapshotDataStoreVO ss=new SnapshotDataStoreVO();
ss.setSnapshotId(obj.getId());
ss.setDataStoreId(dataStore.getId());
ss.setRole(dataStore.getRole());
if (dataStore.getRole() == DataStoreRole.ImageCache) {
ss.setInstallPath("/snapshots/" + snapshotDao.findById(obj.getId()).getAccountId() + "/"+ obj.getId());
}
ss=snapshotDataStoreDao.persist(ss);
break;
case VOLUME:
VolumeDataStoreVO vs=new VolumeDataStoreVO();
vs.setVolumeId(obj.getId());
vs.setDataStoreId(dataStore.getId());
if (dataStore.getRole() == DataStoreRole.ImageCache) {
vs.setInstallPath("/volumes/" + volumeDao.findById(obj.getId()).getAccountId() + "/"+ obj.getId());
}
vs=volumeDataStoreDao.persist(vs);
break;
}
}
return this.get(obj,dataStore);
}
