{
  if (obj.getType() == DataObjectType.TEMPLATE && dataStore.getRole() == DataStoreRole.Primary) {
    VMTemplateStoragePoolVO vo=new VMTemplateStoragePoolVO(dataStore.getId(),obj.getId());
    vo=templatePoolDao.persist(vo);
  }
 else {
    ObjectInDataStoreVO vo=new ObjectInDataStoreVO();
    vo.setDataStoreRole(dataStore.getRole());
    vo.setDataStoreUuid(dataStore.getUuid());
    vo.setObjectType(obj.getType());
    vo.setObjectUuid(obj.getUuid());
    vo=objectDataStoreDao.persist(vo);
  }
  if (obj.getType() == DataObjectType.TEMPLATE) {
    return imageFactory.getTemplate(obj,dataStore);
  }
 else   if (obj.getType() == DataObjectType.VOLUME) {
    return volumeFactory.getVolume(obj,dataStore);
  }
 else   if (obj.getType() == DataObjectType.SNAPSHOT) {
    return snapshotFactory.getSnapshot(obj,dataStore);
  }
  throw new CloudRuntimeException("unknown type");
}
