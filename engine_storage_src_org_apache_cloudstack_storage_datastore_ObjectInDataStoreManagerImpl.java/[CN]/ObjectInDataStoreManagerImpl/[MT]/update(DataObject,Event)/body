{
  DataObjectInStore obj=this.findObject(data,data.getDataStore());
  if (obj == null) {
    throw new CloudRuntimeException("can't find mapping in ObjectInDataStore table for: " + data);
  }
  if (data.getDataStore().getRole() == DataStoreRole.Image) {
switch (data.getType()) {
case TEMPLATE:
      this.stateMachines.transitTo(obj,event,null,templateDataStoreDao);
case SNAPSHOT:
    this.stateMachines.transitTo(obj,event,null,snapshotDataStoreDao);
case VOLUME:
  this.stateMachines.transitTo(obj,event,null,volumeDataStoreDao);
}
}
 else if (data.getType() == DataObjectType.TEMPLATE && data.getDataStore().getRole() == DataStoreRole.Primary) {
try {
this.stateMachines.transitTo(obj,event,null,templatePoolDao);
}
 catch (NoTransitionException e) {
throw e;
}
}
 else {
throw new CloudRuntimeException("Invalid data or store type: " + data.getType() + " "+ data.getDataStore().getRole());
}
return true;
}
