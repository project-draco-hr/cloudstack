{
  DataObjectInStore obj=this.findObject(data,data.getDataStore());
  if (obj == null) {
    throw new CloudRuntimeException("can't find mapping in ObjectInDataStore table for: " + data);
  }
  if (data.getDataStore().getRole() == DataStoreRole.Image || data.getDataStore().getRole() == DataStoreRole.ImageCache) {
switch (data.getType()) {
case TEMPLATE:
      this.stateMachines.transitTo(obj,event,null,templateDataStoreDao);
    break;
case SNAPSHOT:
  this.stateMachines.transitTo(obj,event,null,snapshotDataStoreDao);
break;
case VOLUME:
this.stateMachines.transitTo(obj,event,null,volumeDataStoreDao);
break;
}
}
 else if (data.getType() == DataObjectType.TEMPLATE && data.getDataStore().getRole() == DataStoreRole.Primary) {
this.stateMachines.transitTo(obj,event,null,templatePoolDao);
}
 else {
throw new CloudRuntimeException("Invalid data or store type: " + data.getType() + " "+ data.getDataStore().getRole());
}
return true;
}
