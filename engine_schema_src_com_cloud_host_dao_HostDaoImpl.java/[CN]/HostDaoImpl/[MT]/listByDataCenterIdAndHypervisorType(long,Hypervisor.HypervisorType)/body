{
  SearchBuilder<ClusterVO> clusterSearch=_clusterDao.createSearchBuilder();
  clusterSearch.and("allocationState",clusterSearch.entity().getAllocationState(),SearchCriteria.Op.EQ);
  clusterSearch.and("hypervisorType",clusterSearch.entity().getHypervisorType(),SearchCriteria.Op.EQ);
  SearchBuilder<HostVO> hostSearch=createSearchBuilder();
  hostSearch.and("dc",hostSearch.entity().getDataCenterId(),SearchCriteria.Op.EQ);
  hostSearch.and("type",hostSearch.entity().getType(),Op.EQ);
  hostSearch.and("status",hostSearch.entity().getStatus(),Op.EQ);
  hostSearch.and("resourceState",hostSearch.entity().getResourceState(),Op.EQ);
  hostSearch.join("clusterSearch",clusterSearch,hostSearch.entity().getClusterId(),clusterSearch.entity().getId(),JoinBuilder.JoinType.INNER);
  hostSearch.done();
  SearchCriteria<HostVO> sc=hostSearch.create();
  sc.setParameters("dc",zoneId);
  sc.setParameters("type",Host.Type.Routing);
  sc.setParameters("status",Status.Up);
  sc.setParameters("resourceState",ResourceState.Enabled);
  sc.setJoinParameters("clusterSearch","allocationState",Grouping.AllocationState.Enabled);
  sc.setJoinParameters("clusterSearch","hypervisorType",hypervisorType.toString());
  return listBy(sc);
}
