{
  SearchCriteria<SnapshotScheduleVO> sc=_snapshotScheduleDao.createSearchCriteria();
  sc.addAnd("volumeId",SearchCriteria.Op.EQ,volumeId);
  sc.addAnd("policyId",SearchCriteria.Op.EQ,Snapshot.MANUAL_POLICY_ID);
  List<SnapshotScheduleVO> snapshotSchedules=_snapshotScheduleDao.search(sc,null);
  if (!snapshotSchedules.isEmpty()) {
    Date scheduledTimestamp=snapshotSchedules.get(0).getScheduledTimestamp();
    String dateDisplay=DateUtil.displayDateInTimezone(DateUtil.GMT_TIMEZONE,scheduledTimestamp);
    s_logger.error("Can't execute another manual snapshot for volume: " + volumeId + " while another manual snapshot for the same volume is being created/backed up. "+ "The older snapshot was scheduled at "+ dateDisplay);
    return null;
  }
  SnapshotScheduleVO snapshotSchedule=new SnapshotScheduleVO(volumeId,Snapshot.MANUAL_POLICY_ID,_currentTimestamp);
  _snapshotScheduleDao.persist(snapshotSchedule);
  List<Long> policyIds=new ArrayList<Long>();
  policyIds.add(Snapshot.MANUAL_POLICY_ID);
  return _snapshotManager.createSnapshotAsync(userId,volumeId,policyIds);
}
