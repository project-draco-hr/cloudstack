{
  String newUuid=UUID.randomUUID().toString();
  KVMStoragePool srcPool=template.getPool();
  KVMPhysicalDisk disk=null;
  try {
    if (destPool.getType() != StoragePoolType.RBD) {
      disk=destPool.createPhysicalDisk(newUuid,format,template.getVirtualSize());
      if (template.getFormat() == PhysicalDiskFormat.TAR) {
        Script.runSimpleBashScript("tar -x -f " + template.getPath() + " -C "+ disk.getPath());
      }
 else       if (template.getFormat() == PhysicalDiskFormat.DIR) {
        Script.runSimpleBashScript("mkdir -p " + disk.getPath());
        Script.runSimpleBashScript("chmod 755 " + disk.getPath());
        Script.runSimpleBashScript("cp -p -r " + template.getPath() + "/* "+ disk.getPath());
      }
 else       if (format == PhysicalDiskFormat.QCOW2) {
        QemuImgFile backingFile=new QemuImgFile(template.getPath(),template.getFormat());
        QemuImgFile destFile=new QemuImgFile(disk.getPath());
        QemuImg qemu=new QemuImg();
        qemu.create(destFile,backingFile);
      }
 else       if (format == PhysicalDiskFormat.RAW) {
        QemuImgFile sourceFile=new QemuImgFile(template.getPath(),template.getFormat());
        QemuImgFile destFile=new QemuImgFile(disk.getPath(),PhysicalDiskFormat.RAW);
        QemuImg qemu=new QemuImg();
        qemu.convert(sourceFile,destFile);
      }
    }
 else {
      disk=new KVMPhysicalDisk(destPool.getSourceDir() + "/" + newUuid,newUuid,destPool);
      disk.setFormat(format);
      disk.setSize(template.getVirtualSize());
      disk.setVirtualSize(disk.getSize());
      QemuImg qemu=new QemuImg();
      QemuImgFile srcFile;
      QemuImgFile destFile=new QemuImgFile(KVMPhysicalDisk.RBDStringBuilder(destPool.getSourceHost(),destPool.getSourcePort(),destPool.getAuthUserName(),destPool.getAuthSecret(),disk.getPath()));
      destFile.setFormat(format);
      if (srcPool.getType() != StoragePoolType.RBD) {
        srcFile=new QemuImgFile(template.getPath(),template.getFormat());
      }
 else {
        template.setFormat(PhysicalDiskFormat.RAW);
        srcFile=new QemuImgFile(KVMPhysicalDisk.RBDStringBuilder(srcPool.getSourceHost(),srcPool.getSourcePort(),srcPool.getAuthUserName(),srcPool.getAuthSecret(),template.getPath()));
        srcFile.setFormat(template.getFormat());
      }
      qemu.convert(srcFile,destFile);
    }
  }
 catch (  QemuImgException e) {
    s_logger.error("Failed to create " + disk.getPath() + " due to a failed executing of qemu-img: "+ e.getMessage());
  }
  return disk;
}
