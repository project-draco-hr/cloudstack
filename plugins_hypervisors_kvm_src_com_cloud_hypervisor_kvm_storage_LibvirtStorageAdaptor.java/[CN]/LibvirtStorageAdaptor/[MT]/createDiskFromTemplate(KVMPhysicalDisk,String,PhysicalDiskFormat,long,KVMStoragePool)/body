{
  String newUuid=UUID.randomUUID().toString();
  KVMStoragePool srcPool=template.getPool();
  KVMPhysicalDisk disk=null;
  if (destPool.getType() != StoragePoolType.RBD) {
    disk=destPool.createPhysicalDisk(newUuid,format,template.getVirtualSize());
    if (format == PhysicalDiskFormat.QCOW2) {
      Script.runSimpleBashScript("qemu-img create -f " + template.getFormat() + " -b  "+ template.getPath()+ " "+ disk.getPath());
    }
 else     if (format == PhysicalDiskFormat.RAW) {
      Script.runSimpleBashScript("qemu-img convert -f " + template.getFormat() + " -O raw "+ template.getPath()+ " "+ disk.getPath());
    }
  }
 else {
    disk=new KVMPhysicalDisk(destPool.getSourceDir() + "/" + newUuid,newUuid,destPool);
    disk.setFormat(format);
    disk.setSize(template.getVirtualSize());
    disk.setVirtualSize(disk.getSize());
    if (srcPool.getType() != StoragePoolType.RBD) {
      Script.runSimpleBashScript("qemu-img convert" + " -f " + template.getFormat() + " -O "+ format+ " "+ template.getPath()+ " "+ KVMPhysicalDisk.RBDStringBuilder(destPool.getSourceHost(),destPool.getSourcePort(),destPool.getAuthUserName(),destPool.getAuthSecret(),disk.getPath()));
    }
 else {
      template.setFormat(PhysicalDiskFormat.RAW);
      Script.runSimpleBashScript("qemu-img convert" + " -f " + template.getFormat() + " -O "+ format+ " "+ KVMPhysicalDisk.RBDStringBuilder(srcPool.getSourceHost(),srcPool.getSourcePort(),srcPool.getAuthUserName(),srcPool.getAuthSecret(),template.getPath())+ " "+ KVMPhysicalDisk.RBDStringBuilder(destPool.getSourceHost(),destPool.getSourcePort(),destPool.getAuthUserName(),destPool.getAuthSecret(),disk.getPath()));
    }
  }
  return disk;
}
