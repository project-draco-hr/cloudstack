{
  if (!_reconnectAllowed) {
    return;
  }
synchronized (this) {
    if (_startup != null) {
      _startup.cancel();
      _startup=null;
    }
  }
  link.close();
  link.terminated();
  setLink(null);
  cancelTasks();
  _resource.disconnected();
  while (true) {
    _shell.getBackoffAlgorithm().waitBeforeRetry();
    s_logger.info("Lost connection to the server.  Reconnecting....");
    int inProgress=0;
    if ((inProgress=_inProgress.get()) > 0) {
      s_logger.info("Cannot connect because we still have " + inProgress + " commands in progress.");
      continue;
    }
    try {
      final SocketChannel sch=SocketChannel.open();
      sch.configureBlocking(false);
      sch.connect(link.getSocketAddress());
      link.connect(sch);
      return;
    }
 catch (    final IOException e) {
      s_logger.error("Unable to establish connection with the server",e);
    }
  }
}
