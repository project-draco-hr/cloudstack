{
  String text=this.layout.format(event);
  String trace="";
  if (event.throwable != null) {
    event.throwable.printStackTrace(tp);
    for (int i=0; i < sw.getBuffer().length(); i++) {
      if (sw.getBuffer().charAt(i) == '\t')       sw.getBuffer().replace(i,i + 1,"        ");
    }
    trace=sw.toString();
    sw.getBuffer().delete(0,sw.getBuffer().length());
  }
  try {
    if (fancy) {
      textpane.setEditable(true);
      textpane.insertIcon((ImageIcon)icons.get(event.priority));
      textpane.setEditable(false);
    }
    doc.insertString(doc.getLength(),text + trace,(MutableAttributeSet)attributes.get(event.priority));
  }
 catch (  BadLocationException badex) {
    System.err.println(badex);
  }
  textpane.setCaretPosition(doc.getLength());
}
