{
  byte[] imgBits;
  if (init)   imgBits=getFrameBufferJpeg();
 else   imgBits=getTilesMergedJpeg(tiles,tracker.getTileWidth(),tracker.getTileHeight());
  if (imgBits == null) {
    s_logger.warn("Unable to generate jpeg image");
  }
 else {
    if (s_logger.isTraceEnabled())     s_logger.trace("Generated jpeg image size: " + imgBits.length);
  }
  int key=ajaxImageCache.putImage(imgBits);
  StringBuffer sb=new StringBuffer("/ajaximg?host=");
  sb.append(getClientHostAddress()).append("&port=").append(getClientHostPort()).append("&sid=").append(getClientHostPassword());
  sb.append("&key=").append(key).append("&tag=").append(this.getClientTag());
  sb.append("&ts=").append(System.currentTimeMillis());
  return sb.toString();
}
