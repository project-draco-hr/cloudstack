{
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("testing if vm (" + vm.getId() + ") is alive");
  }
  if (VirtualMachine.Type.isSystemVM(vm.getType())) {
    Nic nic=_networkMgr.getNicForTraffic(vm.getId(),TrafficType.Management);
    if (nic == null) {
      if (s_logger.isDebugEnabled()) {
        s_logger.debug("Unable to find a management nic, cannot ping this system VM, unable to determine state of vm (" + vm.getId() + "), returning null");
      }
      return null;
    }
    HostVO vmHost=_hostDao.findById(vm.getHostId());
    List<Long> otherHosts=findHostByPod(vm.getPodId(),vm.getHostId());
    for (    Long otherHost : otherHosts) {
      Status vmState=testIpAddress(otherHost,vm.getPrivateIpAddress());
      if (vmState == null) {
        continue;
      }
      if (vmState == Status.Up) {
        if (s_logger.isDebugEnabled()) {
          s_logger.debug("successfully pinged vm's private IP (" + vm.getPrivateIpAddress() + "), returning that the VM is up");
        }
        return Boolean.TRUE;
      }
 else       if (vmState == Status.Down) {
        Status vmHostState=testIpAddress(otherHost,vmHost.getPrivateIpAddress());
        if ((vmHostState != null) && (vmHostState == Status.Up)) {
          if (s_logger.isDebugEnabled()) {
            s_logger.debug("successfully pinged vm's host IP (" + vmHost.getPrivateIpAddress() + "), but could not ping VM, returning that the VM is down");
          }
          return Boolean.FALSE;
        }
      }
    }
  }
 else {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Not a System Vm, unable to determine state of vm (" + vm.getId() + "), returning null");
    }
  }
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("unable to determine state of vm (" + vm.getId() + "), returning null");
  }
  return null;
}
