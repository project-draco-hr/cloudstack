{
  boolean processed=false;
  for (  Command cmd : req) {
    if (cmd instanceof PingRoutingCommand) {
      PingRoutingCommand ping=(PingRoutingCommand)cmd;
      if (ping.getNewStates().size() > 0) {
        List<Command> commands=_haMgr.deltaSync(agentId,ping.getNewStates());
        if (commands.size() > 0) {
          try {
            Commands cmds=new Commands(OnError.Continue);
            cmds.addCommands(commands);
            _agentMgr.send(agentId,cmds,this);
          }
 catch (          final AgentUnavailableException e) {
            s_logger.warn("Agent is now unavailable",e);
          }
        }
      }
      processed=true;
    }
  }
  return processed;
}
