{
  final String factory=_ldapConfiguration.getFactory();
  final String url=providerUrl == null ? _ldapConfiguration.getProviderUrl() : providerUrl;
  final String authentication=_ldapConfiguration.getAuthentication();
  final boolean sslStatus=_ldapConfiguration.getSSLStatus();
  final Hashtable<String,String> environment=new Hashtable<String,String>();
  environment.put(Context.INITIAL_CONTEXT_FACTORY,factory);
  environment.put(Context.PROVIDER_URL,url);
  environment.put("com.sun.jndi.ldap.read.timeout","500");
  environment.put("com.sun.jndi.ldap.connect.pool","true");
  if (sslStatus) {
    environment.put(Context.SECURITY_PROTOCOL,"ssl");
    System.setProperty("javax.net.ssl.trustStore",_ldapConfiguration.getTrustStore());
    System.setProperty("javax.net.ssl.trustStorePassword",_ldapConfiguration.getTrustStorePassword());
  }
  if ("none".equals(authentication) && !isSystemContext) {
    environment.put(Context.SECURITY_AUTHENTICATION,"simple");
  }
 else {
    environment.put(Context.SECURITY_AUTHENTICATION,authentication);
  }
  if (principal != null) {
    environment.put(Context.SECURITY_PRINCIPAL,principal);
  }
  if (password != null) {
    environment.put(Context.SECURITY_CREDENTIALS,password);
  }
  return environment;
}
