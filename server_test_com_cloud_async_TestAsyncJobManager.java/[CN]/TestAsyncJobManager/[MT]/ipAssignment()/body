{
  final IPAddressDao ipAddressDao=new IPAddressDaoImpl();
  final ConcurrentHashMap<String,IPAddressVO> map=new ConcurrentHashMap<String,IPAddressVO>();
  s_count=0;
  final long maxCount=1000000;
  Thread t1=new Thread(new Runnable(){
    public void run(){
      while (s_count < maxCount) {
        s_count++;
        Transaction txn=Transaction.open("Alex1");
        try {
          IPAddressVO addr=ipAddressDao.assignIpAddress(1,0,1,false);
          IPAddressVO returnStr=map.put(addr.getAddress(),addr);
          if (returnStr != null) {
            System.out.println("addr : " + addr.getAddress());
          }
          Assert.assertTrue(returnStr == null);
        }
  finally {
          txn.close();
        }
      }
    }
  }
);
  Thread t2=new Thread(new Runnable(){
    public void run(){
      while (s_count < maxCount) {
        s_count++;
        Transaction txn=Transaction.open("Alex2");
        try {
          IPAddressVO addr=ipAddressDao.assignIpAddress(1,0,1,false);
          Assert.assertTrue(map.put(addr.getAddress(),addr) == null);
        }
  finally {
          txn.close();
        }
      }
    }
  }
);
  t1.start();
  t2.start();
  try {
    t1.join();
    t2.join();
  }
 catch (  InterruptedException e) {
  }
}
