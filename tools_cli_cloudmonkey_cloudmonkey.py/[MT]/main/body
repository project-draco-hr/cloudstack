def main():
    self = CloudMonkeyShell
    global grammar
    for rule in grammar:

        def add_grammar(rule):

            def grammar_closure(self, args):
                if self.pipe_runner(('%s %s' % (rule, args))):
                    return
                try:
                    args_partition = args.partition(' ')
                    res = self.cache_verbs[rule][args_partition[0]]
                    cmd = res[0]
                    helpdoc = res[2]
                    args = args_partition[2]
                except KeyError as e:
                    self.print_shell(('Error: invalid %s api arg' % rule), e)
                    return
                if ((' --help' in args) or (' -h' in args)):
                    self.print_shell(helpdoc)
                    return
                self.default(('%s %s' % (cmd, args)))
            return grammar_closure
        grammar_handler = add_grammar(rule)
        grammar_handler.__doc__ = ('%ss resources' % rule.capitalize())
        grammar_handler.__name__ = ('do_' + rule)
        setattr(self, grammar_handler.__name__, grammar_handler)
    shell = CloudMonkeyShell(sys.argv[0])
    if (len(sys.argv) > 1):
        shell.onecmd(' '.join(sys.argv[1:]))
    else:
        shell.cmdloop()
