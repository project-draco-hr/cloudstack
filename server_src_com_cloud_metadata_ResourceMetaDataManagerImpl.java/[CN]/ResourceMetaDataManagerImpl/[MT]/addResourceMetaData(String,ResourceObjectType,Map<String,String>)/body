{
  return Transaction.execute(new TransactionCallback<Boolean>(){
    @Override public Boolean doInTransaction(    TransactionStatus status){
      for (      String key : details.keySet()) {
        String value=details.get(key);
        if (value == null || value.isEmpty()) {
          throw new InvalidParameterValueException("Value for the key " + key + " is either null or empty");
        }
        if (!resourceType.resourceMetadataSupport()) {
          throw new InvalidParameterValueException("The resource type " + resourceType + " doesn't support metadata (resource details)");
        }
        long id=_taggedResourceMgr.getResourceId(resourceId,resourceType);
        if (resourceType == ResourceObjectType.Volume) {
          VolumeDetailVO v=new VolumeDetailVO(id,key,value);
          _volumeDetailDao.persist(v);
        }
 else         if (resourceType == ResourceObjectType.Nic) {
          NicDetailVO n=new NicDetailVO(id,key,value);
          _nicDetailDao.persist(n);
        }
 else         if (resourceType == ResourceObjectType.Zone) {
          DcDetailVO dataCenterDetail=new DcDetailVO(id,key,value);
          _dcDetailsDao.persist(dataCenterDetail);
        }
 else         if (resourceType == ResourceObjectType.Network) {
          NetworkDetailVO networkDetail=new NetworkDetailVO(id,key,value);
          _networkDetailsDao.persist(networkDetail);
        }
 else         if (resourceType == ResourceObjectType.UserVm) {
          _userVmDetailsDao.addVmDetail(id,key,value);
        }
 else         if (resourceType == ResourceObjectType.Template) {
          _templateDetailsDao.addTemplateDetail(id,key,value);
        }
 else         if (resourceType == ResourceObjectType.ServiceOffering) {
          ServiceOfferingDetailsVO entity=new ServiceOfferingDetailsVO(id,key,value);
          _serviceOfferingDetailsDao.persist(entity);
        }
      }
      return true;
    }
  }
);
}
