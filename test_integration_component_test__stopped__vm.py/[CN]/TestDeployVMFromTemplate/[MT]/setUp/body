def setUp(self):
    self.apiclient = self.testClient.getApiClient()
    self.hypervisor = self.testClient.getHypervisorInfo()
    self.dbclient = self.testClient.getDbConnection()
    self.services = Services().services
    self.services['virtual_machine']['zoneid'] = self.zone.id
    self.account = Account.create(self.apiclient, self.services['account'], domainid=self.domain.id)
    builtin_info = get_builtin_template_info(self.apiclient, self.zone.id)
    self.services['template']['url'] = builtin_info[0]
    self.services['template']['hypervisor'] = builtin_info[1]
    self.services['template']['format'] = builtin_info[2]
    self.template = Template.register(self.apiclient, self.services['template'], zoneid=self.zone.id, account=self.account.name, domainid=self.account.domainid, hypervisor=self.hypervisor)
    self.debug(('Registered a template of format: %s with ID: %s' % (self.services['template']['format'], self.template.id)))
    try:
        self.template.download(self.apiclient)
    except Exception as e:
        raise Exception(('Template download failed: %s' % e))
    self.cleanup = [self.account]
    return
