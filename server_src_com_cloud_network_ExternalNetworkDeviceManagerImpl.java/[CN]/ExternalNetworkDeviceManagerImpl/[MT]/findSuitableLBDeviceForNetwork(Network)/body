{
  long physicalNetworkId=network.getPhysicalNetworkId();
  List<ExternalLoadBalancerDeviceVO> lbDevices=_externalLoadBalancerDeviceDao.listByPhysicalNetwork(physicalNetworkId);
  for (  ExternalLoadBalancerDeviceVO lbdevice : lbDevices) {
    long fullCapacity=lbdevice.getCapacity();
    List<NetworkExternalLoadBalancerVO> mappedNetworks=_networkExternalLBDao.listByLBDeviceId(lbdevice.getId());
    long usedCapacity=(mappedNetworks == null) ? 0 : mappedNetworks.size();
    if ((fullCapacity - usedCapacity) > 0) {
      return lbdevice.getId();
    }
  }
  throw new InsufficientNetworkCapacityException("Unable to find a load balancing provider with sufficient capcity " + " to implement the network",Network.class,network.getId());
}
