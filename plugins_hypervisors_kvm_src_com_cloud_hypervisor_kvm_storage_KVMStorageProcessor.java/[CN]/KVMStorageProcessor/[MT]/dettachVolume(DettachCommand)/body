{
  DiskTO disk=cmd.getDisk();
  VolumeObjectTO vol=(VolumeObjectTO)disk.getData();
  PrimaryDataStoreTO primaryStore=(PrimaryDataStoreTO)vol.getDataStore();
  String vmName=vol.getVmName();
  try {
    Connect conn=LibvirtConnection.getConnectionByVmName(vmName);
    KVMStoragePool primary=storagePoolMgr.getStoragePool(primaryStore.getPoolType(),primaryStore.getUuid());
    KVMPhysicalDisk phyDisk=primary.getPhysicalDisk(vol.getPath());
    attachOrDetachDisk(conn,false,vmName,phyDisk,disk.getDiskSeq().intValue());
    return new DettachAnswer(disk);
  }
 catch (  LibvirtException e) {
    s_logger.debug("Failed to attach volume: " + vol.getPath() + ", due to "+ e.toString());
    return new DettachAnswer(e.toString());
  }
catch (  InternalErrorException e) {
    s_logger.debug("Failed to attach volume: " + vol.getPath() + ", due to "+ e.toString());
    return new DettachAnswer(e.toString());
  }
}
