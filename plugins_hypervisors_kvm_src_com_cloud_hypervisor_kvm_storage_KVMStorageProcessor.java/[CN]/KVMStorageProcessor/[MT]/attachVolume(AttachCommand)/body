{
  DiskTO disk=cmd.getDisk();
  VolumeObjectTO vol=(VolumeObjectTO)disk.getData();
  PrimaryDataStoreTO primaryStore=(PrimaryDataStoreTO)vol.getDataStore();
  String vmName=cmd.getVmName();
  try {
    Connect conn=LibvirtConnection.getConnectionByVmName(vmName);
    storagePoolMgr.connectPhysicalDisk(primaryStore.getPoolType(),primaryStore.getUuid(),vol.getPath(),disk.getDetails());
    KVMPhysicalDisk phyDisk=storagePoolMgr.getPhysicalDisk(primaryStore.getPoolType(),primaryStore.getUuid(),vol.getPath());
    attachOrDetachDisk(conn,true,vmName,phyDisk,disk.getDiskSeq().intValue());
    return new AttachAnswer(disk);
  }
 catch (  LibvirtException e) {
    s_logger.debug("Failed to attach volume: " + vol.getPath() + ", due to ",e);
    storagePoolMgr.disconnectPhysicalDisk(primaryStore.getPoolType(),primaryStore.getUuid(),vol.getPath());
    return new AttachAnswer(e.toString());
  }
catch (  InternalErrorException e) {
    s_logger.debug("Failed to attach volume: " + vol.getPath() + ", due to ",e);
    return new AttachAnswer(e.toString());
  }
}
