{
  try {
    DataTO srcData=cmd.getSrcTO();
    SnapshotObjectTO snapshot=(SnapshotObjectTO)srcData;
    DataTO destData=cmd.getDestTO();
    PrimaryDataStoreTO pool=(PrimaryDataStoreTO)destData.getDataStore();
    DataStoreTO imageStore=srcData.getDataStore();
    if (!(imageStore instanceof NfsTO)) {
      return new CopyCmdAnswer("unsupported protocol");
    }
    NfsTO nfsImageStore=(NfsTO)imageStore;
    String snapshotPath=snapshot.getPath();
    int index=snapshotPath.lastIndexOf("/");
    snapshotPath=snapshotPath.substring(0,index);
    String snapshotName=snapshotPath.substring(index + 1);
    KVMStoragePool secondaryPool=storagePoolMgr.getStoragePoolByURI(nfsImageStore.getUrl() + File.separator + snapshotPath);
    KVMPhysicalDisk snapshotDisk=secondaryPool.getPhysicalDisk(snapshotName);
    String primaryUuid=pool.getUuid();
    KVMStoragePool primaryPool=storagePoolMgr.getStoragePool(pool.getPoolType(),primaryUuid);
    String volUuid=UUID.randomUUID().toString();
    KVMPhysicalDisk disk=storagePoolMgr.copyPhysicalDisk(snapshotDisk,volUuid,primaryPool);
    VolumeObjectTO newVol=new VolumeObjectTO();
    newVol.setPath(disk.getName());
    newVol.setSize(disk.getVirtualSize());
    return new CopyCmdAnswer(newVol);
  }
 catch (  CloudRuntimeException e) {
    return new CopyCmdAnswer(e.toString());
  }
}
