{
  String secondaryMountPoint=mountService.getMountPoint(secStorageUrl);
  String exportPath=secondaryMountPoint + "/" + secStorageDir+ "/"+ exportName;
synchronized (exportPath.intern()) {
    if (!new File(exportPath).exists()) {
      Script command=new Script(false,"mkdir",_timeout,s_logger);
      command.add("-p");
      command.add(exportPath);
      if (command.execute() != null) {
        throw new Exception("unable to prepare snapshot backup directory");
      }
    }
  }
  VirtualMachineMO clonedVm=null;
  try {
    Pair<VirtualDisk,String> volumeDeviceInfo=vmMo.getDiskDevice(volumePath);
    if (volumeDeviceInfo == null) {
      String msg="Unable to find related disk device for volume. volume path: " + volumePath;
      s_logger.error(msg);
      throw new Exception(msg);
    }
    Pair<VirtualMachineMO,String[]> cloneResult=vmMo.cloneFromCurrentSnapshot(workerVmName,0,4,volumeDeviceInfo.second(),VmwareHelper.getDiskDeviceDatastore(volumeDeviceInfo.first()));
    clonedVm=cloneResult.first();
    String disks[]=cloneResult.second();
    clonedVm.exportVm(exportPath,exportName,false,false);
    return new Pair<String,String[]>(volumeDeviceInfo.second(),disks);
  }
  finally {
    if (clonedVm != null) {
      clonedVm.detachAllDisks();
      clonedVm.destroy();
    }
  }
}
