{
  long ipId=lb.getSourceIpAddressId();
  IPAddressVO ipAddr=_ipAddressDao.findById(ipId);
  Long networkId=ipAddr.getSourceNetworkId();
  NetworkVO network=_networkDao.findById(networkId);
  DomainRouterVO elbVm=null;
  if (network.getGuestType() == GuestIpType.Direct) {
    LoadBalancerVO lbvo;
    lbvo=_lbDao.findByAccountAndName(account.getId(),lb.getName());
    if (lbvo == null) {
      elbVm=findELBVmWithCapacity(network,ipAddr);
      if (elbVm == null) {
        elbVm=deployLoadBalancerVM(networkId,ipAddr,account.getId());
      }
      IPAddressVO ipvo=_ipAddressDao.findById(ipId);
      ipvo.setAssociatedWithNetworkId(networkId);
      _ipAddressDao.update(ipvo.getId(),ipvo);
    }
  }
}
