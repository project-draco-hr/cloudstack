{
  Long domainId=(Long)params.get("domainid");
  Account account=(Account)params.get("accountobj");
  String accountName=(String)params.get("account");
  Long accountId=null;
  Account finalAccount=null;
  ManagementServer managementServer=getManagementServer();
  if ((account == null) || isAdmin(account.getType())) {
    if (domainId != null) {
      if ((account != null) && !managementServer.isChildDomain(account.getDomainId(),domainId)) {
        throw new ServerApiException(PARAM_ERROR,"Invalid domain id (" + domainId + ") ");
      }
      if (accountName != null) {
        Account userAccount=managementServer.findActiveAccount(accountName,domainId);
        if (userAccount == null) {
          throw new ServerApiException(PARAM_ERROR,"Unable to find account " + accountName + " in domain "+ domainId);
        }
        accountId=userAccount.getId();
      }
    }
 else {
      accountId=((account != null) ? account.getId() : null);
    }
  }
 else {
    accountId=account.getId();
  }
  if (accountId != null) {
    finalAccount=managementServer.findAccountById(accountId);
  }
  return finalAccount;
}
