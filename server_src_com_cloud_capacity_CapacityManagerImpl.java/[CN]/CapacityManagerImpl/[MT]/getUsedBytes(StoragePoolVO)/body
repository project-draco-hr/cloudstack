{
  long usedBytes=0;
  List<VolumeVO> volumes=_volumeDao.findByPoolId(pool.getId(),null);
  if (volumes != null && volumes.size() > 0) {
    DataStoreProvider storeProvider=_dataStoreProviderMgr.getDataStoreProvider(pool.getStorageProviderName());
    DataStoreDriver storeDriver=storeProvider.getDataStoreDriver();
    PrimaryDataStoreDriver primaryStoreDriver=null;
    if (storeDriver instanceof PrimaryDataStoreDriver) {
      primaryStoreDriver=(PrimaryDataStoreDriver)storeDriver;
    }
    for (    VolumeVO volume : volumes) {
      if (primaryStoreDriver != null) {
        usedBytes+=primaryStoreDriver.getVolumeSizeIncludingHypervisorSnapshotReserve(volume,pool);
      }
 else {
        usedBytes+=volume.getSize();
      }
    }
  }
  return usedBytes;
}
