{
  DataTO obj=cmd.getData();
  DataStoreTO dstore=obj.getDataStore();
  if (dstore instanceof NfsTO) {
    NfsTO nfs=(NfsTO)dstore;
    String snapshotPath=obj.getPath();
    if (snapshotPath.startsWith(File.separator)) {
      snapshotPath=snapshotPath.substring(1);
    }
    int index=snapshotPath.lastIndexOf("/");
    String snapshotName=snapshotPath.substring(index + 1);
    snapshotPath=snapshotPath.substring(0,index);
    String parent=getRootDir(nfs.getUrl());
    if (!parent.endsWith(File.separator)) {
      parent+=File.separator;
    }
    String absoluteSnapshotPath=parent + snapshotPath;
    File snapshotDir=new File(absoluteSnapshotPath);
    String details=null;
    if (!snapshotDir.exists()) {
      details="snapshot directory " + snapshotDir.getName() + " doesn't exist";
      s_logger.debug(details);
      return new Answer(cmd,false,details);
    }
    String lPath=absoluteSnapshotPath + "/*" + snapshotName+ "*";
    String result=deleteLocalFile(lPath);
    if (result != null) {
      details="failed to delete snapshot " + lPath + " , err="+ result;
      s_logger.warn(details);
      return new Answer(cmd,false,details);
    }
    return new Answer(cmd,true,null);
  }
 else   if (dstore instanceof S3TO) {
    final S3TO s3=(S3TO)dstore;
    final String path=obj.getPath();
    final String bucket=s3.getBucketName();
    try {
      S3Utils.deleteObject(s3,bucket,path);
      return new Answer(cmd,true,String.format("Deleted snapshot %1%s from bucket %2$s.",path,bucket));
    }
 catch (    Exception e) {
      final String errorMessage=String.format("Failed to delete snapshot %1$s from bucket %2$s due to the following error: %3$s",path,bucket,e.getMessage());
      s_logger.error(errorMessage,e);
      return new Answer(cmd,false,errorMessage);
    }
  }
 else   if (dstore instanceof SwiftTO) {
    String path=obj.getPath();
    String filename=StringUtils.substringAfterLast(path,"/");
    String volumeId=StringUtils.substringAfterLast(StringUtils.substringBeforeLast(path,"/"),"/");
    String result=swiftDelete((SwiftTO)dstore,"V-" + volumeId,filename);
    if (result != null) {
      String errMsg="failed to delete snapshot " + filename + " , err="+ result;
      s_logger.warn(errMsg);
      return new Answer(cmd,false,errMsg);
    }
    return new Answer(cmd,true,"Deleted snapshot " + path + " from swift");
  }
 else {
    return new Answer(cmd,false,"Unsupported image data store: " + dstore);
  }
}
