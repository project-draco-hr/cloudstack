{
  SwiftTO swiftTO=(SwiftTO)cmd.getDataStore();
  String path=cmd.getInstallPath();
  DataStoreTO cacheStore=cmd.getCacheStore();
  if (cacheStore == null || !(cacheStore instanceof NfsTO)) {
    return new DownloadAnswer("cache store can't be null",VMTemplateStorageResourceAssoc.Status.DOWNLOAD_ERROR);
  }
  try {
    NfsTO nfsCacheStore=(NfsTO)cacheStore;
    File file=downloadFromUrlToNfs(cmd.getUrl(),nfsCacheStore,path);
    String swiftPath=SwiftUtil.putObject(swiftTO,file,"T-" + cmd.getId());
    String md5sum=null;
    try {
      md5sum=DigestUtils.md5Hex(new FileInputStream(file));
    }
 catch (    IOException e) {
      s_logger.debug("Failed to get md5sum: " + file.getAbsoluteFile());
    }
    file.delete();
    return new DownloadAnswer(null,100,null,VMTemplateStorageResourceAssoc.Status.DOWNLOADED,swiftPath,swiftPath,file.length(),file.length(),md5sum);
  }
 catch (  Exception e) {
    s_logger.debug("Failed to register template into swift",e);
    return new DownloadAnswer(e.toString(),VMTemplateStorageResourceAssoc.Status.DOWNLOAD_ERROR);
  }
}
