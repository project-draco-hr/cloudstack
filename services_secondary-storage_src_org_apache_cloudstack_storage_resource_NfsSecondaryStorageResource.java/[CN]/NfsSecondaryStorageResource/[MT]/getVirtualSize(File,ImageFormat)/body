{
  Processor processor=null;
  try {
    if (format == null) {
      return file.length();
    }
 else     if (format == ImageFormat.QCOW2) {
      processor=new QCOW2Processor();
    }
 else     if (format == ImageFormat.OVA) {
      processor=new VmdkProcessor();
    }
 else     if (format == ImageFormat.VHD) {
      processor=new VhdProcessor();
    }
    if (processor == null) {
      return file.length();
    }
    processor.configure("template processor",new HashMap<String,Object>());
    return processor.getVirtualSize(file);
  }
 catch (  Exception e) {
    s_logger.debug("Failed to get virtual size:",e);
  }
  return file.length();
}
