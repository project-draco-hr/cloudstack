{
  try {
    ServerResource resource=_resource;
    if (resource != null) {
      if (resource.IsRemoteAgent()) {
        return;
      }
      PingCommand cmd=resource.getCurrentStatus(_id);
      if (cmd == null) {
        s_logger.warn("Unable to get current status on " + _id);
        _mgr.disconnect(DirectAgentAttache.this,Event.AgentDisconnected,true);
        return;
      }
      if (s_logger.isDebugEnabled()) {
        s_logger.debug("Ping from " + _id);
      }
      long seq=_seq++;
      if (s_logger.isTraceEnabled()) {
        s_logger.trace("SeqA " + _id + "-"+ seq+ ": "+ new Request(seq,_id,-1,cmd,false).toString());
      }
      _mgr.handleCommands(DirectAgentAttache.this,seq,new Command[]{cmd});
    }
 else {
      s_logger.debug("Unable to send ping because agent is disconnected " + _id);
    }
  }
 catch (  Exception e) {
    s_logger.warn("Unable to complete the ping task",e);
  }
}
