{
  if (s_logger.isInfoEnabled()) {
    s_logger.info("Executing resource assignVPCPublicIpAddress. domrName: " + domrName + ", routerIp: "+ routerIp+ ", ip: "+ _gson.toJson(ip));
  }
  VmwareManager mgr=getServiceContext().getStockObject(VmwareManager.CONTEXT_STOCK_NAME);
  int ethDeviceNum=this.findRouterEthDeviceIndex(domrName,routerIp,ip.getVifMacAddress());
  if (ethDeviceNum < 0) {
    throw new InternalErrorException("Failed to find DomR VIF to associate/disassociate IP with.");
  }
  String args="";
  if (ip.isAdd()) {
    args+=" -A ";
  }
 else {
    args+=" -D ";
  }
  args+=" -l ";
  args+=ip.getPublicIp();
  args+=" -c ";
  args+="eth" + ethDeviceNum;
  args+=" -g ";
  args+=ip.getVlanGateway();
  args+=" -m ";
  args+=Long.toString(NetUtils.getCidrSize(ip.getVlanNetmask()));
  args+=" -n ";
  args+=NetUtils.getSubNet(ip.getPublicIp(),ip.getVlanNetmask());
  Pair<Boolean,String> result=SshHelper.sshExecute(routerIp,DEFAULT_DOMR_SSHPORT,"root",mgr.getSystemVMKeyFile(),null,"/opt/cloud/bin/vpc_ipassoc.sh " + args);
  if (!result.first()) {
    throw new InternalErrorException("Unable to assign public IP address");
  }
}
