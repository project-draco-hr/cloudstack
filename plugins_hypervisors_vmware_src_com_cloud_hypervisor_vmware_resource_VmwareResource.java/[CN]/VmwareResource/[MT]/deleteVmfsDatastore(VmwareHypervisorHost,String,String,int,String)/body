{
  VmwareContext context=getServiceContext();
  ManagedObjectReference morCluster=hyperHost.getHyperHostCluster();
  ClusterMO cluster=new ClusterMO(context,morCluster);
  List<Pair<ManagedObjectReference,String>> lstHosts=cluster.getClusterHosts();
  HostInternetScsiHbaStaticTarget target=new HostInternetScsiHbaStaticTarget();
  target.setAddress(storageIpAddress);
  target.setPort(storagePortNumber);
  target.setIScsiName(iqn);
  final List<HostInternetScsiHbaStaticTarget> lstTargets=new ArrayList<HostInternetScsiHbaStaticTarget>();
  lstTargets.add(target);
  final List<Thread> threads=new ArrayList<Thread>();
  final List<Exception> exceptions=new ArrayList<Exception>();
  for (  Pair<ManagedObjectReference,String> hostPair : lstHosts) {
    final HostMO host=new HostMO(context,hostPair.first());
    final HostStorageSystemMO hostStorageSystem=host.getHostStorageSystemMO();
    for (    HostHostBusAdapter hba : hostStorageSystem.getStorageDeviceInfo().getHostBusAdapter()) {
      if (hba instanceof HostInternetScsiHba) {
        final String iScsiHbaDevice=hba.getDevice();
        Thread thread=new Thread(){
          public void run(){
            try {
              hostStorageSystem.removeInternetScsiStaticTargets(iScsiHbaDevice,lstTargets);
              hostStorageSystem.rescanHba(iScsiHbaDevice);
            }
 catch (            Exception ex) {
              exceptions.add(ex);
            }
          }
        }
;
        threads.add(thread);
        thread.start();
      }
    }
  }
  for (  Thread thread : threads) {
    thread.join();
  }
  if (exceptions.size() > 0) {
    throw new Exception(exceptions.get(0).getMessage());
  }
}
