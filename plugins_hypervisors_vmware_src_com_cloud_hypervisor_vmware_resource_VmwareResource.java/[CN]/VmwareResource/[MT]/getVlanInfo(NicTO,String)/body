{
  if (nicTo.getBroadcastType() == BroadcastDomainType.Native) {
    return defaultVlan;
  }
 else   if (nicTo.getBroadcastType() == BroadcastDomainType.Vlan || nicTo.getBroadcastType() == BroadcastDomainType.Pvlan) {
    if (nicTo.getBroadcastUri() != null) {
      if (nicTo.getBroadcastType() == BroadcastDomainType.Vlan)       return BroadcastDomainType.getValue(nicTo.getBroadcastUri());
 else       return NetUtils.getPrimaryPvlanFromUri(nicTo.getBroadcastUri());
    }
 else {
      s_logger.warn("BroadcastType is not claimed as VLAN or PVLAN, but without vlan info in broadcast URI. Use vlan info from labeling: " + defaultVlan);
      return defaultVlan;
    }
  }
 else   if (nicTo.getBroadcastType() == BroadcastDomainType.Lswitch) {
    return null;
  }
 else   if (nicTo.getBroadcastType() == BroadcastDomainType.Storage) {
    URI broadcastUri=nicTo.getBroadcastUri();
    if (broadcastUri != null) {
      String vlanId=BroadcastDomainType.getValue(broadcastUri);
      s_logger.debug("Using VLAN [" + vlanId + "] from broadcast uri ["+ broadcastUri+ "]");
      return vlanId;
    }
  }
  s_logger.warn("Unrecognized broadcast type in VmwareResource, type: " + nicTo.getBroadcastType().toString() + ". Use vlan info from labeling: "+ defaultVlan);
  return defaultVlan;
}
