{
  if (nicTo.getBroadcastType() == BroadcastDomainType.Native) {
    return defaultVlan;
  }
  if (nicTo.getBroadcastType() == BroadcastDomainType.Vlan || nicTo.getBroadcastType() == BroadcastDomainType.Pvlan) {
    if (nicTo.getBroadcastUri() != null) {
      if (nicTo.getBroadcastType() == BroadcastDomainType.Vlan)       return nicTo.getBroadcastUri().getHost();
 else       return NetUtils.getPrimaryPvlanFromUri(nicTo.getBroadcastUri());
    }
 else {
      s_logger.warn("BroadcastType is not claimed as VLAN or PVLAN, but without vlan info in broadcast URI. Use vlan info from labeling: " + defaultVlan);
      return defaultVlan;
    }
  }
  s_logger.warn("Unrecognized broadcast type in VmwareResource, type: " + nicTo.getBroadcastType().toString() + ". Use vlan info from labeling: "+ defaultVlan);
  return defaultVlan;
}
