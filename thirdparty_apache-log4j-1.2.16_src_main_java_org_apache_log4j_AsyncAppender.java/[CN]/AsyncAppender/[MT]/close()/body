{
synchronized (buffer) {
    closed=true;
    buffer.notifyAll();
  }
  try {
    dispatcher.join();
  }
 catch (  InterruptedException e) {
    Thread.currentThread().interrupt();
    org.apache.log4j.helpers.LogLog.error("Got an InterruptedException while waiting for the " + "dispatcher to finish.",e);
  }
synchronized (appenders) {
    Enumeration iter=appenders.getAllAppenders();
    if (iter != null) {
      while (iter.hasMoreElements()) {
        Object next=iter.nextElement();
        if (next instanceof Appender) {
          ((Appender)next).close();
        }
      }
    }
  }
}
