def deployvm_in_network(self, vpc, networkid):
    try:
        self.services['virtual_machine']['networkids'] = networkid
        vm = VirtualMachine.create(self.apiclient, services=self.services['virtual_machine'], templateid=self.template.id, zoneid=self.zone.id, accountid=self.account.name, domainid=self.domain.id, serviceofferingid=self.compute_offering.id, hypervisor=self.services['template_kvm']['hypervisor'])
        self.assertIsNotNone(vm, ('Failed to deploy vm in network: %s' % networkid))
        self.assert_((vm.state == 'Running'), 'VM is not running')
        self.logger.debug(('Deployed VM id: %s in VPC %s' % (vm.id, vpc.id)))
        return vm
    except Exception as e:
        raise Exception(('Deployment failed of VM: %s' % e))
