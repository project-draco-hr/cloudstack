{
  long entityId=cmd.getEntityId();
  if (uploadEntityStateMap.containsKey(entityId)) {
    UploadEntity uploadEntity=uploadEntityStateMap.get(entityId);
    if (uploadEntity.getUploadState() == UploadEntity.Status.ERROR) {
      uploadEntityStateMap.remove(entityId);
      return new UploadStatusAnswer(cmd,UploadStatus.ERROR,uploadEntity.getErrorMessage());
    }
 else     if (uploadEntity.getUploadState() == UploadEntity.Status.COMPLETED) {
      UploadStatusAnswer answer=new UploadStatusAnswer(cmd,UploadStatus.COMPLETED);
      answer.setVirtualSize(uploadEntity.getVirtualSize());
      answer.setInstallPath(uploadEntity.getTmpltPath());
      answer.setPhysicalSize(uploadEntity.getEntitysize());
      uploadEntityStateMap.remove(entityId);
      return answer;
    }
 else     if (uploadEntity.getUploadState() == UploadEntity.Status.IN_PROGRESS) {
      return new UploadStatusAnswer(cmd,UploadStatus.IN_PROGRESS);
    }
  }
  return new UploadStatusAnswer(cmd,UploadStatus.UNKNOWN);
}
