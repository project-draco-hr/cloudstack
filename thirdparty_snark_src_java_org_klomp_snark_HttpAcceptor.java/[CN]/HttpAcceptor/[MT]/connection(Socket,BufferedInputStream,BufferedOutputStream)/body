{
  BufferedReader br=new BufferedReader(new InputStreamReader(bis,ASCII));
  String resource=readRequest(br);
  log.log(Level.FINE,"HTTP request for: " + resource);
  if (resource != null) {
    Map headers=readHeaders(br);
    log.log(Level.FINER,headers.toString());
    if (resource.equals("/")) {
      sendData(bos,SNARKPAGE,"text/html");
    }
 else     if (resource.startsWith("/announce")) {
      Map params=parseParams(resource);
      byte[] response=tracker.handleRequest(sock.getInetAddress(),sock.getPort(),params);
      sendData(bos,response,"application/octet-stream");
    }
 else     if (resource.endsWith(".torrent")) {
      MetaInfo info=tracker.getMetaInfo(resource.substring(1,resource.length() - 8));
      if (info != null) {
        byte[] torrent=info.getTorrentData();
        sendData(bos,torrent,"application/x-bittorrent");
      }
 else {
        sendError(bos,404,"Unable to locate that hash.");
      }
    }
 else {
      sendError(bos,404,"Snark Client. Not a real webserver.");
    }
  }
 else {
    sendError(bos,500,"Snark Client. Not a real webserver.");
  }
  sock.close();
}
