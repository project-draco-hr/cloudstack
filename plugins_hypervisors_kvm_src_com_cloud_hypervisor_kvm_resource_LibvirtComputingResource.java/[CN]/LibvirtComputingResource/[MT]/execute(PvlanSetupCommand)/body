{
  final String primaryPvlan=cmd.getPrimary();
  final String isolatedPvlan=cmd.getIsolated();
  final String op=cmd.getOp();
  final String dhcpName=cmd.getDhcpName();
  final String dhcpMac=cmd.getDhcpMac();
  final String dhcpIp=cmd.getDhcpIp();
  final String vmMac=cmd.getVmMac();
  boolean add=true;
  String opr="-A";
  if (op.equals("delete")) {
    opr="-D";
    add=false;
  }
  String result=null;
  Connect conn;
  try {
    if (cmd.getType() == PvlanSetupCommand.Type.DHCP) {
      final Script script=new Script(_ovsPvlanDhcpHostPath,_timeout,s_logger);
      if (add) {
        conn=LibvirtConnection.getConnectionByVmName(dhcpName);
        final List<InterfaceDef> ifaces=getInterfaces(conn,dhcpName);
        final InterfaceDef guestNic=ifaces.get(0);
        script.add(opr,"-b",_guestBridgeName,"-p",primaryPvlan,"-i",isolatedPvlan,"-n",dhcpName,"-d",dhcpIp,"-m",dhcpMac,"-I",guestNic.getDevName());
      }
 else {
        script.add(opr,"-b",_guestBridgeName,"-p",primaryPvlan,"-i",isolatedPvlan,"-n",dhcpName,"-d",dhcpIp,"-m",dhcpMac);
      }
      result=script.execute();
      if (result != null) {
        s_logger.warn("Failed to program pvlan for dhcp server with mac " + dhcpMac);
        return new Answer(cmd,false,result);
      }
 else {
        s_logger.info("Programmed pvlan for dhcp server with mac " + dhcpMac);
      }
    }
 else     if (cmd.getType() == PvlanSetupCommand.Type.VM) {
      final Script script=new Script(_ovsPvlanVmPath,_timeout,s_logger);
      script.add(opr,"-b",_guestBridgeName,"-p",primaryPvlan,"-i",isolatedPvlan,"-v",vmMac);
      result=script.execute();
      if (result != null) {
        s_logger.warn("Failed to program pvlan for vm with mac " + vmMac);
        return new Answer(cmd,false,result);
      }
 else {
        s_logger.info("Programmed pvlan for vm with mac " + vmMac);
      }
    }
  }
 catch (  final LibvirtException e) {
    e.printStackTrace();
  }
  return new Answer(cmd,true,result);
}
