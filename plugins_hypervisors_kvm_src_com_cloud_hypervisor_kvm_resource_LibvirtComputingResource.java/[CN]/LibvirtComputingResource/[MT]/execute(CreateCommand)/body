{
  StorageFilerTO pool=cmd.getPool();
  DiskProfile dskch=cmd.getDiskCharacteristics();
  KVMPhysicalDisk BaseVol=null;
  KVMStoragePool primaryPool=null;
  KVMPhysicalDisk vol=null;
  long disksize;
  try {
    primaryPool=_storagePoolMgr.getStoragePool(pool.getType(),pool.getUuid());
    disksize=dskch.getSize();
    if (cmd.getTemplateUrl() != null) {
      if (primaryPool.getType() == StoragePoolType.CLVM) {
        vol=templateToPrimaryDownload(cmd.getTemplateUrl(),primaryPool,dskch.getPath());
      }
 else {
        BaseVol=primaryPool.getPhysicalDisk(cmd.getTemplateUrl());
        vol=_storagePoolMgr.createDiskFromTemplate(BaseVol,dskch.getPath(),primaryPool,0);
      }
      if (vol == null) {
        return new Answer(cmd,false," Can't create storage volume on storage pool");
      }
    }
 else {
      vol=primaryPool.createPhysicalDisk(dskch.getPath(),dskch.getSize());
    }
    VolumeTO volume=new VolumeTO(cmd.getVolumeId(),dskch.getType(),pool.getType(),pool.getUuid(),pool.getPath(),vol.getName(),vol.getName(),disksize,null);
    volume.setBytesReadRate(dskch.getBytesReadRate());
    volume.setBytesWriteRate(dskch.getBytesWriteRate());
    volume.setIopsReadRate(dskch.getIopsReadRate());
    volume.setIopsWriteRate(dskch.getIopsWriteRate());
    volume.setCacheMode(dskch.getCacheMode());
    return new CreateAnswer(cmd,volume);
  }
 catch (  CloudRuntimeException e) {
    s_logger.debug("Failed to create volume: " + e.toString());
    return new CreateAnswer(cmd,e);
  }
}
