{
  try {
    String snapshotPath=cmd.getSnapshotUuid();
    final int index=snapshotPath.lastIndexOf("/");
    snapshotPath=snapshotPath.substring(0,index);
    final KVMStoragePool secondaryPool=_storagePoolMgr.getStoragePoolByURI(cmd.getSecondaryStorageUrl() + snapshotPath);
    final KVMPhysicalDisk snapshot=secondaryPool.getPhysicalDisk(cmd.getSnapshotName());
    final String primaryUuid=cmd.getPrimaryStoragePoolNameLabel();
    final KVMStoragePool primaryPool=_storagePoolMgr.getStoragePool(cmd.getPool().getType(),primaryUuid);
    final String volUuid=UUID.randomUUID().toString();
    final KVMPhysicalDisk disk=_storagePoolMgr.copyPhysicalDisk(snapshot,volUuid,primaryPool,0);
    return new CreateVolumeFromSnapshotAnswer(cmd,true,"",disk.getName());
  }
 catch (  final CloudRuntimeException e) {
    return new CreateVolumeFromSnapshotAnswer(cmd,false,e.toString(),null);
  }
}
