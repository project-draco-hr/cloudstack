{
  Connect conn;
  final NicTO nic=cmd.getNic();
  final String vmName=cmd.getVmName();
  Domain vm=null;
  try {
    conn=LibvirtConnection.getConnectionByVmName(vmName);
    vm=getDomain(conn,vmName);
    final List<InterfaceDef> pluggedNics=getInterfaces(conn,vmName);
    for (    final InterfaceDef pluggedNic : pluggedNics) {
      if (pluggedNic.getMacAddress().equalsIgnoreCase(nic.getMac())) {
        vm.detachDevice(pluggedNic.toString());
        for (        final VifDriver vifDriver : getAllVifDrivers()) {
          vifDriver.unplug(pluggedNic);
        }
        return new UnPlugNicAnswer(cmd,true,"success");
      }
    }
    return new UnPlugNicAnswer(cmd,true,"success");
  }
 catch (  final LibvirtException e) {
    final String msg=" Unplug Nic failed due to " + e.toString();
    s_logger.warn(msg,e);
    return new UnPlugNicAnswer(cmd,false,msg);
  }
 finally {
    if (vm != null) {
      try {
        vm.free();
      }
 catch (      final LibvirtException l) {
        s_logger.trace("Ignoring libvirt error.",l);
      }
    }
  }
}
