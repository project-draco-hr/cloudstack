{
  String[] results=new String[cmd.getRules().length];
  String callResult;
  Connect conn;
  String routerName=cmd.getAccessDetail(NetworkElementCommand.ROUTER_NAME);
  String routerIp=cmd.getAccessDetail(NetworkElementCommand.ROUTER_IP);
  try {
    conn=LibvirtConnection.getConnection();
    Domain vm=getDomain(conn,routerName);
    String[][] rules=cmd.generateFwRules();
    String[] aclRules=rules[0];
    NicTO nic=cmd.getNic();
    String dev="eth" + nic.getDeviceId();
    String netmask=Long.toString(NetUtils.getCidrSize(nic.getNetmask()));
    StringBuilder sb=new StringBuilder();
    for (int i=0; i < aclRules.length; i++) {
      sb.append(aclRules[i]).append(',');
    }
    String rule=sb.toString();
    String result=_virtRouterResource.assignNetworkACL(routerIp,dev,nic.getIp(),netmask,rule);
    if (result != null) {
      for (int i=0; i < results.length; i++) {
        results[i]="Failed";
      }
      return new SetNetworkACLAnswer(cmd,false,results);
    }
    return new SetNetworkACLAnswer(cmd,true,results);
  }
 catch (  Exception e) {
    String msg="SetNetworkACL failed due to " + e.toString();
    s_logger.error(msg,e);
    return new SetNetworkACLAnswer(cmd,false,results);
  }
}
