{
  String args="";
  if (cmd.isCreate()) {
    args+="-A";
    args+=" -l ";
    args+=cmd.getLocalPublicIp();
    args+=" -n ";
    args+=cmd.getLocalGuestCidr();
    args+=" -g ";
    args+=cmd.getLocalPublicGateway();
    args+=" -r ";
    args+=cmd.getPeerGatewayIp();
    args+=" -N ";
    args+=cmd.getPeerGuestCidrList();
    args+=" -e ";
    args+="\"" + cmd.getEspPolicy() + "\"";
    args+=" -i ";
    args+="\"" + cmd.getIkePolicy() + "\"";
    args+=" -t ";
    args+=Long.toString(cmd.getIkeLifetime());
    args+=" -T ";
    args+=Long.toString(cmd.getEspLifetime());
    args+=" -s ";
    args+="\"" + cmd.getIpsecPsk() + "\"";
    args+=" -d ";
    if (cmd.getDpd()) {
      args+="1";
    }
 else {
      args+="0";
    }
    if (cmd.isPassive()) {
      args+=" -p ";
    }
  }
 else {
    args+="-D";
    args+=" -r ";
    args+=cmd.getPeerGatewayIp();
    args+=" -n ";
    args+=cmd.getLocalGuestCidr();
    args+=" -N ";
    args+=cmd.getPeerGuestCidrList();
  }
  ExecutionResult result=_vrDeployer.executeInVR(cmd.getAccessDetail(NetworkElementCommand.ROUTER_IP),VRScripts.S2SVPN_IPSEC,args);
  if (!result.isSuccess()) {
    return new Answer(cmd,false,"Configure site to site VPN failed due to " + result.getDetails());
  }
  return new Answer(cmd);
}
