{
  String[] results=new String[cmd.getIpAddresses().length];
  for (int i=0; i < results.length; i++) {
    results[i]=IpAssocAnswer.errorResult;
  }
  int i=0;
  for (  IpAddressTO ip : cmd.getIpAddresses()) {
    String args="";
    if (ip.isAdd()) {
      args+="-A";
    }
 else {
      args+="-D";
    }
    String cidrSize=Long.toString(NetUtils.getCidrSize(ip.getVlanNetmask()));
    if (ip.isSourceNat()) {
      args+=" -s";
    }
    if (ip.isFirstIP()) {
      args+=" -f";
    }
    args+=" -l ";
    args+=ip.getPublicIp() + "/" + cidrSize;
    String publicNic="eth" + ip.getNicDevId();
    args+=" -c ";
    args+=publicNic;
    args+=" -g ";
    args+=ip.getVlanGateway();
    if (ip.isNewNic()) {
      args+=" -n";
    }
    ExecutionResult result=_vrDeployer.executeInVR(cmd.getRouterAccessIp(),"ipassoc.sh",args);
    if (result.isSuccess()) {
      results[i++]=ip.getPublicIp() + " - success";
    }
 else {
      results[i++]=ip.getPublicIp() + " - failed:" + result.getDetails();
      break;
    }
  }
  return new IpAssocAnswer(cmd,results);
}
