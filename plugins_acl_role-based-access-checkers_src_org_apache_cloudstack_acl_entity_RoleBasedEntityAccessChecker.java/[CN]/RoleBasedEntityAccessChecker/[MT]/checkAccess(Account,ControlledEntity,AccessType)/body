{
  String entityType="";
  if (entity instanceof InternalIdentity) {
    InternalIdentity entityWithId=(InternalIdentity)entity;
    List<AclGroupAccountMapVO> acctGroups=_aclGroupAccountMapDao.listByAccountId(caller.getId());
    for (    AclGroupAccountMapVO groupMapping : acctGroups) {
      AclEntityPermissionVO entityPermission=_entityPermissionDao.findByGroupAndEntity(groupMapping.getAclGroupId(),entityType,entityWithId.getId(),accessType);
      if (entityPermission != null) {
        if (entityPermission.isAllowed()) {
          return true;
        }
 else {
          if (s_logger.isDebugEnabled()) {
            s_logger.debug("Account " + caller + " does not have permission to access resource "+ entity+ " for access type: "+ accessType);
          }
          throw new PermissionDeniedException(caller + " does not have permission to access resource " + entity);
        }
      }
    }
  }
  if (_accountService.isRootAdmin(caller.getId())) {
    return true;
  }
  if (caller.getId() == entity.getAccountId()) {
    return true;
  }
  List<AclRole> roles=_aclService.getAclRoles(caller.getId());
  return false;
}
