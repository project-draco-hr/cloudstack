{
  if (obj.getType() == DataObjectType.TEMPLATE) {
    VMTemplateStoragePoolVO templateStoragePoolRef=templatePoolDao.findByPoolTemplate(this.getId(),obj.getId());
    if (templateStoragePoolRef == null) {
      try {
        templateStoragePoolRef=new VMTemplateStoragePoolVO(this.getId(),obj.getId());
        templateStoragePoolRef=templatePoolDao.persist(templateStoragePoolRef);
      }
 catch (      Throwable t) {
        templateStoragePoolRef=templatePoolDao.findByPoolTemplate(this.getId(),obj.getId());
        if (templateStoragePoolRef == null) {
          throw new CloudRuntimeException("Failed to create template storage pool entry");
        }
      }
    }
  }
 else   if (obj.getType() == DataObjectType.SNAPSHOT) {
    return objectInStoreMgr.create(obj,this);
  }
  return objectInStoreMgr.get(obj,this);
}
