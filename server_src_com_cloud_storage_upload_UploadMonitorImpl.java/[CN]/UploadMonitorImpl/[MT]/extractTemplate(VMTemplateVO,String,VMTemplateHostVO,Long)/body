{
  if (isTemplateUploadInProgress(template.getId())) {
    return;
  }
  List<HostVO> storageServers=_serverDao.listByTypeDataCenter(Host.Type.SecondaryStorage,dataCenterId);
  HostVO sserver=storageServers.get(0);
  _vmTemplateHostDao.updateUploadStatus(sserver.getId(),template.getId(),0,VMTemplateStorageResourceAssoc.Status.NOT_UPLOADED,"jobid0000",url);
  if (vmTemplateHost != null) {
    start();
    UploadCommand ucmd=new UploadCommand(template,url,vmTemplateHost);
    UploadListener ul=new UploadListener(sserver,template,_timer,_vmTemplateHostDao,vmTemplateHost.getId(),this,ucmd);
    _listenerMap.put(vmTemplateHost,ul);
    long result=send(sserver.getId(),ucmd,ul);
    if (result == -1) {
      s_logger.warn("Unable to start upload of template " + template.getUniqueName() + " from "+ sserver.getName()+ " to "+ url);
      ul.setDisconnected();
      ul.scheduleStatusCheck(RequestType.GET_OR_RESTART);
    }
  }
}
