{
  try {
    final String bucket=s3.getBucketName();
    final String result=executeWithNoWaitLock(determineSnapshotLockId(accountId,volumeId),new Callable<String>(){
      @Override public String call() throws Exception {
        final String innerResult=deleteSnapshotBackupFromLocalFileSystem(secondaryStorageUrl,accountId,volumeId,name,deleteAllFlag);
        if (innerResult != null) {
          return innerResult;
        }
        if (deleteAllFlag) {
          S3Utils.deleteDirectory(s3,bucket,determineSnapshotS3Directory(accountId,volumeId));
        }
 else {
          S3Utils.deleteObject(s3,bucket,determineSnapshotS3Key(accountId,volumeId,determineSnapshotBackupFilename(name)));
        }
        return null;
      }
    }
);
    return result;
  }
 catch (  Exception e) {
    s_logger.error(String.format("Failed to delete snapshot backup for account id %1$s volume id %2$sfrom S3.",accountId,volumeId),e);
    return e.getMessage();
  }
}
