{
  try {
    if (!ipmiPing()) {
      Thread.sleep(1000);
      if (!ipmiPing()) {
        s_logger.warn("Cannot ping ipmi nic " + _ip);
        return null;
      }
    }
  }
 catch (  Exception e) {
    s_logger.debug("Cannot ping ipmi nic " + _ip,e);
    return null;
  }
  if (hostId != null) {
    final List<? extends VMInstanceVO> vms=vmDao.listByHostId(hostId);
    if (vms.isEmpty()) {
      return new PingRoutingCommand(getType(),id,deltaSync(),getHostVmStateReport());
    }
 else {
      VMInstanceVO vm=vms.get(0);
      SecurityGroupHttpClient client=new SecurityGroupHttpClient();
      HashMap<String,Pair<Long,Long>> nwGrpStates=client.sync(vm.getInstanceName(),vm.getId(),vm.getPrivateIpAddress());
      return new PingRoutingWithNwGroupsCommand(getType(),id,null,getHostVmStateReport(),nwGrpStates);
    }
  }
 else {
    return new PingRoutingCommand(getType(),id,deltaSync(),getHostVmStateReport());
  }
}
