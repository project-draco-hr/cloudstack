{
  stateMachine.addTransition(null,Event.CreateRequested,Snapshot.State.Creating);
  stateMachine.addTransition(Snapshot.State.Creating,Event.OperationSucceeded,Snapshot.State.CreatedOnPrimary);
  stateMachine.addTransition(Snapshot.State.Creating,Event.OperationNotPerformed,Snapshot.State.BackedUp);
  stateMachine.addTransition(Snapshot.State.Creating,Event.OperationFailed,Snapshot.State.Error);
  stateMachine.addTransition(Snapshot.State.CreatedOnPrimary,Event.BackupToSecondary,Snapshot.State.BackingUp);
  stateMachine.addTransition(Snapshot.State.BackingUp,Event.OperationSucceeded,Snapshot.State.BackedUp);
  stateMachine.addTransition(Snapshot.State.BackingUp,Event.OperationFailed,Snapshot.State.Error);
  stateMachine.registerListener(new SnapshotStateListener());
}
