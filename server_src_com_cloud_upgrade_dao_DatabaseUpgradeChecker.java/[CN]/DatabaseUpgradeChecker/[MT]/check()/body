{
  String dbVersion=_dao.getCurrentVersion();
  String currentVersion=this.getClass().getPackage().getImplementationVersion();
  if (currentVersion == null) {
    currentVersion=this.getClass().getSuperclass().getPackage().getImplementationVersion();
  }
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("DB version = " + dbVersion + " Code Version = "+ currentVersion);
  }
  if (Version.compare(Version.trimToPatch(dbVersion),Version.trimToPatch(currentVersion)) > 0) {
    throw new CloudRuntimeException("Database version " + dbVersion + " is higher than management software version "+ currentVersion);
  }
  if (Version.compare(Version.trimToPatch(dbVersion),Version.trimToPatch(currentVersion)) == 0) {
    return;
  }
  upgrade(dbVersion,currentVersion);
}
