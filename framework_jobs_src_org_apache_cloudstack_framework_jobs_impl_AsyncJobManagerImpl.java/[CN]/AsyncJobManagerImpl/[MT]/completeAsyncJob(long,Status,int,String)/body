{
  if (logger.isDebugEnabled()) {
    logger.debug("Complete async job-" + jobId + ", jobStatus: "+ jobStatus+ ", resultCode: "+ resultCode+ ", result: "+ resultObject);
  }
  final AsyncJobVO job=_jobDao.findById(jobId);
  if (job == null) {
    if (logger.isDebugEnabled()) {
      logger.debug("job-" + jobId + " no longer exists, we just log completion info here. "+ jobStatus+ ", resultCode: "+ resultCode+ ", result: "+ resultObject);
    }
    _queueMgr.purgeAsyncJobQueueItemId(jobId);
    return;
  }
  if (job.getStatus() != JobInfo.Status.IN_PROGRESS) {
    if (logger.isDebugEnabled()) {
      logger.debug("job-" + jobId + " is already completed.");
    }
    _queueMgr.purgeAsyncJobQueueItemId(jobId);
    return;
  }
  if (resultObject != null) {
    job.setResult(resultObject);
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Publish async job-" + jobId + " complete on message bus");
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Wake up jobs related to job-" + jobId);
  }
  List<Long> wakeupList=Transaction.execute(new TransactionCallback<List<Long>>(){
    @Override public List<Long> doInTransaction(    TransactionStatus status){
      if (logger.isDebugEnabled()) {
        logger.debug("Update db status for job-" + jobId);
      }
      job.setCompleteMsid(getMsid());
      job.setStatus(jobStatus);
      job.setResultCode(resultCode);
      if (resultObject != null) {
        job.setResult(resultObject);
      }
 else {
        job.setResult(null);
      }
      job.setLastUpdated(DateUtil.currentGMTTime());
      job.setExecutingMsid(null);
      _jobDao.update(jobId,job);
      if (logger.isDebugEnabled()) {
        logger.debug("Wake up jobs joined with job-" + jobId + " and disjoin all subjobs created from job- "+ jobId);
      }
      List<Long> wakeupList=wakeupByJoinedJobCompletion(jobId);
      _joinMapDao.disjoinAllJobs(jobId);
      _queueMgr.purgeAsyncJobQueueItemId(jobId);
      return wakeupList;
    }
  }
);
  publishOnEventBus(job,"complete");
  _messageBus.publish(null,AsyncJob.Topics.JOB_STATE,PublishScope.GLOBAL,jobId);
}
