{
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Complete async job-" + jobId + ", jobStatus: "+ jobStatus+ ", resultCode: "+ resultCode+ ", result: "+ resultObject);
  }
  final AsyncJobVO job=_jobDao.findById(jobId);
  if (job == null) {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("job-" + jobId + " no longer exists, we just log completion info here. "+ jobStatus+ ", resultCode: "+ resultCode+ ", result: "+ resultObject);
    }
    return;
  }
  if (job.getStatus() != JobInfo.Status.IN_PROGRESS) {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("job-" + jobId + " is already completed.");
    }
    return;
  }
  if (resultObject != null) {
    job.setResult(resultObject);
  }
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Publish async job-" + jobId + " complete on message bus");
  }
  publishOnEventBus(job,"complete");
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Wake up jobs related to job- " + jobId);
  }
  List<Long> wakeupList=Transaction.execute(new TransactionCallback<List<Long>>(){
    @Override public List<Long> doInTransaction(    TransactionStatus status){
      if (s_logger.isDebugEnabled()) {
        s_logger.debug("Update db status for job- " + jobId);
      }
      job.setCompleteMsid(getMsid());
      job.setStatus(jobStatus);
      job.setResultCode(resultCode);
      if (resultObject != null) {
        job.setResult(resultObject);
      }
 else {
        job.setResult(null);
      }
      job.setLastUpdated(DateUtil.currentGMTTime());
      _jobDao.update(jobId,job);
      if (s_logger.isDebugEnabled()) {
        s_logger.debug("Wake up jobs joined with job- " + jobId + " and disjoin all subjobs created from job- "+ jobId);
      }
      List<Long> wakeupList=wakeupByJoinedJobCompletion(jobId);
      _joinMapDao.disjoinAllJobs(jobId);
      return wakeupList;
    }
  }
);
  _messageBus.publish(null,AsyncJob.Topics.JOB_STATE,PublishScope.GLOBAL,jobId);
}
