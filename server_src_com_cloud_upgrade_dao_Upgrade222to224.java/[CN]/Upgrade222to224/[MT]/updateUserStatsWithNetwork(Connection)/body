{
  try {
    PreparedStatement pstmt=conn.prepareStatement("SELECT id, device_id FROM user_statistics WHERE network_id=0 or network_id is NULL");
    s_logger.debug("Query is " + pstmt);
    ResultSet rs=pstmt.executeQuery();
    while (rs.next()) {
      Long id=rs.getLong(1);
      Long instanceId=rs.getLong(2);
      pstmt=conn.prepareStatement("SELECT network_id FROM nics WHERE instance_id=? AND mode='Dhcp'");
      pstmt.setLong(1,instanceId);
      s_logger.debug("Query is " + pstmt);
      ResultSet rs1=pstmt.executeQuery();
      if (!rs1.next()) {
        throw new CloudRuntimeException("Failed to update user_statistics table as a part of 222 to 224 upgrade: couldn't get network_id from nics table");
      }
      Long networkId=rs1.getLong(1);
      if (networkId != null) {
        pstmt=conn.prepareStatement("UPDATE user_statistics SET network_id=? where id=?");
        pstmt.setLong(1,networkId);
        pstmt.setLong(2,id);
        pstmt.executeUpdate();
      }
    }
    s_logger.debug("Successfully update user_statistics table with network_ids as a part of 222 to 224 upgrade");
    rs.close();
    pstmt.close();
  }
 catch (  SQLException e) {
    throw new CloudRuntimeException("Unable to update the Mode field for nics as a part of 222 to 224 upgrade",e);
  }
}
