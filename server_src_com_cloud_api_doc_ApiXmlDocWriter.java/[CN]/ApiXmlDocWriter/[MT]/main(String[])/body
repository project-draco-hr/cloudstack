{
  Properties preProcessedCommands=new Properties();
  Enumeration command=null;
  String[] fileNames=null;
  List<String> argsList=Arrays.asList(args);
  Iterator<String> iter=argsList.iterator();
  while (iter.hasNext()) {
    String arg=iter.next();
    if (arg.equals("-f")) {
      fileNames=iter.next().split(",");
    }
    if (arg.equals("-d")) {
      dirName=iter.next();
    }
  }
  if ((fileNames == null) || (fileNames.length == 0)) {
    System.out.println("Please specify input file(s) separated by coma using -f option");
    System.exit(2);
  }
  for (  String fileName : fileNames) {
    try {
      FileInputStream in=new FileInputStream(fileName);
      preProcessedCommands.load(in);
    }
 catch (    FileNotFoundException ex) {
      System.out.println("Can't find file " + fileName);
      System.exit(2);
    }
catch (    IOException ex1) {
      System.out.println("Error reading from file " + ex1);
      System.exit(2);
    }
  }
  for (  Object key : preProcessedCommands.keySet()) {
    String preProcessedCommand=preProcessedCommands.getProperty((String)key);
    String[] commandParts=preProcessedCommand.split(";");
    String commandName=commandParts[0];
    all_api_commands.put(key,commandName);
    short cmdPermissions=Short.parseShort(commandParts[1]);
    if ((cmdPermissions & DOMAIN_ADMIN_COMMAND) != 0) {
      domain_admin_api_commands.put(key,commandName);
    }
    if ((cmdPermissions & USER_COMMAND) != 0) {
      regular_user_api_commands.put(key,commandName);
    }
  }
  command=all_api_commands.propertyNames();
  try {
    XStream xs=new XStream();
    xs.alias("command",Command.class);
    xs.alias("arg",Argument.class);
    ObjectOutputStream out=xs.createObjectOutputStream(new FileWriter(dirName + "/commands.xml"),"commands");
    ObjectOutputStream outDomainAdmin=xs.createObjectOutputStream(new FileWriter(dirName + "/commandsDomainAdmin.xml"),"commands");
    ObjectOutputStream regularUser=xs.createObjectOutputStream(new FileWriter(dirName + "/commandsRegularUser.xml"),"commands");
    while (command.hasMoreElements()) {
      String key=(String)command.nextElement();
      Class clas=Class.forName(all_api_commands.getProperty(key));
      ArrayList<Argument> request=new ArrayList<Argument>();
      ArrayList<Argument> response=new ArrayList<Argument>();
      Command apiCommand=new Command();
      apiCommand.setName(key);
      Implementation impl=(Implementation)clas.getAnnotation(Implementation.class);
      if (impl == null)       impl=(Implementation)clas.getSuperclass().getAnnotation(Implementation.class);
      String commandDescription=impl.description();
      if (commandDescription != null)       apiCommand.setDescription(commandDescription);
 else       System.out.println("Command " + apiCommand.getName() + " misses description");
      Field[] fields=clas.getDeclaredFields();
      Class<?> superClass=clas.getSuperclass();
      String superName=superClass.getName();
      if (!superName.equals(BaseCmd.class.getName()) && !superName.equals(BaseAsyncCmd.class.getName()) && !superName.equals(BaseAsyncCreateCmd.class.getName())) {
        Field[] superClassFields=superClass.getDeclaredFields();
        if (superClassFields != null && !superClass.getName().equals(BaseListCmd.class.getName())) {
          Field[] tmpFields=new Field[fields.length + superClassFields.length];
          System.arraycopy(fields,0,tmpFields,0,fields.length);
          System.arraycopy(superClassFields,0,tmpFields,fields.length,superClassFields.length);
          fields=tmpFields;
        }
        superClass=superClass.getSuperclass();
      }
      for (      Field f : fields) {
        Parameter parameterAnnotation=f.getAnnotation(Parameter.class);
        if (parameterAnnotation != null) {
          Argument reqArg=new Argument(parameterAnnotation.name());
          reqArg.setRequired(parameterAnnotation.required());
          if (!parameterAnnotation.description().isEmpty() && parameterAnnotation.expose())           reqArg.setDescription(parameterAnnotation.description());
 else           if (parameterAnnotation.expose()) {
          }
          request.add(reqArg);
        }
      }
      Class responseClas=impl.responseObject();
      Field[] responseFields=responseClas.getDeclaredFields();
      for (      Field responseField : responseFields) {
        SerializedName nameAnnotation=responseField.getAnnotation(SerializedName.class);
        Param descAnnotation=responseField.getAnnotation(Param.class);
        Argument respArg=new Argument(nameAnnotation.value());
        if (descAnnotation != null)         respArg.setDescription(descAnnotation.description());
        response.add(respArg);
      }
      apiCommand.setRequest(request);
      apiCommand.setResponse(response);
      out.writeObject(apiCommand);
      if (domain_admin_api_commands.containsKey(key)) {
        outDomainAdmin.writeObject(apiCommand);
      }
      if (regular_user_api_commands.containsKey(key)) {
        regularUser.writeObject(apiCommand);
      }
    }
    out.close();
    outDomainAdmin.close();
    regularUser.close();
  }
 catch (  Exception ex) {
    ex.printStackTrace();
    System.exit(2);
  }
}
