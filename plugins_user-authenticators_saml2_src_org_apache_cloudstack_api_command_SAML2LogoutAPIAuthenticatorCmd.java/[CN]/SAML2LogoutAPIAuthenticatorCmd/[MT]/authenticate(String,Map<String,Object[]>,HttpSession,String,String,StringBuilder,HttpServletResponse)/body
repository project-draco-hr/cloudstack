{
  auditTrailSb.append("=== SAML SLO Logging out ===");
  LogoutCmdResponse response=new LogoutCmdResponse();
  response.setDescription("success");
  response.setResponseName(getCommandName());
  try {
    DefaultBootstrap.bootstrap();
  }
 catch (  ConfigurationException|FactoryConfigurationError e) {
    s_logger.error("OpenSAML Bootstrapping error: " + e.getMessage());
    throw new ServerApiException(ApiErrorCode.ACCOUNT_ERROR,_apiServer.getSerializedApiError(ApiErrorCode.ACCOUNT_ERROR.getHttpCode(),"OpenSAML Bootstrapping error while creating SP MetaData",params,responseType));
  }
  NameID nameId=(NameID)session.getAttribute(SAMLUtils.SAML_NAMEID);
  String sessionIndex=(String)session.getAttribute(SAMLUtils.SAML_SESSION);
  LogoutRequest logoutRequest=SAMLUtils.buildLogoutRequest(_samlAuthManager.getIdpSingleLogOutUrl(),_samlAuthManager.getServiceProviderId(),nameId,sessionIndex);
  try {
    String redirectUrl=_samlAuthManager.getIdpSingleLogOutUrl() + "?SAMLRequest=" + SAMLUtils.encodeSAMLRequest(logoutRequest);
    resp.sendRedirect(redirectUrl);
  }
 catch (  MarshallingException|IOException e) {
    s_logger.error("SAML SLO error: " + e.getMessage());
    throw new ServerApiException(ApiErrorCode.ACCOUNT_ERROR,_apiServer.getSerializedApiError(ApiErrorCode.ACCOUNT_ERROR.getHttpCode(),"SAML Single Logout Error",params,responseType));
  }
  return ApiResponseSerializer.toSerializedString(response,responseType);
}
