{
  DatagramSocket ds=new DatagramSocket();
  ds.setSoTimeout(2000);
  SyslogAppender appender=new SyslogAppender();
  appender.setSyslogHost("localhost:" + ds.getLocalPort());
  appender.setName("name");
  appender.setHeader(header);
  PatternLayout pl=new PatternLayout("%m");
  appender.setLayout(pl);
  appender.activateOptions();
  Logger l=Logger.getRootLogger();
  l.addAppender(appender);
  if (ex == null) {
    l.info(msg);
  }
 else {
    l.error(msg,ex);
  }
  appender.close();
  String[] retval=new String[packets];
  byte[] buf=new byte[1000];
  for (int i=0; i < packets; i++) {
    DatagramPacket p=new DatagramPacket(buf,0,buf.length);
    ds.receive(p);
    retval[i]=new String(p.getData(),0,p.getLength());
  }
  ds.close();
  return retval;
}
