{
  NetworkOffering offering=_entityMgr.findById(NetworkOffering.class,networkOfferingId);
  if (offering == null) {
    throw new InvalidParameterValueException("Unable to find network offering by ID " + networkOfferingId);
  }
  if (physicalNetworkId != null) {
    if (offering.getGuestType() == GuestType.Shared) {
      return physicalNetworkId;
    }
 else {
      throw new InvalidParameterValueException("Physical network OD can be specified for networks of guest IP type " + GuestType.Shared + " only.");
    }
  }
 else {
    if (zoneId == null) {
      throw new InvalidParameterValueException("ZoneId is required as physicalNetworkId is null");
    }
    return _networkService.findPhysicalNetworkId(zoneId,offering.getTags(),offering.getTrafficType());
  }
}
