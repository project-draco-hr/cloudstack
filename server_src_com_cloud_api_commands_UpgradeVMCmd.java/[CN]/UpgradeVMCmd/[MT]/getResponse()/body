{
  UserVmVO userVm=(UserVmVO)getResponseObject();
  UpgradeVmResponse response=new UpgradeVmResponse();
  if (userVm != null) {
    Account acct=ApiDBUtils.findAccountById(userVm.getAccountId());
    response.setAccount(acct.getAccountName());
    ServiceOffering offering=ApiDBUtils.findServiceOfferingById(userVm.getServiceOfferingId());
    response.setCpuSpeed(offering.getSpeed());
    response.setMemory(offering.getRamSize());
    if (((ServiceOfferingVO)offering).getDisplayText() != null) {
      response.setServiceOfferingName(((ServiceOfferingVO)offering).getDisplayText());
    }
 else {
      response.setServiceOfferingName(offering.getName());
    }
    response.setServiceOfferingId(userVm.getServiceOfferingId());
    VmStats vmStats=ApiDBUtils.getVmStatistics(userVm.getId());
    if (vmStats != null) {
      response.setCpuUsed((long)vmStats.getCPUUtilization());
      response.setNetworkKbsRead((long)vmStats.getNetworkReadKBs());
      response.setNetworkKbsWrite((long)vmStats.getNetworkWriteKBs());
    }
    response.setCreated(userVm.getCreated());
    response.setDisplayName(userVm.getDisplayName());
    response.setDomain(ApiDBUtils.findDomainById(acct.getDomainId()).getName());
    response.setDomainId(acct.getDomainId());
    response.setHaEnable(userVm.isHaEnabled());
    if (userVm.getHostId() != null) {
      response.setHostId(userVm.getHostId());
      response.setHostName(ApiDBUtils.findHostById(userVm.getHostId()).getName());
    }
    response.setIpAddress(userVm.getPrivateIpAddress());
    response.setName(userVm.getName());
    response.setState(userVm.getState().toString());
    response.setZoneId(userVm.getDataCenterId());
    response.setZoneName(ApiDBUtils.findZoneById(userVm.getDataCenterId()).getName());
    VMTemplateVO template=ApiDBUtils.findTemplateById(userVm.getTemplateId());
    response.setPasswordEnabled(template.getEnablePassword());
    response.setTemplateDisplayText(template.getDisplayText());
    response.setTemplateId(template.getId());
    response.setTemplateName(template.getName());
  }
 else {
    throw new ServerApiException(BaseCmd.INTERNAL_ERROR,"Failed to update zone; internal error.");
  }
  response.setResponseName(getName());
  return response;
}
