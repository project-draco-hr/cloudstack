{
  Set<Long> affectedVms=new HashSet<Long>();
  List<NetworkGroupVMMapVO> groupsForVm=_networkGroupVMMapDao.listByInstanceId(userVm.getId());
  for (  NetworkGroupVMMapVO mapVO : groupsForVm) {
    List<IngressRuleVO> allowingRules=_ingressRuleDao.listByAllowedNetworkGroupId(mapVO.getNetworkGroupId());
    affectedVms.addAll(getAffectedVmsForIngressRules(allowingRules));
  }
  return affectedVms;
}
