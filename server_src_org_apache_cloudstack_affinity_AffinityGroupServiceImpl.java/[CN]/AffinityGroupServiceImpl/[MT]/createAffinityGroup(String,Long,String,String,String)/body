{
  Account caller=UserContext.current().getCaller();
  Account owner=_accountMgr.finalizeOwner(caller,account,domainId,null);
  if (_affinityGroupDao.isNameInUse(owner.getAccountId(),owner.getDomainId(),affinityGroupName)) {
    throw new InvalidParameterValueException("Unable to create affinity group, a group with name " + affinityGroupName + " already exisits.");
  }
  AffinityGroupVO group=new AffinityGroupVO(affinityGroupName,affinityGroupType,description,domainId,owner.getId());
  _affinityGroupDao.persist(group);
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Created affinity group =" + affinityGroupName);
  }
  return group;
}
