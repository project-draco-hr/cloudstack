{
  List<FirewallRuleVO> firewallRules=(List<FirewallRuleVO>)getResponseObject();
  Map<String,UserVmVO> userVmCache=new HashMap<String,UserVmVO>();
  List<FirewallRuleResponse> response=new ArrayList<FirewallRuleResponse>();
  for (  FirewallRuleVO fwRule : firewallRules) {
    FirewallRuleResponse ruleData=new FirewallRuleResponse();
    ruleData.setId(fwRule.getId());
    ruleData.setPublicPort(fwRule.getPublicPort());
    ruleData.setPrivatePort(fwRule.getPrivatePort());
    ruleData.setProtocol(fwRule.getProtocol());
    UserVmVO userVM=userVmCache.get(fwRule.getPrivateIpAddress());
    if (userVM == null) {
      Criteria c=new Criteria();
      c.addCriteria(Criteria.ACCOUNTID,new Object[]{addrOwner.getId()});
      c.addCriteria(Criteria.DATACENTERID,ipAddressVO.getDataCenterId());
      c.addCriteria(Criteria.IPADDRESS,fwRule.getPrivateIpAddress());
      List<UserVmVO> userVMs=getManagementServer().searchForUserVMs(c);
      if ((userVMs != null) && (userVMs.size() > 0)) {
        userVM=userVMs.get(0);
        userVmCache.put(fwRule.getPrivateIpAddress(),userVM);
      }
    }
    if (userVM != null) {
      ruleData.setVirtualMachineId(userVM.getId());
      ruleData.setVirtualMachineName(userVM.getName());
    }
    response.add(ruleData);
  }
  return SerializerHelper.toSerializedString(response);
}
