{
  Transaction.execute(new TransactionCallbackNoReturn(){
    @Override public void doInTransactionWithoutResult(    TransactionStatus status){
      UserStatisticsVO userStats;
      userStats=_userStatsDao.lock(accountId,zone.getId(),networkId,publicIp,externalLoadBalancer.getId(),externalLoadBalancer.getType().toString());
      if (userStats != null) {
        long oldNetBytesSent=userStats.getNetBytesSent();
        long oldNetBytesReceived=userStats.getNetBytesReceived();
        long oldCurrentBytesSent=userStats.getCurrentBytesSent();
        long oldCurrentBytesReceived=userStats.getCurrentBytesReceived();
        String warning="Received an external network stats byte count that was less than the stored value. Zone ID: " + userStats.getDataCenterId() + ", account ID: "+ userStats.getAccountId()+ ".";
        userStats.setCurrentBytesSent(newCurrentBytesSent);
        if (oldCurrentBytesSent > newCurrentBytesSent) {
          logger.warn(warning + "Stored bytes sent: " + oldCurrentBytesSent+ ", new bytes sent: "+ newCurrentBytesSent+ ".");
          userStats.setNetBytesSent(oldNetBytesSent + oldCurrentBytesSent);
        }
        userStats.setCurrentBytesReceived(newCurrentBytesReceived);
        if (oldCurrentBytesReceived > newCurrentBytesReceived) {
          logger.warn(warning + "Stored bytes received: " + oldCurrentBytesReceived+ ", new bytes received: "+ newCurrentBytesReceived+ ".");
          userStats.setNetBytesReceived(oldNetBytesReceived + oldCurrentBytesReceived);
        }
        if (_userStatsDao.update(userStats.getId(),userStats)) {
          logger.debug("Successfully updated stats for " + statsEntryIdentifier);
        }
 else {
          logger.debug("Failed to update stats for " + statsEntryIdentifier);
        }
      }
 else {
        logger.warn("Unable to find user stats entry for " + statsEntryIdentifier);
      }
    }
  }
);
}
