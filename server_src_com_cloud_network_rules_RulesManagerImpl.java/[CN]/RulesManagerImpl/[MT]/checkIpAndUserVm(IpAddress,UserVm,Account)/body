{
  if (ipAddress == null || ipAddress.getAllocated() == null || ipAddress.getAccountId() == null) {
    throw new InvalidParameterValueException("Unable to create ip forwarding rule on address " + ipAddress + ", invalid IP address specified.");
  }
  if (userVm == null) {
    return;
  }
  _accountMgr.checkAccess(caller,userVm);
  if (ipAddress.getAccountId().longValue() != userVm.getAccountId()) {
    throw new InvalidParameterValueException("Unable to create ip forwarding rule, IP address " + ipAddress + " owner is not the same as owner of virtual machine "+ userVm.toString());
  }
  if (ipAddress.getDataCenterId() != userVm.getDataCenterId()) {
    throw new InvalidParameterValueException("Unable to create ip forwarding rule, IP address " + ipAddress + " is not in the same availability zone as virtual machine "+ userVm.toString());
  }
}
