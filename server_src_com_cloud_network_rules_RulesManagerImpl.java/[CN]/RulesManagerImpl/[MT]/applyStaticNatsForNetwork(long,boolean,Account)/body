{
  List<IPAddressVO> ips=_ipAddressDao.listStaticNatPublicIps(networkId);
  if (ips.isEmpty()) {
    s_logger.debug("There are no static nat to apply for network id=" + networkId);
    return true;
  }
  if (caller != null) {
    _accountMgr.checkAccess(caller,ips.toArray(new IPAddressVO[ips.size()]));
  }
  List<StaticNat> staticNats=new ArrayList<StaticNat>();
  for (  IPAddressVO ip : ips) {
    String dstIp=_networkMgr.getIpInNetwork(ip.getAssociatedWithVmId(),networkId);
    StaticNatImpl staticNat=new StaticNatImpl(ip.getAccountId(),ip.getDomainId(),networkId,ip.getId(),dstIp,false);
    staticNats.add(staticNat);
  }
  try {
    if (!_networkMgr.applyStaticNats(staticNats,continueOnError)) {
      return false;
    }
  }
 catch (  ResourceUnavailableException ex) {
    s_logger.warn("Failed to create static nat rule due to ",ex);
    return false;
  }
  return true;
}
