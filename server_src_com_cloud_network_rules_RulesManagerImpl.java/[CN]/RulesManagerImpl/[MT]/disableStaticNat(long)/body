{
  UserContext ctx=UserContext.current();
  Account caller=ctx.getCaller();
  IPAddressVO ipAddress=_ipAddressDao.findById(ipId);
  checkIpAndUserVm(ipAddress,null,caller);
  if (ipAddress.getElastic()) {
    throw new InvalidParameterValueException("Can't disable static nat for elastic IP address " + ipAddress);
  }
  Long vmId=ipAddress.getAssociatedWithVmId();
  if (vmId == null) {
    throw new InvalidParameterValueException("IP address " + ipAddress + " is not associated with any vm Id");
  }
  Network guestNetwork=_networkMgr.getNetwork(ipAddress.getAssociatedWithNetworkId());
  NetworkOffering offering=_configMgr.getNetworkOffering(guestNetwork.getNetworkOfferingId());
  if (offering.getElasticIp()) {
    enableElasticIpAndStaticNatForVm(_vmDao.findById(vmId),true);
    return true;
  }
 else {
    return disableStaticNat(ipId,caller,ctx.getCallerUserId(),false);
  }
}
