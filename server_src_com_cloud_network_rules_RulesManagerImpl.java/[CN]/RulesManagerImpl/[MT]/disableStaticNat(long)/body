{
  UserContext ctx=UserContext.current();
  Account caller=ctx.getCaller();
  IPAddressVO ipAddress=_ipAddressDao.findById(ipId);
  checkIpAndUserVm(ipAddress,null,caller);
  Long vmId=ipAddress.getAssociatedWithVmId();
  boolean success=disableStaticNat(ipId,caller,ctx.getCallerUserId());
  if (success && vmId != null) {
    s_logger.debug("Allocating ip and enabling static nat for vm id=" + vmId + " as a part of disassociateIp command");
    UserVm vm=_vmDao.findById(vmId);
    success=enableElasticIpAndStaticNatForVm(vm,true);
    if (!success) {
      s_logger.warn("Failed to allocate ip and enable static nat for vm id=" + vmId + " as a part of disassociateIp command");
    }
 else {
      s_logger.debug("Successfully allocated ip and enabled static nat for vm id=" + vmId + " as a part of disassociateIp command");
    }
  }
  return success;
}
