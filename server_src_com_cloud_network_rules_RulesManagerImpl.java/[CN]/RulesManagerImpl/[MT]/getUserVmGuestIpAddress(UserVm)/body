{
  Ip dstIp=null;
  List<? extends Nic> nics=_networkMgr.getNics(vm);
  for (  Nic nic : nics) {
    Network ntwk=_networkMgr.getNetwork(nic.getNetworkId());
    if (ntwk.getGuestType() == GuestIpType.Virtualized) {
      dstIp=new Ip(nic.getIp4Address());
      return new Pair<Network,Ip>(ntwk,dstIp);
    }
  }
  throw new CloudRuntimeException("Unable to find ip address to map to in " + vm.getId());
}
