{
  List<VMTemplateZoneVO> tpZones=_templateZoneDao.listByTemplateId(templateId);
  for (  VMTemplateZoneVO tpZone : tpZones) {
    DataStore imageStore=null;
    List<DataStore> imageStores=_secStorageMgr.getImageStores(tpZone.getZoneId());
    for (    DataStore imgStore : imageStores) {
      TemplateStrategy ts=imgStore.getTemplateStrategy();
      if (ts.canRegister(templateId)) {
        imageStore=imgStore;
        break;
      }
    }
    if (imageStore == null) {
      continue;
    }
    TemplateStrategy ts=imageStore.getTemplateStrategy();
    ts.register(ts.get(templateId));
  }
}
