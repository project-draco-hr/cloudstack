{
  try {
    SAXParserFactory spfactory=SAXParserFactory.newInstance();
    SAXParser saxParser=spfactory.newSAXParser();
    File file=PropertiesUtil.findConfigFile(filename);
    if (file == null) {
      s_logger.warn("Unable to find the config file automatically.  Now checking properties files.");
      _parentLocator=null;
      _managerMap=new HashMap<String,ComponentInfo<Manager>>();
      _adapterMap=new HashMap<String,Adapters<? extends Adapter>>();
      _daoMap=new LinkedHashMap<String,ComponentInfo<GenericDao<?,?>>>();
      _parentLocator=null;
      return;
    }
    s_logger.info("Config file found at " + file.getAbsolutePath() + ".  Configuring "+ _serverName);
    XmlHandler handler=new XmlHandler(_serverName);
    saxParser.parse(file,handler);
    _daoMap=new LinkedHashMap<String,ComponentInfo<GenericDao<?,? extends Serializable>>>();
    _managerMap=new LinkedHashMap<String,ComponentInfo<Manager>>();
    _adapterMap=new HashMap<String,Adapters<? extends Adapter>>();
    if (handler.parent != null) {
synchronized (s_locators) {
        _parentLocator=s_locators.get(handler.parent);
        if (_parentLocator == null) {
          _parentLocator=new ComponentLocator(handler.parent);
          s_locators.put(handler.parent,_parentLocator);
          _parentLocator.parse(filename,log4jFile);
        }
      }
    }
    ComponentLibrary library=null;
    if (handler.library != null) {
      Class<?> clazz=Class.forName(handler.library);
      library=(ComponentLibrary)clazz.newInstance();
      _daoMap.putAll(library.getDaos());
      _managerMap.putAll(library.getManagers());
    }
    _daoMap.putAll(handler.daos);
    _managerMap.putAll(handler.managers);
    startDaos();
    if (library != null) {
      instantiateAdapters(library.getAdapters());
    }
    instantiateAdapters(handler.adapters);
    instantiateManagers();
    _component=createInstance(handler.componentClass,true,true);
    configureManagers();
    configureAdapters();
    startManagers();
    startAdapters();
  }
 catch (  ParserConfigurationException e) {
    s_logger.error("Unable to load " + _serverName + " due to errors while parsing "+ filename,e);
    System.exit(1);
  }
catch (  SAXException e) {
    s_logger.error("Unable to load " + _serverName + " due to errors while parsing "+ filename,e);
    System.exit(1);
  }
catch (  IOException e) {
    s_logger.error("Unable to load " + _serverName + " due to errors while reading from "+ filename,e);
    System.exit(1);
  }
catch (  CloudRuntimeException e) {
    s_logger.error("Unable to load configuration for " + _serverName + " from "+ filename,e);
    System.exit(1);
  }
catch (  Exception e) {
    s_logger.error("Unable to load configuration for " + _serverName + " from "+ filename,e);
    System.exit(1);
  }
}
