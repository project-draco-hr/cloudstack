{
  PatternLayout layout=new PatternLayout("%c{1} - %m%n");
  RollingFileAppender rfa=new RollingFileAppender();
  rfa.setLayout(layout);
  String datePattern="yyyy-MM-dd_HH_mm_ss";
  TimeBasedRollingPolicy tbrp=new TimeBasedRollingPolicy();
  tbrp.setFileNamePattern("test3-%d{" + datePattern + "}.gz");
  tbrp.activateOptions();
  rfa.setRollingPolicy(tbrp);
  rfa.activateOptions();
  logger.addAppender(rfa);
  SimpleDateFormat sdf=new SimpleDateFormat(datePattern);
  String[] filenames=new String[4];
  Calendar cal=Calendar.getInstance();
  for (int i=0; i < 3; i++) {
    filenames[i]="test3-" + sdf.format(cal.getTime()) + ".gz";
    cal.add(Calendar.SECOND,1);
  }
  filenames[3]="test3-" + sdf.format(cal.getTime());
  System.out.println("Waiting until next second and 100 millis.");
  delayUntilNextSecond(100);
  System.out.println("Done waiting.");
  for (int i=0; i < 5; i++) {
    logger.debug("Hello---" + i);
    Thread.sleep(500);
  }
  for (int i=0; i < 4; i++) {
  }
  rfa.close();
  for (int i=0; i < 3; i++) {
    assertTrue(gzCompare(filenames[i],"witness/rolling/tbr-test3." + i + ".gz"));
  }
  assertTrue(compare(filenames[3],"witness/rolling/tbr-test3.3"));
}
