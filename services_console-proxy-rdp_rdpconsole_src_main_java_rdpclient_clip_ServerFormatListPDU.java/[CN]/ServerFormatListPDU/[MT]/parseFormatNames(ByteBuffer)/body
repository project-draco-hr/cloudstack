{
  Map<Object,ClipboardDataFormat> formats=new HashMap<Object,ClipboardDataFormat>();
  while (buf.cursor < buf.length) {
    int id=buf.readSignedIntLE();
    String name;
    if (state.serverUseLongFormatNames) {
      name=buf.readVariableWideString(RdpConstants.CHARSET_16);
    }
 else {
      Boolean asciiNames=(Boolean)buf.getMetadata(ServerClipRdrChannelRouter.ASCII_NAMES);
      if (asciiNames != null && asciiNames) {
        name=buf.readString(32,RdpConstants.CHARSET_8);
      }
 else {
        name=buf.readString(32,RdpConstants.CHARSET_16);
      }
    }
    formats.put(id,new ClipboardDataFormat(id,name));
    if (name.length() > 0)     formats.put(name,new ClipboardDataFormat(id,name));
  }
  if (verbose)   System.out.println("Server supports following formats for clipboard data: " + formats.values().toString() + ".");
  state.serverClipboardDataFormats=formats;
}
