@attr(tags=['simulator', 'basic', 'advanced'])
def test_DeployVmAntiAffinityGroup(self):
    '\n        Deploys a couple of VMs in the same affinity group and verifies they are not on the same host\n        '
    vm1 = VirtualMachine.create(self.api_client, self.services['virtual_machine'], templateid=self.template.id, accountid=self.account.account.name, domainid=self.account.account.domainid, serviceofferingid=self.service_offering.id, affinitygroupnames=self.ag.name, mode=self.services['mode'])
    list_vm1 = list_virtual_machines(self.api_client, id=vm1.id)
    self.assertEqual(isinstance(list_vm1, list), True, 'Check list response returns a valid list')
    self.assertNotEqual(len(list_vm1), 0, 'Check VM available in List Virtual Machines')
    vm1_response = list_vm1[0]
    self.assertEqual(vm1_response.state, 'Running', msg='VM is not in Running state')
    host_of_vm1 = vm1_response.hostid
    vm2 = VirtualMachine.create(self.api_client, self.services['virtual_machine'], templateid=self.template.id, accountid=self.account.account.name, domainid=self.account.account.domainid, serviceofferingid=self.service_offering.id, affinitygroupnames=self.ag.name, mode=self.services['mode'])
    list_vm2 = list_virtual_machines(self.api_client, id=self.vm1.id)
    self.assertEqual(isinstance(list_vm2, list), True, 'Check list response returns a valid list')
    self.assertNotEqual(len(list_vm2), 0, 'Check VM available in List Virtual Machines')
    vm2_response = list_vm2[0]
    self.assertEqual(vm2_response.state, 'Running', msg='VM is not in Running state')
    host_of_vm2 = vm2_response.hostid
    self.assertNotEqual(host_of_vm1, host_of_vm2, msg=('Both VMs of affinity group %s are on the same host' % self.ag.name))

    @classmethod
    def tearDown(cls):
        try:
            cls.api_client = super(TestDeployVmWithAffinityGroup, cls).getClsTestClient().getApiClient()
            cleanup_resources(cls.api_client, cls.cleanup)
        except Exception as e:
            raise Exception(('Warning: Exception during cleanup : %s' % e))
