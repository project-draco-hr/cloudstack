{
  if (accountObj.getType() == Account.ACCOUNT_TYPE_ADMIN)   return true;
  VMInstanceVO vm=_ms.findVMInstanceById(vmId);
switch (vm.getType()) {
case User:
case DomainRouter:
    if (vm.getAccountId() != accountObj.getId()) {
      if (accountObj.getType() == Account.ACCOUNT_TYPE_NORMAL) {
        if (s_logger.isDebugEnabled()) {
          s_logger.debug("VM access is denied. VM owner account " + vm.getAccountId() + " does not match the account id in session "+ accountObj.getId()+ " and caller is a normal user");
        }
        return false;
      }
      if (accountObj.getType() == Account.ACCOUNT_TYPE_DOMAIN_ADMIN || accountObj.getType() == Account.ACCOUNT_TYPE_READ_ONLY_ADMIN) {
        if (!_ms.isChildDomain(accountObj.getDomainId(),vm.getDomainId())) {
          if (s_logger.isDebugEnabled()) {
            s_logger.debug("VM access is denied. VM owner account " + vm.getAccountId() + " does not match the account id in session "+ accountObj.getId()+ " and the domain-admin caller does not manage the target domain");
          }
          return false;
        }
      }
    }
  break;
case ConsoleProxy:
case SecondaryStorageVm:
return false;
default :
s_logger.warn("Unrecoginized virtual machine type, deny access by default. type: " + vm.getType());
return false;
}
return true;
}
