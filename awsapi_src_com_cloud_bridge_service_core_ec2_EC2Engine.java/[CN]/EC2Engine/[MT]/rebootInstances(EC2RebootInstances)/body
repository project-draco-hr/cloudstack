{
  EC2Instance[] vms=null;
  try {
    String[] instanceSet=request.getInstancesSet();
    EC2DescribeInstancesResponse previousState=listVirtualMachines(instanceSet,null,null);
    vms=previousState.getInstanceSet();
    for (    EC2Instance vm : vms) {
      if (vm.getState().equalsIgnoreCase("Destroyed"))       continue;
      CloudStackUserVm resp=getApi().rebootVirtualMachine(vm.getId());
      if (logger.isDebugEnabled())       logger.debug("Rebooting VM " + resp.getId() + " job "+ resp.getJobId());
    }
    if (instanceSet.length != vms.length)     throw new Exception("One or more instanceIds do not exist, other instances rebooted.");
    return true;
  }
 catch (  Exception e) {
    logger.error("EC2 RebootInstances - ",e);
    handleException(e);
  }
  return false;
}
