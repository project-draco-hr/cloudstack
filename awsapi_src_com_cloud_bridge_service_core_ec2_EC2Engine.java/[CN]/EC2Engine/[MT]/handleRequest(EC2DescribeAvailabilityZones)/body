{
  try {
    EC2DescribeAvailabilityZonesResponse availableZones=listZones(request.getZoneSet(),null);
    EC2AvailabilityZonesFilterSet azfs=request.getFilterSet();
    if (null == azfs)     return availableZones;
 else {
      List<String> matchedAvailableZones=azfs.evaluate(availableZones);
      if (matchedAvailableZones.isEmpty())       return new EC2DescribeAvailabilityZonesResponse();
      return listZones(matchedAvailableZones.toArray(new String[0]),null);
    }
  }
 catch (  EC2ServiceException error) {
    logger.error("EC2 DescribeAvailabilityZones - ",error);
    throw error;
  }
catch (  Exception e) {
    logger.error("EC2 DescribeAvailabilityZones - ",e);
    throw new EC2ServiceException(ServerError.InternalError,e.getMessage() != null ? e.getMessage() : "An unexpected error occurred.");
  }
}
