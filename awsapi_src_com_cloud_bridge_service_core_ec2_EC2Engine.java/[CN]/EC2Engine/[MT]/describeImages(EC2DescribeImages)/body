{
  EC2DescribeImagesResponse images=new EC2DescribeImagesResponse();
  try {
    String[] templateIds=request.getImageSet();
    EC2ImageFilterSet ifs=request.getFilterSet();
    if (templateIds.length == 0) {
      images=listTemplates(null,images);
    }
 else {
      for (      String s : templateIds) {
        images=listTemplates(s,images);
      }
    }
    if (ifs == null)     return images;
 else     return ifs.evaluate(images);
  }
 catch (  Exception e) {
    logger.error("EC2 DescribeImages - ",e);
    throw new EC2ServiceException(ServerError.InternalError,e.getMessage() != null ? e.getMessage() : "An unexpected error occurred.");
  }
}
