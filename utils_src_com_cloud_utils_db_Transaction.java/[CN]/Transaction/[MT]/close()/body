{
  removeUpTo(CURRENT_TXN,null);
  if (_stack.size() == 0) {
    s_logger.trace("Transaction is done");
    cleanup();
  }
  if (this._dbId == CONNECTED_DB) {
    tls.set(_prev);
    _prev=null;
    try {
      s_logger.debug("Unregistering txn" + System.identityHashCode(this));
      JmxUtil.unregisterMBean("Transaction","txn" + System.identityHashCode(this));
    }
 catch (    Exception e) {
      s_logger.error("Unable to unregister MBean",e);
    }
  }
}
