{
  Network network=firewall.getNetwork();
  VirtualRouter router=firewall.getRouter();
  List<? extends FirewallRule> rules=firewall.getRules();
  List<LoadBalancingRule> loadbalancingRules=firewall.getLoadbalancingRules();
  Purpose purpose=firewall.getPurpose();
  final Commands cmds=new Commands(Command.OnError.Continue);
  if (purpose == Purpose.LoadBalancing) {
    firewall.createApplyLoadBalancingRulesCommands(loadbalancingRules,router,cmds,network.getId());
    return applianceManager.sendCommandsToRouter(router,cmds);
  }
 else   if (purpose == Purpose.PortForwarding) {
    firewall.createApplyPortForwardingRulesCommands((List<? extends PortForwardingRule>)rules,router,cmds,network.getId());
    return applianceManager.sendCommandsToRouter(router,cmds);
  }
 else   if (purpose == Purpose.StaticNat) {
    firewall.createApplyStaticNatRulesCommands((List<StaticNatRule>)rules,router,cmds,network.getId());
    return applianceManager.sendCommandsToRouter(router,cmds);
  }
 else   if (purpose == Purpose.Firewall) {
    firewall.createApplyFirewallRulesCommands(rules,router,cmds,network.getId());
    return applianceManager.sendCommandsToRouter(router,cmds);
  }
  s_logger.warn("Unable to apply rules of purpose: " + rules.get(0).getPurpose());
  return false;
}
