{
  try {
    s_logger.debug("HostStatsCollector is running...");
    SearchCriteria<HostVO> sc=_hostDao.createSearchCriteria();
    sc.addAnd("status",SearchCriteria.Op.EQ,Status.Up.toString());
    sc.addAnd("type",SearchCriteria.Op.NEQ,Host.Type.Storage.toString());
    sc.addAnd("type",SearchCriteria.Op.NEQ,Host.Type.ConsoleProxy.toString());
    sc.addAnd("type",SearchCriteria.Op.NEQ,Host.Type.SecondaryStorage.toString());
    ConcurrentHashMap<Long,HostStats> hostStats=new ConcurrentHashMap<Long,HostStats>();
    List<HostVO> hosts=_hostDao.search(sc,null);
    for (    HostVO host : hosts) {
      if (host.getId() != null) {
        HostStatsEntry stats=(HostStatsEntry)_agentMgr.getHostStatistics(host.getId());
        if (stats != null) {
          hostStats.put(host.getId(),stats);
        }
 else {
          s_logger.warn("Received invalid host stats for host: " + host.getId());
        }
      }
 else {
        s_logger.warn("Host: " + host.getId() + " does not exist, skipping host statistics");
      }
    }
    _hostStats=hostStats;
  }
 catch (  Throwable t) {
    s_logger.error("Error trying to retrieve host stats",t);
  }
}
