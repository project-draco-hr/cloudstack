{
  String spId=_samlAuthManager.getServiceProviderId();
  String consumerUrl=_samlAuthManager.getSpSingleSignOnUrl();
  String identityProviderUrl=_samlAuthManager.getIdpSingleSignOnUrl();
  if (idpUrl != null) {
    identityProviderUrl=idpUrl;
  }
  String redirectUrl="";
  try {
    DefaultBootstrap.bootstrap();
    AuthnRequest authnRequest=SAMLUtils.buildAuthnRequestObject(spId,identityProviderUrl,consumerUrl);
    redirectUrl="SAMLRequest=" + SAMLUtils.encodeSAMLRequest(authnRequest);
    redirectUrl=identityProviderUrl + "?" + SAMLUtils.generateSAMLRequestSignature(redirectUrl,privateKey);
  }
 catch (  ConfigurationException|FactoryConfigurationError|MarshallingException|IOException|SignatureException|NoSuchAlgorithmException|InvalidKeyException|java.security.SignatureException e) {
    s_logger.error("SAML AuthnRequest message building error: " + e.getMessage());
  }
  return redirectUrl;
}
