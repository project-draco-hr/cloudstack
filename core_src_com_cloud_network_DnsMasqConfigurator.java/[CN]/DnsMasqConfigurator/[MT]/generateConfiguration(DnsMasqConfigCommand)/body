{
  List<DhcpTO> dhcpTOs=dnsMasqconfigcmd.getIps();
  List<String> dnsMasqconf=Arrays.asList(Dnsmasq_config);
  String range="";
  String gateway="";
  String netmask="";
  String domain=dnsMasqconfigcmd.getDomain();
  String dnsServers="";
  String dns_external="";
  if (dnsMasqconfigcmd.getDns1() != null) {
    dns_external=dnsMasqconfigcmd.getDns1() + ",";
  }
  if (dnsMasqconfigcmd.getDns2() != null) {
    dns_external=dns_external + dnsMasqconfigcmd.getDns2() + ",";
  }
  dns_external=dns_external + "*";
  dns_external=dns_external.replace(",*","");
  int i=0;
  for (; i < dhcpTOs.size(); i++) {
    range=range + "dhcp-range=set:range" + i+ ","+ dhcpTOs.get(i).getStartIpOfSubnet()+ ",static\n";
    gateway=gateway + "dhcp-option=tag:range" + i+ ",3,"+ dhcpTOs.get(i).getGateway()+ "\n";
    netmask=netmask + "dhcp-option=tag:range" + i+ ",1,"+ dhcpTOs.get(i).getNetmask()+ "\n";
    if (!dnsMasqconfigcmd.isDnsProvided()) {
      dnsServers=dnsServers + "dhcp-option=tag:range" + i+ ",6,"+ dns_external+ "\n";
    }
 else {
      dnsServers=dnsServers + "dhcp-option=tag:range" + i+ ",6,"+ dhcpTOs.get(i).getRouterIp()+ ","+ dns_external+ "\n";
    }
  }
  String domain_suffix=dnsMasqconfigcmd.getDomainSuffix();
  if (domain != null) {
    if (domain_suffix != null) {
      dnsMasqconf.get(5).replace(" local=/cs1cloud.internal/"," local=/" + domain + "/");
      dnsMasqconf.set(12,"domain=" + domain_suffix + domain+ "\n");
      dnsMasqconf.set(14,"domain=" + domain_suffix + domain+ "\n");
      dnsMasqconf.set(16,"domain=" + domain_suffix + domain+ "\n");
    }
 else {
      dnsMasqconf.get(5).replace(" local=/cs1cloud.internal/"," local=/" + domain + "/");
      dnsMasqconf.set(12,"domain=" + domain + "\n");
      dnsMasqconf.set(14,"domain=" + domain + "\n");
      dnsMasqconf.set(16,"domain=" + domain + "\n");
    }
  }
 else {
    dnsMasqconf.get(5).replace(" local=/cs1cloud.internal/"," local=/" + domain + "/");
    dnsMasqconf.set(12,"domain=" + "cloudnine.internal\n");
    dnsMasqconf.set(14,"domain=" + "cloudnine.internal\n");
    dnsMasqconf.set(16,"domain=" + "cloudnine.internal\n");
  }
  dnsMasqconf.set(18,range);
  dnsMasqconf.set(22,gateway);
  dnsMasqconf.set(23,netmask);
  dnsMasqconf.set(24,dnsServers);
  return dnsMasqconf.toArray(new String[dnsMasqconf.size()]);
}
