{
  _resource.configure("NiciraNvpResource",_parameters);
  LogicalRouterConfig lrc=mock(LogicalRouterConfig.class);
  LogicalRouterPort lrp=mock(LogicalRouterPort.class);
  LogicalSwitchPort lsp=mock(LogicalSwitchPort.class);
  when(lrc.getUuid()).thenReturn("ccccc");
  when(lrp.getUuid()).thenReturn("ddddd").thenReturn("eeeee");
  when(lsp.getUuid()).thenReturn("fffff");
  when(_nvpApi.createLogicalRouter((LogicalRouterConfig)any())).thenReturn(lrc);
  when(_nvpApi.createLogicalRouterPort(eq("ccccc"),(LogicalRouterPort)any())).thenReturn(lrp);
  when(_nvpApi.createLogicalSwitchPort(eq("bbbbb"),(LogicalSwitchPort)any())).thenReturn(lsp);
  when(_nvpApi.createLogicalRouterNatRule((String)any(),(NatRule)any())).thenThrow(new NiciraNvpApiException());
  CreateLogicalRouterCommand clrc=new CreateLogicalRouterCommand("aaaaa",50,"bbbbb","lrouter","publiccidr","nexthop","internalcidr","owner");
  CreateLogicalRouterAnswer clra=(CreateLogicalRouterAnswer)_resource.executeRequest(clrc);
  assertFalse(clra.getResult());
  verify(_nvpApi,atLeast(1)).deleteLogicalRouter(eq("ccccc"));
  verify(_nvpApi,atLeast(1)).deleteLogicalSwitchPort(eq("bbbbb"),eq("fffff"));
}
