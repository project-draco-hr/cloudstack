{
  resource.configure("NiciraNvpResource",parameters);
  LogicalRouterConfig lrc=mock(LogicalRouterConfig.class);
  LogicalRouterPort lrp=mock(LogicalRouterPort.class);
  LogicalSwitchPort lsp=mock(LogicalSwitchPort.class);
  when(lrc.getUuid()).thenReturn("ccccc");
  when(lrp.getUuid()).thenReturn("ddddd").thenReturn("eeeee");
  when(lsp.getUuid()).thenReturn("fffff");
  when(nvpApi.createLogicalRouter((LogicalRouterConfig)any())).thenReturn(lrc);
  when(nvpApi.createLogicalRouterPort(eq("ccccc"),(LogicalRouterPort)any())).thenReturn(lrp);
  when(nvpApi.createLogicalSwitchPort(eq("bbbbb"),(LogicalSwitchPort)any())).thenReturn(lsp);
  when(nvpApi.createLogicalRouterNatRule((String)any(),(NatRule)any())).thenThrow(new NiciraNvpApiException());
  CreateLogicalRouterCommand clrc=new CreateLogicalRouterCommand("aaaaa",50,"bbbbb","lrouter","publiccidr","nexthop","internalcidr","owner");
  CreateLogicalRouterAnswer clra=(CreateLogicalRouterAnswer)resource.executeRequest(clrc);
  assertFalse(clra.getResult());
  verify(nvpApi,atLeast(1)).deleteLogicalRouter(eq("ccccc"));
  verify(nvpApi,atLeast(1)).deleteLogicalSwitchPort(eq("bbbbb"),eq("fffff"));
}
