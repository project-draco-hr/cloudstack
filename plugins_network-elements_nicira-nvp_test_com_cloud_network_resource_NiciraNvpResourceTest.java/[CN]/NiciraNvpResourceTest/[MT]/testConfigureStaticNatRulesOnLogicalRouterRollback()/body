{
  _resource.configure("NiciraNvpResource",_parameters);
  ConfigureStaticNatRulesOnLogicalRouterCommand cmd=mock(ConfigureStaticNatRulesOnLogicalRouterCommand.class);
  StaticNatRuleTO rule=new StaticNatRuleTO(1,"11.11.11.11",null,null,"10.10.10.10",null,null,null,false,false);
  List<StaticNatRuleTO> rules=new ArrayList<StaticNatRuleTO>();
  rules.add(rule);
  when(cmd.getRules()).thenReturn(rules);
  when(cmd.getLogicalRouterUuid()).thenReturn("aaaaa");
  NatRule[] rulepair=_resource.generateStaticNatRulePair("10.10.10.10","11.11.11.11");
  rulepair[0].setUuid("bbbbb");
  rulepair[1].setUuid("ccccc");
  when(_nvpApi.createLogicalRouterNatRule(eq("aaaaa"),(NatRule)any())).thenReturn(rulepair[0]).thenThrow(new NiciraNvpApiException());
  @SuppressWarnings("unchecked") NiciraNvpList<NatRule> storedRules=mock(NiciraNvpList.class);
  when(storedRules.getResultCount()).thenReturn(0);
  when(_nvpApi.findNatRulesByLogicalRouterUuid("aaaaa")).thenReturn(storedRules);
  ConfigureStaticNatRulesOnLogicalRouterAnswer a=(ConfigureStaticNatRulesOnLogicalRouterAnswer)_resource.executeRequest(cmd);
  assertFalse(a.getResult());
  verify(_nvpApi,atLeastOnce()).deleteLogicalRouterNatRule(eq("aaaaa"),eq("bbbbb"));
}
