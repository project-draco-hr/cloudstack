{
  resource.configure("NiciraNvpResource",parameters);
  final LogicalSwitchPort lsp=mock(LogicalSwitchPort.class);
  when(lsp.getUuid()).thenReturn("eeee");
  when(nvpApi.createLogicalSwitchPort(eq("cccc"),(LogicalSwitchPort)any())).thenReturn(lsp);
  doThrow(new NiciraNvpApiException()).when(nvpApi).updateLogicalSwitchPortAttachment((String)any(),(String)any(),(Attachment)any());
  final CreateLogicalSwitchPortCommand clspc=new CreateLogicalSwitchPortCommand("cccc","dddd","owner","nicname");
  final CreateLogicalSwitchPortAnswer clspa=(CreateLogicalSwitchPortAnswer)resource.executeRequest(clspc);
  assertFalse(clspa.getResult());
  verify(nvpApi,atLeastOnce()).deleteLogicalSwitchPort((String)any(),(String)any());
}
