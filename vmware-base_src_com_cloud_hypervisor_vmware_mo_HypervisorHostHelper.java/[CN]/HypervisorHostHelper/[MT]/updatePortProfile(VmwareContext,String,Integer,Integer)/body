{
  if (vlanId == null) {
    s_logger.info("Skipping update operation over ethernet port profile " + ethPortProfileName + " for untagged VLAN.");
    return;
  }
  s_logger.info("Updating vEthernet port profile with VLAN " + vlanId);
  Map<String,String> vsmCredentials=getValidatedVsmCredentials(context);
  String vsmIp=vsmCredentials.get("vsmip");
  String vsmUserName=vsmCredentials.get("vsmusername");
  String vsmPassword=vsmCredentials.get("vsmpassword");
  String msg;
  NetconfHelper netconfClient;
  try {
    netconfClient=new NetconfHelper(vsmIp,vsmUserName,vsmPassword);
  }
 catch (  CloudRuntimeException e) {
    msg="Failed to connect to Nexus VSM " + vsmIp + " with credentials of user "+ vsmUserName;
    s_logger.error(msg);
    throw new CloudRuntimeException(msg);
  }
  List<Pair<OperationType,String>> params=new ArrayList<Pair<OperationType,String>>();
  params.add(new Pair<OperationType,String>(OperationType.addvlanid,vlanId.toString()));
  try {
    netconfClient.updatePortProfile(ethPortProfileName,SwitchPortMode.trunk,params);
  }
 catch (  CloudRuntimeException e) {
    msg="Failed to modify ethernet port profile " + ethPortProfileName + " with parameters "+ params.toString();
    s_logger.error(msg);
    throw new CloudRuntimeException(msg);
  }
 finally {
    if (netconfClient != null) {
      netconfClient.disconnect();
      s_logger.debug("Disconnected VSM session.");
    }
  }
}
