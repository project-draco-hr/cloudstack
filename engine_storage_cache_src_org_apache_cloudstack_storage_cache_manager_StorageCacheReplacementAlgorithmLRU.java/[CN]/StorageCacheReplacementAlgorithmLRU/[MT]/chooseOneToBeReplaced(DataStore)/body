{
  Calendar cal=Calendar.getInstance();
  cal.setTime(DateUtil.now());
  cal.add(Calendar.DAY_OF_MONTH,-unusedTimeInterval.intValue());
  Date bef=cal.getTime();
  SearchCriteriaService<TemplateDataStoreVO,TemplateDataStoreVO> sc=SearchCriteria2.create(TemplateDataStoreVO.class);
  sc.addAnd(sc.getEntity().getLastUpdated(),SearchCriteria.Op.LT,bef);
  sc.addAnd(sc.getEntity().getState(),SearchCriteria.Op.EQ,ObjectInDataStoreStateMachine.State.Ready);
  sc.addAnd(sc.getEntity().getDataStoreId(),SearchCriteria.Op.EQ,store.getId());
  sc.addAnd(sc.getEntity().getDataStoreRole(),SearchCriteria.Op.EQ,store.getRole());
  sc.addAnd(sc.getEntity().getRefCnt(),SearchCriteria.Op.EQ,0);
  TemplateDataStoreVO template=sc.find();
  if (template != null) {
    return templateFactory.getTemplate(template.getTemplateId(),store);
  }
  SearchCriteriaService<VolumeDataStoreVO,VolumeDataStoreVO> volSc=SearchCriteria2.create(VolumeDataStoreVO.class);
  volSc.addAnd(volSc.getEntity().getLastUpdated(),SearchCriteria.Op.LT,bef);
  volSc.addAnd(volSc.getEntity().getState(),SearchCriteria.Op.EQ,ObjectInDataStoreStateMachine.State.Ready);
  volSc.addAnd(volSc.getEntity().getDataStoreId(),SearchCriteria.Op.EQ,store.getId());
  volSc.addAnd(volSc.getEntity().getRefCnt(),SearchCriteria.Op.EQ,0);
  VolumeDataStoreVO volume=volSc.find();
  if (volume != null) {
    return volumeFactory.getVolume(volume.getVolumeId(),store);
  }
  SearchCriteriaService<SnapshotDataStoreVO,SnapshotDataStoreVO> snapshotSc=SearchCriteria2.create(SnapshotDataStoreVO.class);
  snapshotSc.addAnd(snapshotSc.getEntity().getLastUpdated(),SearchCriteria.Op.LT,bef);
  snapshotSc.addAnd(snapshotSc.getEntity().getState(),SearchCriteria.Op.EQ,ObjectInDataStoreStateMachine.State.Ready);
  snapshotSc.addAnd(snapshotSc.getEntity().getDataStoreId(),SearchCriteria.Op.EQ,store.getId());
  snapshotSc.addAnd(snapshotSc.getEntity().getRole(),SearchCriteria.Op.EQ,store.getRole());
  snapshotSc.addAnd(snapshotSc.getEntity().getRefCnt(),SearchCriteria.Op.EQ,0);
  SnapshotDataStoreVO snapshot=snapshotSc.find();
  if (snapshot != null) {
    return snapshotFactory.getSnapshot(snapshot.getSnapshotId(),store);
  }
  return null;
}
