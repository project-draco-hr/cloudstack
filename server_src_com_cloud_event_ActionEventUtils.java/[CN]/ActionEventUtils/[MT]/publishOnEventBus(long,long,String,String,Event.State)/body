{
  try {
    _eventBus=ComponentContext.getComponent(EventBus.class);
  }
 catch (  NoSuchBeanDefinitionException nbe) {
    return;
  }
  String entityType=null;
  String entityUuid=null;
  UserContext context=UserContext.current();
  if (context != null) {
    entityType=context.getEntityType();
    entityUuid=context.getEntityUUID();
  }
  org.apache.cloudstack.framework.events.Event event=new org.apache.cloudstack.framework.events.Event(ManagementServer.Name,eventCategory,eventType,EventTypes.getEntityForEvent(eventType),null);
  Map<String,String> eventDescription=new HashMap<String,String>();
  Account account=_accountDao.findById(accountId);
  User user=_userDao.findById(userId);
  if (account == null)   return;
  if (user == null)   return;
  eventDescription.put("user",user.getUuid());
  eventDescription.put("account",account.getUuid());
  eventDescription.put("event",eventType);
  eventDescription.put("status",state.toString());
  eventDescription.put("entity",entityType);
  eventDescription.put("entityuuid",entityUuid);
  event.setDescription(eventDescription);
  try {
    _eventBus.publish(event);
  }
 catch (  EventBusException e) {
    s_logger.warn("Failed to publish action event on the the event bus.");
  }
}
