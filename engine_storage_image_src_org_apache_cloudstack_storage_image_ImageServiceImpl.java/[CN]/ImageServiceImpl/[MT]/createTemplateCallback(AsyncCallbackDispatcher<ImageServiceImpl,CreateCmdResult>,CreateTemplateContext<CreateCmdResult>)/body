{
  TemplateObject template=(TemplateObject)context.srcTemplate;
  AsyncCallFuture<CommandResult> future=context.future;
  CommandResult result=new CommandResult();
  DataObject templateOnStore=context.templateOnStore;
  CreateCmdResult callbackResult=callback.getResult();
  if (callbackResult.isFailed()) {
    try {
      templateOnStore.processEvent(ObjectInDataStoreStateMachine.Event.OperationFailed);
      template.stateTransit(TemplateEvent.OperationFailed);
    }
 catch (    NoTransitionException e) {
      s_logger.debug("Failed to update template state",e);
    }
    result.setResult(callbackResult.getResult());
    future.complete(result);
    return null;
  }
  try {
    templateOnStore.processEvent(ObjectInDataStoreStateMachine.Event.OperationSuccessed);
    template.stateTransit(TemplateEvent.OperationSucceeded);
  }
 catch (  NoTransitionException e) {
    s_logger.debug("Failed to transit state",e);
    result.setResult(e.toString());
    future.complete(result);
    return null;
  }
  future.complete(result);
  return null;
}
