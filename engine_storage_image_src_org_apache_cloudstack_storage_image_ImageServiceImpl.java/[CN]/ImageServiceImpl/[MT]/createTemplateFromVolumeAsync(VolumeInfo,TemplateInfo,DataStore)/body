{
  AsyncCallFuture<CommandResult> future=new AsyncCallFuture<CommandResult>();
  DataObject templateOnStore=null;
  try {
    templateOnStore=store.create(template);
    templateOnStore.processEvent(Event.CreateOnlyRequested);
    CopyTemplateContext<CommandResult> context=new CopyTemplateContext<CommandResult>(null,future,templateOnStore);
    AsyncCallbackDispatcher<ImageServiceImpl,CopyCommandResult> caller=AsyncCallbackDispatcher.create(this);
    caller.setCallback(caller.getTarget().copyTemplateAsyncCallback(null,null)).setContext(context);
    this.motionSrv.copyAsync(volume,templateOnStore,caller);
  }
 catch (  Exception e) {
    s_logger.debug("Failed to create template: " + template.getId() + "from volume: "+ volume.getId()+ ", due to "+ e.toString());
    if (templateOnStore != null) {
      try {
        templateOnStore.processEvent(Event.OperationFailed);
      }
 catch (      Exception e1) {
      }
    }
    CommandResult result=new CommandResult();
    result.setResult(e.toString());
    future.complete(result);
  }
  return future;
}
