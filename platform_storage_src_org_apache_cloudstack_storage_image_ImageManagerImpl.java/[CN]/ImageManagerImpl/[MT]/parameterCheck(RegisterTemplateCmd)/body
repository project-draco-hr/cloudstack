{
  Long zoneId=cmd.getZoneId();
  if (zoneId == -1) {
    zoneId=null;
  }
  ImageFormat imgfmt=ImageFormat.valueOf(cmd.getFormat().toUpperCase());
  if (imgfmt == null) {
    throw new IllegalArgumentException("Image format is incorrect " + cmd.getFormat() + ". Supported formats are "+ EnumUtils.listValues(ImageFormat.values()));
  }
  if (zoneId != null) {
    DataCenterVO zone=_dcDao.findById(zoneId);
    if (zone == null) {
      throw new IllegalArgumentException("Please specify a valid zone.");
    }
  }
  List<VMTemplateVO> systemvmTmplts=_templateDao.listAllSystemVMTemplates();
  for (  VMTemplateVO template : systemvmTmplts) {
    if (template.getName().equalsIgnoreCase(cmd.getTemplateName()) || template.getDisplayText().equalsIgnoreCase(cmd.getDisplayText())) {
      throw new IllegalArgumentException("Cannot use reserved names for templates");
    }
  }
  return true;
}
