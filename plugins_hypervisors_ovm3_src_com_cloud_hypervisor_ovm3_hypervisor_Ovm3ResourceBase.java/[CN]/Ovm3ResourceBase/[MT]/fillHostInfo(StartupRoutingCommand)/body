{
  try {
    Linux host=new Linux(c);
    if (!host.getOvmVersion().startsWith("3.2.")) {
      throw new CloudRuntimeException("OVM 3.2.X is only supported, not " + host.getOvmVersion());
    }
    Xen vms=new Xen(c);
    vms.listVms();
    Xen.Vm dom0=vms.getRunningVmConfig("Domain-0");
    cmd.setName(host.getHostName());
    cmd.setSpeed(host.getCpuKhz());
    cmd.setCpus(host.getTotalThreads());
    cmd.setCpuSockets(host.getCpuSockets());
    cmd.setMemory(host.getMemory().longValue());
    BigInteger totalmem=BigInteger.valueOf(host.getMemory().longValue());
    BigInteger freemem=BigInteger.valueOf(host.getFreeMemory().longValue());
    cmd.setDom0MinMemory(totalmem.subtract(freemem).longValue());
    cmd.setGuid(_guid);
    cmd.setDataCenter(_zoneId.toString());
    cmd.setPod(_podId.toString());
    cmd.setCluster(_clusterId.toString());
    cmd.setHypervisorVersion(host.getOvmVersion());
    cmd.setVersion(host.getAgentVersion());
    cmd.setHypervisorType(HypervisorType.Ovm3);
    cmd.setCaps(host.getCapabilities());
    cmd.setPrivateIpAddress(_ip);
    cmd.setStorageIpAddress(_ip);
    cmd.setHostVmStateReport(HostVmStateReport());
    Network net=new Network(c);
    String defaultBridge=net.getBridgeByIp(_ip).getName();
    if (defaultBridge == null) {
      throw new CloudRuntimeException("Unable to obtain valid bridge with " + _ip);
    }
    if (_publicNetworkName == null) {
      _publicNetworkName=defaultBridge;
    }
    if (_privateNetworkName == null) {
      _privateNetworkName=_publicNetworkName;
    }
    if (_guestNetworkName == null) {
      _guestNetworkName=_publicNetworkName;
    }
    Map<String,String> d=cmd.getHostDetails();
    d.put("public.network.device",_publicNetworkName);
    if (_privateNetworkName != null)     d.put("private.network.device",_privateNetworkName);
    if (_guestNetworkName != null)     d.put("guest.network.device",_guestNetworkName);
    if (_storageNetworkName != null)     d.put("storage.network.device",_storageNetworkName);
    d.put("ismaster",this._isMaster.toString());
    cmd.setHostDetails(d);
    s_logger.debug("Add an Ovm3 host " + _name + ":"+ cmd.getHostDetails());
  }
 catch (  XmlRpcException e) {
    s_logger.debug("XML RPC Exception" + e.getMessage(),e);
    throw new CloudRuntimeException("XML RPC Exception" + e.getMessage(),e);
  }
catch (  Exception e) {
    s_logger.debug("Exception " + e.getMessage(),e);
    throw new CloudRuntimeException("Exception" + e.getMessage(),e);
  }
}
