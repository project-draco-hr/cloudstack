{
  StorageFilerTO primaryStorage=cmd.getPool();
  DiskProfile disk=cmd.getDiskCharacteristics();
  String fileName=UUID.randomUUID().toString() + ".img";
  String dst=primaryStorage.getPath() + "/" + primaryStorage.getUuid()+ "/"+ fileName;
  try {
    StoragePlugin store=new StoragePlugin(c);
    store.setUuid(primaryStorage.getUuid());
    store.setName(primaryStorage.getUserInfo());
    store.setSsUuid(primaryStorage.getUserInfo());
    if (cmd.getTemplateUrl() != null) {
      s_logger.debug("CreateCommand " + cmd.getTemplateUrl() + " "+ dst);
      Linux host=new Linux(c);
      host.copyFile(cmd.getTemplateUrl(),dst);
    }
 else {
      s_logger.debug("CreateCommand " + dst);
      store.storagePluginCreate(primaryStorage.getUuid(),primaryStorage.getHost(),dst,disk.getSize());
    }
    store.storagePluginGetFileInfo(dst);
    VolumeTO volume=new VolumeTO(cmd.getVolumeId(),disk.getType(),primaryStorage.getType(),primaryStorage.getUuid(),primaryStorage.getPath(),fileName,store.getFileName(),store.getFileSize(),null);
    return new CreateAnswer(cmd,volume);
  }
 catch (  Exception e) {
    s_logger.debug("CreateCommand failed",e);
    return new CreateAnswer(cmd,e.getMessage());
  }
}
