{
  Xen xen=new Xen(c);
  String doThis=(isAttach) ? "AttachIso" : "DettachIso";
  String msg=null;
  try {
    Xen.Vm vm=xen.getVmConfig(vmName);
    if (vm == null) {
      msg=doThis + " can't find VM " + vmName;
      return msg;
    }
    TemplateObjectTO isoTO=(TemplateObjectTO)disk.getData();
    DataStoreTO store=isoTO.getDataStore();
    if (!(store instanceof NfsTO)) {
      msg=doThis + " unsupported protocol";
      return msg;
    }
    NfsTO nfsStore=(NfsTO)store;
    String secPoolUuid=setupSecondaryStorage(nfsStore.getUrl());
    String isoPath=_ovmSec + File.separator + secPoolUuid+ File.separator+ isoTO.getPath();
    s_logger.debug(doThis + " " + isoPath);
    if (isAttach) {
      vm.addIso(isoPath);
    }
 else {
      if (!vm.removeDisk(isoPath)) {
        msg=doThis + " failed for " + vmName+ " iso was not attached "+ isoPath;
        return msg;
      }
    }
    xen.configureVm(_ovmObject.deDash(vm.getPrimaryPoolUuid()),vm.getVmUuid());
    return msg;
  }
 catch (  Exception e) {
    msg=doThis + " failed for " + vmName+ " "+ e.getMessage();
    return msg;
  }
 finally {
    if (msg == null) {
      msg="success";
    }
    s_logger.debug(msg);
  }
}
