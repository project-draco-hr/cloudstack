{
  CloudStackPlugin cSp=new CloudStackPlugin(c);
  Map<String,String> stats=cSp.ovsDomUStats(vmName);
  Map<String,String> o_stats=this._vmStats.get(vmName);
  VmStatsEntry e=new VmStatsEntry();
  if (o_stats == null) {
    e.setNumCPUs(1);
    e.setNetworkReadKBs(0);
    e.setNetworkWriteKBs(0);
    e.setDiskReadKBs(0);
    e.setDiskWriteKBs(0);
    e.setDiskReadIOs(0);
    e.setDiskWriteIOs(0);
    e.setCPUUtilization(0);
    e.setEntityType("vm");
  }
 else {
    Integer cpus=Integer.parseInt(stats.get("vcpus"));
    e.setNumCPUs(Integer.parseInt(stats.get(cpus)));
    e.setNetworkReadKBs(Double.parseDouble(stats.get("rx_bytes")) - Double.parseDouble(o_stats.get("rx_bytes")));
    e.setNetworkWriteKBs(Double.parseDouble(stats.get("tx_bytes")) - Double.parseDouble(o_stats.get("tx_bytes")));
    ;
    e.setDiskReadKBs(Double.parseDouble(stats.get("rd_bytes")) - Double.parseDouble(o_stats.get("rd_bytes")));
    ;
    e.setDiskWriteKBs(Double.parseDouble(stats.get("rw_bytes")) - Double.parseDouble(o_stats.get("rw_bytes")));
    e.setDiskReadIOs(Double.parseDouble(stats.get("rd_ops")) - Double.parseDouble(o_stats.get("rd_ops")));
    e.setDiskWriteIOs(Double.parseDouble(stats.get("rw_ops")) - Double.parseDouble(o_stats.get("rw_ops")));
    Double d_cpu=Double.parseDouble(stats.get("cputime")) - Double.parseDouble(o_stats.get("cputime"));
    Double d_time=Double.parseDouble(stats.get("uptime")) - Double.parseDouble(o_stats.get("uptime"));
    Double cpupct=d_cpu / d_time * 100 * cpus;
    e.setCPUUtilization(cpupct);
    e.setEntityType("vm");
  }
  this._vmStats.replace(vmName,stats);
  return e;
}
