{
  for (  DiskTO volume : spec.getDisks()) {
    try {
      if (volume.getType() == Volume.Type.ROOT) {
        VolumeObjectTO vol=(VolumeObjectTO)volume.getData();
        DataStoreTO ds=(DataStoreTO)vol.getDataStore();
        String dsk=vol.getPath() + "/" + vol.getUuid()+ ".raw";
        vm.addRootDisk(dsk);
        vm.setPrimaryPoolUuid(ds.getUuid());
        s_logger.debug("Adding root disk: " + dsk);
      }
 else       if (volume.getType() == Volume.Type.ISO) {
        DataTO isoTO=volume.getData();
        if (isoTO.getPath() != null) {
          TemplateObjectTO template=(TemplateObjectTO)isoTO;
          DataStoreTO store=template.getDataStore();
          if (!(store instanceof NfsTO)) {
            throw new CloudRuntimeException("unsupported protocol");
          }
          NfsTO nfsStore=(NfsTO)store;
          String secPoolUuid=setupSecondaryStorage(nfsStore.getUrl());
          String isoPath=this._ovmSec + File.separator + secPoolUuid+ File.separator+ template.getPath();
          vm.addIso(isoPath);
          s_logger.debug("Adding ISO: " + isoPath);
        }
      }
 else       if (volume.getType() == Volume.Type.DATADISK) {
        vm.addDataDisk(volume.getData().getPath());
        s_logger.debug("Adding data disk: " + volume.getData().getPath());
      }
 else {
        throw new CloudRuntimeException("Unknown volume type: " + volume.getType());
      }
    }
 catch (    Exception e) {
      s_logger.debug("CreateVbds failed",e);
      throw new CloudRuntimeException("Exception" + e.getMessage(),e);
    }
  }
  return true;
}
