{
  if (s_logger.isTraceEnabled()) {
    s_logger.trace("Begin scanning directly connected hosts");
  }
  long cutSeconds=(System.currentTimeMillis() >> 10) - (_pingInterval * 3);
  List<HostVO> hosts=_hostDao.findDirectAgentToLoad(_clusterMgr.getManagementNodeId(),cutSeconds,_loadSize);
  if (hosts != null && hosts.size() == _loadSize) {
    Long clusterId=hosts.get((int)(_loadSize - 1)).getClusterId();
    if (clusterId != null) {
      for (int i=(int)(_loadSize - 1); i > 0; i--) {
        if (hosts.get(i).getClusterId() == clusterId) {
          hosts.remove(i);
        }
 else {
          break;
        }
      }
    }
  }
  if (hosts != null && hosts.size() > 0) {
    for (    HostVO host : hosts) {
      try {
        AgentAttache agentattache=findAttache(host.getId());
        if (agentattache != null) {
          if (agentattache.forForward()) {
            if (s_logger.isInfoEnabled()) {
              s_logger.info(host + " is detected down, but we have a forward attache running, disconnect this one before launching the host");
            }
            removeAgent(agentattache,Status.Disconnected);
          }
 else {
            continue;
          }
        }
        if (s_logger.isDebugEnabled()) {
          s_logger.debug("Loading directly connected host " + host.getId() + "("+ host.getName()+ ")");
        }
        loadDirectlyConnectedHost(host);
      }
 catch (      Throwable e) {
        s_logger.debug(" can not load directly connected host " + host.getId() + "("+ host.getName()+ ") due to "+ e.toString());
      }
    }
  }
  if (s_logger.isTraceEnabled()) {
    s_logger.trace("End scanning directly connected hosts");
  }
}
