{
  boolean result=true;
  if (currentOwnerId == _nodeId) {
    _agentToTransferIds.remove(hostId);
    if (!startRebalance(hostId)) {
      s_logger.debug("Failed to start agent rebalancing");
      failRebalance(hostId);
      return false;
    }
    try {
      Answer[] answer=sendRebalanceCommand(futureOwnerId,hostId,currentOwnerId,futureOwnerId,Event.StartAgentRebalance);
      if (answer == null || !answer[0].getResult()) {
        s_logger.warn("Host " + hostId + " failed to connect to the  management server "+ futureOwnerId+ " as a part of rebalance process");
        result=false;
      }
    }
 catch (    Exception ex) {
      s_logger.warn("Host " + hostId + " failed to connect to the  management server "+ futureOwnerId+ " as a part of rebalance process",ex);
      result=false;
    }
    if (result) {
      s_logger.debug("Got host id=" + hostId + " from management server "+ futureOwnerId);
      finishRebalance(hostId,futureOwnerId,Event.RebalanceCompleted);
    }
 else {
      finishRebalance(hostId,futureOwnerId,Event.RebalanceFailed);
    }
  }
 else   if (futureOwnerId == _nodeId) {
    HostVO host=_hostDao.findById(hostId);
    try {
      if (s_logger.isDebugEnabled()) {
        s_logger.debug("Loading directly connected host " + host.getId() + "("+ host.getName()+ ") as a part of rebalance process");
      }
      result=loadDirectlyConnectedHost(host,true);
    }
 catch (    Exception ex) {
      s_logger.warn("Unable to load directly connected host " + host.getId() + " as a part of rebalance due to exception: ",ex);
      result=false;
    }
  }
  return result;
}
