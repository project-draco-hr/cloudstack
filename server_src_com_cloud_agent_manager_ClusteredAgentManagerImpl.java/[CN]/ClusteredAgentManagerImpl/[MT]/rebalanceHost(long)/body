{
  HostTransferMapVO map=_hostTransferDao.findById(hostId);
  HostVO host=_hostDao.findById(hostId);
  boolean result=true;
  if (map.getInitialOwner() == _nodeId) {
    ClusteredDirectAgentAttache attache=(ClusteredDirectAgentAttache)findAttache(hostId);
    if (attache != null && !attache.getTransferMode()) {
      attache.setTransferMode(true);
      s_logger.debug("Putting agent id=" + hostId + " to transfer mode");
      _agents.put(hostId,attache);
      if (host != null && host.getRemoved() == null) {
        host.setManagementServerId(null);
        s_logger.debug("Updating host id=" + hostId + " with the status "+ Status.Rebalance);
        _hostDao.updateStatus(host,Event.StartAgentRebalance,_nodeId);
      }
      try {
        Answer[] answer=sendRebalanceCommand(hostId,map.getFutureOwner(),Event.StartAgentRebalance);
        if (answer == null) {
          s_logger.warn("Host " + hostId + " failed to connect to the  management server "+ map.getFutureOwner()+ " as a part of rebalance process");
          result=false;
        }
      }
 catch (      Exception ex) {
        s_logger.warn("Host " + hostId + " failed to connect to the  management server "+ map.getFutureOwner()+ " as a part of rebalance process",ex);
        result=false;
      }
      if (result) {
        s_logger.debug("Got host id=" + hostId + " from management server "+ map.getFutureOwner());
      }
    }
  }
 else   if (map.getFutureOwner() == _nodeId) {
    try {
      if (s_logger.isDebugEnabled()) {
        s_logger.debug("Loading directly connected host " + host.getId() + "("+ host.getName()+ ") as a part of rebalance process");
      }
      loadDirectlyConnectedHost(host);
    }
 catch (    Exception ex) {
      s_logger.warn("Unable to load directly connected host " + host.getId() + " as a part of rebalance due to exception: ",ex);
    }
  }
  return result;
}
