{
  LdapConfigurationVO configuration=_ldapConfigurationDao.findByHostname(hostname);
  if (configuration == null) {
    LdapContext context=null;
    try {
      final String providerUrl="ldap://" + hostname + ":"+ port;
      context=_ldapContextFactory.createBindContext(providerUrl);
      configuration=new LdapConfigurationVO(hostname,port);
      _ldapConfigurationDao.persist(configuration);
      s_logger.info("Added new ldap server with hostname: " + hostname);
      return new LdapConfigurationResponse(hostname,port);
    }
 catch (    NamingException|IOException e) {
      s_logger.debug("NamingException while doing an LDAP bind",e);
      throw new InvalidParameterValueException("Unable to bind to the given LDAP server");
    }
 finally {
      closeContext(context);
    }
  }
 else {
    throw new InvalidParameterValueException("Duplicate configuration");
  }
}
