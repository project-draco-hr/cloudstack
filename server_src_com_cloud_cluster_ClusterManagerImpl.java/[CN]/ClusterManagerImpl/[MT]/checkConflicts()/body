{
  Date cutTime=DateUtil.currentGMTTime();
  List<ManagementServerHostVO> peers=_mshostDao.getActiveList(new Date(cutTime.getTime() - heartbeatThreshold));
  for (  ManagementServerHostVO peer : peers) {
    if (_mshostId == peer.getMsid()) {
      continue;
    }
    if (_clusterNodeIP.equals(peer.getServiceIP().trim())) {
      if ("127.0.0.1".equals(_clusterNodeIP)) {
        throw new ConfigurationException("Detected another management node with localhost IP is already running, please check your cluster configuration");
      }
 else {
        if (!pingManagementNode(peer.getId())) {
          throw new ConfigurationException("Detected that another management node with the same IP " + peer.getServiceIP() + " is already running");
        }
      }
    }
  }
}
