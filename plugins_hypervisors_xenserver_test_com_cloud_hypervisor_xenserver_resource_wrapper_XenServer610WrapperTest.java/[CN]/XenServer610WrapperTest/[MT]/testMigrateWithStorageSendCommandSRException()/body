{
  final String vmName="small";
  final Connection conn=Mockito.mock(Connection.class);
  final VirtualMachineTO vmSpec=Mockito.mock(VirtualMachineTO.class);
  final VolumeTO volume1=Mockito.mock(VolumeTO.class);
  final VolumeTO volume2=Mockito.mock(VolumeTO.class);
  final Map<VolumeTO,Object> volumeToSr=new HashMap<VolumeTO,Object>();
  volumeToSr.put(volume1,new String("a"));
  volumeToSr.put(volume2,new String("b"));
  final Map<NicTO,Object> nicToNetwork=new HashMap<NicTO,Object>();
  final Map<String,String> token=new HashMap<String,String>();
  final MigrateWithStorageSendCommand migrateStorageCommand=new MigrateWithStorageSendCommand(vmSpec,volumeToSr,nicToNetwork,token);
  final CitrixRequestWrapper wrapper=CitrixRequestWrapper.getInstance();
  assertNotNull(wrapper);
  when(xenServer610Resource.getConnection()).thenReturn(conn);
  when(vmSpec.getName()).thenReturn(vmName);
  final Answer answer=wrapper.execute(migrateStorageCommand,xenServer610Resource);
  verify(xenServer610Resource,times(1)).getConnection();
  assertFalse(answer.getResult());
}
