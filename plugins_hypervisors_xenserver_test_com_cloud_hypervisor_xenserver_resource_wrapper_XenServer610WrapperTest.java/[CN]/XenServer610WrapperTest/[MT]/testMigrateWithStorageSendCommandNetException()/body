{
  final String vmName="small";
  final String path="/";
  final Connection conn=Mockito.mock(Connection.class);
  final VirtualMachineTO vmSpec=Mockito.mock(VirtualMachineTO.class);
  final VolumeTO volume1=Mockito.mock(VolumeTO.class);
  final VolumeTO volume2=Mockito.mock(VolumeTO.class);
  final SR sr1=Mockito.mock(SR.class);
  final SR sr2=Mockito.mock(SR.class);
  final VDI vdi1=Mockito.mock(VDI.class);
  final VDI vdi2=Mockito.mock(VDI.class);
  final NicTO nic1=Mockito.mock(NicTO.class);
  final NicTO nic2=Mockito.mock(NicTO.class);
  final Map<VolumeTO,Object> volumeToSr=new HashMap<VolumeTO,Object>();
  volumeToSr.put(volume1,sr1);
  volumeToSr.put(volume2,sr2);
  final Map<NicTO,Object> nicToNetwork=new HashMap<NicTO,Object>();
  nicToNetwork.put(nic1,new String("a"));
  nicToNetwork.put(nic2,new String("b"));
  final Map<String,String> token=new HashMap<String,String>();
  final MigrateWithStorageSendCommand migrateStorageCommand=new MigrateWithStorageSendCommand(vmSpec,volumeToSr,nicToNetwork,token);
  final CitrixRequestWrapper wrapper=CitrixRequestWrapper.getInstance();
  assertNotNull(wrapper);
  when(xenServer610Resource.getConnection()).thenReturn(conn);
  when(vmSpec.getName()).thenReturn(vmName);
  when(volume1.getPath()).thenReturn(path);
  when(volume2.getPath()).thenReturn(path);
  when(xenServer610Resource.getVDIbyUuid(conn,volume1.getPath())).thenReturn(vdi1);
  when(xenServer610Resource.getVDIbyUuid(conn,volume2.getPath())).thenReturn(vdi2);
  final Answer answer=wrapper.execute(migrateStorageCommand,xenServer610Resource);
  verify(xenServer610Resource,times(1)).getConnection();
  assertFalse(answer.getResult());
}
