{
  Site2SiteVpnConnectionVO conn=_vpnConnectionDao.findById(id);
  if (conn.getState() != State.Connected) {
    throw new InvalidParameterValueException("Site to site VPN connection " + id + " not in correct state(connected) to process disconnect!");
  }
  List<? extends Site2SiteVpnServiceProvider> elements=_networkMgr.getSite2SiteVpnElements();
  boolean result=true;
  conn.setState(State.Disconnecting);
  for (  Site2SiteVpnServiceProvider element : elements) {
    result=result & element.stopSite2SiteVpn(conn);
  }
  if (result) {
    conn.setState(State.Disconnected);
    _vpnConnectionDao.persist(conn);
  }
  conn.setState(State.Error);
}
