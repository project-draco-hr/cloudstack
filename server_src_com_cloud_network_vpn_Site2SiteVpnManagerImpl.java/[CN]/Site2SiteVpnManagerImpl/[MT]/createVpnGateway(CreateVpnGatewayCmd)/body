{
  Long ipId=cmd.getPublicIpId();
  IpAddress ip=_networkMgr.getIp(ipId);
  if (ip.getVpcId() == null) {
    throw new InvalidParameterValueException("The VPN gateway cannot create with ip not belong to VPC");
  }
  Long domainId=ip.getDomainId();
  Long accountId=ip.getAccountId();
  if (_vpnGatewayDao.findByIpAddrId(ipId) != null) {
    throw new InvalidParameterValueException("The VPN gateway with ip ID " + ipId + " already existed!");
  }
  Site2SiteVpnGatewayVO gw=new Site2SiteVpnGatewayVO(ipId);
  _vpnGatewayDao.persist(gw);
  return gw;
}
