{
  Long customerGatewayId=cmd.getCustomerGatewayId();
  Site2SiteCustomerGateway customerGateway=_customerGatewayDao.findById(customerGatewayId);
  if (customerGateway == null) {
    throw new InvalidParameterValueException("Unable to found specified Site to Site VPN customer gateway " + customerGatewayId + " !");
  }
  Long vpnGatewayId=cmd.getVpnGatewayId();
  Site2SiteVpnGateway vpnGateway=_vpnGatewayDao.findById(vpnGatewayId);
  if (vpnGateway == null) {
    throw new InvalidParameterValueException("Unable to found specified Site to Site VPN gateway " + vpnGatewayId + " !");
  }
  if (_vpnConnectionDao.findByCustomerGatewayId(customerGatewayId) != null || _vpnConnectionDao.findByVpnGatewayId(vpnGatewayId) != null) {
    throw new InvalidParameterValueException("The vpn connection with customer gateway id " + customerGatewayId + " or vpn gateway id "+ vpnGatewayId+ " already existed!");
  }
  Site2SiteVpnConnectionVO conn=new Site2SiteVpnConnectionVO(vpnGatewayId,customerGatewayId);
  return conn;
}
