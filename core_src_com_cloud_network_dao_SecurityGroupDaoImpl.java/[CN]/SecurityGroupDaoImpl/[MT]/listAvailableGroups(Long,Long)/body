{
  List<SecurityGroupVO> availableGroups=new ArrayList<SecurityGroupVO>();
  if ((accountId != null) || (domainId != null)) {
    if (accountId != null) {
      SearchCriteria<SecurityGroupVO> sc=createSearchCriteria();
      sc.addAnd("accountId",SearchCriteria.Op.EQ,accountId);
      List<SecurityGroupVO> accountGroups=listActiveBy(sc);
      availableGroups.addAll(accountGroups);
    }
 else     if (domainId != null) {
      while (domainId != null) {
        SearchCriteria<SecurityGroupVO> sc=createSearchCriteria();
        sc.addAnd("domainId",SearchCriteria.Op.EQ,domainId);
        if (accountId != null) {
          sc.addAnd("accountId",SearchCriteria.Op.NEQ,accountId);
        }
        List<SecurityGroupVO> domainGroups=listActiveBy(sc);
        availableGroups.addAll(domainGroups);
        DomainVO domain=_domainDao.findById(domainId);
        domainId=domain.getParent();
      }
    }
  }
  return availableGroups;
}
