{
  try {
    String snapshotPath=command.getSnapshotUuid();
    final int index=snapshotPath.lastIndexOf("/");
    snapshotPath=snapshotPath.substring(0,index);
    final KVMStoragePoolManager storagePoolMgr=libvirtComputingResource.getStoragePoolMgr();
    final KVMStoragePool secondaryPool=storagePoolMgr.getStoragePoolByURI(command.getSecondaryStorageUrl() + snapshotPath);
    final KVMPhysicalDisk snapshot=secondaryPool.getPhysicalDisk(command.getSnapshotName());
    final String primaryUuid=command.getPrimaryStoragePoolNameLabel();
    final StorageFilerTO pool=command.getPool();
    final KVMStoragePool primaryPool=storagePoolMgr.getStoragePool(pool.getType(),primaryUuid);
    final String volUuid=UUID.randomUUID().toString();
    final KVMPhysicalDisk disk=storagePoolMgr.copyPhysicalDisk(snapshot,volUuid,primaryPool,0);
    if (disk == null) {
      throw new NullPointerException("Disk was not successfully copied to the new storage.");
    }
    return new CreateVolumeFromSnapshotAnswer(command,true,"",disk.getName());
  }
 catch (  final CloudRuntimeException e) {
    return new CreateVolumeFromSnapshotAnswer(command,false,e.toString(),null);
  }
catch (  final Exception e) {
    return new CreateVolumeFromSnapshotAnswer(command,false,e.toString(),null);
  }
}
