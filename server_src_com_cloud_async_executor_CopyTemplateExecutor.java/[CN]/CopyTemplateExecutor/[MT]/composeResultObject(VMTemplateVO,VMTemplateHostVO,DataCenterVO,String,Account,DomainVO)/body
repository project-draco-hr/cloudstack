{
  CopyTemplateResultObject resultObject=new CopyTemplateResultObject();
  boolean isAdmin=false;
  if (owner.getType() == Account.ACCOUNT_TYPE_ADMIN)   isAdmin=true;
  if (isAdmin || owner.getId().longValue() == template.getAccountId()) {
    if (templateHostRef.getDownloadState() != Status.DOWNLOADED) {
      String templateStatus="Processing";
      if (templateHostRef.getDownloadState() == VMTemplateHostVO.Status.DOWNLOAD_IN_PROGRESS) {
        if (templateHostRef.getDownloadPercent() == 100) {
          templateStatus="Installing Template";
        }
 else {
          templateStatus=templateHostRef.getDownloadPercent() + "% Downloaded";
        }
      }
 else {
        templateStatus=templateHostRef.getErrorString();
      }
      resultObject.setTemplateStatus(templateStatus);
    }
 else     if (templateHostRef.getDownloadState() == VMTemplateHostVO.Status.DOWNLOADED) {
      resultObject.setTemplateStatus("Download Complete");
    }
 else {
      resultObject.setTemplateStatus("Successfully Installed");
    }
  }
  resultObject.setAccountName(owner.getAccountName());
  resultObject.setDomainId(owner.getDomainId());
  resultObject.setDomainName(domain.getName());
  resultObject.setId(template.getId());
  resultObject.setName(template.getName());
  resultObject.setDisplayText(template.getDisplayText());
  resultObject.setPublic(template.isPublicTemplate());
  resultObject.setOsTypeName(guestOSName);
  resultObject.setCreated(templateHostRef.getCreated());
  resultObject.setReady(templateHostRef != null && templateHostRef.getDownloadState() == Status.DOWNLOADED);
  resultObject.setFeatured(template.isFeatured());
  resultObject.setPasswordEnabled(template.getEnablePassword());
  resultObject.setFormat(template.getFormat());
  resultObject.setGuestOsId(template.getGuestOSId());
  resultObject.setZoneId(destZone.getId());
  resultObject.setZoneName(destZone.getName());
  return resultObject;
}
