{
  UserVm userVm=(UserVm)getResponseObject();
  UserVmResponse response=new UserVmResponse();
  response.setId(userVm.getId());
  response.setName(userVm.getName());
  response.setCreated(userVm.getCreated());
  response.setZoneId(userVm.getDataCenterId());
  response.setZoneName(getManagementServer().findDataCenterById(userVm.getDataCenterId()).getName());
  response.setPrivateIp(userVm.getPrivateIpAddress());
  response.setServiceOfferingId(userVm.getServiceOfferingId());
  response.setHaEnable(userVm.isHaEnabled());
  response.setGroup(userVm.getGroup());
  if (userVm.getDisplayName() == null || userVm.getDisplayName().length() == 0) {
    response.setDisplayName(userVm.getName());
  }
 else {
    response.setDisplayName(userVm.getDisplayName());
  }
  if (userVm.getState() != null) {
    response.setState(userVm.getState().toString());
  }
  VMTemplateVO template=managementServer.findTemplateById(userVm.getTemplateId());
  Account acct=managementServer.findAccountById(Long.valueOf(userVm.getAccountId()));
  if (acct != null) {
    response.setAccountName(acct.getAccountName());
    response.setDomainId(acct.getDomainId());
    response.setDomain(managementServer.findDomainIdById(acct.getDomainId()).getName());
  }
  User userExecutingCmd=managementServer.getUser(userId);
  Account acctForUserExecutingCmd=managementServer.findAccountById(Long.valueOf(userExecutingCmd.getAccountId()));
  if ((BaseCmd.isAdmin(acctForUserExecutingCmd.getType()) && (userVm.getHostId() != null)) || (BaseCmd.isAdmin(acct.getType()) && (userVm.getHostId() != null))) {
    response.setHostName(managementServer.getHostBy(userVm.getHostId()).getName());
    response.setHostId(userVm.getHostId());
  }
  String templateName="none";
  boolean templatePasswordEnabled=false;
  String templateDisplayText=null;
  if (template != null) {
    templateName=template.getName();
    templatePasswordEnabled=template.getEnablePassword();
    templateDisplayText=template.getDisplayText();
    if (templateDisplayText == null) {
      templateDisplayText=templateName;
    }
  }
  if (templatePasswordEnabled) {
    response.setPassword(param.getPassword());
  }
  Long isoId=userVm.getIsoId();
  if (isoId != null) {
    VMTemplateVO iso=getManagementServer().findTemplateById(isoId.longValue());
    if (iso != null) {
      response.setIsoId(isoId.longValue());
      response.setIsoName(iso.getName());
      response.setTemplateId(isoId.longValue());
      response.setTemplateName(iso.getName());
      templateDisplayText=iso.getDisplayText();
      if (templateDisplayText == null)       templateDisplayText=iso.getName();
      response.setIsoDisplayText(templateDisplayText);
      response.setTemplateDisplayText(templateDisplayText);
    }
  }
 else {
    response.setTemplateId(userVm.getTemplateId());
    response.setTemplateName(templateName);
    response.setTemplateDisplayText(templateDisplayText);
    response.setPasswordEnabled(templatePasswordEnabled);
  }
  ServiceOfferingVO offering=managementServer.findServiceOfferingById(userVm.getServiceOfferingId());
  response.setServiceOfferingId(userVm.getServiceOfferingId());
  response.setServiceOfferingName(offering.getName());
  response.setCpuNumber(offering.getCpu());
  response.setCpuSpeed(offering.getSpeed());
  response.setMemory(offering.getRamSize());
  response.setNetworkGroupList(managementServer.getNetworkGroupsNamesForVm(userVm.getId()));
  return SerializerHelper.toSerializedString(response);
}
