{
  ListVmIdByAffinityGroup=createSearchBuilder(Long.class);
  ListVmIdByAffinityGroup.and("affinityGroupId",ListVmIdByAffinityGroup.entity().getAffinityGroupId(),SearchCriteria.Op.EQ);
  ListVmIdByAffinityGroup.selectField(ListVmIdByAffinityGroup.entity().getInstanceId());
  ListVmIdByAffinityGroup.done();
  ListByAffinityGroup=createSearchBuilder();
  ListByAffinityGroup.and("affinityGroupId",ListByAffinityGroup.entity().getAffinityGroupId(),SearchCriteria.Op.EQ);
  ListByAffinityGroup.done();
  ListByVmId=createSearchBuilder();
  ListByVmId.and("instanceId",ListByVmId.entity().getInstanceId(),SearchCriteria.Op.EQ);
  ListByVmId.done();
  ListByVmIdGroupId=createSearchBuilder();
  ListByVmIdGroupId.and("instanceId",ListByVmIdGroupId.entity().getInstanceId(),SearchCriteria.Op.EQ);
  ListByVmIdGroupId.and("affinityGroupId",ListByVmIdGroupId.entity().getAffinityGroupId(),SearchCriteria.Op.EQ);
  ListByVmIdGroupId.done();
  SearchBuilder<AffinityGroupVO> groupSearch=_affinityGroupDao.createSearchBuilder();
  groupSearch.and("type",groupSearch.entity().getType(),SearchCriteria.Op.EQ);
  ListByVmIdType=createSearchBuilder();
  ListByVmIdType.and("instanceId",ListByVmIdType.entity().getInstanceId(),SearchCriteria.Op.EQ);
  ListByVmIdType.join("groupSearch",groupSearch,ListByVmIdType.entity().getAffinityGroupId(),groupSearch.entity().getId(),JoinType.INNER);
  ListByVmIdType.done();
  CountSGForVm=createSearchBuilder(Long.class);
  CountSGForVm.select(null,Func.COUNT,null);
  CountSGForVm.and("vmId",CountSGForVm.entity().getInstanceId(),SearchCriteria.Op.EQ);
  CountSGForVm.done();
}
