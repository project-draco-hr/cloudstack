{
  List<VolumeVO> volumes=_volsDao.findByAccount(accountId);
  boolean success=true;
  for (  VolumeVO volume : volumes) {
    if (volume.getPoolId() == null) {
      continue;
    }
    Long volumeId=volume.getId();
    Long dcId=volume.getDataCenterId();
    String primaryStoragePoolNameLabel=_storageMgr.getPrimaryStorageNameLabel(volume);
    if (_snapshotDao.listByVolumeIdIncludingRemoved(volumeId).isEmpty()) {
      continue;
    }
    List<HostVO> ssHosts=_hostDao.listSecondaryStorageHosts(dcId);
    for (    HostVO ssHost : ssHosts) {
      DeleteSnapshotsDirCommand cmd=new DeleteSnapshotsDirCommand(primaryStoragePoolNameLabel,ssHost.getStorageUrl(),dcId,accountId,volumeId,volume.getPath());
      Answer answer=null;
      Long poolId=volume.getPoolId();
      if (poolId != null) {
        try {
          answer=_storageMgr.sendToPool(poolId,cmd);
        }
 catch (        StorageUnavailableException e) {
        }
      }
 else {
        s_logger.info("Pool id for volume id: " + volumeId + " belonging to account id: "+ accountId+ " is null. Assuming the snapshotsDir for the account has already been deleted");
      }
      if (success) {
        success=(answer != null) && answer.getResult();
        if (success) {
          s_logger.debug("Deleted snapshotsDir for volume: " + volumeId + " under account: "+ accountId);
        }
 else         if (answer != null) {
          s_logger.error(answer.getDetails());
        }
      }
    }
    List<SnapshotVO> snapshots=listSnapsforVolume(volumeId);
    for (    SnapshotVO snapshot : snapshots) {
      if (_snapshotDao.expunge(snapshot.getId())) {
        if (snapshot.getType() == Type.MANUAL) {
          _resourceLimitMgr.decrementResourceCount(accountId,ResourceType.snapshot);
        }
        UsageEventVO usageEvent=new UsageEventVO(EventTypes.EVENT_SNAPSHOT_DELETE,snapshot.getAccountId(),volume.getDataCenterId(),snapshot.getId(),snapshot.getName(),null,null,volume.getSize());
        _usageEventDao.persist(usageEvent);
      }
    }
  }
  return success;
}
