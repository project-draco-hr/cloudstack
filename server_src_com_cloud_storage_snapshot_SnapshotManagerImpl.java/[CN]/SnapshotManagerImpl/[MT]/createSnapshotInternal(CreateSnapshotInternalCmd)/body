{
  Long volumeId=cmd.getVolumeId();
  Long policyId=cmd.getPolicyId();
  SnapshotVO snapshot=null;
  Long snapshotId=null;
  try {
    snapshot=createSnapshotImpl(volumeId,policyId);
  }
 catch (  InvalidParameterValueException ex) {
    s_logger.warn("Received invalid parameter exception creating a recurring snapshot that should've already had validated params: " + ex.getMessage());
  }
  boolean backedUp=false;
  if (snapshot != null && snapshot.getStatus() == Snapshot.Status.CreatedOnPrimary) {
    snapshotId=snapshot.getId();
    backedUp=backupSnapshotToSecondaryStorage(snapshot,cmd.getStartEventId());
    if (!backedUp) {
      throw new CloudRuntimeException("Created snapshot: " + snapshotId + " on primary but failed to backup on secondary");
    }
  }
 else {
    return snapshot;
  }
  postCreateSnapshot(cmd.getVolumeId(),snapshotId,policyId,backedUp);
  return snapshot;
}
