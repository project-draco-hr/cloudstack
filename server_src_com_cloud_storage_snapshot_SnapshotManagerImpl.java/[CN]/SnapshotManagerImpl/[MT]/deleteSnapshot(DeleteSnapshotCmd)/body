{
  Long snapshotId=cmd.getId();
  Snapshot snapshotCheck=_snapshotDao.findByIdIncludingRemoved(snapshotId.longValue());
  if (snapshotCheck == null) {
    throw new InvalidParameterValueException("unable to find a snapshot with id " + snapshotId);
  }
  Account snapshotOwner=_accountDao.findById(snapshotCheck.getAccountId());
  if (snapshotOwner == null) {
    throw new InvalidParameterValueException("Snapshot id " + snapshotId + " does not have a valid account");
  }
  checkAccountPermissions(snapshotOwner.getId(),snapshotOwner.getDomainId(),"snapshot",snapshotId);
  boolean status=true;
  if (Type.MANUAL.ordinal() == snapshotCheck.getSnapshotType()) {
    status=deleteSnapshotInternal(snapshotId,Snapshot.MANUAL_POLICY_ID);
    if (!status) {
      s_logger.warn("Failed to delete snapshot");
      throw new CloudRuntimeException("Failed to delete snapshot:" + snapshotId);
    }
  }
 else {
    List<SnapshotPolicyVO> policies=listPoliciesforVolume(snapshotCheck.getVolumeId());
    for (    SnapshotPolicyVO policy : policies) {
      status=deleteSnapshotInternal(snapshotId,policy.getId());
      if (!status) {
        s_logger.warn("Failed to delete snapshot");
        throw new CloudRuntimeException("Failed to delete snapshot:" + snapshotId);
      }
    }
  }
  return status;
}
