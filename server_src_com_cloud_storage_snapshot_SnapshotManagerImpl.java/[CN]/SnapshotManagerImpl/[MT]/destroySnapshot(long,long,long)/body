{
  boolean success=false;
  String details=null;
  SnapshotVO snapshot=_snapshotDao.findById(snapshotId);
  if (snapshot != null) {
    SnapshotVO nextSnapshot=_snapshotDao.findNextSnapshot(snapshotId);
    if (nextSnapshot == null) {
      details="Successfully deleted snapshot " + snapshotId + " for volumeId: "+ snapshot.getVolumeId()+ " and policyId "+ policyId;
      s_logger.debug("This is last snapshot for volume. Not destroying now: " + snapshot.getId());
      postDeleteSnapshot(snapshotId,policyId,true);
      success=true;
    }
 else {
      VolumeVO volume=_volsDao.findById(snapshot.getVolumeId());
      String primaryStoragePoolNameLabel=_storageMgr.getPrimaryStorageNameLabel(volume);
      String secondaryStoragePoolUrl=_storageMgr.getSecondaryStorageURL(volume.getDataCenterId());
      Long dcId=volume.getDataCenterId();
      Long accountId=volume.getAccountId();
      Long volumeId=volume.getId();
      String backupOfSnapshot=snapshot.getBackupSnapshotId();
      String backupOfNextSnapshot=null;
      if (nextSnapshot != null) {
        backupOfNextSnapshot=nextSnapshot.getBackupSnapshotId();
      }
      DeleteSnapshotBackupCommand cmd=new DeleteSnapshotBackupCommand(primaryStoragePoolNameLabel,secondaryStoragePoolUrl,dcId,accountId,volumeId,backupOfSnapshot,snapshot.getName(),backupOfNextSnapshot);
      details="Failed to destroy snapshot id:" + snapshotId + " for volume: "+ volume.getId();
      Answer answer=_storageMgr.sendToHostsOnStoragePool(volume.getPoolId(),cmd,details,_totalRetries,_pauseInterval,_shouldBeSnapshotCapable);
      if ((answer != null) && answer.getResult()) {
        postDeleteSnapshot(snapshotId,policyId,false);
        success=true;
        details="Successfully deleted snapshot " + snapshotId + " for volumeId: "+ volumeId+ " and policyId "+ policyId;
        s_logger.debug(details);
      }
 else       if (answer != null) {
        if (answer.getDetails() != null) {
          details=answer.getDetails();
        }
        s_logger.error(details);
      }
    }
  }
  String eventParams="id=" + snapshotId;
  EventVO event=new EventVO();
  event.setUserId(userId);
  event.setAccountId((snapshot != null) ? snapshot.getAccountId() : 0);
  event.setType(EventTypes.EVENT_SNAPSHOT_DELETE);
  event.setDescription(details);
  event.setParameters(eventParams);
  event.setLevel(success ? EventVO.LEVEL_INFO : EventVO.LEVEL_ERROR);
  _eventDao.persist(event);
  return success;
}
