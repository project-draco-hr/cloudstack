{
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Calling deleteSnapshot for snapshotId: " + snapshotId + " and policyId "+ policyId);
  }
  SnapshotVO lastSnapshot=null;
  _snapshotDao.remove(snapshotId);
  long lastId=snapshotId;
  boolean destroy=false;
  while (true) {
    lastSnapshot=_snapshotDao.findNextSnapshot(lastId);
    if (lastSnapshot == null) {
      destroy=true;
      break;
    }
    if (lastSnapshot.getRemoved() == null) {
      break;
    }
    lastId=lastSnapshot.getId();
  }
  if (destroy) {
    lastSnapshot=_snapshotDao.findByIdIncludingRemoved(lastId);
    while (lastSnapshot.getRemoved() != null) {
      String BackupSnapshotId=lastSnapshot.getBackupSnapshotId();
      if (BackupSnapshotId != null) {
        if (destroySnapshotBackUp(userId,lastId,policyId)) {
        }
 else {
          s_logger.debug("Destroying snapshot backup failed " + lastSnapshot);
          break;
        }
      }
      postDeleteSnapshot(userId,lastId,policyId);
      lastId=lastSnapshot.getPrevSnapshotId();
      if (lastId == 0) {
        break;
      }
      lastSnapshot=_snapshotDao.findByIdIncludingRemoved(lastId);
    }
  }
  return true;
}
