{
  Account caller=CallContext.current().getCallingAccount();
  SnapshotVO snapshotCheck=_snapshotDao.findById(snapshotId);
  if (snapshotCheck == null) {
    throw new InvalidParameterValueException("unable to find a snapshot with id " + snapshotId);
  }
  _accountMgr.checkAccess(caller,null,true,snapshotCheck);
  SnapshotStrategy snapshotStrategy=null;
  for (  SnapshotStrategy strategy : snapshotStrategies) {
    if (strategy.canHandle(snapshotCheck)) {
      snapshotStrategy=strategy;
      break;
    }
  }
  try {
    boolean result=snapshotStrategy.deleteSnapshot(snapshotId);
    if (result) {
      if (snapshotCheck.getState() == Snapshot.State.BackedUp) {
        UsageEventUtils.publishUsageEvent(EventTypes.EVENT_SNAPSHOT_DELETE,snapshotCheck.getAccountId(),snapshotCheck.getDataCenterId(),snapshotId,snapshotCheck.getName(),null,null,0L,snapshotCheck.getClass().getName(),snapshotCheck.getUuid());
      }
      _resourceLimitMgr.decrementResourceCount(snapshotCheck.getAccountId(),ResourceType.snapshot);
      _resourceLimitMgr.decrementResourceCount(snapshotCheck.getAccountId(),ResourceType.secondary_storage,new Long(snapshotCheck.getSize()));
    }
    return result;
  }
 catch (  Exception e) {
    s_logger.debug("Failed to delete snapshot: " + snapshotCheck.getId() + ":"+ e.toString());
    throw new CloudRuntimeException("Failed to delete snapshot:" + e.toString());
  }
}
