{
  Long volumeId=cmd.getVolumeId();
  boolean display=cmd.isDisplay();
  Long id=cmd.getId();
  Pair<List<SnapshotPolicyVO>,Integer> result=null;
  if (id != null) {
    result=_snapshotPolicyDao.listAndCountById(id,display,null);
    if (result != null && result.first() != null && !result.first().isEmpty()) {
      SnapshotPolicyVO snapshotPolicy=result.first().get(0);
      volumeId=snapshotPolicy.getId();
    }
  }
  VolumeVO volume=_volsDao.findById(volumeId);
  if (volume == null) {
    throw new InvalidParameterValueException("Unable to find a volume with id " + volumeId);
  }
  _accountMgr.checkAccess(CallContext.current().getCallingAccount(),null,true,volume);
  if (result != null)   return new Pair<List<? extends SnapshotPolicy>,Integer>(result.first(),result.second());
  result=_snapshotPolicyDao.listAndCountByVolumeId(volumeId,display);
  return new Pair<List<? extends SnapshotPolicy>,Integer>(result.first(),result.second());
}
