{
  IAMGroup group=new IAMGroupVO("group1","tester group1");
  List<IAMGroup> groups=new ArrayList<IAMGroup>();
  groups.add(group);
  Long groupId=group.getId();
  List<Long> policyIds=new ArrayList<Long>();
  policyIds.add(100L);
  policyIds.add(200L);
  IAMPolicy policy1=new IAMPolicyVO("policy1","my first policy");
  IAMPolicy policy2=new IAMPolicyVO("policy2","my second policy");
  List<IAMPolicy> policies=new ArrayList<IAMPolicy>();
  policies.add(policy1);
  policies.add(policy2);
  when(_iamSrv.attachIAMPoliciesToGroup(policyIds,groupId)).thenReturn(group);
  when(_iamSrv.listIAMPoliciesByGroup(groupId)).thenReturn(policies);
  Pair<List<IAMGroup>,Integer> grpList=new Pair<List<IAMGroup>,Integer>(groups,1);
  when(_iamSrv.listIAMGroups(null,"group1",callerDomainPath,0L,20L)).thenReturn(grpList);
  _aclSrv.attachIAMPoliciesToGroup(policyIds,groupId);
  ListResponse<IAMGroupResponse> grpResp=_aclSrv.listIAMGroups(null,"group1",callerDomainId,0L,20L);
  assertTrue("No. of response items should be one",grpResp.getCount() == 1);
  IAMGroupResponse resp=grpResp.getResponses().get(0);
  Set<String> policyNames=resp.getPolicyList();
  assertEquals("There should be 2 policies in the group",2,policyNames.size());
  assertTrue("policy1 should be assigned to the group",policyNames.contains("policy1"));
  assertTrue("policy2 should be assigned to the group",policyNames.contains("policy2"));
  policyIds.remove(1);
  policies.remove(policy2);
  when(_iamSrv.removeIAMPoliciesFromGroup(policyIds,groupId)).thenReturn(group);
  _aclSrv.removeIAMPoliciesFromGroup(policyIds,groupId);
  grpResp=_aclSrv.listIAMGroups(null,"group1",callerDomainId,0L,20L);
  assertTrue("No. of response items should be one",grpResp.getCount() == 1);
  resp=grpResp.getResponses().get(0);
  policyNames=resp.getPolicyList();
  assertEquals("There should be 1 policy attached to the group",1,policyNames.size());
  assertFalse("policy2 should not belong to the group anymore",policyNames.contains("policy2"));
}
