{
  long retries=waitingReties;
  TemplatePrimaryDataStoreVO templateStoreVO=null;
  do {
    try {
      Thread.sleep(waitingTime);
    }
 catch (    InterruptedException e) {
    }
    templateStoreVO=templateStoreDao.findByTemplateIdAndPoolIdAndReady(template.getId(),dataStore.getId());
    if (templateStoreVO != null) {
      break;
    }
    retries--;
  }
 while (retries > 0);
  if (templateStoreVO == null) {
    throw new CloudRuntimeException("waiting too long for template downloading, marked it as failed");
  }
  return templateStoreVO;
}
