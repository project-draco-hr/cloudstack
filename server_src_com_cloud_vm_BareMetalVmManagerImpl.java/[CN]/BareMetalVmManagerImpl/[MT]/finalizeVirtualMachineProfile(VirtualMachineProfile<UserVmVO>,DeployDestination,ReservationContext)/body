{
  UserVmVO vm=profile.getVirtualMachine();
  Account owner=_accountDao.findById(vm.getAccountId());
  if (owner == null || owner.getState() == Account.State.disabled) {
    throw new PermissionDeniedException("The owner of " + vm + " either does not exist or is disabled: "+ vm.getAccountId());
  }
  PxeServerType pxeType=(PxeServerType)profile.getParameter(Param.PxeSeverType);
  if (pxeType == null) {
    s_logger.debug("This is a normal IPMI start, skip prepartion of PXE server");
    return true;
  }
  s_logger.debug("This is a PXE start, prepare PXE server first");
  PxeServerManager pxeMgr=null;
  ComponentLocator locator=ComponentLocator.getLocator(ManagementService.Name);
  if (pxeType == PxeServerType.LinMin) {
    pxeMgr=locator.getManager(LinMinPxeServerManager.class);
  }
 else {
    throw new CloudRuntimeException("Unsupport PXE type " + pxeType.toString());
  }
  if (pxeMgr == null) {
    throw new CloudRuntimeException("No PXE manager find for type " + pxeType.toString());
  }
  List<HostVO> servers=_hostDao.listBy(Host.Type.PxeServer,vm.getDataCenterId());
  if (servers.size() == 0) {
    throw new CloudRuntimeException("Cannot find PXE server, please make sure there is one PXE server per zone");
  }
  HostVO pxeServer=servers.get(0);
  if (!pxeMgr.prepare(profile,dest,context,pxeServer.getId())) {
    throw new CloudRuntimeException("Pepare PXE server failed");
  }
  profile.addBootArgs("PxeBoot");
  return true;
}
