{
  long vmId=cmd.getEntityId();
  UserVmVO vm=_vmDao.findById(vmId);
  _vmDao.loadDetails(vm);
  List<HostVO> servers=_hostDao.listBy(Host.Type.PxeServer,vm.getDataCenterId());
  if (servers.size() == 0) {
    throw new CloudRuntimeException("Cannot find PXE server, please make sure there is one PXE server per zone");
  }
  HostVO pxeServer=servers.get(0);
  VMTemplateVO template=_templateDao.findById(vm.getTemplateId());
  if (template == null || template.getFormat() != Storage.ImageFormat.BAREMETAL) {
    throw new InvalidParameterValueException("Invalid template with id = " + vm.getTemplateId());
  }
  Map<VirtualMachineProfile.Param,Object> params=new HashMap<VirtualMachineProfile.Param,Object>();
  if (pxeServer.getResource().equalsIgnoreCase("com.cloud.baremetal.LinMinPxeServerResource")) {
    params.put(Param.PxeSeverType,PxeServerType.LinMin);
  }
 else {
    throw new CloudRuntimeException("Unkown PXE server resource " + pxeServer.getResource());
  }
  return startVirtualMachine(cmd,params);
}
