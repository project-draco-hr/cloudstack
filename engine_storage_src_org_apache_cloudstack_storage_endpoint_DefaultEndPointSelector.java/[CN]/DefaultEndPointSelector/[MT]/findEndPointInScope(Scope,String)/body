{
  StringBuilder sbuilder=new StringBuilder();
  sbuilder.append(sqlBase);
  if (scope.getScopeType() == ScopeType.HOST) {
    sbuilder.append(" and id = ");
    sbuilder.append(scope.getScopeId());
  }
 else   if (scope.getScopeType() == ScopeType.CLUSTER) {
    sbuilder.append(" and cluster_id = ");
    sbuilder.append(scope.getScopeId());
  }
 else   if (scope.getScopeType() == ScopeType.ZONE) {
    sbuilder.append(" and data_center_id = ");
    sbuilder.append(scope.getScopeId());
  }
  sbuilder.append(" ORDER by rand() limit 1");
  String sql=sbuilder.toString();
  PreparedStatement pstmt=null;
  ResultSet rs=null;
  HostVO host=null;
  Transaction txn=Transaction.currentTxn();
  try {
    pstmt=txn.prepareStatement(sql);
    rs=pstmt.executeQuery();
    while (rs.next()) {
      long id=rs.getLong(1);
      host=hostDao.findById(id);
    }
  }
 catch (  SQLException e) {
    s_logger.warn("can't find endpoint",e);
  }
 finally {
    try {
      if (rs != null) {
        rs.close();
      }
      if (pstmt != null) {
        pstmt.close();
      }
    }
 catch (    SQLException e) {
    }
  }
  if (host == null) {
    return null;
  }
  return RemoteHostEndPoint.getHypervisorHostEndPoint(host.getId(),host.getPrivateIpAddress(),host.getPublicIpAddress());
}
