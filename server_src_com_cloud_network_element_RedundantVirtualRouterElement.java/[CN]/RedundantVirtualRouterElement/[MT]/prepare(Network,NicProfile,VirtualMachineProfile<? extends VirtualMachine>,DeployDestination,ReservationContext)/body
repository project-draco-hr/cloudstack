{
  NetworkOfferingVO offering=_networkOfferingDao.findById(network.getNetworkOfferingId());
  if (offering.isSystemOnly()) {
    return false;
  }
  if (!_networkMgr.isProviderAvailable(_networkMgr.getPhysicalNetworkId(network),"RedundantVirtualRouter")) {
    return false;
  }
  if (vm.getType() != VirtualMachine.Type.User) {
    return false;
  }
  @SuppressWarnings("unchecked") VirtualMachineProfile<UserVm> uservm=(VirtualMachineProfile<UserVm>)vm;
  List<DomainRouterVO> routers=_routerMgr.deployVirtualRouter(network,dest,_accountMgr.getAccount(network.getAccountId()),uservm.getParameters(),getProvider());
  if ((routers == null) || (routers.size() == 0)) {
    throw new ResourceUnavailableException("Can't find at least one running router!",this.getClass(),0);
  }
  List<VirtualRouter> rets=_routerMgr.addVirtualMachineIntoNetwork(network,nic,uservm,dest,context,routers);
  return (rets != null) && (!rets.isEmpty());
}
