{
  if (entity instanceof VirtualMachineTemplate) {
    VirtualMachineTemplate template=(VirtualMachineTemplate)entity;
    if (!template.isPublicTemplate()) {
      Account owner=_accountDao.findById(template.getAccountId());
      if (BaseCmd.isAdmin(caller.getType()) || (owner.getId() == caller.getId())) {
        return true;
      }
      LaunchPermissionVO permission=_launchPermissionDao.findByTemplateAndAccount(template.getId(),caller.getId());
      if (permission == null) {
        throw new PermissionDeniedException(caller + " does not have permission to launch instances from " + template);
      }
    }
    return true;
  }
 else {
    if (caller.getType() == Account.ACCOUNT_TYPE_NORMAL) {
      if (caller.getId() != entity.getAccountId()) {
        throw new PermissionDeniedException(caller + " does not have permission to operate with resource " + entity);
      }
    }
  }
  return true;
}
