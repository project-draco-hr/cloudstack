{
  VolumeVO volume=_volsDao.findById(cmd.getEntityId());
  if (cmd.getSnapshotId() != null) {
    return createVolumeFromSnapshot(volume,cmd.getSnapshotId());
  }
 else {
    DiskOfferingVO diskOffering=_diskOfferingDao.findById(cmd.getDiskOfferingId());
    _accountMgr.incrementResourceCount(volume.getAccountId(),ResourceType.volume);
    volume.setSourceId(diskOffering.getId());
    volume.setSourceType(SourceType.DiskOffering);
    volume.setStatus(AsyncInstanceCreateStatus.Created);
    _volsDao.update(volume.getId(),volume);
  }
  return _volsDao.findById(volume.getId());
}
