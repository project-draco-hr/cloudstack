{
  VolumeVO volume=_volsDao.findById(cmd.getEntityId());
  if (cmd.getSnapshotId() != null) {
    return createVolumeFromSnapshot(volume,cmd.getSnapshotId());
  }
 else {
    DataCenterVO dc=_dcDao.findById(cmd.getZoneId());
    DiskOfferingVO diskOffering=_diskOfferingDao.findById(cmd.getDiskOfferingId());
    long sizeMB=diskOffering.getDiskSize();
    _accountMgr.incrementResourceCount(volume.getAccountId(),ResourceType.volume);
    VolumeVO volForUpdate=_volsDao.createForUpdate();
    volForUpdate.setSourceId(diskOffering.getId());
    volForUpdate.setSourceType(SourceType.DiskOffering);
    volForUpdate.setStatus(AsyncInstanceCreateStatus.Created);
    _volsDao.update(volume.getId(),volForUpdate);
  }
  return _volsDao.findById(volume.getId());
}
