{
  VolumeVO volume=_volsDao.findById(cmd.getEntityId());
  try {
    if (cmd.getSnapshotId() != null) {
      return createVolumeFromSnapshot(volume,cmd.getSnapshotId());
    }
 else {
      _volsDao.update(volume.getId(),volume);
    }
    return _volsDao.findById(volume.getId());
  }
  finally {
    if (volume.getState() != Volume.State.Ready) {
      s_logger.trace("Decrementing volume resource count for account id=" + volume.getAccountId() + " as volume failed to create on the backend");
      _accountMgr.decrementResourceCount(volume.getAccountId(),ResourceType.volume);
    }
  }
}
