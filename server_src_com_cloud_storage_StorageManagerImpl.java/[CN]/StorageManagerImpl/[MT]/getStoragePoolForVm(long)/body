{
  SearchCriteria<StoragePoolVO> sc=PoolsUsedByVmSearch.create();
  sc.setJoinParameters("volumes","vm",vmId);
  sc.setJoinParameters("volumes","status",AsyncInstanceCreateStatus.Created.toString());
  List<StoragePoolVO> sps=_storagePoolDao.search(sc,null);
  if (sps.size() == 0) {
    throw new RuntimeException("Volume is not created for VM " + vmId);
  }
  StoragePoolVO sp=sps.get(0);
  for (  StoragePoolVO tsp : sps) {
    if (tsp.isLocal()) {
      sp=tsp;
      break;
    }
  }
  return sp;
}
