{
  VolumeVO createdVolume=null;
  SnapshotVO snapshot=_snapshotDao.findById(snapshotId);
  Transaction txn=Transaction.currentTxn();
  txn.start();
  Pair<VolumeVO,String> volumeDetails=createVolumeFromSnapshot(volume,snapshot);
  createdVolume=volumeDetails.first();
  Long diskOfferingId=volume.getDiskOfferingId();
  if (createdVolume.getPath() != null) {
    Long offeringId=null;
    if (diskOfferingId != null) {
      DiskOfferingVO offering=_diskOfferingDao.findById(diskOfferingId);
      if (offering != null && (offering.getType() == DiskOfferingVO.Type.Disk)) {
        offeringId=offering.getId();
      }
    }
    UsageEventVO usageEvent=new UsageEventVO(EventTypes.EVENT_VOLUME_CREATE,volume.getAccountId(),volume.getDataCenterId(),volume.getId(),volume.getName(),offeringId,null,createdVolume.getSize());
    _usageEventDao.persist(usageEvent);
  }
  txn.commit();
  return createdVolume;
}
