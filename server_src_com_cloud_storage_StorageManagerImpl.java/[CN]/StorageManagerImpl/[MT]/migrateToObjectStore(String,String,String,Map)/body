{
  List<ImageStoreVO> imgStores=_imageStoreDao.listImageStores();
  List<ImageStoreVO> nfsStores=new ArrayList<ImageStoreVO>();
  if (imgStores != null && imgStores.size() > 0) {
    for (    ImageStoreVO store : imgStores) {
      if (!store.getProviderName().equals(DataStoreProvider.NFS_IMAGE)) {
        throw new InvalidParameterValueException("We only support migrate NFS secondary storage to use object store!");
      }
 else {
        nfsStores.add(store);
      }
    }
  }
  if (nfsStores != null && nfsStores.size() > 0) {
    for (    ImageStoreVO store : nfsStores) {
      long storeId=store.getId();
      _accountMgr.checkAccessAndSpecifyAuthority(CallContext.current().getCallingAccount(),store.getDataCenterId());
      DataStoreProvider provider=dataStoreProviderMgr.getDataStoreProvider(store.getProviderName());
      DataStoreLifeCycle lifeCycle=provider.getDataStoreLifeCycle();
      DataStore secStore=dataStoreMgr.getDataStore(storeId,DataStoreRole.Image);
      lifeCycle.migrateToObjectStore(secStore);
      _templateStoreDao.updateStoreRoleToCachce(storeId);
      _snapshotStoreDao.updateStoreRoleToCache(storeId);
    }
  }
  return discoverImageStore(name,url,providerName,null,details);
}
