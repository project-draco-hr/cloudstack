{
  VirtualMachineProfileImpl<VMInstanceVO> vmProfile=new VirtualMachineProfileImpl<VMInstanceVO>(vm,template,(ServiceOfferingVO)offering,null,null);
  Enumeration<StoragePoolAllocator> en=_storagePoolAllocators.enumeration();
  while (en.hasMoreElements()) {
    final StoragePoolAllocator allocator=en.nextElement();
    final List<StoragePool> poolList=allocator.allocateToPool(dskCh,vmProfile,dc.getId(),pod.getId(),clusterId,avoid,1);
    if (poolList != null && !poolList.isEmpty()) {
      return (StoragePoolVO)poolList.get(0);
    }
  }
  return null;
}
