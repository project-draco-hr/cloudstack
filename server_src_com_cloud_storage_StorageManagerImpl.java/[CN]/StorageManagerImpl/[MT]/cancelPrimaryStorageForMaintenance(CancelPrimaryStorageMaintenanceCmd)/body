{
  Long primaryStorageId=cmd.getId();
  Long userId=CallContext.current().getCallingUserId();
  User user=_userDao.findById(userId);
  Account account=CallContext.current().getCallingAccount();
  StoragePoolVO primaryStorage=null;
  primaryStorage=_storagePoolDao.findById(primaryStorageId);
  if (primaryStorage == null) {
    String msg="Unable to obtain lock on the storage pool in cancelPrimaryStorageForMaintenance()";
    s_logger.error(msg);
    throw new InvalidParameterValueException(msg);
  }
  if (primaryStorage.getStatus().equals(StoragePoolStatus.Up) || primaryStorage.getStatus().equals(StoragePoolStatus.PrepareForMaintenance)) {
    throw new StorageUnavailableException("Primary storage with id " + primaryStorageId + " is not ready to complete migration, as the status is:"+ primaryStorage.getStatus().toString(),primaryStorageId);
  }
  DataStoreProvider provider=dataStoreProviderMgr.getDataStoreProvider(primaryStorage.getStorageProviderName());
  DataStoreLifeCycle lifeCycle=provider.getDataStoreLifeCycle();
  DataStore store=dataStoreMgr.getDataStore(primaryStorage.getId(),DataStoreRole.Primary);
  lifeCycle.cancelMaintain(store);
  return (PrimaryDataStoreInfo)dataStoreMgr.getDataStore(primaryStorage.getId(),DataStoreRole.Primary);
}
