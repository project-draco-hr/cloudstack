{
  if (volume.getVolumeType() == VolumeType.ROOT && Storage.ImageFormat.ISO != template.getFormat()) {
    SearchCriteria<VMTemplateHostVO> sc=HostTemplateStatesSearch.create();
    sc.setParameters("id",template.getId());
    sc.setParameters("state",com.cloud.storage.VMTemplateStorageResourceAssoc.Status.DOWNLOADED);
    sc.setJoinParameters("host","dcId",dc.getId());
    List<VMTemplateHostVO> sss=_vmTemplateHostDao.search(sc,null);
    if (sss.size() == 0) {
      throw new CloudRuntimeException("Template " + template.getName() + " has not been completely downloaded to zone "+ dc.getId());
    }
    VMTemplateHostVO ss=sss.get(0);
    return new DiskCharacteristicsTO(volume.getVolumeType(),volume.getName(),diskOffering,ss.getSize());
  }
 else {
    return new DiskCharacteristicsTO(volume.getVolumeType(),volume.getName(),diskOffering);
  }
}
