{
  long storeId=cmd.getId();
  User caller=_accountMgr.getActiveUser(CallContext.current().getCallingUserId());
  ImageStoreVO store=_imageStoreDao.findById(storeId);
  if (store == null) {
    throw new InvalidParameterValueException("Cache store with id " + storeId + " doesn't exist");
  }
  _accountMgr.checkAccessAndSpecifyAuthority(CallContext.current().getCallingAccount(),store.getDataCenterId());
  List<SnapshotDataStoreVO> snapshots=_snapshotStoreDao.listActiveOnCache(storeId);
  if (snapshots != null && snapshots.size() > 0) {
    throw new InvalidParameterValueException("Cannot delete cache store with staging snapshots currently in use!");
  }
  List<VolumeDataStoreVO> volumes=_volumeStoreDao.listActiveOnCache(storeId);
  if (volumes != null && volumes.size() > 0) {
    throw new InvalidParameterValueException("Cannot delete cache store with staging volumes currently in use!");
  }
  List<TemplateDataStoreVO> templates=this._templateStoreDao.listActiveOnCache(storeId);
  if (templates != null && templates.size() > 0) {
    throw new InvalidParameterValueException("Cannot delete cache store with staging templates currently in use!");
  }
  Transaction txn=Transaction.currentTxn();
  txn.start();
  _imageStoreDetailsDao.deleteDetails(storeId);
  _snapshotStoreDao.deletePrimaryRecordsForStore(storeId,DataStoreRole.ImageCache);
  _volumeStoreDao.deletePrimaryRecordsForStore(storeId);
  _templateStoreDao.deletePrimaryRecordsForStore(storeId);
  _imageStoreDao.remove(storeId);
  txn.commit();
  return true;
}
