{
  long storeId=cmd.getId();
  User caller=_accountMgr.getActiveUser(UserContext.current().getCallerUserId());
  ImageStoreVO store=_imageStoreDao.findById(storeId);
  if (store == null) {
    throw new InvalidParameterValueException("Image store with id " + storeId + " doesn't exist");
  }
  _accountMgr.checkAccessAndSpecifyAuthority(UserContext.current().getCaller(),store.getDataCenterId());
  List<SnapshotDataStoreVO> snapshots=_snapshotStoreDao.listLiveByStoreId(storeId);
  if (snapshots != null && snapshots.size() > 0) {
    throw new CloudRuntimeException("Cannot delete image store with active snapshots backup!");
  }
  List<VolumeDataStoreVO> volumes=_volumeStoreDao.listLiveByStoreId(storeId);
  if (volumes != null && volumes.size() > 0) {
    throw new CloudRuntimeException("Cannot delete image store with active volumes backup!");
  }
  List<TemplateDataStoreVO> templates=_templateStoreDao.listLiveByStoreId(storeId);
  if (templates != null && templates.size() > 0) {
    throw new CloudRuntimeException("Cannot delete image store with active templates backup!");
  }
  Transaction txn=Transaction.currentTxn();
  txn.start();
  _imageStoreDetailsDao.deleteDetails(storeId);
  _snapshotStoreDao.deletePrimaryRecordsForStore(storeId);
  _volumeStoreDao.deletePrimaryRecordsForStore(storeId);
  _templateStoreDao.deletePrimaryRecordsForStore(storeId);
  _imageStoreDao.remove(storeId);
  txn.commit();
  return true;
}
