{
  ArrayList<VolumeVO> vols=new ArrayList<VolumeVO>(dataDisks.size() + 1);
  VolumeVO dataVol=null;
  VolumeVO rootVol=null;
  long deviceId=0;
  Transaction txn=Transaction.currentTxn();
  txn.start();
  rootVol=new VolumeVO(VolumeType.ROOT,rootDisk.getName(),dc.getId(),account.getDomainId(),account.getId(),rootDisk.getDiskOfferingId(),rootDisk.getSize());
  if (rootDisk.getTemplateId() != null) {
    rootVol.setTemplateId(rootDisk.getTemplateId());
  }
  rootVol.setInstanceId(vm.getId());
  rootVol.setDeviceId(deviceId++);
  rootVol=_volsDao.persist(rootVol);
  vols.add(rootVol);
  for (  DiskCharacteristics dataDisk : dataDisks) {
    dataVol=new VolumeVO(VolumeType.DATADISK,dataDisk.getName(),dc.getId(),account.getDomainId(),account.getId(),dataDisk.getDiskOfferingId(),dataDisk.getSize());
    dataVol.setDeviceId(deviceId++);
    dataVol=_volsDao.persist(dataVol);
    dataVol.setInstanceId(vm.getId());
    vols.add(dataVol);
  }
  txn.commit();
  return vols;
}
