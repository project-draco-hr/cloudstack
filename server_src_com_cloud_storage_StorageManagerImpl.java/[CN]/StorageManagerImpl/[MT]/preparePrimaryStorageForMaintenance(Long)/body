{
  Long userId=UserContext.current().getCallerUserId();
  User user=_userDao.findById(userId);
  Account account=UserContext.current().getCaller();
  boolean restart=true;
  StoragePoolVO primaryStorage=null;
  primaryStorage=_storagePoolDao.findById(primaryStorageId);
  if (primaryStorage == null) {
    String msg="Unable to obtain lock on the storage pool record in preparePrimaryStorageForMaintenance()";
    s_logger.error(msg);
    throw new InvalidParameterValueException(msg);
  }
  if (!primaryStorage.getStatus().equals(StoragePoolStatus.Up) && !primaryStorage.getStatus().equals(StoragePoolStatus.ErrorInMaintenance)) {
    throw new InvalidParameterValueException("Primary storage with id " + primaryStorageId + " is not ready for migration, as the status is:"+ primaryStorage.getStatus().toString());
  }
  DataStoreProvider provider=dataStoreProviderMgr.getDataStoreProvider(primaryStorage.getStorageProviderName());
  DataStoreLifeCycle lifeCycle=provider.getDataStoreLifeCycle();
  DataStore store=dataStoreMgr.getDataStore(primaryStorage.getId(),DataStoreRole.Primary);
  lifeCycle.maintain(store);
  return (PrimaryDataStoreInfo)dataStoreMgr.getDataStore(primaryStorage.getId(),DataStoreRole.Primary);
}
