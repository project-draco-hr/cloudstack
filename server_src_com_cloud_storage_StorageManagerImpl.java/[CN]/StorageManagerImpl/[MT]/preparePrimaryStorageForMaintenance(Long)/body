{
  StoragePoolVO primaryStorage=null;
  primaryStorage=_storagePoolDao.findById(primaryStorageId);
  if (primaryStorage == null) {
    String msg="Unable to obtain lock on the storage pool record in preparePrimaryStorageForMaintenance()";
    logger.error(msg);
    throw new InvalidParameterValueException(msg);
  }
  if (!primaryStorage.getStatus().equals(StoragePoolStatus.Up) && !primaryStorage.getStatus().equals(StoragePoolStatus.ErrorInMaintenance)) {
    throw new InvalidParameterValueException("Primary storage with id " + primaryStorageId + " is not ready for migration, as the status is:"+ primaryStorage.getStatus().toString());
  }
  DataStoreProvider provider=_dataStoreProviderMgr.getDataStoreProvider(primaryStorage.getStorageProviderName());
  DataStoreLifeCycle lifeCycle=provider.getDataStoreLifeCycle();
  DataStore store=_dataStoreMgr.getDataStore(primaryStorage.getId(),DataStoreRole.Primary);
  lifeCycle.maintain(store);
  return (PrimaryDataStoreInfo)_dataStoreMgr.getDataStore(primaryStorage.getId(),DataStoreRole.Primary);
}
