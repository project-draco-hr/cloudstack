{
  Long storeId=cmd.getId();
  String storeName=cmd.getStoreName();
  ImageStore store=null;
  if (storeId != null) {
    store=_imageStoreDao.findById(storeId);
  }
 else   if (storeName != null) {
    store=_imageStoreDao.findByName(storeName);
  }
 else {
    throw new InvalidParameterValueException("Either image store id or name has to be specified!");
  }
  if (store == null) {
    throw new InvalidParameterValueException("Unable to find image store by id: " + storeId + " OR by name: "+ storeName);
  }
  ImageStoreVO activeStore=_imageStoreDao.findEnabledStore();
  ImageStoreVO activeStoreForUpdate=_imageStoreDao.createForUpdate();
  activeStoreForUpdate.setState(ImageStore.State.Disabled);
  if (!_imageStoreDao.update(activeStore.getId(),activeStoreForUpdate)) {
    throw new CloudRuntimeException("Failed to disable current active image store " + activeStore.getName());
  }
  ImageStoreVO storeForUpdate=_imageStoreDao.createForUpdate();
  storeForUpdate.setState(ImageStore.State.Enabled);
  if (_imageStoreDao.update(store.getId(),storeForUpdate)) {
    return _imageStoreDao.findById(store.getId());
  }
 else {
    throw new CloudRuntimeException("Failed to enable image store by id: " + storeId + " OR by name: "+ storeName);
  }
}
