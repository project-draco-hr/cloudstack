{
  VirtualMachineProfile<VMInstanceVO> profile=new VirtualMachineProfileImpl<VMInstanceVO>(vm);
  for (  StoragePoolAllocator allocator : _storagePoolAllocators) {
    ExcludeList avoidList=new ExcludeList();
    for (    StoragePool pool : avoid) {
      avoidList.addPool(pool.getId());
    }
    DataCenterDeployment plan=new DataCenterDeployment(dc.getId(),pod.getId(),clusterId,hostId,null,null);
    final List<StoragePool> poolList=allocator.allocateToPool(dskCh,profile,plan,avoidList,1);
    if (poolList != null && !poolList.isEmpty()) {
      return (StoragePool)this.dataStoreMgr.getDataStore(poolList.get(0).getId(),DataStoreRole.Primary);
    }
  }
  return null;
}
