{
  SearchCriteria<StoragePoolVO> sc=_storagePoolDao.createSearchCriteria();
  List<StoragePoolVO> pools=new ArrayList<StoragePoolVO>();
  if (zoneId != null) {
    sc.addAnd("dataCenterId",SearchCriteria.Op.EQ,zoneId);
  }
  if (podId != null) {
    sc.addAnd("podId",SearchCriteria.Op.EQ,podId);
  }
  if (poolId != null) {
    sc.addAnd("hostOrPoolId",SearchCriteria.Op.EQ,poolId);
  }
  if (poolId != null) {
    pools.add(_storagePoolDao.findById(poolId));
  }
 else {
    pools=_storagePoolDao.search(sc,null);
  }
  List<CapacityVO> capacities=new LinkedList<CapacityVO>();
  for (  StoragePoolVO storagePool : pools) {
    StorageStats stats=ApiDBUtils.getStoragePoolStatistics(storagePool.getId());
    if (stats == null)     continue;
    CapacityVO capacity=new CapacityVO(storagePool.getId(),storagePool.getDataCenterId(),storagePool.getPodId(),storagePool.getClusterId(),stats.getByteUsed(),stats.getCapacityBytes(),CapacityVO.CAPACITY_TYPE_STORAGE);
    capacities.add(capacity);
  }
  return capacities;
}
