{
  LoadBalancer result=null;
  try {
    if (publicIpId == null) {
      if (getZoneId() == null) {
        throw new InvalidParameterValueException("Either zone id or public ip id needs to be specified");
      }
      LoadBalancer existing=findExistingLB();
      if (existing == null) {
        allocateIp();
      }
 else {
        this.setPublicIpId(existing.getSourceIpAddressId());
      }
    }
    result=_lbService.createLoadBalancerRule(this);
  }
 catch (  NetworkRuleConflictException e) {
    s_logger.warn("Exception: ",e);
    throw new ServerApiException(BaseCmd.NETWORK_RULE_CONFLICT_ERROR,e.getMessage());
  }
  LoadBalancerResponse response=_responseGenerator.createLoadBalancerResponse(result);
  response.setResponseName(getCommandName());
  this.setResponseObject(response);
}
