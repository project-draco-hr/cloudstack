{
  Transaction txn=Transaction.currentTxn();
  try {
    txn.start();
    ClusterVO cluster=_clusterDao.lockRow(cmd.getId(),true);
    if (cluster == null) {
      if (s_logger.isDebugEnabled()) {
        s_logger.debug("Cluster: " + cmd.getId() + " does not even exist.  Delete call is ignored.");
      }
      txn.rollback();
      return true;
    }
    List<HostVO> hosts=_hostDao.listByCluster(cmd.getId());
    if (hosts.size() > 0) {
      if (s_logger.isDebugEnabled()) {
        s_logger.debug("Cluster: " + cmd.getId() + " still has hosts");
      }
      txn.rollback();
      return false;
    }
    _clusterDao.remove(cmd.getId());
    txn.commit();
    return true;
  }
 catch (  Throwable t) {
    s_logger.error("Unable to delete cluster: " + cmd.getId(),t);
    txn.rollback();
    return false;
  }
}
