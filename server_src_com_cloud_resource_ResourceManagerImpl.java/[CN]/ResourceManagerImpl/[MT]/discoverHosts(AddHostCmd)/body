{
  Long dcId=cmd.getZoneId();
  Long podId=cmd.getPodId();
  Long clusterId=cmd.getClusterId();
  String clusterName=cmd.getClusterName();
  String url=cmd.getUrl();
  String username=cmd.getUsername();
  String password=cmd.getPassword();
  Long memCapacity=cmd.getMemCapacity();
  Long cpuSpeed=cmd.getCpuSpeed();
  Long cpuNum=cmd.getCpuNum();
  String mac=cmd.getMac();
  List<String> hostTags=cmd.getHostTags();
  Map<String,String> bareMetalParams=new HashMap<String,String>();
  dcId=_accountMgr.checkAccessAndSpecifyAuthority(UserContext.current().getCaller(),dcId);
  if (clusterName == null && clusterId == null) {
    clusterName="Standalone-" + url;
  }
  if (clusterId != null) {
    ClusterVO cluster=_clusterDao.findById(clusterId);
    if (cluster == null) {
      throw new InvalidParameterValueException("can not fine cluster for clusterId " + clusterId);
    }
 else {
      if (cluster.getGuid() == null) {
        List<HostVO> hosts=_hostDao.listByCluster(clusterId);
        if (!hosts.isEmpty()) {
          throw new CloudRuntimeException("Guid is not updated for cluster " + clusterId + " need to wait hosts in this cluster up");
        }
      }
    }
  }
  if (cmd.getHypervisor().equalsIgnoreCase(Hypervisor.HypervisorType.BareMetal.toString())) {
    if (memCapacity == null) {
      memCapacity=Long.valueOf(0);
    }
    if (cpuSpeed == null) {
      cpuSpeed=Long.valueOf(0);
    }
    if (cpuNum == null) {
      cpuNum=Long.valueOf(0);
    }
    if (mac == null) {
      mac="unknown";
    }
    bareMetalParams.put("cpuNum",cpuNum.toString());
    bareMetalParams.put("cpuCapacity",cpuSpeed.toString());
    bareMetalParams.put("memCapacity",memCapacity.toString());
    bareMetalParams.put("mac",mac);
    if (hostTags != null && hostTags.size() > 0) {
      bareMetalParams.put("hostTag",hostTags.get(0));
    }
  }
  String allocationState=cmd.getAllocationState();
  if (allocationState == null) {
    allocationState=Host.HostAllocationState.Enabled.toString();
  }
  return discoverHostsFull(dcId,podId,clusterId,clusterName,url,username,password,cmd.getHypervisor(),hostTags,bareMetalParams,allocationState);
}
