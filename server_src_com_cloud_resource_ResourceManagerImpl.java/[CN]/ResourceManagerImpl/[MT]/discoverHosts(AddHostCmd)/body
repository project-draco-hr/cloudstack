{
  Long dcId=cmd.getZoneId();
  Long podId=cmd.getPodId();
  Long clusterId=cmd.getClusterId();
  String clusterName=cmd.getClusterName();
  String url=cmd.getUrl();
  String username=cmd.getUsername();
  String password=cmd.getPassword();
  List<String> hostTags=cmd.getHostTags();
  dcId=_accountMgr.checkAccessAndSpecifyAuthority(UserContext.current().getCaller(),dcId);
  if (clusterName == null && clusterId == null) {
    clusterName="Standalone-" + url;
  }
  if (clusterId != null) {
    ClusterVO cluster=_clusterDao.findById(clusterId);
    if (cluster == null) {
      throw new InvalidParameterValueException("can not fine cluster for clusterId " + clusterId);
    }
 else {
      if (cluster.getGuid() == null) {
        List<HostVO> hosts=listAllHostsInCluster(clusterId);
        if (!hosts.isEmpty()) {
          throw new CloudRuntimeException("Guid is not updated for cluster " + clusterId + " need to wait hosts in this cluster up");
        }
      }
    }
  }
  String allocationState=cmd.getAllocationState();
  if (allocationState == null) {
    allocationState=Host.HostAllocationState.Enabled.toString();
  }
  return discoverHostsFull(dcId,podId,clusterId,clusterName,url,username,password,cmd.getHypervisor(),hostTags,cmd.getFullUrlParams(),allocationState);
}
