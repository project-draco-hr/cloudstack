{
  for (  DiskTO volume : spec.getDisks()) {
    if (volume.getType() == Volume.Type.ROOT) {
      VolumeObjectTO vol=(VolumeObjectTO)volume.getData();
      OvmDisk.Details root=new OvmDisk.Details();
      root.path=vol.getPath();
      root.type=OvmDisk.WRITE;
      root.isIso=false;
      vm.rootDisk=root;
    }
 else     if (volume.getType() == Volume.Type.ISO) {
      DataTO isoTO=volume.getData();
      if (isoTO.getPath() != null) {
        TemplateObjectTO template=(TemplateObjectTO)isoTO;
        DataStoreTO store=template.getDataStore();
        if (!(store instanceof NfsTO)) {
          throw new CloudRuntimeException("unsupported protocol");
        }
        NfsTO nfsStore=(NfsTO)store;
        String isoPath=nfsStore.getUrl() + File.separator + template.getPath();
        OvmDisk.Details iso=new OvmDisk.Details();
        URI path=new URI(isoPath);
        iso.path=path.getHost() + ":" + path.getPath();
        iso.type=OvmDisk.READ;
        iso.isIso=true;
        vm.disks.add(iso);
      }
    }
 else     if (volume.getType() == Volume.Type.DATADISK) {
      OvmDisk.Details data=new OvmDisk.Details();
      data.path=volume.getData().getPath();
      data.type=OvmDisk.SHAREDWRITE;
      data.isIso=false;
      vm.disks.add(data);
    }
 else {
      throw new CloudRuntimeException("Unknow volume type: " + volume.getType());
    }
  }
}
