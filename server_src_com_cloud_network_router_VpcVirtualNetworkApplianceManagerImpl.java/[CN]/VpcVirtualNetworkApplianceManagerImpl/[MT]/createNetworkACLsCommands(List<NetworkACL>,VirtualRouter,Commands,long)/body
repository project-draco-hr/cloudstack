{
  List<NetworkACLTO> rulesTO=null;
  String guestVlan=null;
  Network guestNtwk=_networkDao.findById(guestNetworkId);
  URI uri=guestNtwk.getBroadcastUri();
  if (uri != null) {
    guestVlan=guestNtwk.getBroadcastUri().getHost();
  }
  if (rules != null) {
    rulesTO=new ArrayList<NetworkACLTO>();
    for (    NetworkACL rule : rules) {
      NetworkACLTO ruleTO=new NetworkACLTO(rule,guestVlan,rule.getTrafficType());
      rulesTO.add(ruleTO);
    }
  }
  Network network=_networkMgr.getNetwork(guestNetworkId);
  Nic nic=_nicDao.findByInstanceIdAndNetworkId(network.getId(),router.getId());
  NicProfile nicProfile=new NicProfile(nic,network,nic.getBroadcastUri(),nic.getIsolationUri(),_networkMgr.getNetworkRate(network.getId(),router.getId()),_networkMgr.isSecurityGroupSupportedInNetwork(network),_networkMgr.getNetworkTag(router.getHypervisorType(),network));
  SetNetworkACLCommand cmd=new SetNetworkACLCommand(rulesTO,_itMgr.toNicTO(nicProfile,router.getHypervisorType()));
  cmd.setAccessDetail(NetworkElementCommand.ROUTER_IP,getRouterControlIp(router.getId()));
  cmd.setAccessDetail(NetworkElementCommand.ROUTER_GUEST_IP,getRouterIpInNetwork(guestNetworkId,router.getId()));
  cmd.setAccessDetail(NetworkElementCommand.GUEST_VLAN_TAG,guestVlan);
  cmd.setAccessDetail(NetworkElementCommand.ROUTER_NAME,router.getInstanceName());
  DataCenterVO dcVo=_dcDao.findById(router.getDataCenterIdToDeployIn());
  cmd.setAccessDetail(NetworkElementCommand.ZONE_NETWORK_TYPE,dcVo.getNetworkType().toString());
  cmds.addCommand(cmd);
}
