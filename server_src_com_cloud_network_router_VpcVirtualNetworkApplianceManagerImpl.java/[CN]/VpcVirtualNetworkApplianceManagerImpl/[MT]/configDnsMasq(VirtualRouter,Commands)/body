{
  if (s_logger.isTraceEnabled()) {
    s_logger.trace("configDnsMasq(" + router.getHostName() + ", "+ cmds+ ")");
  }
  VpcVO vpc=_vpcDao.findById(router.getVpcId());
  DataCenterVO dcVo=_dcDao.findById(router.getDataCenterId());
  List<DhcpTO> ipList=new ArrayList<DhcpTO>();
  String cidr=vpc.getCidr();
  String[] cidrPair=cidr.split("\\/");
  String cidrAddress=cidrPair[0];
  long cidrSize=Long.parseLong(cidrPair[1]);
  String startIpOfSubnet=NetUtils.getIpRangeStartIpFromCidr(cidrAddress,cidrSize);
  DhcpTO DhcpTO=new DhcpTO(router.getPrivateIpAddress(),router.getPublicIpAddress(),NetUtils.getCidrNetmask(cidrSize),startIpOfSubnet);
  ipList.add(DhcpTO);
  NicVO nic=_nicDao.findByIp4AddressAndVmId(_routerDao.findById(router.getId()).getPrivateIpAddress(),router.getId());
  DataCenterVO dcvo=_dcDao.findById(router.getDataCenterId());
  boolean dnsProvided=_networkModel.isProviderSupportServiceInNetwork(nic.getNetworkId(),Service.Dns,Provider.VirtualRouter);
  String domain_suffix=dcvo.getDetail(ZoneConfig.DnsSearchOrder.getName());
  DnsMasqConfigCommand dnsMasqConfigCmd=new DnsMasqConfigCommand(vpc.getNetworkDomain(),ipList,dcVo.getDns1(),dcVo.getDns2(),dcVo.getInternalDns1(),dcVo.getInternalDns2());
  dnsMasqConfigCmd.setAccessDetail(NetworkElementCommand.ROUTER_IP,getRouterControlIp(router.getId()));
  dnsMasqConfigCmd.setAccessDetail(NetworkElementCommand.ROUTER_NAME,router.getInstanceName());
  dnsMasqConfigCmd.setAccessDetail(NetworkElementCommand.ROUTER_GUEST_IP,router.getPublicIpAddress());
  dnsMasqConfigCmd.setAccessDetail(NetworkElementCommand.ZONE_NETWORK_TYPE,dcVo.getNetworkType().toString());
  dnsMasqConfigCmd.setDomainSuffix(domain_suffix);
  dnsMasqConfigCmd.setIfDnsProvided(dnsProvided);
  cmds.addCommand("dnsMasqConfig",dnsMasqConfigCmd);
}
