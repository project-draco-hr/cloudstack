{
  List<NetworkACLTO> rulesTO=null;
  String guestVlan=null;
  Network guestNtwk=_networkDao.findById(guestNetworkId);
  URI uri=guestNtwk.getBroadcastUri();
  if (uri != null) {
    guestVlan=guestNtwk.getBroadcastUri().getHost();
  }
  if (rules != null) {
    rulesTO=new ArrayList<NetworkACLTO>();
    for (    FirewallRule rule : rules) {
      if (rule.getSourceCidrList() == null && (rule.getPurpose() == Purpose.Firewall || rule.getPurpose() == Purpose.NetworkACL)) {
        _firewallDao.loadSourceCidrs((FirewallRuleVO)rule);
      }
      NetworkACLTO ruleTO=new NetworkACLTO(rule,guestVlan,rule.getTrafficType());
      rulesTO.add(ruleTO);
    }
  }
  SetNetworkACLCommand cmd=new SetNetworkACLCommand(rulesTO,getNicTO(router,guestNetworkId,null));
  cmd.setAccessDetail(NetworkElementCommand.ROUTER_IP,getRouterControlIp(router.getId()));
  cmd.setAccessDetail(NetworkElementCommand.ROUTER_GUEST_IP,getRouterIpInNetwork(guestNetworkId,router.getId()));
  cmd.setAccessDetail(NetworkElementCommand.GUEST_VLAN_TAG,guestVlan);
  cmd.setAccessDetail(NetworkElementCommand.ROUTER_NAME,router.getInstanceName());
  DataCenterVO dcVo=_dcDao.findById(router.getDataCenterIdToDeployIn());
  cmd.setAccessDetail(NetworkElementCommand.ZONE_NETWORK_TYPE,dcVo.getNetworkType().toString());
  cmds.addCommand(cmd);
}
