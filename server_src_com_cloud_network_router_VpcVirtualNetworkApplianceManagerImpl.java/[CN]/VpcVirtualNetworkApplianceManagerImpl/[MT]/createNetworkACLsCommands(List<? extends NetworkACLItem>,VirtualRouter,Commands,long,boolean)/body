{
  List<NetworkACLTO> rulesTO=null;
  String guestVlan=null;
  Network guestNtwk=_networkDao.findById(guestNetworkId);
  URI uri=guestNtwk.getBroadcastUri();
  if (uri != null) {
    guestVlan=guestNtwk.getBroadcastUri().getHost();
  }
  if (rules != null) {
    rulesTO=new ArrayList<NetworkACLTO>();
    for (    NetworkACLItem rule : rules) {
      NetworkACLTO ruleTO=new NetworkACLTO((NetworkACLItemVO)rule,guestVlan,rule.getTrafficType());
      rulesTO.add(ruleTO);
    }
  }
  SetNetworkACLCommand cmd=new SetNetworkACLCommand(rulesTO,getNicTO(router,guestNetworkId,null));
  cmd.setAccessDetail(NetworkElementCommand.ROUTER_IP,getRouterControlIp(router.getId()));
  cmd.setAccessDetail(NetworkElementCommand.ROUTER_GUEST_IP,getRouterIpInNetwork(guestNetworkId,router.getId()));
  cmd.setAccessDetail(NetworkElementCommand.GUEST_VLAN_TAG,guestVlan);
  cmd.setAccessDetail(NetworkElementCommand.ROUTER_NAME,router.getInstanceName());
  DataCenterVO dcVo=_dcDao.findById(router.getDataCenterId());
  cmd.setAccessDetail(NetworkElementCommand.ZONE_NETWORK_TYPE,dcVo.getNetworkType().toString());
  if (privateGateway) {
    cmd.setAccessDetail(NetworkElementCommand.VPC_PRIVATE_GATEWAY,String.valueOf(VpcGateway.Type.Private));
  }
  cmds.addCommand(cmd);
}
