{
  String networkDomain=network.getNetworkDomain();
  String cidr=network.getCidr();
  String dhcpRange=null;
  if (cidr != null) {
    dhcpRange=NetUtils.getDhcpRange(cidr);
  }
  boolean result=true;
  try {
    Map<PlugNicCommand.Param,String> params=new HashMap<PlugNicCommand.Param,String>();
    params.put(PlugNicCommand.Param.NetworkDomain,networkDomain);
    params.put(PlugNicCommand.Param.DhcpRange,dhcpRange);
    PlugNicCommand plugNicCmd=new PlugNicCommand(vm,nic,params);
    Commands cmds=new Commands(OnError.Stop);
    cmds.addCommand("plugnic",plugNicCmd);
    _agentMgr.send(dest.getHost().getId(),cmds);
    Answer plugNicAnswer=cmds.getAnswer(Answer.class);
    if (!(plugNicAnswer != null && plugNicAnswer.getResult())) {
      s_logger.warn("Unable to plug nic for vm " + vm.getHostName());
      result=false;
    }
  }
 catch (  OperationTimedoutException e) {
    throw new AgentUnavailableException("Unable to plug nic for vm " + vm.getHostName(),dest.getHost().getId(),e);
  }
  return result;
}
