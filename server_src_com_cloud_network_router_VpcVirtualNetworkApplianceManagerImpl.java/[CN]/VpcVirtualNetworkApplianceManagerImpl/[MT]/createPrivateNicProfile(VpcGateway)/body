{
  Network network=_networkMgr.getNetwork(privateGateway.getNetworkId());
  PrivateIpVO ipVO=_privateIpDao.allocateIpAddress(network.getDataCenterId(),network.getId(),privateGateway.getIp4Address());
  NicProfile privateNic=new NicProfile();
  String vlanTag=network.getBroadcastUri().getHost();
  String netmask=NetUtils.getCidrNetmask(network.getCidr());
  PrivateIpAddress ip=new PrivateIpAddress(ipVO,vlanTag,network.getGateway(),netmask,ipVO.getMacAddress());
  privateNic.setIp4Address(ip.getIpAddress());
  privateNic.setGateway(ip.getGateway());
  privateNic.setNetmask(ip.getNetmask());
  privateNic.setIsolationUri(IsolationType.Vlan.toUri(ip.getVlanTag()));
  privateNic.setBroadcastUri(IsolationType.Vlan.toUri(ip.getVlanTag()));
  privateNic.setBroadcastType(BroadcastDomainType.Vlan);
  privateNic.setFormat(AddressFormat.Ip4);
  privateNic.setReservationId(String.valueOf(ip.getVlanTag()));
  privateNic.setMacAddress(ip.getMacAddress());
  return privateNic;
}
