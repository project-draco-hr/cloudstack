{
  Long groupId=cmd.getId();
  Account caller=UserContext.current().getCaller();
  SecurityGroupVO group=_securityGroupDao.findById(groupId);
  if (group == null) {
    throw new InvalidParameterValueException("Unable to find network group: " + groupId + "; failed to delete group.");
  }
  _accountMgr.checkAccess(caller,group);
  final Transaction txn=Transaction.currentTxn();
  txn.start();
  group=_securityGroupDao.lockRow(groupId,true);
  if (group == null) {
    s_logger.info("Not deleting group -- cannot find id " + groupId);
    return false;
  }
  if (group.getName().equalsIgnoreCase(SecurityGroupManager.DEFAULT_GROUP_NAME)) {
    txn.rollback();
    throw new InvalidParameterValueException("The network group default is reserved");
  }
  List<IngressRuleVO> allowingRules=_ingressRuleDao.listByAllowedSecurityGroupId(groupId);
  if (allowingRules.size() != 0) {
    txn.rollback();
    throw new ResourceInUseException("Cannot delete group when there are ingress rules that allow this group");
  }
  List<IngressRuleVO> rulesInGroup=_ingressRuleDao.listBySecurityGroupId(groupId);
  if (rulesInGroup.size() != 0) {
    txn.rollback();
    throw new ResourceInUseException("Cannot delete group when there are ingress rules in this group");
  }
  _securityGroupDao.expunge(groupId);
  txn.commit();
  s_logger.debug("Deleted security group id=" + groupId);
  return true;
}
