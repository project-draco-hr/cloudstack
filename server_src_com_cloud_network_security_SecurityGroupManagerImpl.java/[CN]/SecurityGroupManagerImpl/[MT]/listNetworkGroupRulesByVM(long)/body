{
  List<SecurityGroupRulesVO> results=new ArrayList<SecurityGroupRulesVO>();
  List<NetworkGroupVMMapVO> networkGroupMappings=_networkGroupVMMapDao.listByInstanceId(vmId);
  if (networkGroupMappings != null) {
    for (    NetworkGroupVMMapVO networkGroupMapping : networkGroupMappings) {
      NetworkGroupVO group=_networkGroupDao.findById(networkGroupMapping.getNetworkGroupId());
      List<SecurityGroupRulesVO> rules=_networkGroupRulesDao.listNetworkGroupRules(group.getAccountId(),networkGroupMapping.getGroupName());
      if (rules != null) {
        results.addAll(rules);
      }
    }
  }
  return results;
}
