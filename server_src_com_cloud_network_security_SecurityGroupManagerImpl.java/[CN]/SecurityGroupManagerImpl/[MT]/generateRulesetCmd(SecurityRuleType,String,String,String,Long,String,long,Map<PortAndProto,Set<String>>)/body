{
  List<IpPortAndProto> result=new ArrayList<IpPortAndProto>();
  for (  PortAndProto pAp : rules.keySet()) {
    Set<String> cidrs=rules.get(pAp);
    if (cidrs.size() > 0) {
      IpPortAndProto ipPortAndProto=new SecurityGroupRulesCmd.IpPortAndProto(pAp.getProto(),pAp.getStartPort(),pAp.getEndPort(),cidrs.toArray(new String[cidrs.size()]));
      result.add(ipPortAndProto);
    }
  }
  return new SecurityGroupRulesCmd(ruleType,guestIp,guestMac,vmName,vmId,signature,seqnum,result.toArray(new IpPortAndProto[result.size()]));
}
