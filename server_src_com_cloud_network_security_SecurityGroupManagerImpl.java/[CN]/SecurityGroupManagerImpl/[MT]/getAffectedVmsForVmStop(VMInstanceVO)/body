{
  List<Long> affectedVms=new ArrayList<Long>();
  List<SecurityGroupVMMapVO> groupsForVm=_securityGroupVMMapDao.listByInstanceId(vm.getId());
  for (  SecurityGroupVMMapVO mapVO : groupsForVm) {
    List<IngressRuleVO> allowingRules=_ingressRuleDao.listByAllowedSecurityGroupId(mapVO.getSecurityGroupId());
    affectedVms.addAll(getAffectedVmsForIngressRules(allowingRules));
  }
  return affectedVms;
}
