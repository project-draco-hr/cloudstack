{
  String value=configDao.getValue(Config.BackupSnapshotWait.toString());
  int _backupsnapshotwait=NumbersUtil.parseInt(value,Integer.parseInt(Config.BackupSnapshotWait.getDefaultValue()));
  DataObject cacheData=null;
  try {
    if (destData.getDataStore().getRole() != DataStoreRole.ImageCache) {
      cacheData=cacheMgr.getCacheObject(srcData,destData.getDataStore().getScope());
      CopyCommand cmd=new CopyCommand(srcData.getTO(),destData.getTO(),_backupsnapshotwait);
      cmd.setCacheTO(cacheData.getTO());
      EndPoint ep=selector.select(srcData,destData);
      Answer answer=ep.sendMessage(cmd);
      return answer;
    }
 else {
      CopyCommand cmd=new CopyCommand(srcData.getTO(),destData.getTO(),_backupsnapshotwait);
      EndPoint ep=selector.select(srcData,destData);
      Answer answer=ep.sendMessage(cmd);
      return answer;
    }
  }
 catch (  Exception e) {
    s_logger.debug("copy snasphot failed: " + e.toString());
    if (cacheData != null) {
      cacheMgr.deleteCacheObject(cacheData);
    }
    throw new CloudRuntimeException(e.toString());
  }
}
