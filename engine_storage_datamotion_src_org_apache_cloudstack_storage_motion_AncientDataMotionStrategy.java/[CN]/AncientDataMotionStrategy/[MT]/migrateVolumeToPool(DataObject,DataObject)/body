{
  VolumeInfo volume=(VolumeInfo)srcData;
  StoragePool destPool=(StoragePool)this.dataStoreMgr.getDataStore(destData.getDataStore().getId(),DataStoreRole.Primary);
  MigrateVolumeCommand command=new MigrateVolumeCommand(volume.getId(),volume.getPath(),destPool);
  EndPoint ep=selector.select(volume.getDataStore());
  MigrateVolumeAnswer answer=(MigrateVolumeAnswer)ep.sendMessage(command);
  if (answer == null || !answer.getResult()) {
    throw new CloudRuntimeException("Failed to migrate volume " + volume + " to storage pool "+ destPool);
  }
 else {
    VolumeVO volumeVo=this.volDao.findById(volume.getId());
    Long oldPoolId=volume.getPoolId();
    volumeVo.setPath(answer.getVolumePath());
    volumeVo.setFolder(destPool.getPath());
    volumeVo.setPodId(destPool.getPodId());
    volumeVo.setPoolId(destPool.getId());
    volumeVo.setLastPoolId(oldPoolId);
    this.volDao.update(volume.getId(),volumeVo);
  }
  return answer;
}
