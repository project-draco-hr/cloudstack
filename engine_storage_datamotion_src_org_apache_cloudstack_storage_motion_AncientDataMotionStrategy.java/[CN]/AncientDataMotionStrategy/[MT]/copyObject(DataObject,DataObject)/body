{
  String value=configDao.getValue(Config.PrimaryStorageDownloadWait.toString());
  int _primaryStorageDownloadWait=NumbersUtil.parseInt(value,Integer.parseInt(Config.PrimaryStorageDownloadWait.getDefaultValue()));
  Answer answer=null;
  boolean usingCache=false;
  DataObject cacheData=null;
  DataObject srcForCopy=srcData;
  try {
    if (needCacheStorage(srcData,destData)) {
      Scope destScope=getZoneScope(destData.getDataStore().getScope());
      srcForCopy=cacheData=cacheMgr.createCacheObject(srcData,destScope);
    }
    CopyCommand cmd=new CopyCommand(srcForCopy.getTO(),destData.getTO(),_primaryStorageDownloadWait,_mgmtServer.getExecuteInSequence());
    EndPoint ep=selector.select(srcForCopy,destData);
    answer=ep.sendMessage(cmd);
    if (cacheData != null) {
      if (answer == null || !answer.getResult()) {
        cacheMgr.deleteCacheObject(srcForCopy);
      }
 else {
        cacheMgr.releaseCacheObject(srcForCopy);
      }
    }
    return answer;
  }
 catch (  Exception e) {
    s_logger.debug("copy object failed: " + e.toString());
    if (cacheData != null) {
      cacheMgr.deleteCacheObject(cacheData);
    }
    throw new CloudRuntimeException(e.toString());
  }
}
