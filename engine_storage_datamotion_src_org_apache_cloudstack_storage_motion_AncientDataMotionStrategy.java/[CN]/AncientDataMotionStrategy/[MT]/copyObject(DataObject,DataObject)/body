{
  String value=configDao.getValue(Config.PrimaryStorageDownloadWait.toString());
  int _primaryStorageDownloadWait=NumbersUtil.parseInt(value,Integer.parseInt(Config.PrimaryStorageDownloadWait.getDefaultValue()));
  Answer answer=null;
  DataObject cacheData=null;
  try {
    if (needCacheStorage(srcData,destData)) {
      Scope destScope=getZoneScope(destData.getDataStore().getScope());
      cacheData=cacheMgr.createCacheObject(srcData,destScope);
      CopyCommand cmd=new CopyCommand(cacheData.getTO(),destData.getTO(),_primaryStorageDownloadWait);
      EndPoint ep=selector.select(cacheData,destData);
      answer=ep.sendMessage(cmd);
    }
 else {
      CopyCommand cmd=new CopyCommand(srcData.getTO(),destData.getTO(),_primaryStorageDownloadWait);
      EndPoint ep=selector.select(srcData,destData);
      answer=ep.sendMessage(cmd);
    }
    if (cacheData != null) {
      if (answer == null || !answer.getResult()) {
        cacheMgr.deleteCacheObject(cacheData);
      }
 else {
        cacheMgr.releaseCacheObject(cacheData);
      }
    }
    return answer;
  }
 catch (  Exception e) {
    s_logger.debug("copy object failed: " + e.toString());
    if (cacheData != null) {
      cacheMgr.deleteCacheObject(cacheData);
    }
    throw new CloudRuntimeException(e.toString());
  }
}
