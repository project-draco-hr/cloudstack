{
  List<VMTemplateVO> tmplts=_templateDao.listAllInZone(dcId);
  Iterator<VMTemplateVO> iter=tmplts.iterator();
  while (iter.hasNext()) {
    VMTemplateVO tmplt=iter.next();
    if (tmplt.isPublicTemplate() || tmplt.isFeatured()) {
      continue;
    }
    List<VMTemplateHostVO> tmpltHosts=_vmTemplateHostDao.listByZoneTemplate(dcId,tmplt.getId());
    for (    VMTemplateHostVO tmpltHost : tmpltHosts) {
      if (tmpltHost.getDownloadState() == Status.DOWNLOADED || tmpltHost.getDownloadState() == Status.DOWNLOAD_IN_PROGRESS) {
        iter.remove();
        break;
      }
    }
  }
  return tmplts;
}
