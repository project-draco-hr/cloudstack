{
  List<SecondaryStorageVmVO> ssVms=_secStorageVmDao.getSecStorageVmListInStates(SecondaryStorageVm.Role.templateProcessor,sourceServer.getScope().getScopeId(),State.Running);
  if (ssVms.size() > 0) {
    SecondaryStorageVmVO ssVm=ssVms.get(0);
    if (ssVm.getPublicIpAddress() == null) {
      s_logger.warn("A running secondary storage vm has a null public ip?");
      return null;
    }
    ImageStoreVO svo=this._imageStoreDao.findById(sourceServer.getId());
    return generateCopyUrl(ssVm.getPublicIpAddress(),svo.getParent(),srcTmpltStore.getInstallPath());
  }
  VMTemplateVO tmplt=_templateDao.findById(srcTmpltStore.getTemplateId());
  HypervisorType hyperType=tmplt.getHypervisorType();
  if (hyperType != null && hyperType == HypervisorType.KVM) {
    return "file://" + "/" + srcTmpltStore.getInstallPath();
  }
  return null;
}
