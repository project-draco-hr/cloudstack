{
  List<HypervisorType> hypers=_hostDao.getAvailHypervisorInZone(host.getId(),host.getDataCenterId());
  HypervisorType hostHyper=host.getHypervisorType();
  if (hypers.contains(hostHyper)) {
    return;
  }
  Set<VMTemplateVO> toBeDownloaded=new HashSet<VMTemplateVO>();
  List<HostVO> ssHosts=_hostDao.listBy(Host.Type.SecondaryStorage,host.getDataCenterId());
  if (ssHosts == null || ssHosts.isEmpty()) {
    return;
  }
  HostVO sshost=ssHosts.get(0);
  List<VMTemplateVO> rtngTmplts=_templateDao.listAllSystemVMTemplates();
  List<VMTemplateVO> defaultBuiltin=_templateDao.listDefaultBuiltinTemplates();
  for (  VMTemplateVO rtngTmplt : rtngTmplts) {
    if (rtngTmplt.getHypervisorType() == hostHyper) {
      toBeDownloaded.add(rtngTmplt);
    }
  }
  for (  VMTemplateVO builtinTmplt : defaultBuiltin) {
    if (builtinTmplt.getHypervisorType() == hostHyper) {
      toBeDownloaded.add(builtinTmplt);
    }
  }
  for (  VMTemplateVO template : toBeDownloaded) {
    VMTemplateHostVO tmpltHost=_vmTemplateHostDao.findByHostTemplate(sshost.getId(),template.getId());
    if (tmpltHost == null || tmpltHost.getDownloadState() != Status.DOWNLOADED) {
      if (_vmTemplateZoneDao.findByZoneTemplate(sshost.getDataCenterId(),template.getId()) == null) {
        _templateDao.addTemplateToZone(template,sshost.getDataCenterId());
      }
      downloadTemplateToStorage(template,sshost);
    }
  }
}
