{
  UserContext context=UserContext.current();
  context.setAccountId(1);
  HostVO host=_hostDao.findById(agentId);
  if (host.getHypervisorType() != HypervisorType.VMware) {
    return true;
  }
  List<DomainRouterVO> routers=_routerDao.listByHostId(agentId);
  for (  DomainRouterVO router : routers) {
    try {
      State oldState=router.getState();
      _routerMgr.stopRouter(router.getId(),true);
      if (oldState == State.Running) {
        shutdownRouterVM(router);
      }
    }
 catch (    ResourceUnavailableException e) {
      s_logger.warn("Fail to stop router " + router.getInstanceName() + " when host disconnected!",e);
    }
catch (    ConcurrentOperationException e) {
      s_logger.warn("Fail to stop router " + router.getInstanceName() + " when host disconnected!",e);
    }
  }
  return true;
}
