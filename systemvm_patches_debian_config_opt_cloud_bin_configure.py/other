import sys
from merge import dataBag
from pprint import pprint
import subprocess
import logging
import re
import time
logging.basicConfig(filename='/var/log/cloud.log', level=logging.DEBUG, format='%(asctime)s %(message)s')
db = dataBag()
db.setKey('ips')
db.load()
dbag = db.getDataBag()
for dev in csDevice('').list():
    ip = csIp(dev)
    ip.compare(dbag)
for dev in dbag:
    if (dev == 'id'):
        continue
    ip = csIp(dev)
    for address in dbag[dev]:
        csRoute(dev).add(address)
        ip.setAddress(address)
        if ip.configured():
            logging.info('Address %s on device %s already configured', ip.ip(), dev)
        else:
            logging.info('Address %s on device %s not configured', ip.ip(), dev)
            if csDevice(dev).waitForDevice():
                ip.configure()
