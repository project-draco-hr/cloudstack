def main(argv):
    logging.basicConfig(filename='/var/log/cloud.log', level=logging.DEBUG, format='%(asctime)s %(message)s')
    db = dataBag()
    db.setKey('ips')
    db.load()
    dbag = db.getDataBag()
    for dev in CsDevice('').list():
        ip = CsIP(dev)
        ip.compare(dbag)
    for dev in dbag:
        if (dev == 'id'):
            continue
        ip = CsIP(dev)
        for address in dbag[dev]:
            CsRoute(dev).add(address)
            ip.setAddress(address)
            if ip.configured():
                logging.info('Address %s on device %s already configured', ip.ip(), dev)
                ip.post_configure()
            else:
                logging.info('Address %s on device %s not configured', ip.ip(), dev)
                if CsDevice(dev).waitfordevice():
                    ip.configure()
