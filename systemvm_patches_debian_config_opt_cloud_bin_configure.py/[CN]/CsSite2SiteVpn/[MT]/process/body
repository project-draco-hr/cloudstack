def process(self):
    self.confips = []
    for file in os.listdir(self.VPNCONFDIR):
        m = re.search('ipsec.vpn-(.*).conf', file)
        if m:
            self.confips.append(m.group(1))
    for public_ip in self.dbag:
        if (public_ip == 'id'):
            continue
        dev = CsHelper.get_device(public_ip)
        if (dev == ''):
            logging.error('Request for ipsec to %s not possible because ip is not configured', public_ip)
            continue
        CsHelper.start_if_stopped('ipsec')
        self.configure_iptables(dev, self.dbag[public_ip])
        self.configure_ipsec(self.dbag[public_ip])
    for ip in self.confips:
        self.deletevpn(ip)
