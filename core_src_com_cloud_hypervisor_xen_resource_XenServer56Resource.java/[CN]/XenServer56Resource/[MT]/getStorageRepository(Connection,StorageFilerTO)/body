{
  try {
    SR sr=super.getStorageRepository(conn,pool);
    if (!sr.getShared(conn) || (pool.getType() != StoragePoolType.IscsiLUN && pool.getType() != StoragePoolType.NetworkFilesystem && pool.getType() != StoragePoolType.PreSetup)) {
      return sr;
    }
    setupHeartbeatSr(conn,sr,false);
    return sr;
  }
 catch (  Exception e) {
    String msg="Catch Exception " + e.getClass().getName() + ", Unable to setup heartbeat sr on "+ pool.getUuid()+ " due to "+ e.toString();
    s_logger.warn(msg);
    throw new CloudRuntimeException(msg);
  }
}
