{
  try {
    PreparedStatement pstmt=conn.prepareStatement("DELETE from op_ha_work WHERE taken IS NOT NULL");
    pstmt.executeUpdate();
    pstmt.close();
    pstmt=conn.prepareStatement("SELECT DISTINCT host_id from op_ha_work");
    ResultSet rs=pstmt.executeQuery();
    while (rs.next()) {
      Long hostId=rs.getLong(1);
      pstmt=conn.prepareStatement("SELECT * from host where id=?");
      pstmt.setLong(1,hostId);
      ResultSet hostSet=pstmt.executeQuery();
      if (!hostSet.next()) {
        pstmt=conn.prepareStatement("DELETE from op_ha_work where host_id=?");
        pstmt.setLong(1,hostId);
        pstmt.executeUpdate();
        s_logger.debug("Removed records from op_ha_work having hostId=" + hostId + " as the host no longer exists");
      }
      hostSet.close();
    }
    rs.close();
    pstmt.close();
    s_logger.debug("Completed cleaning up op_ha_work table");
  }
 catch (  SQLException e) {
    throw new CloudRuntimeException("Failed to cleanup op_ha_work table due to:",e);
  }
}
