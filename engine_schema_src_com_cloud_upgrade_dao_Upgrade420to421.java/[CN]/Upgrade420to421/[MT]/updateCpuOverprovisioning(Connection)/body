{
  PreparedStatement pstmt1=null;
  PreparedStatement pstmt2=null;
  PreparedStatement pstmt3=null;
  ResultSet result1=null;
  ResultSet result2=null;
  try {
    pstmt1=conn.prepareStatement("select value from `cloud`.`configuration` where name='cpu.overprovisioning.factor'");
    result1=pstmt1.executeQuery();
    String overprov="1";
    if (result1.next()) {
      overprov=result1.getString(1);
    }
    s_logger.debug("Starting updating user_vm_details with cpu/memory overprovisioning factors");
    pstmt2=conn.prepareStatement("select id from `cloud`.`vm_instance` where removed is null and id not in (select vm_id from  `cloud`.`user_vm_details` where name='cpuOvercommitRatio')");
    pstmt3=conn.prepareStatement("INSERT IGNORE INTO cloud.user_vm_details (vm_id, name, value) VALUES (?, ?, ?)");
    result2=pstmt2.executeQuery();
    while (result2.next()) {
      pstmt3.setLong(1,result2.getLong(1));
      pstmt3.setString(2,"cpuOvercommitRatio");
      pstmt3.setString(3,overprov);
      pstmt3.executeUpdate();
      pstmt3.setLong(1,result2.getLong(1));
      pstmt3.setString(2,"memoryOvercommitRatio");
      pstmt3.setString(3,"1");
      pstmt3.executeUpdate();
    }
    s_logger.debug("Done updating user_vm_details with cpu/memory overprovisioning factors");
  }
 catch (  SQLException e) {
    throw new CloudRuntimeException("Unable to update cpu/memory overprovisioning factors",e);
  }
 finally {
    try {
      if (pstmt1 != null)       pstmt1.close();
      if (pstmt2 != null)       pstmt2.close();
      if (pstmt3 != null)       pstmt3.close();
    }
 catch (    SQLException e) {
    }
  }
}
