{
  long vmId=work.getInstanceId();
  long srcHostId=work.getHostId();
  try {
    work.setStep(Step.Migrating);
    _haDao.update(work.getId(),work);
    VMInstanceVO vm=_instanceDao.findById(vmId);
    boolean result=false;
    try {
      _itMgr.migrateAway(vm.getUuid(),srcHostId,null);
    }
 catch (    InsufficientServerCapacityException e) {
      s_logger.warn("Failed to deploy vm " + vmId + " with original planner, sending HAPlanner");
      _itMgr.migrateAway(vm.getUuid(),srcHostId,_haPlanners.get(0));
    }
    return null;
  }
 catch (  InsufficientServerCapacityException e) {
    s_logger.warn("Insufficient capacity for migrating a VM.");
    _resourceMgr.maintenanceFailed(srcHostId);
    return (System.currentTimeMillis() >> 10) + _migrateRetryInterval;
  }
}
