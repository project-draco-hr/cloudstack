{
  if (oldState == State.Running && event == VirtualMachine.Event.FollowAgentPowerOffReport && newState == State.Stopped) {
    long serviceOfferingId=vo.getServiceOfferingId();
    ServiceOfferingVO serviceOffering=_serviceOfferingDao.findById(serviceOfferingId);
    if (serviceOffering != null && serviceOffering.getOfferHA()) {
      VMInstanceVO vm=_instanceDao.findById(vo.getId());
      s_logger.info("Detected out-of-band stop of a HA enabled VM " + vm.getInstanceName() + ", will schedule restart");
      scheduleRestart(vm,true);
    }
  }
  return true;
}
