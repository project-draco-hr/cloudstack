{
  if (oldState == State.Running && event == VirtualMachine.Event.FollowAgentPowerOffReport && newState == State.Stopped) {
    VMInstanceVO vm=_instanceDao.findById(vo.getId());
    if (vm.isHaEnabled()) {
      s_logger.info("Detected out-of-band stop of a HA enabled VM " + vm.getInstanceName() + ", will schedule restart");
      scheduleRestart(vm,true);
    }
  }
  return true;
}
