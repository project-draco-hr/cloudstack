{
  final HashMap<Long,AgentVmInfo> map=new HashMap<Long,AgentVmInfo>();
  if (states == null) {
    return map;
  }
  final Collection<VirtualMachineManager<VMInstanceVO>> handlers=_handlers.values();
  for (  final Map.Entry<String,State> entry : states.entrySet()) {
    for (    final VirtualMachineManager<VMInstanceVO> handler : handlers) {
      final String name=entry.getKey();
      final Long id=handler.convertToId(name);
      if (id != null) {
        map.put(id,new AgentVmInfo(entry.getKey(),handler,entry.getValue()));
        break;
      }
    }
  }
  return map;
}
