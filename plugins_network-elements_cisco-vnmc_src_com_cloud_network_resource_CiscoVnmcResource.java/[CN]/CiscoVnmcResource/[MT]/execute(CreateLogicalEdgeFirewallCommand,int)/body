{
  String tenant="vlan-" + cmd.getVlanId();
  try {
    if (!_connection.createTenant(tenant))     throw new Exception("Failed to create tenant in VNMC for guest network with vlan " + cmd.getVlanId());
    if (!_connection.createTenantVDC(tenant))     throw new Exception("Failed to create tenant VDC in VNMC for guest network with vlan " + cmd.getVlanId());
    if (!_connection.createTenantVDCEdgeSecurityProfile(tenant))     throw new Exception("Failed to create tenant edge security profile in VNMC for guest network with vlan " + cmd.getVlanId());
    createEdgeDeviceProfile(tenant,cmd.getPublicGateways(),cmd.getVlanId());
    if (!_connection.createEdgeFirewall(tenant,cmd.getPublicIp(),cmd.getInternalIp(),cmd.getPublicSubnet(),cmd.getInternalSubnet()))     throw new Exception("Failed to create edge firewall in VNMC for guest network with vlan " + cmd.getVlanId());
  }
 catch (  Throwable e) {
    String msg="CreateLogicalEdgeFirewallCommand failed due to " + e.getMessage();
    s_logger.error(msg,e);
    return new Answer(cmd,false,msg);
  }
  return new Answer(cmd,true,"Success");
}
