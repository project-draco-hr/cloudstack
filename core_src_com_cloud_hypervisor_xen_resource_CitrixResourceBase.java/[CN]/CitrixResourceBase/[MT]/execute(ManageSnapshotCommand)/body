{
  long snapshotId=cmd.getSnapshotId();
  String snapshotName=cmd.getSnapshotName();
  boolean success=false;
  String cmdSwitch=cmd.getCommandSwitch();
  String snapshotOp="Unsupported snapshot command." + cmdSwitch;
  if (cmdSwitch.equals(ManageSnapshotCommand.CREATE_SNAPSHOT)) {
    snapshotOp="create";
  }
 else   if (cmdSwitch.equals(ManageSnapshotCommand.DESTROY_SNAPSHOT)) {
    snapshotOp="destroy";
  }
  String details="ManageSnapshotCommand operation: " + snapshotOp + " Failed for snapshotId: "+ snapshotId;
  String snapshotUUID=null;
  Connection conn=getConnection();
  try {
    if (cmdSwitch.equals(ManageSnapshotCommand.CREATE_SNAPSHOT)) {
      String volumeUUID=cmd.getVolumePath();
      VDI volume=getVDIbyUuid(volumeUUID);
      VDI snapshot=volume.snapshot(conn,new HashMap<String,String>());
      if (snapshotName != null) {
        snapshot.setNameLabel(conn,snapshotName);
      }
      VDI.Record vdir=snapshot.getRecord(conn);
      snapshotUUID=vdir.uuid;
      success=true;
      details=null;
    }
 else     if (cmd.getCommandSwitch().equals(ManageSnapshotCommand.DESTROY_SNAPSHOT)) {
      snapshotUUID=cmd.getSnapshotPath();
      VDI snapshot=getVDIbyUuid(snapshotUUID);
      snapshot.destroy(conn);
      snapshotUUID=null;
      success=true;
      details=null;
    }
  }
 catch (  XenAPIException e) {
    details+=", reason: " + e.toString();
    s_logger.warn(details,e);
  }
catch (  Exception e) {
    details+=", reason: " + e.toString();
    s_logger.warn(details,e);
  }
  return new ManageSnapshotAnswer(cmd,snapshotId,snapshotUUID,success,details);
}
