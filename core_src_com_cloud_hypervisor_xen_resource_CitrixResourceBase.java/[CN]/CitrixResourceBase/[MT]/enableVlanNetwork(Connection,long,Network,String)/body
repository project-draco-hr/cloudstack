{
  Network vlanNetwork=null;
  String name="VLAN" + Long.toString(tag);
  vlanNetwork=getNetworkByName(conn,name,true);
  if (vlanNetwork == null) {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Creating VLAN network for " + tag + " on host "+ _host.ip);
    }
    Network.Record nwr=new Network.Record();
    nwr.nameLabel=name;
    nwr.bridge=name;
    vlanNetwork=Network.create(conn,nwr);
  }
  PIF nPif=PIF.getByUuid(conn,pifUuid);
  PIF.Record nPifr=nPif.getRecord(conn);
  Network.Record vlanNetworkr=vlanNetwork.getRecord(conn);
  if (vlanNetworkr.PIFs != null) {
    for (    PIF pif : vlanNetworkr.PIFs) {
      PIF.Record pifr=pif.getRecord(conn);
      if (pifr.device.equals(nPifr.device) && pifr.host.equals(nPifr.host)) {
        return vlanNetwork;
      }
    }
  }
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("Creating VLAN " + tag + " on host "+ _host.ip+ " on device "+ nPifr.device);
  }
  VLAN vlan=VLAN.create(conn,nPif,tag,vlanNetwork);
  VLAN.Record vlanr=vlan.getRecord(conn);
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("VLAN is created for " + tag + ".  The uuid is "+ vlanr.uuid);
  }
  return vlanNetwork;
}
