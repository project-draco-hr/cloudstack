{
  if (tag != null) {
    if (s_logger.isDebugEnabled()) {
      s_logger.debug("Looking for network named " + tag);
    }
    Network network=getNetworkByName(conn,tag);
  }
  if (type == TrafficType.Guest) {
    return new Pair<Network,String>(Network.getByUuid(conn,_host.guestNetwork),_host.guestPif);
  }
 else   if (type == TrafficType.Control) {
    setupLinkLocalNetwork(conn);
    return new Pair<Network,String>(Network.getByUuid(conn,_host.linkLocalNetwork),null);
  }
 else   if (type == TrafficType.Management) {
    return new Pair<Network,String>(Network.getByUuid(conn,_host.privateNetwork),_host.privatePif);
  }
 else   if (type == TrafficType.Public) {
    return new Pair<Network,String>(Network.getByUuid(conn,_host.publicNetwork),_host.publicPif);
  }
 else   if (type == TrafficType.Storage) {
    return new Pair<Network,String>(Network.getByUuid(conn,_host.storageNetwork1),_host.storagePif1);
  }
 else   if (type == TrafficType.Vpn) {
    return new Pair<Network,String>(Network.getByUuid(conn,_host.publicNetwork),_host.publicPif);
  }
  throw new CloudRuntimeException("Unsupported network type: " + type);
}
