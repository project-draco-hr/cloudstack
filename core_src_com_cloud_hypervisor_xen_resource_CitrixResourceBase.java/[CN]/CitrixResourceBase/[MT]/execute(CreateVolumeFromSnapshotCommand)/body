{
  Connection conn=getConnection();
  String primaryStorageNameLabel=cmd.getPrimaryStoragePoolNameLabel();
  Long accountId=cmd.getAccountId();
  Long volumeId=cmd.getVolumeId();
  String secondaryStoragePoolURL=cmd.getSecondaryStoragePoolURL();
  String backedUpSnapshotUuid=cmd.getSnapshotUuid();
  boolean result=false;
  String details=null;
  String volumeUUID=null;
  SR snapshotSR=null;
  if (secondaryStoragePoolURL == null) {
    details+=" because the URL passed: " + secondaryStoragePoolURL + " is invalid.";
    return new CreateVolumeFromSnapshotAnswer(cmd,result,details,volumeUUID);
  }
  try {
    SR primaryStorageSR=getSRByNameLabelandHost(conn,primaryStorageNameLabel);
    if (primaryStorageSR == null) {
      throw new InternalErrorException("Could not create volume from snapshot because the primary Storage SR could not be created from the name label: " + primaryStorageNameLabel);
    }
    URI snapshotURI=new URI(secondaryStoragePoolURL + "/snapshots/" + accountId+ "/"+ volumeId);
    snapshotSR=createNfsSRbyURI(conn,snapshotURI,false);
    snapshotSR.scan(conn);
    VDI snapshotVDI=getVDIbyUuid(conn,backedUpSnapshotUuid);
    VDI volumeVDI=cloudVDIcopy(conn,snapshotVDI,primaryStorageSR);
    volumeUUID=volumeVDI.getUuid(conn);
    result=true;
  }
 catch (  XenAPIException e) {
    details+=" due to " + e.toString();
    s_logger.warn(details,e);
  }
catch (  Exception e) {
    details+=" due to " + e.getMessage();
    s_logger.warn(details,e);
  }
 finally {
    if (snapshotSR != null) {
      removeSR(conn,snapshotSR);
    }
  }
  if (!result) {
    s_logger.error(details);
  }
  return new CreateVolumeFromSnapshotAnswer(cmd,result,details,volumeUUID);
}
