{
  try {
    Connection conn=getConnection();
    SR.Record srr=sr.getRecord(conn);
    Set<PBD> pbds=sr.getPBDs(conn);
    if (pbds.size() == 0) {
      String msg="There is no PBDs for this SR: " + _host.uuid;
      s_logger.warn(msg);
      removeSR(sr);
      return false;
    }
    Set<Host> hosts=null;
    if (srr.shared) {
      hosts=Host.getAll(conn);
      for (      Host host : hosts) {
        boolean found=false;
        for (        PBD pbd : pbds) {
          if (host.equals(pbd.getHost(conn))) {
            PBD.Record pbdr=pbd.getRecord(conn);
            if (currentlyAttached(sr,srr,pbd,pbdr)) {
              if (!pbdr.currentlyAttached) {
                pbd.plug(conn);
              }
            }
 else {
              if (pbdr.currentlyAttached) {
                pbd.unplug(conn);
              }
              pbd.plug(conn);
            }
            pbds.remove(pbd);
            found=true;
            break;
          }
        }
        if (!found) {
          PBD.Record pbdr=srr.PBDs.iterator().next().getRecord(conn);
          pbdr.host=host;
          pbdr.uuid="";
          PBD pbd=PBD.create(conn,pbdr);
          pbd.plug(conn);
        }
      }
    }
 else {
      for (      PBD pbd : pbds) {
        PBD.Record pbdr=pbd.getRecord(conn);
        if (!pbdr.currentlyAttached) {
          pbd.plug(conn);
        }
      }
    }
  }
 catch (  Exception e) {
    String msg="checkSR failed host:" + _host.uuid;
    s_logger.warn(msg);
    return false;
  }
  return true;
}
