{
  VolumeType type=volume.getType();
  VDI vdi=mount(conn,vmName,volume);
  VBD.Record vbdr=new VBD.Record();
  vbdr.VM=vm;
  if (vdi != null) {
    vbdr.VDI=vdi;
  }
 else {
    vbdr.empty=true;
  }
  if (type == VolumeType.ROOT && bootLoaderType == BootloaderType.PyGrub) {
    vbdr.bootable=true;
  }
  vbdr.userdevice=Long.toString(volume.getDeviceId());
  if (volume.getType() == VolumeType.ISO) {
    String guestOsTypeName=getGuestOsType(guestOsDisplayName,bootLoaderType == BootloaderType.CD);
    if (!(guestOsTypeName.startsWith("Windows") || guestOsTypeName.startsWith("Citrix") || guestOsTypeName.startsWith("Other"))) {
      if (volume.getName() != null) {
        String volumeGuestOsTypeName=getGuestOsType(volume.getName(),bootLoaderType == BootloaderType.CD);
        if (!(volumeGuestOsTypeName.startsWith("Windows") || volumeGuestOsTypeName.startsWith("Citrix") || volumeGuestOsTypeName.startsWith("Other"))) {
          vbdr.bootable=true;
        }
 else {
          vbdr.bootable=false;
        }
      }
 else {
        vbdr.bootable=false;
      }
    }
    vbdr.mode=Types.VbdMode.RO;
    vbdr.type=Types.VbdType.CD;
  }
 else {
    vbdr.mode=Types.VbdMode.RW;
    vbdr.type=Types.VbdType.DISK;
  }
  VBD vbd=VBD.create(conn,vbdr);
  if (s_logger.isDebugEnabled()) {
    s_logger.debug("VBD " + vbd.getUuid(conn) + " created for "+ volume);
  }
  return vbd;
}
