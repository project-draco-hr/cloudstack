{
  try {
    Connection conn=getConnection();
    if (!pingXenServer()) {
      Thread.sleep(1000);
      if (!pingXenServer()) {
        s_logger.warn(" can not ping xenserver " + _host.uuid);
        return null;
      }
    }
    HashMap<String,State> newStates=sync(conn);
    if (newStates == null) {
      s_logger.warn("Unable to get current status from sync");
      return null;
    }
    if (!_canBridgeFirewall && !_isOvs) {
      return new PingRoutingCommand(getType(),id,newStates);
    }
 else     if (_isOvs) {
      List<Pair<String,Long>> ovsStates=ovsFullSyncStates();
      return new PingRoutingWithOvsCommand(getType(),id,newStates,ovsStates);
    }
 else {
      HashMap<String,Pair<Long,Long>> nwGrpStates=syncNetworkGroups(conn,id);
      return new PingRoutingWithNwGroupsCommand(getType(),id,newStates,nwGrpStates);
    }
  }
 catch (  Exception e) {
    s_logger.warn("Unable to get current status",e);
    return null;
  }
}
