{
  VIF.Record vifr=new VIF.Record();
  vifr.VM=vm;
  vifr.device=Integer.toString(nic.getDeviceId());
  vifr.MAC=nic.getMac();
  Pair<Network,String> network=getNetworkForTraffic(conn,nic.getType());
  if (nic.getBroadcastType() == BroadcastDomainType.Vlan) {
    vifr.network=enableVlanNetwork(conn,nic.getVlan(),network.first(),network.second());
  }
 else {
    vifr.network=network.first();
  }
  if (nic.getNetworkRateMbps() != null) {
    vifr.qosAlgorithmType="ratelimit";
    vifr.qosAlgorithmParams=new HashMap<String,String>();
    vifr.qosAlgorithmParams.put("kbps",Integer.toString(nic.getNetworkRateMbps() * 128));
  }
  VIF vif=VIF.create(conn,vifr);
  if (s_logger.isDebugEnabled()) {
    vifr=vif.getRecord(conn);
    s_logger.debug("Created a vif " + vifr.uuid + " on "+ nic.getDeviceId());
  }
  return vif;
}
