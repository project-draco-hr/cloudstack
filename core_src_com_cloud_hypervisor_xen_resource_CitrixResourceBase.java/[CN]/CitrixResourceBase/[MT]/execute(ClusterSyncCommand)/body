{
  Connection conn=getConnection();
  Pool pool;
  try {
    pool=Pool.getByUuid(conn,_host.pool);
    Pool.Record poolr=pool.getRecord(conn);
    Host.Record hostr=poolr.master.getRecord(conn);
    if (!_host.uuid.equals(hostr.uuid)) {
      return new ClusterSyncAnswer(cmd.getClusterId());
    }
  }
 catch (  Exception e) {
    s_logger.warn("Check for master failed, failing the Cluster sync command");
    return new ClusterSyncAnswer(cmd.getClusterId());
  }
  HashMap<String,Pair<String,State>> newStates;
  int sync_type=-1;
  if (cmd.isRightStep()) {
    newStates=fullClusterSync(conn);
    sync_type=ClusterSyncAnswer.FULL_SYNC;
  }
 else {
    newStates=deltaClusterSync(conn);
    if (newStates == null) {
      s_logger.warn("Unable to get current status from sync");
    }
    sync_type=ClusterSyncAnswer.DELTA_SYNC;
  }
  cmd.incrStep();
  return new ClusterSyncAnswer(cmd.getClusterId(),newStates,sync_type);
}
