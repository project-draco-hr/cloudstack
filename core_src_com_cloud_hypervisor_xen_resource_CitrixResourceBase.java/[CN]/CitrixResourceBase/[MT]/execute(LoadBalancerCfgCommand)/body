{
  String routerIp=cmd.getRouterIp();
  if (routerIp == null) {
    return new Answer(cmd);
  }
  String tmpCfgFilePath="/tmp/" + cmd.getRouterIp().replace('.','_') + ".cfg";
  String tmpCfgFileContents="";
  for (int i=0; i < cmd.getConfig().length; i++) {
    tmpCfgFileContents+=cmd.getConfig()[i];
    tmpCfgFileContents+="\n";
  }
  String result=callHostPlugin("vmops","createFile","filepath",tmpCfgFilePath,"filecontents",tmpCfgFileContents);
  if (result == null || result.isEmpty()) {
    return new Answer(cmd,false,"LoadBalancerCfgCommand failed to create HA proxy cfg file.");
  }
  String[] addRules=cmd.getAddFwRules();
  String[] removeRules=cmd.getRemoveFwRules();
  String args="";
  args+="-i " + routerIp;
  args+=" -f " + tmpCfgFilePath;
  StringBuilder sb=new StringBuilder();
  if (addRules.length > 0) {
    for (int i=0; i < addRules.length; i++) {
      sb.append(addRules[i]).append(',');
    }
    args+=" -a " + sb.toString();
  }
  sb=new StringBuilder();
  if (removeRules.length > 0) {
    for (int i=0; i < removeRules.length; i++) {
      sb.append(removeRules[i]).append(',');
    }
    args+=" -d " + sb.toString();
  }
  result=callHostPlugin("vmops","setLoadBalancerRule","args",args);
  if (result == null || result.isEmpty()) {
    return new Answer(cmd,false,"LoadBalancerCfgCommand failed");
  }
  callHostPlugin("vmops","deleteFile","filepath",tmpCfgFilePath);
  return new Answer(cmd);
}
