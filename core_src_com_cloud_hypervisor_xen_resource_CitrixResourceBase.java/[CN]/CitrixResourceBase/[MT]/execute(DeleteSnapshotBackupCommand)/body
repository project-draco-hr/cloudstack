{
  Long dcId=cmd.getDataCenterId();
  Long accountId=cmd.getAccountId();
  Long volumeId=cmd.getVolumeId();
  String secondaryStoragePoolURL=cmd.getSecondaryStoragePoolURL();
  String backupUUID=cmd.getSnapshotUuid();
  String childUUID=cmd.getChildUUID();
  String primaryStorageNameLabel=cmd.getPrimaryStoragePoolNameLabel();
  String details=null;
  boolean success=false;
  SR primaryStorageSR=null;
  Boolean isISCSI=false;
  try {
    Connection conn=getConnection();
    primaryStorageSR=getSRByNameLabelandHost(primaryStorageNameLabel);
    if (primaryStorageSR == null) {
      details="Primary Storage SR could not be created from the name label: " + primaryStorageNameLabel;
      throw new InternalErrorException(details);
    }
    isISCSI=SRType.LVMOISCSI.equals(primaryStorageSR.getType(conn));
  }
 catch (  XenAPIException e) {
    details="Couldn't determine primary SR type " + e.getMessage();
    s_logger.error(details,e);
  }
catch (  Exception e) {
    details="Couldn't determine primary SR type " + e.getMessage();
    s_logger.error(details,e);
  }
  if (primaryStorageSR != null) {
    URI uri=null;
    try {
      uri=new URI(secondaryStoragePoolURL);
    }
 catch (    URISyntaxException e) {
      details="Error finding the secondary storage URL" + e.getMessage();
      s_logger.error(details,e);
    }
    if (uri != null) {
      String secondaryStorageMountPath=uri.getHost() + ":" + uri.getPath();
      if (secondaryStorageMountPath == null) {
        details="Couldn't delete snapshot because the URL passed: " + secondaryStoragePoolURL + " is invalid.";
      }
 else {
        details=deleteSnapshotBackup(dcId,accountId,volumeId,secondaryStorageMountPath,backupUUID,childUUID,isISCSI);
        success=(details != null && details.equals("1"));
        if (success) {
          s_logger.debug("Successfully deleted snapshot backup " + backupUUID);
        }
      }
    }
  }
  return new DeleteSnapshotBackupAnswer(cmd,success,details);
}
