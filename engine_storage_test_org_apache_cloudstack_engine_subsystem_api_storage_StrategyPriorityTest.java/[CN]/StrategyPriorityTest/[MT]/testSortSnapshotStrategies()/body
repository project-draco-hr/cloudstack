{
  SnapshotStrategy cantHandleStrategy=mock(SnapshotStrategy.class);
  SnapshotStrategy defaultStrategy=mock(SnapshotStrategy.class);
  SnapshotStrategy hyperStrategy=mock(SnapshotStrategy.class);
  SnapshotStrategy pluginStrategy=mock(SnapshotStrategy.class);
  SnapshotStrategy highestStrategy=mock(SnapshotStrategy.class);
  doReturn(StrategyPriority.CANT_HANDLE).when(cantHandleStrategy).canHandle(any(Snapshot.class),any(SnapshotOperation.class));
  doReturn(StrategyPriority.DEFAULT).when(defaultStrategy).canHandle(any(Snapshot.class),any(SnapshotOperation.class));
  doReturn(StrategyPriority.HYPERVISOR).when(hyperStrategy).canHandle(any(Snapshot.class),any(SnapshotOperation.class));
  doReturn(StrategyPriority.PLUGIN).when(pluginStrategy).canHandle(any(Snapshot.class),any(SnapshotOperation.class));
  doReturn(StrategyPriority.HIGHEST).when(highestStrategy).canHandle(any(Snapshot.class),any(SnapshotOperation.class));
  List<SnapshotStrategy> strategies=new ArrayList<SnapshotStrategy>(5);
  strategies.addAll(Arrays.asList(defaultStrategy,pluginStrategy,hyperStrategy,cantHandleStrategy,highestStrategy));
  StorageStrategyFactoryImpl factory=new StorageStrategyFactoryImpl();
  factory.setSnapshotStrategies(strategies);
  Iterator<SnapshotStrategy> iter=factory.getSnapshotStrategies(mock(Snapshot.class),SnapshotOperation.TAKE).iterator();
  assertEquals("Highest was not 1st.",highestStrategy,iter.next());
  assertEquals("Plugin was not 2nd.",pluginStrategy,iter.next());
  assertEquals("Hypervisor was not 3rd.",hyperStrategy,iter.next());
  assertEquals("Default was not 4th.",defaultStrategy,iter.next());
  assertTrue("Can't Handle was not 5th.",!iter.hasNext());
}
