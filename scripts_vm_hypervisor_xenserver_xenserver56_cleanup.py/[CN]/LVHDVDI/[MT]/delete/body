def delete(self):
    if (len(self.children) > 0):
        raise util.SMException(("VDI %s has children, can't delete" % self.uuid))
    self.sr.lock()
    try:
        self.sr.lvmCache.remove(self.lvName)
    finally:
        self.sr.unlock()
    RefCounter.reset(self.uuid, (lvhdutil.NS_PREFIX_LVM + self.sr.uuid))
    self.sr.xapi.forgetVDI(self.uuid)
    VDI.delete(self)
