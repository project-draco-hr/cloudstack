{
  Transaction txn=Transaction.currentTxn();
  Connection conn=null;
  try {
    s_logger.debug("Checking to see if the database is at a version before it was the version table is created");
    conn=txn.getConnection();
    PreparedStatement pstmt=conn.prepareStatement("SHOW TABLES LIKE 'VERSION'");
    ResultSet rs=pstmt.executeQuery();
    if (!rs.next()) {
      pstmt.close();
      rs.close();
      pstmt=conn.prepareStatement("SHOW TABLES LIKE 'NICS'");
      rs=pstmt.executeQuery();
      if (!rs.next()) {
        pstmt.close();
        rs.close();
        s_logger.debug("No version table and no nics table, returning 2.1.7");
        return "2.1.7";
      }
 else {
        pstmt.close();
        rs.close();
        s_logger.debug("No version table but has nics table, returning 2.1.2");
        return "2.2.1";
      }
    }
  }
 catch (  SQLException e) {
    throw new CloudRuntimeException("Unable to get the current version",e);
  }
  SearchCriteria<String> sc=CurrentVersionSearch.create();
  sc.setParameters("step",Step.Complete);
  Filter filter=new Filter(VersionVO.class,"updated",true,0l,1l);
  List<String> vers=customSearch(sc,filter);
  return vers.get(0);
}
