{
  return Transaction.executeWithException(new TransactionCallbackWithException<PublicIp>(){
    @Override public PublicIp doInTransaction(    TransactionStatus status) throws Exception {
      Network frontEndNetwork=_networkModel.getNetwork(guestNetworkId);
      PublicIp ip=_ipAddrMgr.assignPublicIpAddress(frontEndNetwork.getDataCenterId(),null,account,VlanType.DirectAttached,frontEndNetwork.getId(),null,true);
      IPAddressVO ipvo=_ipAddressDao.findById(ip.getId());
      ipvo.setAssociatedWithNetworkId(frontEndNetwork.getId());
      _ipAddressDao.update(ipvo.getId(),ipvo);
      s_logger.info("Acquired frontend IP for ELB " + ip);
      return ip;
    }
  }
,InsufficientAddressCapacityException.class);
}
