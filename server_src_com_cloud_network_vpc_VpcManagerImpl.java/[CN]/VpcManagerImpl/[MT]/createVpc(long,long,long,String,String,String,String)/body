{
  Account caller=UserContext.current().getCaller();
  Account owner=_accountMgr.getAccount(vpcOwnerId);
  _accountMgr.checkAccess(caller,null,false,owner);
  VpcOfferingVO vpcOff=_vpcOffDao.findById(vpcOffId);
  if (vpcOff == null) {
    InvalidParameterValueException ex=new InvalidParameterValueException("Unable to find vpc offering by specified id");
    ex.addProxyObject("vpc_offerings",vpcOffId,"vpcOfferingId");
    throw ex;
  }
  DataCenter zone=_configMgr.getZone(zoneId);
  if (Grouping.AllocationState.Disabled == zone.getAllocationState() && !_accountMgr.isRootAdmin(caller.getType())) {
    PermissionDeniedException ex=new PermissionDeniedException("Cannot perform this operation since specified Zone is currently disabled");
    ex.addProxyObject("data_center",zone.getId(),"zoneId");
    throw ex;
  }
  if (networkDomain == null) {
    networkDomain=_ntwkMgr.getAccountNetworkDomain(owner.getId(),zoneId);
    if (networkDomain == null) {
      networkDomain="cs" + Long.toHexString(owner.getId()) + _ntwkMgr.getDefaultNetworkDomain();
    }
  }
  return createVpc(zoneId,vpcOffId,owner,vpcName,displayText,cidr,networkDomain);
}
