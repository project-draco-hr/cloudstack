{
  UserContext ctx=UserContext.current();
  int networksCount=_ntwkDao.getNetworkCountByVpcId(vpc.getId());
  if (networksCount > 0) {
    throw new InvalidParameterValueException("Can't delete VPC " + vpc + " as its used by "+ networksCount+ " networks");
  }
  s_logger.debug("Updating VPC " + vpc + " with state "+ Vpc.State.Inactive+ " as a part of vpc delete");
  VpcVO vpcVO=_vpcDao.findById(vpc.getId());
  vpcVO.setState(Vpc.State.Inactive);
  _vpcDao.update(vpc.getId(),vpcVO);
  if (!shutdownVpc(vpc.getId())) {
    s_logger.warn("Failed to shutdown vpc " + vpc + " as a part of vpc destroy process");
    return false;
  }
  if (!cleanupVpcResources(vpc.getId(),ctx.getCaller(),ctx.getCallerUserId())) {
    s_logger.warn("Failed to cleanup resources for vpc " + vpc);
    return false;
  }
  if (_vpcDao.remove(vpc.getId())) {
    s_logger.debug("Vpc " + vpc + " is removed succesfully");
    return true;
  }
 else {
    return false;
  }
}
