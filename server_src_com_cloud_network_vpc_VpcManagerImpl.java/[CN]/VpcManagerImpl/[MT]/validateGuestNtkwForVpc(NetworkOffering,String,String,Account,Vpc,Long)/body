{
  if (networkId == null) {
    validateNewVpcGuestNetwork(cidr,networkOwner,vpc,networkDomain);
  }
  if (!(guestNtwkOff.getGuestType() == GuestType.Isolated && _ntwkMgr.areServicesSupportedByNetworkOffering(guestNtwkOff.getId(),Service.SourceNat))) {
    throw new InvalidParameterValueException("Only networks of type " + GuestType.Isolated + " with service "+ Service.SourceNat+ " can be added as a part of VPC");
  }
  if (guestNtwkOff.getRedundantRouter()) {
    throw new InvalidParameterValueException("No redunant router support when network belnogs to VPC");
  }
  if (guestNtwkOff.isConserveMode()) {
    throw new InvalidParameterValueException("Only networks with conserve mode Off can belong to VPC");
  }
  List<NetworkOfferingServiceMapVO> networkProviders=_ntwkOffServiceDao.listByNetworkOfferingId(guestNtwkOff.getId());
  for (  NetworkOfferingServiceMapVO nSvcVO : networkProviders) {
    String pr=nSvcVO.getProvider();
    String service=nSvcVO.getService();
    if (_vpcOffServiceDao.findByServiceProviderAndOfferingId(service,pr,vpc.getVpcOfferingId()) == null) {
      throw new InvalidParameterValueException("Service/provider combination " + service + "/"+ pr+ " is not supported by VPC "+ vpc);
    }
  }
  if (_ntwkMgr.areServicesSupportedByNetworkOffering(guestNtwkOff.getId(),Service.Lb)) {
    List<? extends Network> networks=getVpcNetworks(vpc.getId());
    for (    Network network : networks) {
      if (networkId != null && network.getId() == networkId.longValue()) {
        continue;
      }
 else {
        if (_ntwkMgr.areServicesSupportedInNetwork(network.getId(),Service.Lb)) {
          throw new InvalidParameterValueException("LB service is already supported " + "by network " + network + " in VPC "+ vpc);
        }
      }
    }
  }
}
