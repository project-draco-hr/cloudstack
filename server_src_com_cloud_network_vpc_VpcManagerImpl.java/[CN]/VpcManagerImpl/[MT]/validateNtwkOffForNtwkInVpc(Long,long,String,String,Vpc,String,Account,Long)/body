{
  NetworkOffering guestNtwkOff=_configMgr.getNetworkOffering(newNtwkOffId);
  if (guestNtwkOff == null) {
    throw new InvalidParameterValueException("Can't find network offering by id specified");
  }
  if (networkId == null) {
    validateNewVpcGuestNetwork(newCidr,gateway,networkOwner,vpc,newNetworkDomain);
  }
  List<Service> svcs=_ntwkModel.listNetworkOfferingServices(guestNtwkOff.getId());
  validateNtwkOffForVpc(guestNtwkOff,svcs);
  List<NetworkOfferingServiceMapVO> networkProviders=_ntwkOffServiceDao.listByNetworkOfferingId(guestNtwkOff.getId());
  for (  NetworkOfferingServiceMapVO nSvcVO : networkProviders) {
    String pr=nSvcVO.getProvider();
    String service=nSvcVO.getService();
    if (_vpcOffServiceDao.findByServiceProviderAndOfferingId(service,pr,vpc.getVpcOfferingId()) == null) {
      throw new InvalidParameterValueException("Service/provider combination " + service + "/"+ pr+ " is not supported by VPC "+ vpc);
    }
  }
  if (_ntwkModel.areServicesSupportedByNetworkOffering(guestNtwkOff.getId(),Service.Lb) && guestNtwkOff.getPublicLb()) {
    List<? extends Network> networks=getVpcNetworks(vpc.getId());
    for (    Network network : networks) {
      if (networkId != null && network.getId() == networkId.longValue()) {
        continue;
      }
 else {
        NetworkOffering otherOff=_configMgr.getNetworkOffering(network.getNetworkOfferingId());
        if (_ntwkModel.areServicesSupportedInNetwork(network.getId(),Service.Lb) && otherOff.getPublicLb()) {
          throw new InvalidParameterValueException("Public LB service is already supported " + "by network " + network + " in VPC "+ vpc);
        }
      }
    }
  }
  if (aclId != null && (!_ntwkModel.areServicesSupportedByNetworkOffering(guestNtwkOff.getId(),Service.NetworkACL))) {
    throw new InvalidParameterValueException("Cannot apply NetworkACL. Network Offering does not support NetworkACL service");
  }
}
