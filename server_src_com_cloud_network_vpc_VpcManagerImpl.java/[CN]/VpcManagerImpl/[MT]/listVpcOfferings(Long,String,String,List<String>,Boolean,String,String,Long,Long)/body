{
  Filter searchFilter=new Filter(VpcOfferingVO.class,"created",false,startIndex,pageSizeVal);
  SearchCriteria<VpcOfferingVO> sc=_vpcOffDao.createSearchCriteria();
  if (keyword != null) {
    SearchCriteria<VpcOfferingVO> ssc=_vpcOffDao.createSearchCriteria();
    ssc.addOr("displayText",SearchCriteria.Op.LIKE,"%" + keyword + "%");
    ssc.addOr("name",SearchCriteria.Op.LIKE,"%" + keyword + "%");
    sc.addAnd("name",SearchCriteria.Op.SC,ssc);
  }
  if (name != null) {
    sc.addAnd("name",SearchCriteria.Op.LIKE,"%" + name + "%");
  }
  if (displayText != null) {
    sc.addAnd("displayText",SearchCriteria.Op.LIKE,"%" + displayText + "%");
  }
  if (isDefault != null) {
    sc.addAnd("isDefault",SearchCriteria.Op.EQ,isDefault);
  }
  if (state != null) {
    sc.addAnd("state",SearchCriteria.Op.EQ,state);
  }
  if (id != null) {
    sc.addAnd("id",SearchCriteria.Op.EQ,id);
  }
  List<VpcOfferingVO> offerings=_vpcOffDao.search(sc,searchFilter);
  boolean listBySupportedServices=(supportedServicesStr != null && !supportedServicesStr.isEmpty() && !offerings.isEmpty());
  if (listBySupportedServices) {
    List<VpcOfferingVO> supportedOfferings=new ArrayList<VpcOfferingVO>();
    Service[] supportedServices=null;
    if (listBySupportedServices) {
      supportedServices=new Service[supportedServicesStr.size()];
      int i=0;
      for (      String supportedServiceStr : supportedServicesStr) {
        Service service=Service.getService(supportedServiceStr);
        if (service == null) {
          throw new InvalidParameterValueException("Invalid service specified " + supportedServiceStr);
        }
 else {
          supportedServices[i]=service;
        }
        i++;
      }
    }
    for (    VpcOfferingVO offering : offerings) {
      if (areServicesSupportedByVpcOffering(offering.getId(),supportedServices)) {
        supportedOfferings.add(offering);
      }
    }
    return supportedOfferings;
  }
 else {
    return offerings;
  }
}
