{
  boolean providerEnabled=false;
  for (  PhysicalNetwork pNtwk : _pNtwkDao.listByZone(zoneId)) {
    if (_ntwkMgr.isProviderEnabledInPhysicalNetwork(pNtwk.getId(),Provider.VPCVirtualRouter.getName())) {
      providerEnabled=true;
      break;
    }
  }
  if (!providerEnabled) {
    throw new InvalidParameterValueException("Provider " + Provider.VPCVirtualRouter.getName() + " should be enabled in at least one physical network of the zone specified");
  }
  if (!NetUtils.isValidCIDR(cidr)) {
    throw new InvalidParameterValueException("Invalid CIDR specified " + cidr);
  }
  if (!NetUtils.verifyDomainName(networkDomain)) {
    throw new InvalidParameterValueException("Invalid network domain. Total length shouldn't exceed 190 chars. Each domain " + "label must be between 1 and 63 characters long, can contain ASCII letters 'a' through 'z', " + "the digits '0' through '9', "+ "and the hyphen ('-'); can't start or end with \"-\"");
  }
  VpcVO vpc=new VpcVO(zoneId,vpcName,displayText,vpcOwner.getId(),vpcOwner.getDomainId(),vpcOffId,cidr,networkDomain);
  vpc=_vpcDao.persist(vpc);
  if (vpc != null) {
    s_logger.debug("Created VPC " + vpc);
  }
 else {
    s_logger.debug("Failed to create VPC");
  }
  return vpc;
}
