{
  Vpc vpc=getActiveVpc(vpcId);
  if (vpc == null) {
    InvalidParameterValueException ex=new InvalidParameterValueException("Unable to find Enabled VPC ");
    ex.addProxyObject("vpc",vpcId,"VPC");
    throw ex;
  }
  _accountMgr.checkAccess(caller,null,false,vpc);
  if (networkDomain == null) {
    networkDomain=vpc.getNetworkDomain();
  }
  if (vpc.getZoneId() != zoneId) {
    throw new InvalidParameterValueException("New network doesn't belong to vpc zone");
  }
  validateNtkwOffForVpc(ntwkOffId,cidr,networkDomain,owner,vpc,null,gateway);
  Network guestNetwork=_ntwkMgr.createGuestNetwork(ntwkOffId,name,displayText,gateway,cidr,vlanId,networkDomain,owner,domainId,pNtwk,zoneId,aclType,subdomainAccess,vpcId,null,null);
  return guestNetwork;
}
