{
  CallContext ctx=CallContext.current();
  Account caller=ctx.getCallingAccount();
  Vpc vpc=_vpcDao.findById(vpcId);
  if (vpc == null) {
    throw new InvalidParameterValueException("Unable to find vpc by id " + vpcId);
  }
  _accountMgr.checkAccess(caller,null,false,vpc);
  s_logger.debug("Shutting down vpc " + vpc);
  boolean success=true;
  List<Provider> providersToImplement=getVpcProviders(vpc.getId());
  ReservationContext context=new ReservationContextImpl(null,null,_accountMgr.getActiveUser(ctx.getCallingUserId()),caller);
  for (  VpcProvider element : getVpcElements()) {
    if (providersToImplement.contains(element.getProvider())) {
      if (element.shutdownVpc(vpc,context)) {
        s_logger.debug("Vpc " + vpc + " has been shutdown succesfully");
      }
 else {
        s_logger.warn("Vpc " + vpc + " failed to shutdown");
        success=false;
      }
    }
  }
  return success;
}
