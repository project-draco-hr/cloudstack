{
  try {
    GlobalLock lock=GlobalLock.getInternLock("VpcCleanup");
    if (lock == null) {
      s_logger.debug("Couldn't get the global lock");
      return;
    }
    if (!lock.lock(30)) {
      s_logger.debug("Couldn't lock the db");
      return;
    }
    try {
      Transaction.executeWithException(new TransactionCallbackWithException<Object>(){
        @Override public Object doInTransaction(        TransactionStatus status) throws Exception {
          List<VpcVO> inactiveVpcs=_vpcDao.listInactiveVpcs();
          s_logger.info("Found " + inactiveVpcs.size() + " removed VPCs to cleanup");
          for (          VpcVO vpc : inactiveVpcs) {
            s_logger.debug("Cleaning up " + vpc);
            destroyVpc(vpc,_accountMgr.getAccount(Account.ACCOUNT_ID_SYSTEM),User.UID_SYSTEM);
          }
          return null;
        }
      }
,Exception.class);
    }
 catch (    Exception e) {
      s_logger.error("Exception ",e);
    }
 finally {
      lock.unlock();
    }
  }
 catch (  Exception e) {
    s_logger.error("Exception ",e);
  }
}
